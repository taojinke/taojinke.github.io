
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="baidu-site-verification" content="1XvvwQ7Apt" />
  
    <title>dianzi blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="edwin">
    

    
    <meta name="description" content="edwin jin dianzi blog">
<meta property="og:type" content="website">
<meta property="og:title" content="dianzi blog">
<meta property="og:url" content="http://taojinke.github.io/page/18/index.html">
<meta property="og:site_name" content="dianzi blog">
<meta property="og:description" content="edwin jin dianzi blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dianzi blog">
<meta name="twitter:description" content="edwin jin dianzi blog">

    
    <link rel="alternative" href="/atom.xml" title="dianzi blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?345f95aea4ada2935d6f9ea4177b51ab";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="dianzi blog" title="dianzi blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="dianzi blog">dianzi blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
						<a href="/music/index.html" target="_blank">Music</a>
					</li>
					<li>
 					
						<form class="search" action="http://taojinke.github.io/" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fe00ab/" title="memcached 1.4.23发布,集中式缓存系统 -" itemprop="url">memcached 1.4.23发布,集中式缓存系统 -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p> memcached 1.4.23 &#x53D1;&#x5E03;&#xFF0C;&#x6B64;&#x7248;&#x672C;&#x73B0;&#x5DF2;&#x63D0;&#x4F9B;&#x4E0B;&#x8F7D;&#xFF1A; <a href="http://www.memcached.org/files/memcached-1.4.23.tar.gz" target="_blank" rel="external">http://www.memcached.org/files/memcached-1.4.23.tar.gz</a> &#x3002; </p>
<p>&#x6B64;&#x7248;&#x672C;&#x66F4;&#x65B0;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<h3 id="Bug_&#x4FEE;&#x590D;">Bug &#x4FEE;&#x590D;</h3><ul>
<li>spinlocks removed since they never seem to improve performance.</li>
<li>flush_all was not thread safe.</li>
<li>better handle items refcounted in tail by unlinking them from the LRU&apos;s</li>
</ul>
<h3 id="&#x65B0;&#x7279;&#x6027;">&#x65B0;&#x7279;&#x6027;</h3><p>&#x91CD;&#x5199;&#x4E86; memcached &#x7684;&#x6838;&#x5FC3; LRU &#x7B97;&#x6CD5;&#xFF1A;</p>
<ul>
<li>global cache_lock is gone, LRU&apos;s are now independently locked.</li>
<li>LRU&apos;s are now split between HOT, WARM, and COLD LRU&apos;s. New items enter the HOT LRU.</li>
<li>LRU updates only happen as items reach the bottom of an LRU. If active in HOT, stay in HOT, if active in WARM, stay in WARM. If active in COLD, move to WARM.</li>
<li>HOT/WARM each capped at 32% of memory available for that slab class. COLD is uncapped.</li>
<li>Items flow from HOT/WARM into COLD.</li>
<li>A background thread exists which shuffles items between/within the LRU&apos;s as capacities are reached.</li>
</ul>
<p>&#x4E3B;&#x8981;&#x76EE;&#x6807;&#x662F;&#x4FDD;&#x62A4;&#x201C;scanning&#x201D;&#x7684; active items&#xFF0C;&#x5176;&#x6B21;&#x662F;&#x4E3A;&#x4E86;&#x6539;&#x8FDB;&#x5EF6;&#x8FDF;&#x3002;</p>
<p>&#x66F4;&#x591A;&#x6539;&#x8FDB;&#x5185;&#x5BB9;&#x8BF7;&#x770B; <a href="https://code.google.com/p/memcached/wiki/ReleaseNotes1423" target="_blank" rel="external">&#x53D1;&#x884C;&#x8BF4;&#x660E;</a> &#x3002; </p>
<p>memcached&#x662F;&#x4E00;&#x5957;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x5FEB;&#x53D6;&#x7CFB;&#x7EDF;&#xFF0C;&#x5F53;&#x521D;&#x662F;Danga Interactive&#x4E3A;&#x4E86;LiveJournal&#x6240;&#x53D1;&#x5C55;&#x7684;&#xFF0C;&#x4F46;&#x76EE;&#x524D;&#x88AB;&#x8BB8;&#x591A;&#x8F6F;&#x4EF6;&#xFF08;&#x5982;MediaWiki&#xFF09;&#x6240;&#x4F7F;&#x7528;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x5957;&#x5F00;&#x653E;&#x6E90;&#x4EE3;&#x7801;&#x8F6F;&#x4EF6;&#xFF0C;&#x4EE5;BSD license&#x6388;&#x6743;&#x91CA;&#x51FA;&#x3002; </p>
<p>memcached&#x7F3A;&#x4E4F;&#x8BA4;&#x8BC1;&#x4EE5;&#x53CA;&#x5B89;&#x5168;&#x7BA1;&#x5236;&#xFF0C;&#x8FD9;&#x4EE3;&#x8868;&#x5E94;&#x8BE5;&#x5C06;memcached&#x670D;&#x52A1;&#x5668;&#x653E;&#x7F6E;&#x5728;&#x9632;&#x706B;&#x5899;&#x540E;&#x3002;</p>
<p>memcached &#x7684;API&#x4F7F;&#x7528;&#x4E09;&#x5341;&#x4E8C;&#x4F4D;&#x5143;&#x7684;&#x5FAA;&#x73AF;&#x5197;&#x4F59;&#x6821;&#x9A8C;&#xFF08;CRC-32&#xFF09;&#x8BA1;&#x7B97;&#x952E;&#x503C;&#x540E;&#xFF0C;&#x5C06;&#x8D44;&#x6599;&#x5206;&#x6563;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x3002;&#x5F53;&#x8868;&#x683C;&#x6EE1;&#x4E86;&#x4EE5;&#x540E;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x65B0;&#x589E;&#x7684;&#x8D44;&#x6599;&#x4F1A;&#x4EE5;LRU&#x673A;&#x5236;&#x66FF;&#x6362;&#x6389;&#x3002; &#x7531;&#x4E8E;memcached&#x901A;&#x5E38;&#x53EA;&#x662F;&#x5F53;&#x4F5C;&#x5FEB;&#x53D6;&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;memcached&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5F0F;&#x5728;&#x5199;&#x56DE;&#x8F83;&#x6162;&#x7684;&#x7CFB;&#x7EDF;&#x65F6;&#xFF08;&#x50CF;&#x662F;&#x540E;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF09;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x7A0B;&#x5F0F;&#x7801;&#x66F4;&#x65B0; memcached&#x5185;&#x7684;&#x8D44;&#x6599;&#x3002;</p>
<p>memcached&#x5177;&#x6709;&#x591A;&#x79CD;&#x8BED;&#x8A00;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x53D1;&#x5305;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;Perl/PHP/JAVA/C/Python/Ruby/C#/MySQL/</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x5305;&#x7684;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x662F;&#xFF1A; <a href="http://code.google.com/p/memcached/wiki/Clients" target="_blank" rel="external">http://code.google.com/p/memcached/wiki/Clients</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Memcached/">Memcached</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fd164b/" title="分布式系统中异步处理的优化 -" itemprop="url">分布式系统中异步处理的优化 -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="&#x5355;&#x673A;&#x65F6;&#x4EE3;&#x7684;&#x6570;&#x636E;&#x8BF7;&#x6C42;_&#x5341;&#x4E94;&#x5E74;&#x524D;&#x5199;&#x8F6F;&#x4EF6;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x4E00;&#x4E2A;Client&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;DB_Server&#xFF0C;&#x6216;&#x8005;&#x591A;&#x4E2A;Client&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;DB_Server&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;Client&#x6267;&#x884C;&#x5404;&#x81EA;&#x7684;&#x670D;&#x52A1;&#x3002;&#x5F53;&#x65F6;&#x7684;&#x8BA8;&#x8BBA;&#x5F88;&#x591A;&#x662F;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x8981;&#x5199;&#x5728;Client&#x7AEF;&#x8FD8;&#x662F;&#x5199;&#x5728;DB_Server&#x7AEF;&#xFF0C;&#x6D41;&#x884C;&#x7684;&#x601D;&#x8DEF;&#x6709;&#x4E24;&#x79CD;&#xFF1A;"><strong>&#x5355;&#x673A;&#x65F6;&#x4EE3;&#x7684;&#x6570;&#x636E;&#x8BF7;&#x6C42;</strong> &#x5341;&#x4E94;&#x5E74;&#x524D;&#x5199;&#x8F6F;&#x4EF6;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x4E00;&#x4E2A;Client&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;DB Server&#xFF0C;&#x6216;&#x8005;&#x591A;&#x4E2A;Client&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;DB Server&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;Client&#x6267;&#x884C;&#x5404;&#x81EA;&#x7684;&#x670D;&#x52A1;&#x3002;&#x5F53;&#x65F6;&#x7684;&#x8BA8;&#x8BBA;&#x5F88;&#x591A;&#x662F;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x8981;&#x5199;&#x5728;Client&#x7AEF;&#x8FD8;&#x662F;&#x5199;&#x5728;DB Server&#x7AEF;&#xFF0C;&#x6D41;&#x884C;&#x7684;&#x601D;&#x8DEF;&#x6709;&#x4E24;&#x79CD;&#xFF1A;</h3><p>&#x628A;DB Server&#x5199;&#x5F97;&#x5F88;&#x590D;&#x6742;&#xFF0C;&#x6BD4;&#x5982;Oracle&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x800C;Client&#x7AEF;&#x5219;&#x5199;&#x5F97;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x6709;&#x8C03;&#x7528;&#x8FD4;&#x56DE;DB&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x6709;&#x7B80;&#x5355;&#x7684;&#x8868;&#xFF0C;&#x800C;Client&#x5199;&#x5F97;&#x590D;&#x6742;&#x3002;&#x5F88;&#x591A;&#x521B;&#x4E1A;&#x516C;&#x53F8;&#x4F1A;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x5BF9;SQL&#x4E0D;&#x662F;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x719F;&#x6089;PHP&#x3002;&#x65E9;&#x671F;Facebook&#x5C31;&#x662F;&#x5178;&#x578B;&#x7684;&#x4EE3;&#x8868; </p>
<h3 id="&#x5927;&#x6570;&#x636E;&#x65F6;&#x4EE3;&#x7684;&#x6570;&#x636E;&#x8BF7;&#x6C42;_&#x5355;&#x673A;&#x65F6;&#x4EE3;&#x968F;&#x7740;&#x4E24;&#x4E2A;&#x8D8B;&#x52BF;&#x800C;&#x9010;&#x6E10;&#x6210;&#x4E3A;&#x5386;&#x53F2;&#x3002;&#x4E00;&#x4E2A;&#x8D8B;&#x52BF;&#x662F;&#x968F;&#x7740;&#x4E92;&#x8054;&#x7F51;&#x7684;&#x6D41;&#x884C;&#xFF0C;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x4EBA;&#x5F00;&#x59CB;&#x4E0A;&#x7F51;&#x4F7F;&#x7528;Web&#x670D;&#x52A1;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x7528;&#x6237;&#x589E;&#x957F;&#x901F;&#x5EA6;&#x662F;&#x975E;&#x5E38;&#x5FEB;&#x7684;&#xFF0C;&#x7ED3;&#x679C;&#x9020;&#x6210;&#x4E00;&#x53F0;DB_Server&#x65E0;&#x6CD5;&#x50A8;&#x5B58;&#x4E0B;&#x6240;&#x6709;&#x7528;&#x6237;&#x7684;&#x6570;&#x636E;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x8D8B;&#x52BF;&#x662F;&#x8BA1;&#x7B97;&#x673A;&#x80FD;&#x529B;&#x8D8A;&#x6765;&#x8D8A;&#x5F3A;&#xFF0C;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x9488;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x4E5F;&#x53D8;&#x591A;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;Facebook&#x4E0D;&#x4EC5;&#x8981;&#x4FDD;&#x5B58;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#xFF0C;&#x8FD8;&#x6709;&#x4ED6;&#x7684;&#x5173;&#x7CFB;&#x94FE;&#x4FE1;&#x606F;&#xFF0C;&#x4ED6;&#x7684;&#x4F7F;&#x7528;&#x4E60;&#x60EF;&#x3001;&#x70B9;&#x51FB;&#x4E60;&#x60EF;&#x7B49;&#xFF0C;&#x5C31;&#x9020;&#x6210;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#xFFFD;&#xFFFD;&#xFFFD;&#x6570;&#x636E;&#x91CF;&#x4E5F;&#x5927;&#x5927;&#x589E;&#x52A0;&#xFF0C;&#x4EC5;&#x4EC5;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;DB_Server&#x5C31;&#x51C6;&#x5907;&#x597D;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x53D8;&#x6210;&#x4E86;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#x4E8B;&#x60C5;&#x3002;">&#x5927;&#x6570;&#x636E;&#x65F6;&#x4EE3;&#x7684;&#x6570;&#x636E;&#x8BF7;&#x6C42; &#x5355;&#x673A;&#x65F6;&#x4EE3;&#x968F;&#x7740;&#x4E24;&#x4E2A;&#x8D8B;&#x52BF;&#x800C;&#x9010;&#x6E10;&#x6210;&#x4E3A;&#x5386;&#x53F2;&#x3002;&#x4E00;&#x4E2A;&#x8D8B;&#x52BF;&#x662F;&#x968F;&#x7740;&#x4E92;&#x8054;&#x7F51;&#x7684;&#x6D41;&#x884C;&#xFF0C;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x4EBA;&#x5F00;&#x59CB;&#x4E0A;&#x7F51;&#x4F7F;&#x7528;Web&#x670D;&#x52A1;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x7528;&#x6237;&#x589E;&#x957F;&#x901F;&#x5EA6;&#x662F;&#x975E;&#x5E38;&#x5FEB;&#x7684;&#xFF0C;&#x7ED3;&#x679C;&#x9020;&#x6210;&#x4E00;&#x53F0;DB Server&#x65E0;&#x6CD5;&#x50A8;&#x5B58;&#x4E0B;&#x6240;&#x6709;&#x7528;&#x6237;&#x7684;&#x6570;&#x636E;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x8D8B;&#x52BF;&#x662F;&#x8BA1;&#x7B97;&#x673A;&#x80FD;&#x529B;&#x8D8A;&#x6765;&#x8D8A;&#x5F3A;&#xFF0C;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x9488;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x4E5F;&#x53D8;&#x591A;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;Facebook&#x4E0D;&#x4EC5;&#x8981;&#x4FDD;&#x5B58;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#xFF0C;&#x8FD8;&#x6709;&#x4ED6;&#x7684;&#x5173;&#x7CFB;&#x94FE;&#x4FE1;&#x606F;&#xFF0C;&#x4ED6;&#x7684;&#x4F7F;&#x7528;&#x4E60;&#x60EF;&#x3001;&#x70B9;&#x51FB;&#x4E60;&#x60EF;&#x7B49;&#xFF0C;&#x5C31;&#x9020;&#x6210;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#xFFFD;&#xFFFD;&#xFFFD;&#x6570;&#x636E;&#x91CF;&#x4E5F;&#x5927;&#x5927;&#x589E;&#x52A0;&#xFF0C;&#x4EC5;&#x4EC5;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;DB Server&#x5C31;&#x51C6;&#x5907;&#x597D;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x53D8;&#x6210;&#x4E86;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#x4E8B;&#x60C5;&#x3002;</h3><p>&#x8FD9;&#x5C31;&#x5E26;&#x6765;&#x4E86;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x9488;&#x5BF9;&#x591A;&#x4E2A;DB Server&#x7684;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x5199;&#xFF1F;</p>
<h4 id="&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E5F;&#x6709;&#x4E24;&#x4E2A;&#x601D;&#x8DEF;&#xFF1A;">&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E5F;&#x6709;&#x4E24;&#x4E2A;&#x601D;&#x8DEF;&#xFF1A;</h4><p>&#x4E32;&#x884C;&#x540C;&#x6B65;&#x3002;&#x5148;query DB1&#xFF0C;&#x8FD4;&#x56DE;res1&#xFF0C;&#x518D;&#x4F7F;&#x7528;res1&#x505A;&#x53E6;&#x4E00;&#x4E2A;DB&#x7684;query&#xFF0C;&#x8FD4;&#x56DE;res2&#x3002;&#x8FD9;&#x662F;&#x5728;&#x7B2C;&#x4E8C;&#x4E2A;Query&#x4F9D;&#x8D56;&#x7B2C;&#x4E00;&#x4E2A;Query&#x7ED3;&#x679C;&#x7684;&#x60C5;&#x51B5;</p>
<p>&#x5E76;&#x884C;&#x540C;&#x6B65;&#x3002;&#x9488;&#x5BF9;DB1&#x7684;query&#x8DDF;&#x9488;&#x5BF9;DB2&#x7684;query&#x540C;&#x6B65;&#x8FDB;&#x884C;&#x3002;&#x8FD9;&#x662F;&#x4E24;&#x4E2A;Query&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#x60C5;&#x51B5;&#x3002;Facebook&#x65E9;&#x671F;&#x4E13;&#x95E8;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x5E76;&#x884C;&#x5904;&#x7406;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x6CD5;&#x662F; ExecParallelQuery(conn1,Query1,conn2,Query2)</p>
<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x6BD4;&#x4EE5;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x4E86;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD8;&#x662F;&#x80FD;&#x5B9E;&#x73B0;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x9700;&#x6C42;&#x3002;&#x4F46;&#x8FD9;&#x65F6;&#x5019;&#x5E26;&#x6765;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x7B49;&#x5F85;&#x3002;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x7684;&#x52A0;&#x8F7D;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8C03;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x540C;&#x7684;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E0D;&#x540C;&#x7684;&#x56E2;&#x961F;&#x5199;&#x7684;&#x3002;&#x6BD4;&#x5982;&#x83B7;&#x53D6;&#x670B;&#x53CB;&#x5173;&#x7CFB;&#x7684;&#x51FD;&#x6570;getFriends&#x628A;&#x81EA;&#x5DF1;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x7528;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x83B7;&#x53D6;&#x4E86;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7B2C;&#x4E09;&#x65B9;&#x5F00;&#x53D1;&#x8005;&#x8FC7;&#x6765;&#xFF0C;&#x5219;&#x4E0D;&#x4EC5;&#x8981;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8C03;&#x7528;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x5C31;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x524D;&#x9762;&#x8FD9;&#x4E2A;getFriends&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E86;&#x7ED3;&#x679C;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x5F00;&#x59CB;&#x6267;&#x884C;&#xFF0C;&#x5C31;&#x5F88;&#x6162;&#x4E86;&#x3002;</p>
<p>&#x8981;&#x5982;&#x4F55;&#x505A;&#x5230;&#x5E76;&#x884C;&#x5904;&#x7406;&#x5728;&#x4EE3;&#x7801;&#x5C42;&#x9762;&#x5F88;&#x76F4;&#x89C2;&#xFF0C;&#x5728;&#x673A;&#x5668;&#x4E0A;&#x7684;&#x6267;&#x884C;&#x6548;&#x7387;&#x53C8;&#x597D;&#x5462;&#xFF1F;</p>
<p>&#x5F02;&#x6B65;&#x7684;&#x5904;&#x7406;&#x601D;&#x8DEF;&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x6765;&#x7684;&#x3002;</p>
<p>&#x6240;&#x8C13;&#x5F02;&#x6B65;&#x5C31;&#x662F;&#xFF0C;&#x6211;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x77E5;&#x9053;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x54EA;&#x51E0;&#x4E2A;DB Server&#xFF0C;&#x4F46;&#x6211;&#x5148;&#x4E0D;&#x7740;&#x6025;&#x53BB;&#x8BBF;&#x95EE;&#xFF0C;&#x800C;&#x662F;&#x5148;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#xFF0C;&#x7B49;&#x7B49;&#x770B;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x662F;&#x4E0D;&#x662F;&#x4E5F;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;DB&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x5F85;&#x4F1A;&#x513F;&#x518D;&#x4E00;&#x8D77;&#x53BB;&#x8BBF;&#x95EE;&#x3002;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7684;&#x6307;&#x4EE4;&#x6BD4;&#x5982;&#x8BF4;&#x662F; conn.asyncExec(Query) &#xFF0C;&#x8FD9;&#x4E2A;&#x53EF;&#x4EE5;&#x7ACB;&#x523B;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;Future&#x5BF9;&#x8C61;&#xFF0C;&#x610F;&#x601D;&#x5C31;&#x662F;&#x201C;&#x5F85;&#x4F1A;&#x513F;&#x518D;&#x53BB;&#x6267;&#x884C;&#x201D;&#x3002;&#x5982;&#x679C;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x8FD4;&#x56DE;&#x8FD9;&#x79CD;Future&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x4E9B;Future&#x5BF9;&#x8C61;&#x6765;&#x5224;&#x65AD;&#x54EA;&#x4E9B;&#x8BF7;&#x6C42;&#x6CA1;&#x6709;&#x4F9D;&#x8D56;&#x53EF;&#x4EE5;&#x5E76;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x54EA;&#x4E9B;&#x8BF7;&#x6C42;&#x6709;&#x4F9D;&#x8D56;&#x9700;&#x8981;&#x4E32;&#x884C;&#x5904;&#x7406;&#x4E86;&#x3002;&#x5982;&#x6B64;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x56E2;&#x961F;&#x5199;&#x51FA;&#x6765;&#x7684;&#x51FD;&#x6570;&#x5C31;&#x4E0D;&#x7528;&#x4E00;&#x4E2A;&#x7B49;&#x4E00;&#x4E2A;&#xFF0C;&#x800C;&#x662F;&#x53EF;&#x4EE5;&#x5728;&#x66F4;&#x9AD8;&#x5C42;&#x9762;&#x4E0A;&#x4E92;&#x76F8;&#x5408;&#x4F5C;&#x3002;</p>
<p>&#x7136;&#x800C;&#x8FD9;&#x53C8;&#x5E26;&#x6765;&#x4E86;&#xFFFD;&#xFFFD;&#xFFFD;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7684;&#x5199;&#x6CD5;&#x662F;&#x5177;&#x6709;&#x4F20;&#x67D3;&#x6027;&#x7684;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#x6709;&#x7684;&#x51FD;&#x6570;&#x5199;&#x7684;&#x5F02;&#x6B65;&#xFF0C;&#x6709;&#x7684;&#x51FD;&#x6570;&#x6CA1;&#x5199;&#x5F02;&#x6B65;&#xFF0C;&#x5C31;&#x4F1A;&#x9020;&#x6210;&#x6709;&#x7684;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E86;Future Object&#xFF0C;&#x6709;&#x7684;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E86;&#x6570;&#x503C;&#xFF0C;&#x5BFC;&#x81F4;&#x65E0;&#x6CD5;&#x6267;&#x884C;&#x3002;&#x8981;&#x5B9E;&#x73B0;&#x5F02;&#x6B65;&#xFF0C;&#x9700;&#x8981;&#x5173;&#x8054;&#x7684;&#x6240;&#x6709;&#x51FD;&#x6570;&#x90FD;&#x7528;&#x5F02;&#x6B65;&#x7684;&#x5199;&#x6CD5;&#x8FD4;&#x56DE;Future Object&#x624D;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x6240;&#x4EE5;Facebook&#x5728;&#x8F6C;&#x5411;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7684;&#x8FC7;&#x7A0B;&#x662F;&#x975E;&#x5E38;&#x75DB;&#x82E6;&#x7684;&#xFF0C;&#x4E00;&#x5F00;&#x59CB;&#x505A;&#x4E86;&#x5C40;&#x90E8;&#x4FEE;&#x6539;&#xFF0C;&#x518D;&#x4FEE;&#x6539;&#x8C03;&#x7528;&#x4E86;&#x5C40;&#x90E8;&#x4FEE;&#x6539;&#x8FC7;&#x7684;&#x51FD;&#x6570;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x6709;&#x8C03;&#x7528;&#x7684;&#x8C03;&#x7528;&#x90FD;&#x8981;&#x4FEE;&#x6539;&#xFF0C;&#x6700;&#x540E;&#x5168;&#x90E8;&#x6539;&#x6210;&#x4E86;&#x5F02;&#x6B65;&#xFF0C;&#x53EA;&#x8981;&#x6709;&#x8C03;&#x7528;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;IO&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x8981;&#x6539;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;DB Query&#x90FD;&#x62C6;&#x5206;&#x6210;&#x4E24;&#x6B65;&#xFF0C;&#x4E00;&#x4E2A;set request&#xFF0C;&#x4E00;&#x4E2A;receive response&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x5DE5;&#x4F5C;&#x91CF;&#x5F88;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x521B;&#x4E1A;&#x56E2;&#x961F;&#x7684;&#x8BDD;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x7B2C;&#x4E00;&#x5929;&#x5C31;&#x7528;&#x6B63;&#x786E;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x8FD9;&#x4E48;&#x75DB;&#x82E6;&#x3002;</p>
<p>&#x6240;&#x6709;&#x51FD;&#x6570;&#x6539;&#x5199;&#x540E;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6267;&#x884C;&#x90FD;&#x4F1A;&#x8FD4;&#x56DE;Future Object&#x3002;&#x90A3;&#x4E48;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x8FD9;&#x4E9B;Future Object&#x5F62;&#x6210;&#x4E00;&#x68F5;&#x4F9D;&#x8D56;&#x6811;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x597D;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<p><a href="http://webphpdo-images.stor.sinaapp.com/uploads/2015/04/future_obj_tree.jpg" target="_blank" rel="external"><img src="http://taojinke.github.io/img/20150703/1fd0052.jpg" alt=""></a></p>
<p>&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7684;&#x4F18;&#x5316; &#x8FD9;&#x91CC;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x4E00;&#x4E2A;Future&#x5BF9;&#x8C61;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;Future&#x5BF9;&#x8C61;&#x6709;&#x4E24;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x7B49;&#x5F85;&#x6267;&#x884C;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x5B8C;&#x6210;&#x6267;&#x884C;&#x3002;&#x540C;&#x7EA7;&#x7684;&#x8282;&#x70B9;&#x662F;&#x6CA1;&#x6709;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5E76;&#x884C;&#x6267;&#x884C;&#xFF1B;&#x4E0A;&#x4E0B;&#x8282;&#x70B9;&#x662F;&#x6709;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x4E32;&#x884C;&#x6267;&#x884C;&#xFF0C;&#x5148;&#x6267;&#x884C;&#x4E0B;&#x5C42;&#x518D;&#x6267;&#x884C;&#x4E0A;&#x5C42;&#x3002;</p>
<p>&#x6811;&#x7ED3;&#x6784;&#x5F62;&#x6210;&#x540E;&#xFF0C;&#x4ECE;&#x4E0B;&#x5230;&#x4E0A;&#x6267;&#x884C;&#xFF0C;&#x76F4;&#x5230;&#x6700;&#x4E0A;&#x9762;&#x7684;top parent&#x8282;&#x70B9;&#x88AB;&#x6267;&#x884C;&#x8FDB;&#x5165;&#x5B8C;&#x6210;&#x6267;&#x884C;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x662F;&#x5B8C;&#x6210;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x4E4B;&#x540E;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x90A3;&#x5C31;&#x662F;PHP&#x8FD9;&#x4E2A;&#x8BED;&#x8A00;&#x5DF2;&#x7ECF;&#x8DDF;&#x4EE5;&#x524D;&#x4E0D;&#x540C;&#x4E86;&#xFF0C;&#x4E0D;&#x518D;&#x662F;&#x4E00;&#x4E0A;&#x6765;&#x5C31;&#x662F;&#x6267;&#x884C;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E0A;&#x6765;&#x5148;lazy&#x4E00;&#x4E0B;&#xFF0C;&#x770B;&#x6E05;&#x695A;&#x6240;&#x6709;&#x7684;Query&#x4E4B;&#x540E;&#x518D;&#x6267;&#x884C;&#x3002;</p>
<h3 id="&#x5F02;&#x6B65;&#x5904;&#x7406;&#x8FD8;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;_&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x4F3C;&#x4E4E;&#x5DF2;&#x7ECF;&#x662F;&#x8DB3;&#x591F;&#x597D;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x6709;&#x95EE;&#x9898;&#x3002;&#x770B;&#x770B;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x3002;">&#x5F02;&#x6B65;&#x5904;&#x7406;&#x8FD8;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898; &#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x4F3C;&#x4E4E;&#x5DF2;&#x7ECF;&#x662F;&#x8DB3;&#x591F;&#x597D;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x6709;&#x95EE;&#x9898;&#x3002;&#x770B;&#x770B;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x3002;</h3><p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6709;&#x4E24;&#x4E2A;&#x67E5;&#x8BE2;&#x9700;&#x6C42;&#x3002;&#x4E00;&#x4E2A;&#x662F;&#x67E5;&#x8BE2;&#x4F60;&#x5728;&#x6DD8;&#x5B9D;&#x4E0A;&#x4E70;&#x8FC7;&#x4E1C;&#x897F;&#x7684;&#x670B;&#x53CB;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x67E5;&#x8BE2;&#x4F60;&#x5728;&#x6DD8;&#x5B9D;&#x4E0A;&#x4E70;&#x8FC7;&#x4FDD;&#x65F6;&#x6377;&#x7684;&#x670B;&#x53CB;&#x3002;&#x5E38;&#x7406;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5148;&#x60F3;&#x5230;&#x67E5;&#x8BE2;&#x4F60;&#x5728;&#x6DD8;&#x5B9D;&#x4E0A;&#x7684;&#x670B;&#x53CB;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x53E6;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x6837;&#xFF1A;</p>
<p>IdList friends = waitFor(getFriends(myId));<br>yield return getTaoBaoBuyers(friends);&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x4FDD;&#x65F6;&#x6377;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x800C;&#x8A00;&#xFF0C;&#x8FD9;&#x662F;&#x4E0D;&#x5BF9;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6DD8;&#x5B9D;&#x4E0A;&#x4E70;&#x4FDD;&#x65F6;&#x6377;&#x7684;&#x4EBA;&#x662F;&#x5F88;&#x5C11;&#x7684;&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x4E00;&#x4E24;&#x4E2A;&#xFF0C;&#x800C;&#x6DD8;&#x5B9D;&#x4E0A;&#x7684;&#x597D;&#x53CB;&#x6570;&#x53EF;&#x80FD;&#x6709;&#x4E0A;&#x767E;&#x3002;&#x56E0;&#x6B64;&#x4FDD;&#x65F6;&#x6377;&#x7684;&#x67E5;&#x8BE2;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x4E2A;&#x6B21;&#x5E8F;&#x6BD4;&#x8F83;&#x4F18;&#x5316;&#xFF1A;</p>
<p>IdList buyers = waitFor(getPorscheBuyer());<br>yield return getFriends(buyers);&#x8FD9;&#x4E2A;&#x6B21;&#x5E8F;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x51B3;&#x5B9A;&#xFF1F;&#x5B9E;&#x9645;&#x4E0A;&#x4E0D;&#x5E94;&#x8BE5;&#x5728;&#x5199;&#x7A0B;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#x51B3;&#x5B9A;&#xFF0C;&#x56E0;&#x4E3A;&#x5199;&#x7A0B;&#x5E8F;&#x7684;&#x65F6;&#x5019;&#x662F;&#x65E0;&#x6CD5;&#x907F;&#x514D;&#x6709;&#x5148;&#x540E;&#x987A;&#x5E8F;&#x7684;&#x2014;&#x2014;&#x7F16;&#x8F91;&#x5668;&#x53EA;&#x80FD;&#x4E00;&#x884C;&#x4E00;&#x884C;&#x7684;&#x5199;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x662F;&#x673A;&#x5668;&#x6267;&#x884C;&#x5374;&#x65E0;&#x9700;&#x7BA1;&#x8FD9;&#x4E2A;&#x3002;&#x6240;&#x4EE5;&#x66F4;&#x597D;&#x7684;&#x65B9;&#x6CD5;&#x5E94;&#x8BE5;&#x662F;&#x5728;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x4E4B;&#x524D;&#x518D;&#x52A0;&#x5165;&#x4E00;&#x4E2A;phase&#x3002;</p>
<p>&#x5176;&#x5B9E;&#x4F20;&#x7EDF;&#x6570;&#x636E;&#x5E93;&#x7684;cardinality&#xFF08;&#x57FA;&#x6570;&#xFF09;&#x529F;&#x80FD;&#x5DF2;&#x7ECF;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x4F60;&#x5728;DB query&#x91CC;&#x9762;&#x4F7F;&#x7528; INNER JOIN &#x8FD9;&#x4E2A;&#x6307;&#x4EE4;&#xFF0C;&#x5176;&#x5B9E;DB&#x5DF2;&#x7ECF;&#x80FD;&#x591F;&#x9884;&#x5224;&#x54EA;&#x4E00;&#x4E2A;&#x8868;&#x7ED9;&#x51FA;&#x7684;row&#x4F1A;&#x6BD4;&#x8F83;&#x5C11;&#xFF0C;&#x4ECE;&#x800C;&#x4EE5;&#x66F4;&#x4F18;&#x5316;&#x7684;&#x6B21;&#x5E8F;&#x53BB;&#x6267;&#x884C;&#x3002;&#x4F46;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528;&#x7684;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;PHP&#xFF0C;Java&#xFF0C;Python&#x8FD8;&#x662F;C/C++&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x8003;&#x8651;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x6709;&#x4EBA;&#x4F1A;&#x5F00;&#x5F88;&#x591A;&#x7EBF;&#x7A0B;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x8FD9;&#x4E0D;&#x662F;&#x6700;&#x4F73;&#x65B9;&#x6848;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;Linux&#x7CFB;&#x7EDF;&#x91CC;&#xFF0C;&#x4F60;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x8981;&#x662F;&#x4E0A;&#x4E86;200-300&#xFF0C;&#x5C31;&#x4F1A;&#x6709;&#x5F88;&#x5927;&#x7684;overhead&#x3002;</p>
<p>&#x4EE3;&#x7801;&#x6267;&#x884C;&#x7684;&#x6B21;&#x5E8F;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x3002;&#x53E6;&#x5916;&#x6700;&#x8FD1;&#x51E0;&#x5E74;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x6D41;&#x884C;&#x7684;&#x4F18;&#x5316;&#x601D;&#x8DEF;&#xFF0C;&#x5C31;&#x662F;&#x4E0A;memcache&#x3002;&#x6211;&#x4EEC;&#x6709;&#x65F6;&#x5019;&#x4F1A;&#x770B;&#x5230;&#x7A0B;&#x5E8F;&#x5458;&#x628A;&#x4ED6;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x653E;&#x8FDB;&#x4E86;memcache&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x4F9D;&#x8D56;&#x6811;&#x7684;&#x4E2D;&#x95F4;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x6211;&#x5C31;&#x95EE;&#x4ED6;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x628A;&#x4ED6;&#x8FD9;&#x4E2A;Class&#x653E;&#x5165;memcache&#xFF0C;&#x4ED6;&#x53EF;&#x80FD;&#x4F1A;&#x8BF4;&#xFF0C;&#x4ED6;&#x89C9;&#x5F97;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x548C;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x7684;child&#x88AB;&#x8C03;&#x7528;&#x7684;&#x6B21;&#x6570;&#x591A;&#x3002;&#x6211;&#x89C9;&#x5F97;&#x8FD9;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x7406;&#x60F3;&#x7684;&#x3002;&#x4F60;&#x4ECA;&#x5929;&#x89C9;&#x5F97;&#x8FD9;&#x4E2A;Class&#x88AB;&#x8C03;&#x7528;&#x7684;&#x591A;&#xFF0C;&#x53EF;&#x4EE5;&#x653E;&#x8FDB;memcache&#xFF0C;&#x4F46;&#x660E;&#x5929;&#x662F;&#x4E0D;&#x662F;&#x4F1A;&#x6709;&#x66F4;&#x91CD;&#x8981;&#x7684;Class&#x4F1A;&#x66F4;&#x503C;&#x5F97;&#x653E;&#x8FDB;memcache&#xFF0C;&#x4E8E;&#x662F;&#x4F60;&#x53C8;&#x8981;&#x628A;memcache&#x7684;&#x8D44;&#x6E90;&#x8BA9;&#x7ED9;&#x8FD9;&#x4E2A;&#x65B0;&#x7684;Class&#xFF1F;&#x5982;&#x679C;&#x4F60;&#x653E;&#x5165;memcache&#x7684;Class&#x5E76;&#x4E0D;&#x662F;&#x6700;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x8FD9;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x771F;&#x6B63;&#x4F18;&#x5316;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x88AB;&#x62FF;&#x8D70;&#x4E86;&#x3002;</p>
<h4 id="&#x5982;&#x4F55;&#x8BA9;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x7684;&#x66F4;&#x597D;&#xFF1F;">&#x5982;&#x4F55;&#x8BA9;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x7684;&#x66F4;&#x597D;&#xFF1F;</h4><p>&#x54EA;&#x4E2A;query&#x5148;&#x6267;&#x884C;&#xFF0C;&#x54EA;&#x4E2A;query&#x540E;&#x6267;&#x884C;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x662F;&#x5728;&#x7F16;&#x7801;&#x9636;&#x6BB5;&#x6765;&#x505A;&#x7684;&#x3002;&#x54EA;&#x4E2A;Class&#x8BE5;&#x8FDB;memcache&#xFF0C;&#x54EA;&#x4E2A;Class&#x8BE5;&#x51FA;memcache&#xFF0C;&#x4E5F;&#x4E0D;&#x5E94;&#x8BE5;&#x5728;&#x7F16;&#x7801;&#x9636;&#x6BB5;&#x6765;&#x505A;&#x3002;&#x5E94;&#x8BE5;&#x6709;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x7684;&#x9636;&#x6BB5;&#xFF0C;&#x4E13;&#x95E8;&#x8FDB;&#x884C;&#x8FD9;&#x79CD;&#x8C03;&#x5EA6;&#x5DE5;&#x4F5C;&#xFF0C;&#x7136;&#x800C;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x8FD8;&#x6CA1;&#x6709;&#x516C;&#x53F8;&#x80FD;&#x591F;&#x505A;&#x5230;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x5408;&#x9002;&#x7684;&#x8BED;&#x8A00;&#x3002;</p>
<p>&#x5F02;&#x6B65;&#x5904;&#x7406;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#x600E;&#x6837;&#x505A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x4F18;&#x5316;&#x4F5C;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x66F4;&#x591A;&#x7684;&#x601D;&#x8003;&#x3002;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x80FD;&#x591F;&#x628A;&#x8BA1;&#x7B97;&#x673A;&#x5F53;&#x4F5C;&#x79D1;&#x5B66;&#x53BB;&#x601D;&#x8003;&#xFF0C;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5DE5;&#x7A0B;&#x5E94;&#x7528;&#x3002;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x770B;&#x5341;&#x51E0;&#x5E74;&#x524D;&#xFF0C;&#x5BF9;&#x5355;&#x673A;&#x662F;&#x975E;&#x5E38;&#x4E86;&#x89E3;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x672A;&#x6765;&#x8FC7;&#x4E86;&#x4E94;&#x5E74;&#x5341;&#x5E74;&#x518D;&#x56DE;&#x6765;&#x770B;&#xFF0C;&#x53EF;&#x80FD;&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E5F;&#x4F1A;&#x4E86;&#x89E3;&#x7684;&#x6BD4;&#x73B0;&#x5728;&#x66F4;&#x591A;&#x5F88;&#x591A;&#xFF0C;&#x53EF;&#x80FD;&#x7ED9;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x5199;&#x7A0B;&#x5E8F;&#x4E5F;&#x4F1A;&#x53D8;&#x5F97;&#x8DDF;&#x7ED9;&#x5355;&#x673A;&#x5199;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#x7B80;&#x5355;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x5C31;&#x9700;&#x8981;&#x66F4;&#x5408;&#x9002;&#x7684;&#x5DE5;&#x5177;&#x8BED;&#x8A00;&#x53BB;&#x7ED9;&#x5927;&#x5BB6;&#x63D0;&#x4F9B;&#x8FD9;&#x79CD;&#x5F02;&#x6B65;&#x7684;&#x4FBF;&#x5229;&#x3002;&#x662F;&#x4E0D;&#x662F;&#x4F1A;&#x6709;Haskell&#x90A3;&#x6837;lazy&#x7684;&#x65B9;&#x5F0F;&#x4ECE;&#x7CFB;&#x7EDF;&#x5C42;&#x9762;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF1F;&#x5E0C;&#x671B;&#x8DDF;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x601D;&#x8003;&#x63A2;&#x8BA8;&#x3002;</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Memcached/">Memcached</a><a href="/tags/分布式系统/">分布式系统</a><a href="/tags/数据库/">数据库</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fc8640/" title="在windows系统下安装memcached -" itemprop="url">在windows系统下安装memcached -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Memcached &#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5185;&#x5B58;&#x5BF9;&#x8C61;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#xFF0C;&#x901A;&#x5E38;&#x88AB;&#x7528;&#x4E8E;&#x52A8;&#x6001;Web&#x5E94;&#x7528;&#x4EE5;&#x51CF;&#x8F7B;&#x6570;&#x636E;&#x5E93;&#x8D1F;&#x8F7D;&#x3002;&#x5B83;&#x901A;&#x8FC7;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x548C;&#x5BF9;&#x8C61;&#x6765;&#x51CF;&#x5C11;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x52A8;&#x6001;&#x3001;&#x6570;&#x636E;&#x5E93;&#x9A71;&#x52A8;&#x7F51;&#x7AD9;&#x7684;&#x901F;&#x5EA6;&#x3002;Memcached&#x57FA;&#x4E8E;&#x201C;Key=&gt;Value&#x201D;&#x65B9;&#x5F0F;&#x7EC4;&#x7EC7;&#x6570;&#x636E;&#xFF0C;&#x57FA;&#x4E8E;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x65B9;&#x5F0F;&#x5B8C;&#x6210;&#x670D;&#x52A1;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;memcached&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x662F;&#x6613;&#x5931;&#x7684;&#xFF0C;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x91CD;&#x542F;&#xFF0C;&#x6216;&#x8005;memcached&#x8FDB;&#x7A0B;&#x4E2D;&#x6B62;&#xFF0C;&#x6570;&#x636E;&#x4FBF;&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x6240;&#x4EE5;memcached&#x4E0D;&#x80FD;&#x7528;&#x6765;&#x6301;&#x4E45;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x8BB2;&#x89E3;&#x4E00;&#x4E0B;&#x5728;windows&#x7CFB;&#x7EDF;&#x4E0B;&#x5982;&#x4F55;&#x5B89;&#x88C5;memcached</p>
<p>&#xFF08;1&#xFF09;&#x5B89;&#x88C5;memcache&#x9996;&#x5148;&#x4F60;&#x5F97;&#x4E0B;&#x8F7D;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;memcached &#x7684;&#x5B89;&#x88C5;&#x6587;&#x4EF6;&#x548C;php&#x6240;&#x9700;&#x8981;&#x7684; pecl &#x6269;&#x5C55; php_memcache.dll &#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x662F;&#x4ECB;&#x7ECD;&#x5728; windows &#x4E0B;&#x9762;&#x5B89;&#x88C5; memcached &#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7684;&#x662F; memcached.exe &#x6587;&#x4EF6;&#x3002; memcached.exe &#x5177;&#x4F53;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x4E3A;&#xFF1A; <a href="http://code.jellycan.com/files/memcached-1.2.6-win32-bin.zip" target="_blank" rel="external">http://code.jellycan.com/files/memcached-1.2.6-win32-bin.zip</a> &#xFF0C;&#x81F3;&#x4E8E; php_memcache.dll&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x63D0;&#x4F9B;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x4E86;&#xFF0C;&#x81EA;&#x5DF1;&#x53BB;&#x767E;&#x5EA6;&#x641C;&#x5427;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x4E00;&#x5B9A;&#x8981;&#x548C;&#x81EA;&#x5DF1;&#x7684;php&#x7248;&#x672C;&#x76F8;&#x540C;&#x3002; </p>
<p>&#xFF08;2&#xFF09;&#x4EE5;&#x4E0A;&#x6240;&#x9700;&#x5DE5;&#x5177;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;&#x90A3;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5B89;&#x88C5;&#x5E76;&#x8C03;&#x8BD5;&#x4E86;&#x3002;&#x9996;&#x5148;&#x5B89;&#x88C5; memcache&#x3002;</p>
<p>&#x5C06;&#x4E0B;&#x8F7D;&#x7684; memcache &#x6587;&#x4EF6;&#x5305;&#x89E3;&#x538B;&#x653E;&#x67D0;&#x4E2A;&#x76D8;&#xFFFD;&#xFFFD;&#xFFFD;&#x9762;&#xFF0C;&#x6BD4;&#x5982;&#x5728;c:\memcached</p>
<p>&#x5728;&#x7EC8;&#x7AEF;&#xFF08;&#x5373;cmd&#x547D;&#x4EE4;&#x754C;&#x9762;&#xFF09;&#x4E0B;&#x8F93;&#x5165; &quot;c:\memcached\memcached.exe -d install&quot; &#x5B89;&#x88C5;</p>
<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4F60;&#x53EF;&#x80FD;&#x4E0D;&#x77E5;&#x9053;&#x4F60;&#x5B89;&#x88C5;&#x7684; memcache &#x4F7F;&#x7528;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x7AEF;&#x53E3;&#xFF0C;&#x4E0B;&#x9762;&#x901A;&#x8FC7;&#x4FEE;&#x6539;&#x6CE8;&#x518C;&#x8868;&#x5C06;&#x7AEF;&#x53E3;&#x4FEE;&#x6539;&#x4E3A;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#x3002;&#x6253;&#x5F00;&#x6CE8;&#x518C;&#x8868;&#x7F16;&#x8F91;&#x5668;&#xFF0C;&#x627E;&#x5230; HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\memcached Server &#x4E0B;&#x9762;&#x627E;&#x5230;&#x4E00;&#x4E2A; ImagePath &#x7684;&#x5B57;&#x7B26;&#x4E32;&#x9879;&#xFF0C;&#x53CC;&#x51FB;&#x8BE5;&#x4E32;&#xFF0C;&#x5728;&#x8BE5;&#x9879;&#x76EE;&#x503C;&#x540E;&#x9762;&#x8FFD;&#x52A0;&#x5199;&#x5165; -l 127.0.0.1 -m 45 -p 51321 &#xFF08;&#x8FD9;&#x91CC;&#x7684;&#x610F;&#x601D;&#x5373;&#x8BBF;&#x95EE;ip&#x4E3A;&#xFF1A;127.0.0.1 &#x4F7F;&#x7528;45M&#x5185;&#x5B58;&#xFF0C;51321&#x4E3A;&#x7AEF;&#x53E3;&#xFF09;&#xFF0C;&#x4FEE;&#x6539;&#x5B8C;&#x6BD5;&#x5173;&#x95ED;&#x6CE8;&#x518C;&#x8868;&#x7F16;&#x8F91;&#x5668;&#x3002;</p>
<p>&#x63A5;&#x7740;&#x547D;&#x4EE4;&#x754C;&#x9762;&#x91CC;&#x8F93;&#x5165;&#xFF1A;&quot;c:\memcached\memcached.exe -d start&quot; &#x542F;&#x52A8; memcache &#x670D;&#x52A1;&#x6216;&#x8005;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x670D;&#x52A1;&#x9879;&#x91CC;&#x9762;&#x627E;&#x5230;memcached&#x670D;&#x52A1;&#xFF0C;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x3002;</p>
<p>&#x4EE5;&#x4E0A;&#x64CD;&#x4F5C;&#x5B8C;&#x6BD5;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x68C0;&#x6D4B;&#x4E00;&#x4E0B;&#x7F13;&#x5B58;&#x670D;&#x52A1; memcache &#x662F;&#x5426;&#x6210;&#x529F;&#x5B89;&#x88C5;&#x5E76;&#x8FD0;&#x884C;&#x4E86;&#x3002;&#x7EE7;&#x7EED;&#x5728;&#x7EC8;&#x7AEF;&#x8F93;&#x5165;&#xFF1A;&quot;telnet 127.0.0.1 51321&quot;&#xFF0C;&#x8F93;&#x5165;&#x5B8C;&#x6BD5;&#x53EF;&#x80FD;&#x4EC0;&#x4E48;&#x53CD;&#x5E94;&#xFF0C;&#x63A5;&#x7740;&#x8F93;&#x5165; stats &#xFF0C;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x4E00;&#x5806;&#x7C7B;&#x4F3C;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x770B;&#x61C2;&#x6216;&#x770B;&#x4E0D;&#x61C2;&#x7684;&#x82F1;&#x6587;&#xFF0C;&#x5C31;&#x8BF4;&#x660E; memcache &#x670D;&#x52A1;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x5B89;&#x88C5;&#x5E76;&#x8FD0;&#x884C;&#x4E86;&#x3002;</p>
<pre><code><span class="label">STAT</span> pid <span class="number">5636</span>
<span class="label">STAT</span> uptime <span class="number">936</span>
<span class="label">STAT</span> time <span class="number">1344915126</span>
<span class="label">STAT</span> version <span class="number">1</span>.<span class="number">2</span>.<span class="number">6</span>
<span class="label">STAT</span> pointer_size <span class="number">32</span>
<span class="label">STAT</span> curr_items <span class="number">0</span>
<span class="label">STAT</span> total_items <span class="number">0</span>
<span class="label">STAT</span> <span class="keyword">bytes </span><span class="number">0</span>
<span class="label">STAT</span> curr_connections <span class="number">2</span>
<span class="label">STAT</span> total_connections <span class="number">3</span>
<span class="label">STAT</span> connection_structures <span class="number">3</span>
<span class="label">STAT</span> cmd_get <span class="number">0</span>
<span class="label">STAT</span> cmd_set <span class="number">0</span>
<span class="label">STAT</span> get_hits <span class="number">0</span>
<span class="label">STAT</span> get_misses <span class="number">0</span>
<span class="label">STAT</span> evictions <span class="number">0</span>
<span class="label">STAT</span> <span class="keyword">bytes_read </span><span class="number">19</span>
<span class="label">STAT</span> <span class="keyword">bytes_written </span><span class="number">7</span>
<span class="label">STAT</span> limit_maxbytes <span class="number">67108864</span>
<span class="label">STAT</span> threads <span class="number">1</span>
<span class="label">END</span>
</code></pre><p><strong>[1] &#xA0;[2]&#xA0;&#xA0;&#x4E0B;&#x4E00;&#x9875;</strong></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Memcached/">Memcached</a><a href="/tags/Windows/">Windows</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fc04db/" title="nginx+tomcat+memcached (msm)实现 session同步复制 -" itemprop="url">nginx+tomcat+memcached (msm)实现 session同步复制 -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p> &#x6807;&#x7B7E;&#xFF1A; <strong>nginx**</strong>tomcat<strong>**memcached</strong> | &#x53D1;&#x8868;&#x65F6;&#x95F4;&#xFF1A;2015-05-08 15:13 | &#x4F5C;&#x8005;&#xFF1A;annan211 </p>
<p> &#x5206;&#x4EAB;&#x5230;&#xFF1A;</p>
<p>&#x51FA;&#x5904;&#xFF1A;<a href="http://www.iteye.com" target="_blank" rel="external">http://www.iteye.com</a> </p>
<p>tomcat + memcached + nginx &#x5B9E;&#x73B0;session&#x5171;&#x4EAB;</p>
<p>&#x8FD9;&#x91CC;&#x91CD;&#x70B9;&#x5F3A;&#x8C03;&#x5982;&#x4F55;&#x5B9E;&#x73B0;linux&#x670D;&#x52A1;&#x5668;&#x4E0A; &#x670D;&#x52A1;&#x5668;session&#x5171;&#x4EAB;&#xFF0C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9; cookie &#x548C;session&#x7684;&#x5DE5;&#x4F5C;&#x673A;&#x5236;&#x975E;&#x5E38;&#x4E86;&#x89E3;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E86;&#x89E3;&#x5176;&#x4E2D;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x5C31;&#x7B97;&#x914D;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x4E5F;&#x6BEB;&#x65E0;&#x610F;&#x4E49;&#x3002;&#x6362;&#x4E86;&#x5DE5;&#x4F5C;&#x6362;&#x4E86;&#x73AF;&#x5883;&#xFF0C;&#x91CD;&#x65B0;&#x914D;&#x7F6E;&#x8D77;&#x6765;</p>
<p>&#x4ECD;&#x7136;&#x9700;&#x8981;&#x91CD;&#x5934;&#x6765;&#x8FC7;&#xFF0C;&#x4E8B;&#x500D;&#x529F;&#x534A;&#x3002;</p>
<p>cookie&#x662F;&#x600E;&#x6837;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x4E3A;login&#x7684;Cookie&#x6765;&#x5305;&#x542B;&#x8BBF;&#x95EE;&#x8005;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x521B;&#x5EFA;Cookie&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;Header&#x5982;&#x4E0B;&#x9762;&#x6240;&#x793A;&#xFF0C;&#x8FD9;&#x91CC;&#x5047;&#x8BBE;&#x8BBF;&#x95EE;&#x8005;&#x7684;&#x6CE8;&#x518C;&#x540D;&#x662F;&#x201C;Michael Jordan&#x201D;&#xFF0C;</p>
<p>&#x540C;&#x65F6;&#x8FD8;&#x5BF9;&#x6240;&#x521B;&#x5EFA;&#x7684;Cookie&#x7684;&#x5C5E;&#x6027;&#x5982;path&#x3001;domain&#x3001;expires&#x7B49;&#x8FDB;&#x884C;&#x4E86;&#x6307;&#x5B9A;&#x3002;</p>
<pre><code>Set-Cookie:<span class="variable">login=</span>Michael Jordan;<span class="variable">path=</span>/;<span class="variable">domain=</span>msn.com; 
<span class="variable">expires=</span>Monday,<span class="number">01</span>-Mar-<span class="number">99</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> GMT
</code></pre><p>&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;Header&#x4F1A;&#x81EA;&#x52A8;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x8BA1;&#x7B97;&#x673A;&#x7684;Cookie&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x3002;&#x6D4F;&#x89C8;&#x5668;&#x5C06;&#x53D8;&#x91CF;&#x540D;&#x4E3A;&#x201C;login&#x201D;&#x7684;Cookie&#x8D4B;&#x503C;&#x4E3A;&#x201C;Michael Jordon&#x201D;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x4F20;&#x9012;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FD9;&#x4E2A;</p>
<p>Cookie&#x7684;&#x503C;&#x662F;&#x7ECF;&#x8FC7;&#x4E86;URLEncode&#x65B9;&#x6CD5;&#x7684;URL&#x7F16;&#x7801;&#x64CD;&#x4F5C;&#x7684;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x542B;&#x6709;Cookie&#x503C;&#x7684;HTTP Header&#x88AB;&#x4FDD;&#x5B58;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x7684;Cookie&#x6587;&#x4EF6;&#x540E;&#xFF0C;Header&#x5C31;&#x901A;&#x77E5;&#x6D4F;&#x89C8;&#x5668;&#x5C06;Cookie&#x901A;&#x8FC7;&#x8BF7;&#x6C42;&#x4EE5;&#x5FFD;&#x7565;&#x8DEF;&#x5F84;&#x7684;&#x65B9;&#x5F0F;&#x8FD4;&#x56DE;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5B8C;&#x6210;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8BA4;&#x8BC1;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;Cookie&#x7684;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#x6765;&#x9650;&#x5B9A;&#x8BE5;Cookie&#x7684;&#x4F7F;&#x7528;&#x3002;&#x4F8B;&#x5982;Domain&#x5C5E;&#x6027;&#x80FD;&#x591F;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x5BF9;Cookie&#x53D1;&#x9001;&#x8FDB;&#x884C;&#x9650;&#x5B9A;&#xFF0C;&#x5177;&#x4F53;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8BE5;Cookie&#x53EA;&#x80FD;&#x4F20;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x670D;</p>
<p>&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x800C;&#x51B3;&#x4E0D;&#x4F1A;&#x8DD1;&#x5230;&#x5176;&#x4ED6;&#x7684;&#x5982;www.hp.com&#x7684;Web&#x7AD9;&#x70B9;&#x4E0A;&#x53BB;&#x3002;Expires&#x5C5E;&#x6027;&#x5219;&#x6307;&#x5B9A;&#x4E86;&#x8BE5;Cookie&#x4FDD;&#x5B58;&#x7684;&#x65F6;&#x95F4;&#x671F;&#x9650;&#xFF0C;&#x4F8B;&#x5982;&#x4E0A;&#x9762;&#x7684;Cookie&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x53EA;&#x4FDD;&#x5B58;&#x5230;1999&#x5E74;3&#x6708;1&#x65E5;1&#x79D2;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;Cookie&#x592A;&#x591A;&#xFF0C;&#x8D85;&#x8FC7;&#x4E86;&#x7CFB;&#x7EDF;&#x6240;&#x5141;&#x8BB8;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5C06;&#x81EA;&#x52A8;&#x5BF9;&#x5B83;&#x8FDB;&#x884C;&#x5220;&#x9664;&#x3002;&#x81F3;&#x4E8E;&#x5C5E;&#x6027;Path&#xFF0C;&#x7528;&#x6765;&#x6307;&#x5B9A;Cookie&#x5C06;&#x88AB;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x54EA;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x8DEF;&#x5F84;&#x4E0B;&#x3002;</p>
<p>&#x8BF4;&#x660E;&#xFF1A;&#x6D4F;&#x89C8;&#x5668;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;Cookie&#x540E;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x9488;&#x5BF9;&#x8BE5;&#x7F51;&#x7AD9;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x4F1A;&#x5728;Header&#x4E2D;&#x5E26;&#x7740;&#x8FD9;&#x4E2A;Cookie&#xFF1B;&#x4E0D;&#x8FC7;&#xFF0C;&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x7F51;&#x7AD9;&#x7684;&#x8BF7;&#x6C42;Cookie&#x662F;&#x7EDD;&#x5BF9;&#x4E0D;&#x4F1A;&#x8DDF;&#x7740;&#x53D1;&#x9001;&#x7684;&#x3002;&#x800C;</p>
<p>&#x4E14;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x8FD9;&#x6837;&#x4E00;&#x76F4;&#x53D1;&#x9001;&#xFF0C;&#x76F4;&#x5230;Cookie&#x8FC7;&#x671F;&#x4E3A;&#x6B62;&#x3002;</p>
<p>session&#x53C8;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;</p>
<p>&#x7531;&#x4E8E;http&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x4F60;&#x8BBF;&#x95EE;&#x4E86;&#x9875;&#x9762;A&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8BBF;&#x95EE;B&#xFF0C;http&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#x8FD9;2&#x4E2A;&#x8BBF;&#x95EE;&#x6765;&#x81EA;&#x4E00;&#x4E2A;&#x4EBA;&#xFF0C;&#x56E0;&#x6B64;&#x8981;&#x7528;cookie&#x6216;session&#x6765;&#x8DDF;&#x8E2A;&#x7528;&#x6237;&#xFF0C;&#x6839;&#x636E;&#x6388;&#x6743;&#x548C;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x6765;</p>
<p>&#x663E;&#x793A;&#x4E0D;&#x540C;&#x7684;&#x9875;&#x9762;&#x3002;&#x6BD4;&#x5982;&#x7528;&#x6237;A&#x767B;&#x9646;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x80FD;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#xFF0C;&#x800C;B&#x6CA1;&#x767B;&#x9646;&#xFF0C;&#x65E0;&#x6CD5;&#x770B;&#x5230;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#x3002;&#x8FD8;&#x6709;A&#x53EF;&#x80FD;&#x5728;&#x8D2D;&#x7269;&#xFF0C;&#x628A;&#x5546;&#x54C1;&#x653E;&#x5165;&#x8D2D;&#x7269;&#x8F66;&#xFF0C;&#x6B64;&#x65F6;B&#x4E5F;&#x6709;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;</p>
<p>&#x4F60;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;A&#xFF0C;B&#x7684;&#x8EAB;&#x4EFD;&#x548C;&#x8D2D;&#x7269;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4E00;&#x4E2A;session ID&#x6765;&#x7EF4;&#x6301;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>cookie&#x662F;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x4FDD;&#x6301;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x7528;&#x6237;&#x7684;&#x8BBF;&#x95EE;&#x4FE1;&#x606F;&#xFF08;&#x8D26;&#x6237;&#x5BC6;&#x7801;&#x7B49;&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x5220;&#x9664;&#x6216;&#x8BBE;&#x7F6E;&#x6709;&#x6548;&#x671F;&#xFF0C;&#x5728;&#x4E0B;&#x6B21;&#x8BBF;&#x95EE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;</p>
<p>&#x8FD4;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x3002;&#x6CE8;&#x610F;&#xFF1A;cookie&#x53EF;&#x4EE5;&#x88AB;&#x7981;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x60F3;&#x5176;&#x4ED6;&#x529E;&#x6CD5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;session&#x3002;&#x6BD4;&#x5982;&#xFF1A;&#x4F60;&#x53BB;&#x5546;&#x573A;&#x8D2D;&#x7269;&#xFF0C;&#x5546;&#x573A;&#x4F1A;&#x7ED9;&#x4F60;&#x529E;&#x4E00;&#x5F20;&#x4F1A;&#x5458;&#x5361;&#xFF0C;&#x4E0B;&#x6B21;&#x4F60;&#x6765;&#x51FA;&#x793A;&#x8BE5;&#x5361;&#xFF0C;&#x4F1A;&#x6709;&#x6253;&#x6298;&#x4F18;&#x60E0;</p>
<p>&#x3002;&#x8BE5;&#x5361;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x4FDD;&#x5B58;&#xFF08;cookie&#xFF09;&#xFF0C;&#x6216;&#x662F;&#x5546;&#x573A;&#x4EE3;&#x4E3A;&#x4FDD;&#x7BA1;&#xFF0C;&#x7531;&#x4E8E;&#x4F1A;&#x5458;&#x592A;&#x591A;&#xFF0C;&#x4E2A;&#x4EBA;&#x9700;&#x8981;&#x4FDD;&#x5B58;&#x5361;&#x53F7;&#x4FE1;&#x606F;&#xFF08;session ID)&#x3002;</p>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6301;&#x4E45;&#x5316;SESSION&#xFF1F;</p>
<p>&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x7684;Session&#x5BF9;&#x8C61;&#x5B58;&#x5728;Servlet&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5982;&#x679C;Tomcat&#x670D;&#x52A1;&#x5668;&#x91CD;&#x8D77;/&#x5F53;&#x673A;&#x7684;&#x8BDD;&#x8BE5;session&#x5C31;&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x800C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x64CD;&#x4F5C;&#x5E94;&#x4E3A;session&#x7684;&#x4E22;&#x5931;&#x800C;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E22;&#x5931;&#xFF0C;&#x800C;&#x4E14;</p>
<p>&#x5F53;&#x524D;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x91CF;&#x5DE8;&#x5927;&#xFF0C;&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x7684;Session&#x91CC;&#x5B58;&#x653E;&#x5927;&#x91CF;&#x7684;&#x6570;&#x636E;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5F88;&#x5360;&#x7528;&#x670D;&#x52A1;&#x5668;&#x5927;&#x91CF;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x4ECE;&#x800C;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6027;&#x80FD;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#x3002;</p>
<p>&#x756A;&#x5916;&#x7BC7;</p>
<p>session &#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x975E;&#x5E38;&#x5B9D;&#x8D35;&#x3002;&#x4F46;&#x662F;session&#x540C;&#x6837;&#x4E5F;&#x662F;&#x7F3A;&#x61BE;&#x6EE1;&#x8EAB;&#xFF0C;&#x5728;&#x5927;&#x89C4;&#x6A21;&#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#xFF0C;&#x6700;&#x597D;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x3002;&#x6BD4;&#x5982;&#x6DD8;&#x5B9D;&#x7F51;&#x3002;</p>
<p>&#x5BF9;nginx&#x7684;&#x4E86;&#x89E3;&#xFF1F;</p>
<p>nginx &#x662F;&#x4E00;&#x6B3E;&#x975E;&#x5E38;&#x4F18;&#x79C0;&#x7684;&#x670D;&#x52A1;&#x5668;&#x8F6F;&#x4EF6;&#xFF0C;&#x5176;&#x4F18;&#x79C0;&#x7A0B;&#x5EA6;&#x8FD9;&#x91CC;&#x4E0D;&#x8FC7;&#x591A;&#x8D58;&#x8FF0;&#x3002;</p>
<p>&#x8FDB;&#x5165;&#x6B63;&#x9898;</p>
<p>session &#x5B9E;&#x73B0;&#x5171;&#x4EAB;&#x7684;&#x65B9;&#x6CD5;&#x5206;&#x4E3A;&#x591A;&#x79CD;</p>
<p>&#x5BF9;&#x4E8E;WEB&#x5E94;&#x7528;&#x96C6;&#x7FA4;&#x7684;&#x6280;&#x672F;&#x5B9E;&#x73B0;&#x800C;&#x8A00;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x96BE;&#x70B9;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x80FD;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x4FDD;&#x6301;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4F1A;&#x8BDD;&#xFF08;Session&#xFF09;&#x4FE1;&#x606F;&#x662F;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x5757;&#x3002;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;</p>
<p>&#x5927;&#x4F53;&#x4E0A;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x628A;&#x6240;&#x6709;Session&#x6570;&#x636E;&#x653E;&#x5230;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x6216;&#x8005;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF0C;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x8FD9;&#x53F0;Session&#x670D;&#x52A1;&#x5668;&#x6765;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF1B;&#x53E6;&#x4E00;&#x79CD;&#x5C31;&#x662F;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x8282;</p>
<p>&#x70B9;&#x95F4;&#x8FDB;&#x884C;Session&#x6570;&#x636E;&#x7684;&#x540C;&#x6B65;&#x62F7;&#x8D1D;&#xFF0C;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x5747;&#x4FDD;&#x5B58;&#x4E86;&#x6240;&#x6709;&#x7684;Session&#x6570;&#x636E;&#x3002;</p>
<p>&#x4E00; &#x4F7F;&#x7528;tomcat&#x81EA;&#x8EAB;&#x96C6;&#x7FA4;&#x7279;&#x6027;&#x5B8C;&#x6210;session&#x5171;&#x4EAB;</p>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x4F7F;&#x7528;tomcat&#x81EA;&#x8EAB;&#x5E7F;&#x64AD;&#x7684;&#x7279;&#x70B9;&#x6765;&#x8FDB;&#x884C;session&#x540C;&#x6B65;&#x62F7;&#x8D1D;&#xFF0C;&#x4F18;&#x70B9;&#x662F;&#x7B80;&#x5355;&#xFF0C;&#x7F3A;&#x70B9;&#x662F;&#x4E00;&#x65E6;tomcat&#x96C6;&#x7FA4;&#x6570;&#x91CF;&#x8FC7;&#x591A;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5F15;&#x53D1;&#x5E7F;&#x64AD;&#x98CE;&#x66B4;&#x3002;</p>
<p>&#x8BE6;&#x7EC6;&#x914D;&#x7F6E; &#x8BF7;&#x53C2;&#x7167; &#x535A;&#x5BA2; <a href="http://zyycaesar.iteye.com/blog/296606" target="_blank" rel="external">http://zyycaesar.iteye.com/blog/296606</a></p>
<p>&#x7C97;&#x7565;&#x914D;&#x7F6E;&#x5982;&#x4E0B; tomcat/server.xml</p>
<pre><code><span class="subst">&amp;</span><span class="literal">lt</span>;Cluster className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>ha<span class="built_in">.</span>tcp<span class="built_in">.</span>SimpleTcpCluster<span class="subst">&amp;</span>quot;
        channelSendOptions<span class="subst">=&amp;</span>quot;<span class="number">8</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;Manager className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>ha<span class="built_in">.</span>session<span class="built_in">.</span>DeltaManager<span class="subst">&amp;</span>quot;
      expireSessionsOnShutdown<span class="subst">=&amp;</span>quot;<span class="literal">false</span><span class="subst">&amp;</span>quot;
      notifyListenersOnReplication<span class="subst">=&amp;</span>quot;<span class="literal">true</span><span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;Channel className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>tribes<span class="built_in">.</span><span class="keyword">group</span><span class="built_in">.</span>GroupChannel<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
     <span class="subst">&amp;</span><span class="literal">lt</span>;Membership className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>tribes<span class="built_in">.</span>membership<span class="built_in">.</span>McastService<span class="subst">&amp;</span>quot;
        address<span class="subst">=&amp;</span>quot;<span class="number">224.0</span><span class="built_in">.0</span><span class="built_in">.0</span><span class="subst">&amp;</span>quot;
        port<span class="subst">=&amp;</span>quot;<span class="number">45564</span><span class="subst">&amp;</span>quot;
        frequency<span class="subst">=&amp;</span>quot;<span class="number">500</span><span class="subst">&amp;</span>quot;
        dropTime<span class="subst">=&amp;</span>quot;<span class="number">3000</span><span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
     <span class="subst">&amp;</span><span class="literal">lt</span>;Receiver className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>tribes<span class="built_in">.</span>transport<span class="built_in">.</span>nio<span class="built_in">.</span>NioReceiver<span class="subst">&amp;</span>quot;
         address<span class="subst">=&amp;</span>quot;<span class="number">192.168</span><span class="built_in">.0</span><span class="built_in">.223</span><span class="subst">&amp;</span>quot;
         port<span class="subst">=&amp;</span>quot;<span class="number">4001</span><span class="subst">&amp;</span>quot;
         autoBind<span class="subst">=&amp;</span>quot;<span class="number">100</span><span class="subst">&amp;</span>quot;
         selectorTimeout<span class="subst">=&amp;</span>quot;<span class="number">5000</span><span class="subst">&amp;</span>quot;
         maxThreads<span class="subst">=&amp;</span>quot;<span class="number">6</span><span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
     <span class="subst">&amp;</span><span class="literal">lt</span>;Sender className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>tribes<span class="built_in">.</span>transport<span class="built_in">.</span>ReplicationTransmitter<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;Transport className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>tribes<span class="built_in">.</span>transport<span class="built_in">.</span>nio<span class="built_in">.</span>PooledParallelSender<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
     <span class="subst">&amp;</span><span class="literal">lt</span>;/Sender<span class="subst">&amp;</span><span class="literal">gt</span>;
     <span class="subst">&amp;</span><span class="literal">lt</span>;Interceptor className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>tribes<span class="built_in">.</span><span class="keyword">group</span><span class="built_in">.</span>interceptors<span class="built_in">.</span>TcpFailureDetector<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
     <span class="subst">&amp;</span><span class="literal">lt</span>;Interceptor className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>tribes<span class="built_in">.</span><span class="keyword">group</span><span class="built_in">.</span>interceptors<span class="built_in">.</span>MessageDispatch15Interceptor<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;/Channel<span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;Valve className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>ha<span class="built_in">.</span>tcp<span class="built_in">.</span>ReplicationValve<span class="subst">&amp;</span>quot;
    filter<span class="subst">=&amp;</span>quot;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>gif;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>js;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>jpg;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>png;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>htm;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>html;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>css;<span class="built_in">.</span><span class="subst">*\</span><span class="built_in">.</span>txt;<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;Valve className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>ha<span class="built_in">.</span>session<span class="built_in">.</span>JvmRouteBinderValve<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;ClusterListener className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>ha<span class="built_in">.</span>session<span class="built_in">.</span>JvmRouteSessionIDBinderListener<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;ClusterListener className<span class="subst">=&amp;</span>quot;org<span class="built_in">.</span>apache<span class="built_in">.</span>catalina<span class="built_in">.</span>ha<span class="built_in">.</span>session<span class="built_in">.</span>ClusterSessionListener<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/Cluster<span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><p>&#x4E8C; &#x4F7F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x6301;&#x4E45;&#x5316;session</p>
<p>&#x8FD9;&#x91CC;&#x53C8;&#x5206;&#x4E3A;&#x7269;&#x7406;&#x6570;&#x636E;&#x5E93;&#x548C;&#x5185;&#x5B58;&#x6570;&#x636E;&#x5E93;</p>
<p>&#x7269;&#x7406;&#x6570;&#x636E;&#x5E93;&#x5907;&#x4EFD;session&#xFF0C;&#x7531;&#x4E8E;&#x5176;&#x6027;&#x80FD;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x4F5C;&#x4ECB;&#x7ECD;&#x3002;</p>
<p>&#x5185;&#x5B58;&#x6570;&#x636E;&#x5E93; &#x53EF;&#x4EE5;&#x6682;&#x5206;&#x4E3A; redis &#x548C; memcached</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EA;&#x4ECB;&#x7ECD;memcached</p>
<p>&#x591A;&#x4E2A;tomcat&#x5404;&#x79CD;&#x5E8F;&#x5217;&#x5316;&#x7B56;&#x7565;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x4E00;&#x3001;java&#x9ED8;&#x8BA4;&#x5E8F;&#x5217;&#x5316;tomcat&#x914D;&#x7F6E;</p>
<p>conf/context.xml&#x6DFB;&#x52A0;</p>
<pre><code>&amp;lt;Manager <span class="variable">className=</span>&amp;quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&amp;quot;
       <span class="variable">memcachedNodes=</span>&amp;quot;n1:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11211</span> n2:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11311</span>&amp;quot;     
    <span class="variable">lockingMode=</span>&amp;quot;auto&amp;quot;
    <span class="variable">sticky=</span>&amp;quot;<span class="constant">false</span>&amp;quot; 
    <span class="variable">requestUriIgnorePattern=</span> &amp;quot;.*\.(png|gif|jpg|css|js)$&amp;quot;    
    <span class="variable">sessionBackupAsync=</span> &amp;quot;<span class="constant">false</span>&amp;quot;   
    <span class="variable">sessionBackupTimeout=</span> &amp;quot;<span class="number">100</span>&amp;quot;      
    <span class="variable">transcoderFactoryClass=</span>&amp;quot;de.javakaffee.web.msm.JavaSerializationTranscoderFactory&amp;quot;    
        /&amp;gt;
</code></pre><p>lib&#x589E;&#x52A0;jar&#x5305;&#xFF1A;</p>
<pre><code><span class="tag">spymemcached-2</span><span class="class">.10</span><span class="class">.3</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-tc7-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
</code></pre><p>&#x4E8C;&#x3001;javolution&#x5E8F;&#x5217;&#x5316;tomcat&#x914D;&#x7F6E;</p>
<p>conf/context.xml&#x6DFB;&#x52A0;</p>
<pre><code>&amp;lt;Manager <span class="variable">className=</span>&amp;quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&amp;quot;
       <span class="variable">memcachedNodes=</span>&amp;quot;n1:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11211</span> n2:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11311</span>&amp;quot;   
    <span class="variable">lockingMode=</span>&amp;quot;auto&amp;quot;
    <span class="variable">sticky=</span>&amp;quot;<span class="constant">false</span>&amp;quot; 
    <span class="variable">requestUriIgnorePattern=</span> &amp;quot;.*\.(png|gif|jpg|css|js)$&amp;quot;    
    <span class="variable">sessionBackupAsync=</span> &amp;quot;<span class="constant">false</span>&amp;quot;   
    <span class="variable">sessionBackupTimeout=</span> &amp;quot;<span class="number">100</span>&amp;quot;  
    <span class="variable">copyCollectionsForSerialization=</span>&amp;quot;<span class="constant">true</span>&amp;quot;   
    <span class="variable">transcoderFactoryClass=</span>&amp;quot;de.javakaffee.web.msm.serializer.javolution.JavolutionTranscoderFactory&amp;quot;    
        /&amp;gt;
</code></pre><p>lib&#x589E;&#x52A0;jar&#x5305;</p>
<pre><code><span class="tag">msm-javolution-serializer-cglib-1</span><span class="class">.3</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">msm-javolution-serializer-jodatime-1</span><span class="class">.3</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">spymemcached-2</span><span class="class">.10</span><span class="class">.3</span><span class="class">.jar</span>
    <span class="tag">javolution-5</span><span class="class">.4</span><span class="class">.3</span><span class="class">.1</span><span class="class">.jar</span>
    <span class="tag">msm-javolution-serializer-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-tc7-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
</code></pre><p>&#x4E09;&#x3001;xstream&#x5E8F;&#x5217;&#x5316;tomcat&#x914D;&#x7F6E;</p>
<p>conf/context.xml&#x6DFB;&#x52A0;</p>
<pre><code>&amp;lt;Manager <span class="variable">className=</span>&amp;quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&amp;quot;
       <span class="variable">memcachedNodes=</span>&amp;quot;n1:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11211</span> n2:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11311</span>&amp;quot;   
    <span class="variable">lockingMode=</span>&amp;quot;auto&amp;quot;
    <span class="variable">sticky=</span>&amp;quot;<span class="constant">false</span>&amp;quot; 
    <span class="variable">requestUriIgnorePattern=</span> &amp;quot;.*\.(png|gif|jpg|css|js)$&amp;quot;    
    <span class="variable">sessionBackupAsync=</span> &amp;quot;<span class="constant">false</span>&amp;quot;   
    <span class="variable">sessionBackupTimeout=</span> &amp;quot;<span class="number">100</span>&amp;quot;
    <span class="variable">transcoderFactoryClass=</span>&amp;quot;de.javakaffee.web.msm.serializer.xstream.XStreamTranscoderFactory&amp;quot;    
        /&amp;gt;
</code></pre><p>lib&#x589E;&#x52A0;jar&#x5305;</p>
<pre><code><span class="tag">xmlpull-1</span><span class="class">.1</span><span class="class">.3</span><span class="class">.1</span><span class="class">.jar</span>
    <span class="tag">xpp3_min-1</span><span class="class">.1</span><span class="class">.4c</span><span class="class">.jar</span>
    <span class="tag">xstream-1</span><span class="class">.4</span><span class="class">.6</span><span class="class">.jar</span>
    <span class="tag">msm-xstream-serializer-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">spymemcached-2</span><span class="class">.10</span><span class="class">.3</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-tc7-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
</code></pre><p>&#x56DB;&#x3001;flexjson&#x5E8F;&#x5217;&#x5316;tomcat&#x914D;&#x7F6E;</p>
<p>conf/context.xml&#x6DFB;&#x52A0;</p>
<pre><code>&amp;lt;Manager <span class="variable">className=</span>&amp;quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&amp;quot;
       <span class="variable">memcachedNodes=</span>&amp;quot;n1:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11211</span> n2:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11311</span>&amp;quot;     
    <span class="variable">lockingMode=</span>&amp;quot;auto&amp;quot;
    <span class="variable">sticky=</span>&amp;quot;<span class="constant">false</span>&amp;quot; 
    <span class="variable">requestUriIgnorePattern=</span> &amp;quot;.*\.(png|gif|jpg|css|js)$&amp;quot;    
    <span class="variable">sessionBackupAsync=</span> &amp;quot;<span class="constant">false</span>&amp;quot;   
    <span class="variable">sessionBackupTimeout=</span> &amp;quot;<span class="number">100</span>&amp;quot;      
    <span class="variable">transcoderFactoryClass=</span>&amp;quot;de.javakaffee.web.msm.serializer.json.JSONTranscoderFactory&amp;quot;    
        /&amp;gt;
</code></pre><p>lib&#x589E;&#x52A0;jar&#x5305;</p>
<pre><code><span class="tag">flexjson-3</span><span class="class">.1</span><span class="class">.jar</span>
    <span class="tag">msm-flexjson-serializer-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">spymemcached-2</span><span class="class">.10</span><span class="class">.3</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-tc7-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
</code></pre><p>&#x4E94;&#x3001;kryo&#x5E8F;&#x5217;&#x5316;tomcat&#x914D;&#x7F6E;</p>
<p>conf/context.xml&#x6DFB;&#x52A0;</p>
<pre><code>&amp;lt;Manager <span class="variable">className=</span>&amp;quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&amp;quot;
       <span class="variable">memcachedNodes=</span>&amp;quot;n1:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11211</span> n2:<span class="number">192.168</span>.<span class="number">100.208</span>:<span class="number">11311</span>&amp;quot;   
    <span class="variable">lockingMode=</span>&amp;quot;auto&amp;quot;
    <span class="variable">sticky=</span>&amp;quot;<span class="constant">false</span>&amp;quot; 
    <span class="variable">requestUriIgnorePattern=</span> &amp;quot;.*\.(png|gif|jpg|css|js)$&amp;quot;    
    <span class="variable">sessionBackupAsync=</span> &amp;quot;<span class="constant">false</span>&amp;quot;   
    <span class="variable">sessionBackupTimeout=</span> &amp;quot;<span class="number">100</span>&amp;quot;    
    <span class="variable">copyCollectionsForSerialization=</span>&amp;quot;<span class="constant">true</span>&amp;quot;   
    <span class="variable">transcoderFactoryClass=</span>&amp;quot;de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory&amp;quot;    
        /&amp;gt;
</code></pre><p>lib&#x589E;&#x52A0;jar&#x5305;</p>
<pre><code><span class="tag">kryo-1</span><span class="class">.04</span><span class="class">.jar</span>
    <span class="tag">minlog-1</span><span class="class">.2</span><span class="class">.jar</span>
    <span class="tag">asm-3</span><span class="class">.2</span><span class="class">.jar</span>
    <span class="tag">reflectasm-1</span><span class="class">.01</span><span class="class">.jar</span>
    <span class="tag">kryo-serializers-0</span><span class="class">.11</span><span class="class">.jar</span>
    <span class="tag">msm-kryo-serializer-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">spymemcached-2</span><span class="class">.10</span><span class="class">.3</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
    <span class="tag">memcached-session-manager-tc7-1</span><span class="class">.7</span><span class="class">.0</span><span class="class">.jar</span>
</code></pre><p>&#x5B98;&#x7F51;&#x4ECB;&#x7ECD;&#x8BF4; &#x4F7F;&#x7528;kryo &#x5E8F;&#x5217;&#x5316;tomcat&#x7684;&#x6548;&#x7387;&#x6700;&#x9AD8; &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x53EA;&#x4ECB;&#x7ECD;kryo&#x5E8F;&#x5217;&#x5316;&#x3002;&#x5177;&#x4F53;&#x6548;&#x7387;&#x5BF9;&#x6BD4;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8FDB;&#x4E00;&#x6B65;&#x9A8C;&#x8BC1;&#x3002;</p>
<p>1 &#x4FEE;&#x6539;tomcat/context.xml&#x6587;&#x4EF6; &#x65B0;&#x589E;&#x5982;&#x4E0B;&#x4EE3;&#x7801;</p>
<pre><code>&amp;lt;Manager <span class="variable">className=</span>&amp;quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&amp;quot;
        <span class="variable">memcachedNodes=</span>&amp;quot;n1:<span class="number">192.168</span>.<span class="number">0.216</span>:<span class="number">11211</span>&amp;quot; 
        <span class="variable">sticky=</span>&amp;quot;<span class="constant">false</span>&amp;quot;
        <span class="variable">storageKeyPrefix=</span>&amp;quot;context&amp;quot;
        <span class="variable">sessionBackupAsync=</span>&amp;quot;<span class="constant">false</span>&amp;quot;
        <span class="variable">lockingMode=</span>&amp;quot;uriPattern:/path1|/path2&amp;quot;
        <span class="variable">requestUriIgnorePattern=</span>&amp;quot;.*\.(ico|png|gif|jpg|css|js)$&amp;quot;
        <span class="variable">transcoderFactoryClass=</span>&amp;quot;de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory&amp;quot;
    /&amp;gt;
</code></pre><p>Manager &#x5404;&#x53C2;&#x6570;&#x8BF4;&#x660E;&#xFF1A;</p>
<p>className</p>
<p>&#x5FC5;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x914D;&#x7F6E;&#x4E3A;</p>
<pre><code><span class="tag">de</span><span class="class">.javakaffee</span><span class="class">.web</span><span class="class">.msm</span><span class="class">.MemcachedBackupSessionManager</span>&amp;<span class="id">#x548C</span>;<span class="tag">de</span><span class="class">.javakaffee</span><span class="class">.web</span><span class="class">.msm</span><span class="class">.DummyMemcachedBackupSessionManager</span>&amp;<span class="id">#x3002</span>;
</code></pre><p>&#x5176;&#x4E2D;DummyMemcachedBackupSessionManager&#x53EF;&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x771F;&#x5B9E;&#x5B58;&#x5728;memcached&#x3002;</p>
<p>memcachedNodes</p>
<p>&#x5FC5;&#x9009;&#x9879;&#xFF0C;memcached&#x7684;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#xFF0C;&#x683C;&#x5F0F;&#x5982;&#xFF1A;</p>
<pre><code>memcachedNodes=&amp;quot;<span class="string">n1:</span><span class="string">app01:</span><span class="number">11211</span>,<span class="string">n2:</span><span class="string">app02:</span><span class="number">11211</span>&amp;quot;&amp;#x3002;
</code></pre><p>failoverNodes</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x5728;non-sticky sessions&#x6A21;&#x5F0F;&#x3002;&#x6545;&#x969C;&#x8F6C;&#x79FB;&#x914D;&#x7F6E;&#x8282;&#x70B9;&#xFF0C;&#x591A;&#x4E2A;&#x4F7F;&#x7528;&#x7A7A;&#x683C;&#x6216;&#x9017;&#x53F7;&#x5206;&#x5F00;&#xFF0C;&#x914D;&#x7F6E;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x4E3A;&#x5907;&#x4EFD;&#x8282;&#x70B9;&#xFF0C;&#x5F53;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x90FD;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x624D;&#x4F1A;&#x5B58;&#x50A8;&#x5230;&#x5907;</p>
<p>&#x4EFD;&#x8282;&#x70B9;&#xFF0C;&#x5B98;&#x65B9;&#x5EFA;&#x8BAE;&#x914D;&#x7F6E;&#x4E3A;&#x548C;tomcat&#x540C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8282;&#x70B9;&#x3002;</p>
<p>&#x7406;&#x7531;&#x5982;&#x4E0B;:</p>
<p>&#x5047;&#x5982;&#x6709;&#x4E24;&#x53F0;&#x670D;&#x52A1;&#x5668;m1,m2&#xFF0C;&#x5176;&#x4E2D;m1&#x90E8;&#x7F72;tomcat&#x548C;memcached&#x8282;&#x70B9;n1&#xFF0C;m2&#x90E8;&#x7F72;memcached&#x8282;&#x70B9;n2&#x3002;</p>
<p>&#x5982;&#x679C;&#x914D;&#x7F6E;tomcat&#x7684;failoverNodes&#x503C;&#x4E3A;n2&#x6216;&#x8005;&#x4E0D;&#x914D;&#x7F6E;&#xFF0C;&#x5219;&#x5F53;&#x670D;&#x52A1;&#x5668;m1&#x6302;&#x6389;&#x540E;n1&#x548C;tomcat&#x4E2D;&#x4FDD;&#x5B58;&#x7684;session&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x800C;n2&#x4E2D;&#x672A;&#x4FDD;&#x5B58;&#x6216;&#x8005;&#x53EA;&#x4FDD;&#x5B58;&#x4E86;&#x90E8;&#x5206;session&#xFF0C;&#x8FD9;&#x5C31;&#x9020;&#x6210;</p>
<p>&#x90E8;&#x5206;&#x7528;&#x6237;&#x72B6;&#x6001;&#x4E22;&#x5931;&#x3002;</p>
<p>&#x5982;&#x679C;&#x914D;&#x7F6E;tomcat&#x7684;failoverNodes&#x503C;&#x4E3A;n1&#xFF0C;&#x5219;&#x5F53;m1&#x6302;&#x6389;&#x540E;&#x56E0;&#x4E3A;n2&#x4E2D;&#x4FDD;&#x5B58;&#x4E86;&#x6240;&#x6709;&#x7684;session&#xFF0C;&#x6240;&#x4EE5;&#x91CD;&#x542F;tomcat&#x7684;&#x65F6;&#x5019;&#x7528;&#x6237;&#x72B6;&#x6001;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#x3002;</p>
<p>&#x4E3A;&#x4EC0;&#x4E48;n2&#x4E2D;&#x4FDD;&#x5B58;&#x4E86;&#x6240;&#x6709;&#x7684;session? &#x56E0;&#x4E3A;failoverNodes&#x914D;&#x7F6E;&#x7684;&#x503C;&#x662F;n1&#xFF0C;&#x53EA;&#x6709;&#x5F53;n2&#x8282;&#x70B9;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x624D;&#x4F1A;&#x628A;session&#x5B58;&#x50A8;&#x5230;n1&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;n1&#x4E2D;&#x662F;&#x6CA1;&#x6709;&#x4FDD;&#x5B58;&#x4EFB;&#x4F55;session&#x7684;&#x3002;</p>
<p>username</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;SASL&#x7684;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5982;&#x679C;&#x8282;&#x70B9;&#x4FDD;&#x62A4;membase&#x7684;bucket uri&#x3002;</p>
<p>password</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x548C;username&#x642D;&#x914D;&#x4F7F;&#x7528;&#x3002;</p>
<p>memcachedProtocol</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x9ED8;&#x8BA4;text&#xFF0C;memcached&#x4F7F;&#x7528;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x53EF;&#x9009;&#x503C;&#xFF1A;text&#xFF0C;binary&#x3002;</p>
<p>sticky</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x9ED8;&#x8BA4;true&#xFF0C;&#x5236;&#x5B9A;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x7C98;&#x6027;session&#x6A21;&#x5F0F;&#x3002;</p>
<p>&#x8BF4;&#x9053;sticky &#x9700;&#x8981;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;</p>
<p>Sticky &#x6A21;&#x5F0F;&#xFF1A;</p>
<p>tomcat session &#x4E3A; &#x4E3B;session&#xFF0C; memcached &#x4E3A;&#x5907; session&#x3002;Request&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#xFF0C; &#x4ECE;memcached&#x52A0;&#x8F7D;&#x5907; session&#x5230; tomcat (&#x4EC5;&#x5F53;tomcat jvmroute&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;</p>
<p>&#x5426;&#x5219;&#x76F4;&#x63A5;&#x53D6;tomcat session)&#xFF1B;Request&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x5C06;tomcat session&#x66F4;&#x65B0;&#x81F3;memcached&#xFF0C;&#x4EE5;&#x8FBE;&#x5230;&#x4E3B;&#x5907;&#x540C;&#x6B65;&#x4E4B;&#x76EE;&#x7684;&#x3002;</p>
<p>Non-Sticky&#x6A21;&#x5F0F;&#xFF1A;tomcat session &#x4E3A; &#x4E2D;&#x8F6C;session&#xFF0C; memcached1 &#x4E3A;&#x4E3B; sessionmemcached 2 &#x4E3A;&#x5907;session&#x3002;Request&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#xFF0C;&#x4ECE;memcached 2&#x52A0;&#x8F7D;&#x5907; session</p>
<p>&#x5230; tomcat&#xFF0C;&#xFF08;&#x5F53; &#x5BB9;&#x5668; &#x4E2D;&#x8FD8;&#x662F;&#x6CA1;&#x6709;session &#x5219;&#x4ECE;memcached1&#x52A0;&#x8F7D;&#x4E3B; session &#x5230; tomcat&#xFF0C; &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x662F;&#x53EA;&#x6709;&#x4E00;&#x4E2A;memcached&#x8282;&#x70B9;&#xFF0C;&#x6216;&#x8005;&#x6709;memcached1 &#x51FA;&#x9519;&#x65F6;&#xFF09;&#xFF0C;</p>
<p>Request&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x5C06;tomcat session&#x66F4;&#x65B0;&#x81F3;&#x4E3B;memcached1&#x548C;&#x5907;memcached2&#xFF0C;&#x5E76;&#x4E14;&#x6E05;&#x9664;tomcat session &#x3002;&#x4EE5;&#x8FBE;&#x5230;&#x4E3B;&#x5907;&#x540C;&#x6B65;&#x4E4B;&#x76EE;&#x7684;&#x3002;</p>
<p>&#x591A;&#x53F0;tomcat&#x96C6;&#x7FA4;&#x65F6; &#x9700;&#x8981;&#x9009;&#x62E9;Non-Sticky&#x6A21;&#x5F0F;&#xFF0C;&#x5373;sticky=&quot;false&quot;</p>
<p>&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;&#x5F97;jar &#x5217;&#x8868;&#x5982;&#x4E0B;</p>
<pre><code><span class="tag">couchbase-client-1</span><span class="class">.2</span><span class="class">.2</span><span class="class">.jar</span>
       <span class="tag">kryo-1</span><span class="class">.03</span><span class="class">.jar</span>
       <span class="tag">kryo-serializers-0</span><span class="class">.10</span><span class="class">.jar</span>
       <span class="tag">memcached-2</span><span class="class">.5</span><span class="class">.jar</span>
       <span class="tag">memcached-session-manager-1</span><span class="class">.6</span><span class="class">.5</span><span class="class">.jar</span>
       <span class="tag">memcached-session-manager-tc7-1</span><span class="class">.6</span><span class="class">.5</span><span class="class">.jar</span>
       <span class="tag">minlog-1</span><span class="class">.2</span><span class="class">.jar</span>
       <span class="tag">msm-kryo-serializer-1</span><span class="class">.6</span><span class="class">.5</span><span class="class">.jar</span>
       <span class="tag">reflectasm-0</span><span class="class">.9</span><span class="class">.jar</span>
       <span class="tag">spymemcached-2</span><span class="class">.10</span><span class="class">.2</span><span class="class">.jar</span>
</code></pre><p>&#x5982;&#x679C;&#x4F60;&#x67E5;&#x770B;&#x8FC7;&#x6E90;&#x7801;&#xFF0C;&#x4F60;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x4F60;&#x8C03;&#x8BD5;&#x4E0D;&#x6210;&#x529F;&#xFF0C;session&#x4E0D;&#x5171;&#x4EAB;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x662F; memcached-session-manager-1.6.5.jar</p>
<p>memcached-session-manager-tc7-1.6.5.jar&#xA0;&#xA0; msm-kryo-serializer-1.6.5.jar&#xA0; &#x8FD9;&#x4E09;&#x4E2A;jar&#x5305;&#x51FA;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#x7248;&#x672C;&#x4E5F;&#x5F88;&#x91CD;&#x8981;&#x3002;</p>
<p>&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x4E00;&#x81F4;&#x4E5F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x65F6;&#x95F4;&#x4E0D;&#x4E00;&#x81F4;&#x5C06;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;session&#x8FC7;&#x671F;&#x3002;</p>
<p>memcached &#x7684;&#x542F;&#x52A8;&#x6240;&#x6709;&#x8005;&#x6700;&#x597D;&#x8BBE;&#x7F6E;&#x4E3A;nobody</p>
<p>&#x672C;&#x535A;&#x6587;&#x662F;&#x7ECF;&#x8FC7;&#x5B9E;&#x9645;&#x7535;&#x5546;&#x9879;&#x76EE;&#x9A8C;&#x8BC1;&#xFF0C;&#x5B9E;&#x9645;&#x767B;&#x5F55;&#x9A8C;&#x8BC1;&#xFF0C;&#x9A8C;&#x8BC1;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E0D;&#x65AD;&#x5173;&#x505C;&#x4E00;&#x4E9B;tomcat&#xFF0C;&#x6240;&#x4EE5;&#x672C;&#x535A;&#x6587;&#x53EF;&#x4F5C;&#x4E3A;&#x771F;&#x5B9E;&#x53C2;&#x8003;&#x3002;</p>
<p>&#x9A8C;&#x8BC1;&#x9879;&#x76EE;&#x4E3A;&#x5927;&#x7EA2;&#x889C;&#x5168;&#x7403;&#x8D2D;&#x3002;</p>
<p>lockingMode</p>
<p>&#x53EF;&#x9009;&#x503C;&#xFF0C;&#x9ED8;&#x8BA4;none&#xFF0C;&#x53EA;&#x5BF9;non-sticky&#x6709;&#x6548;&#x3002;</p>
<p>requestUriIgnorePattern</p>
<p>&#x53EF;&#x9009;&#x503C;&#xFF0C;&#x5236;&#x5B9A;&#x5FFD;&#x7565;&#x90A3;&#x4E9B;&#x8BF7;&#x6C42;&#x7684;session&#x64CD;&#x4F5C;&#xFF0C;&#x4E00;&#x822C;&#x5236;&#x5B9A;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x5982;css,js&#x4E00;&#x7C7B;&#x7684;&#x3002;</p>
<p>sessionBackupAsync</p>
<p>&#x53EF;&#x9009;&#x503C;&#xFF0C;&#x9ED8;&#x8BA4;true&#xFF0C;&#x662F;&#x5426;&#x5F02;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x5B58;&#x50A8;&#x5230;memcached&#x3002;</p>
<p>backupThreadCount</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;cpu&#x6838;&#x5FC3;&#x6570;&#xFF0C;&#x5F02;&#x6B65;&#x5B58;&#x50A8;session&#x7684;&#x7EBF;&#x7A0B;&#xFFFD;&#xFFFD;&#xFFFD;&#x3002;</p>
<p>sessionBackupTimeout</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x9ED8;&#x8BA4;100&#x6BEB;&#x79D2;&#xFF0C;&#x5F02;&#x6B65;&#x5B58;&#x50A8;session&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<p>operationTimeout</p>
<p>&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x9ED8;&#x8BA4;1000&#x6BEB;&#x79D2;&#xFF0C;memcached&#x7684;&#x64CD;&#x4F5C;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<p>storageKeyPrefix</p>
<p>&#x53EF;&#x9009;&#x503C;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;webappVersion&#xFF0C;&#x5B58;&#x50A8;&#x5230;memcached&#x7684;&#x524D;&#x7F00;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x533A;&#x5206;&#x591A;&#x4E2A;webapp&#x5171;&#x4EAB;session&#x7684;&#x60C5;&#x51B5;&#x3002;&#x53EF;&#x9009;&#x503C;&#xFF1A;&#x9759;&#x6001;&#x5B57;&#x7B26;&#x4E32;&#x3001;host&#x3001;context&#x3001;webappVersion&#xFF0C;</p>
<p>&#x591A;&#x4E2A;&#x4F7F;&#x7528;&#x9017;&#x53F7;&#x5206;&#x5272;&#x3002;</p>
<p>sessionAttributeFilter</p>
<p>&#x53EF;&#x9009;&#x503C;&#xFF0C;&#x901A;&#x8FC7;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x786E;&#x5B9A;&#x90A3;&#x4E9B;session&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x5E94;&#x8BE5;&#x88AB;&#x5B58;&#x50A8;&#x5230;memcached&#x3002;&#x4F8B;&#x5B50;&#x5982;&#xFF1A;sessionAttributeFilter=&quot;^(userName|sessionHistory)$&quot;&#x3002;</p>
<p>transcoderFactoryClass</p>
<p>&#x53EF;&#x9009;&#x503C;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;de.javakaffee.web.msm.JavaSerializationTranscoderFactory&#xFF0C;&#x5236;&#x5B9A;&#x5E8F;&#x5217;&#x5316;&#x548C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x6570;&#x636E;&#x5230;memcached&#x7684;&#x5DE5;&#x5382;&#x7C7B;&#x3002;</p>
<p>&#x4E09; &#x4F7F;&#x7528; filter &#x65B9;&#x6CD5;&#x5B58;&#x50A8;</p>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x6BD4;&#x8F83;&#x63A8;&#x8350;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528;&#x8303;&#x56F4;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x4E0D;&#x4EC5;&#x9650;&#x4E8E; tomcat &#xFF0C;&#x800C;&#x4E14;&#x5B9E;&#x73B0;&#x7684;&#x539F;&#x7406;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x5BB9;&#x6613;&#x63A7;&#x5236;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; memcached-session-filter</p>
<p>&#x5B98;&#x65B9;&#x7F51;&#x5740;&#xFF1A;<a href="http://code.google.com/p/memcached-session-filter/" target="_blank" rel="external">http://code.google.com/p/memcached-session-filter/</a></p>
<p>&#x5B98;&#x65B9;&#x4ECB;&#x7ECD;&#xFF1A;&#x89E3;&#x51B3;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E0B;java web&#x5BB9;&#x5668;session&#x5171;&#x4EAB;,&#x4F7F;&#x7528;filter&#x62E6;&#x622A;&#x5668;&#x548C;memcached&#x5B9E;&#x73B0;&#x3002;&#x5728;tomcat 6&#x548C;websphere 8&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#xFF0C;&#x73B0;&#x7F51;&#x5E76;&#x53D1;2000&#xFF0C;&#x65E5;PV&#x91CF;1100&#x4E07;&#x3002;</p>
<p>&#x6682;&#x4E0D;&#x652F;&#x6301;session event&#x5305;&#x62EC;create destory &#x548C; attribute change</p>
<p>&#x4E1C;&#x897F;&#x5F88;&#x4E0D;&#x9519;&#xFF0C;&#x4F53;&#x79EF;&#x5F88;&#x5C0F;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x4E2A;&#x4E1C;&#x4E1C;&#x8981;&#x548C; spring &#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x4E14;&#x8981;&#x6C42;&#x5B58;&#x50A8;&#x5230; memcached &#x7684;&#x5BF9;&#x8C61;&#x8981;&#x5B9E;&#x73B0; java &#x7684;&#x5E8F;&#x5217;&#x5316;&#x63A5;&#x53E3;</p>
<p>&#x5927;&#x5BB6;&#x4E5F;&#x77E5;&#x9053;&#xFF0C;java &#x672C;&#x8EAB;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x6027;&#x80FD;&#x4E5F;&#x5F88;&#x4E00;&#x822C;&#x3002;</p>
<p>&#x5C06;&#x5176;&#x7B80;&#x5355;&#x6269;&#x5C55;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4E0D;&#x518D;&#x4F9D;&#x8D56; spring &#xFF0C;&#x5E76;&#x4E14;&#x5229;&#x7528; javolution &#x5B9E;&#x73B0;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x7F13;&#x5B58;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x518D;&#x6709;&#x9650;&#x5236;&#x3002;</p>
<p><a href="http://annan211.iteye.com/blog/2209656#comments" target="_blank" rel="external">&#x5DF2;&#x6709; <strong>0</strong> &#x4EBA;&#x53D1;&#x8868;&#x7559;&#x8A00;&#xFF0C;&#x731B;&#x51FB;-&gt;&gt; <strong>&#x8FD9;&#x91CC;</strong> &lt;&lt;-&#x53C2;&#x4E0E;&#x8BA8;&#x8BBA;</a></p>
<p>ITeye&#x63A8;&#x8350;</p>
<ul>
<li><a href="http://www.iteye.com/clicks/433" target="_blank" rel="external">&#x2014;&#x8F6F;&#x4EF6;&#x4EBA;&#x624D;&#x514D;&#x8BED;&#x8A00;&#x4F4E;&#x62C5;&#x4FDD; &#x8D74;&#x7F8E;&#x5E26;&#x85AA;&#x8BFB;&#x7814;&#xFF01;&#x2014;</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Memcached/">Memcached</a><a href="/tags/Tomcat/">Tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fb3a38/" title="Web缓存技术-Memcached -" itemprop="url">Web缓存技术-Memcached -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>&#x4E92;&#x8054;&#x7F51;&#x4E0A;&#x7684;&#x5E94;&#x7528;&#x3001;&#x7F51;&#x7AD9;&#xFF0C;&#x968F;&#x7740;&#x7528;&#x6237;&#x7684;&#x589E;&#x957F;&#xFF0C;&#x529F;&#x80FD;&#x7684;&#x589E;&#x5F3A;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x5668;&#x8D85;&#x8F7D;&#xFF0C;&#x54CD;&#x5E94;&#x53D8;&#x6162;&#x7B49;&#x95EE;&#x9898;&#x3002;&#x7F13;&#x5B58;&#x6280;&#x672F;&#x662F;&#x51CF;&#x8F7B;&#x670D;&#x52A1;&#x5668;&#x538B;&#x529B;&#x3001;&#x52A0;&#x5FEB;&#x670D;&#x52A1;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x3001;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x7684;&#x6709;&#x6548;&#x9014;&#x5F84;&#x3002;Memcached&#x662F;&#x975E;&#x5E38;&#x6D41;&#x884C;&#x7684;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x5BF9;Memcached&#x7684;&#x5B89;&#x88C5;&#x3001;&#x8BBE;&#x5B9A;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="Memcached&#x7B80;&#x4ECB;">Memcached&#x7B80;&#x4ECB;</h2><p>Memcached&#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x3001;&#x9AD8;&#x6027;&#x80FD;&#x3001;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#xFF0C;&#x7528;&#x4E8E;&#x52A0;&#x901F;&#x52A8;&#x6001;&#x7F51;&#x7AD9;&#x7684;&#x8BBF;&#x95EE;&#xFF0C;&#x51CF;&#x8F7B;&#x6570;&#x636E;&#x5E93;&#x8D1F;&#x8F7D;&#x3002;</p>
<p>Memcached&#x4F7F;&#x7528;&#x4E86;Slab Allocator&#x7684;&#x673A;&#x5236;&#x5206;&#x914D;&#x3001;&#x7BA1;&#x7406;&#x5185;&#x5B58;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x5185;&#x5B58;&#x788E;&#x7247;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>Memcached&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x6A21;&#x5F0F;&#x4E0B;&#x8FD0;&#x884C;&#xFF0C;&#x4F46;&#x7EBF;&#x7A0B;&#x6570;&#x901A;&#x5E38;&#x53EA;&#x9700;&#x8BBE;&#x5B9A;&#x4E3A;&#x4E0E;CPU&#x6570;&#x91CF;&#x76F8;&#x540C;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x4E0E;Nginx&#x7684;&#x8BBE;&#x5B9A;&#x7C7B;&#x4F3C;&#x3002;</p>
<h2 id="Memcached&#x4F7F;&#x7528;">Memcached&#x4F7F;&#x7528;</h2><h4 id="&#x5B89;&#x88C5;:">&#x5B89;&#x88C5;:</h4><p>&#x5728;CentOS&#x4E0B;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x5B89;&#x88C5;&#xFF1A;</p>
<pre><code>sudo yum <span class="keyword">install</span> memcached
</code></pre><h4 id="&#x542F;&#x52A8;&#xFF1A;">&#x542F;&#x52A8;&#xFF1A;</h4><pre><code>memcached -<span class="keyword">m</span> 100 -p 11211 -<span class="keyword">d</span> -t 2 -c 1024 -P /tmp/memcached.pid
</code></pre><p>-m &#x6307;&#x5B9A;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5BB9;&#x91CF;&#xFF0C;&#x5355;&#x4F4D;MB&#xFF0C;&#x9ED8;&#x8BA4;64MB&#x3002;</p>
<p>-p &#x6307;&#x5B9A;&#x76D1;&#x542C;&#x7684;TCP&#x7AEF;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;11211&#x3002;</p>
<p>-d &#x4EE5;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x6A21;&#x5F0F;&#x542F;&#x52A8;&#x3002;</p>
<p>-t &#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;4&#x3002;</p>
<p>-c &#x6700;&#x5927;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;1024&#x3002;</p>
<p>-P &#x4FDD;&#x5B58;PID&#x6587;&#x4EF6;&#x3002;</p>
<h4 id="&#x5173;&#x95ED;&#xFF1A;">&#x5173;&#x95ED;&#xFF1A;</h4><pre><code><span class="keyword">kill</span> <span class="string">`cat /tmp/memcached.pid`</span>
</code></pre><h4 id="&#x6D4B;&#x8BD5;&#xFF1A;">&#x6D4B;&#x8BD5;&#xFF1A;</h4><p>&#x4F7F;&#x7528;telnet&#x8FDE;&#x63A5;memcached&#x670D;&#x52A1;&#x3002;</p>
<pre><code><span class="title">telnet</span> localhost <span class="number">11211</span>
</code></pre><p>&#x5B58;&#x50A8;&#x547D;&#x4EE4;&#x683C;&#x5F0F;&#xFFFD;&#xFFFD;&#xFFFD;</p>
<pre><code><span class="built_in">set</span> foo <span class="number">0</span> <span class="number">0</span> <span class="number">4</span>
abcd
STORED

<span class="subst">&amp;</span><span class="literal">lt</span>;command name<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;key<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;flags<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;exptime<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="built_in">bytes</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;<span class="built_in">data</span> block<span class="subst">&amp;</span><span class="literal">gt</span>;

<span class="subst">&amp;</span><span class="literal">lt</span>;command name<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="built_in">set</span>, add, replace<span class="subst">&amp;</span><span class="variable">#x7B49</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;key<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="variable">#x5173</span>;<span class="subst">&amp;</span><span class="variable">#x952E</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;flags<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="variable">#x6574</span>;<span class="subst">&amp;</span><span class="variable">#x5F62</span>;<span class="subst">&amp;</span><span class="variable">#x53C2</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5B58</span>;<span class="subst">&amp;</span><span class="variable">#x50A8</span>;<span class="subst">&amp;</span><span class="variable">#x5BA2</span>;<span class="subst">&amp;</span><span class="variable">#x6237</span>;<span class="subst">&amp;</span><span class="variable">#x7AEF</span>;<span class="subst">&amp;</span><span class="variable">#x5BF9</span>;<span class="subst">&amp;</span><span class="variable">#x952E</span>;<span class="subst">&amp;</span><span class="variable">#x503C</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x989D</span>;<span class="subst">&amp;</span><span class="variable">#x5916</span>;<span class="subst">&amp;</span><span class="variable">#x4FE1</span>;<span class="subst">&amp;</span><span class="variable">#x606F</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5982</span>;<span class="subst">&amp;</span><span class="variable">#x503C</span>;<span class="subst">&amp;</span><span class="variable">#x662F</span>;<span class="subst">&amp;</span><span class="variable">#x538B</span>;<span class="subst">&amp;</span><span class="variable">#x7F29</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x662F</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x7B26</span>;<span class="subst">&amp;</span><span class="variable">#x4E32</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x6216</span>;JSON<span class="subst">&amp;</span><span class="variable">#x7B49</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;exptime<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x636E</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x5B58</span>;<span class="subst">&amp;</span><span class="variable">#x6D3B</span>;<span class="subst">&amp;</span><span class="variable">#x65F6</span>;<span class="subst">&amp;</span><span class="variable">#x95F4</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5355</span>;<span class="subst">&amp;</span><span class="variable">#x4F4D</span>;<span class="subst">&amp;</span><span class="variable">#x4E3A</span>;<span class="subst">&amp;</span><span class="variable">#x79D2</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="number">0</span><span class="subst">&amp;</span><span class="variable">#x8868</span>;<span class="subst">&amp;</span><span class="variable">#x793A</span>;<span class="subst">&amp;</span><span class="variable">#x6C38</span>;<span class="subst">&amp;</span><span class="variable">#x8FDC</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;<span class="built_in">bytes</span><span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="variable">#x5B58</span>;<span class="subst">&amp;</span><span class="variable">#x50A8</span>;<span class="subst">&amp;</span><span class="variable">#x503C</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x8282</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;<span class="built_in">data</span> block<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="variable">#x5B58</span>;<span class="subst">&amp;</span><span class="variable">#x50A8</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x636E</span>;<span class="subst">&amp;</span><span class="variable">#x5185</span>;<span class="subst">&amp;</span><span class="variable">#x5BB9</span>;
</code></pre><p>&#x8BFB;&#x53D6;&#x547D;&#x4EE4;&#x683C;&#x5F0F;&#xFF1A;</p>
<pre><code>get foo
VALUE foo <span class="number">0</span> <span class="number">4</span>
abcd
END

<span class="subst">&amp;</span><span class="literal">lt</span>;command name<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;key<span class="subst">&amp;</span><span class="literal">gt</span>;

<span class="subst">&amp;</span><span class="literal">lt</span>;command name<span class="subst">&amp;</span><span class="literal">gt</span>; get, gets<span class="subst">&amp;</span><span class="variable">#x3002</span>;gets<span class="subst">&amp;</span><span class="variable">#x6BD4</span>;get<span class="subst">&amp;</span><span class="variable">#x591A</span>;<span class="subst">&amp;</span><span class="variable">#x8FD4</span>;<span class="subst">&amp;</span><span class="variable">#x56DE</span>;<span class="subst">&amp;</span><span class="variable">#x4E00</span>;<span class="subst">&amp;</span><span class="variable">#x4E2A</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x8FD9</span>;<span class="subst">&amp;</span><span class="variable">#x4E2A</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x68C0</span>;<span class="subst">&amp;</span><span class="variable">#x67E5</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x636E</span>;<span class="subst">&amp;</span><span class="variable">#x6709</span>;<span class="subst">&amp;</span><span class="variable">#x6CA1</span>;<span class="subst">&amp;</span><span class="variable">#x6709</span>;<span class="subst">&amp;</span><span class="variable">#x53D1</span>;<span class="subst">&amp;</span><span class="variable">#x751F</span>;<span class="subst">&amp;</span><span class="variable">#x53D8</span>;<span class="subst">&amp;</span><span class="variable">#x5316</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5F53</span>;key<span class="subst">&amp;</span><span class="variable">#x5BF9</span>;<span class="subst">&amp;</span><span class="variable">#x5E94</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x636E</span>;<span class="subst">&amp;</span><span class="variable">#x6539</span>;<span class="subst">&amp;</span><span class="variable">#x53D8</span>;<span class="subst">&amp;</span><span class="variable">#x65F6</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;gets<span class="subst">&amp;</span><span class="variable">#x591A</span>;<span class="subst">&amp;</span><span class="variable">#x8FD4</span>;<span class="subst">&amp;</span><span class="variable">#x56DE</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x4E5F</span>;<span class="subst">&amp;</span><span class="variable">#x4F1A</span>;<span class="subst">&amp;</span><span class="variable">#x6539</span>;<span class="subst">&amp;</span><span class="variable">#x53D8</span>;<span class="subst">&amp;</span><span class="variable">#x3002</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;key<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="variable">#x5173</span>;<span class="subst">&amp;</span><span class="variable">#x952E</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;

<span class="subst">&amp;</span><span class="variable">#x8FD4</span>;<span class="subst">&amp;</span><span class="variable">#x56DE</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x636E</span>;<span class="subst">&amp;</span><span class="variable">#x683C</span>;<span class="subst">&amp;</span><span class="variable">#x5F0F</span>;<span class="subst">&amp;</span><span class="variable">#xFF1A</span>;

VALUE <span class="subst">&amp;</span><span class="literal">lt</span>;key<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;flags<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="built_in">bytes</span><span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><p>CAS(checked and set)&#xFF1A;</p>
<pre><code>cas foo <span class="number">0</span> <span class="number">0</span> <span class="number">4</span> <span class="number">1</span>
cdef
STORED

cas <span class="subst">&amp;</span><span class="literal">lt</span>;key<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;flags<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;exptime<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="built_in">bytes</span><span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;version<span class="subst">&amp;</span><span class="literal">gt</span>;

<span class="subst">&amp;</span><span class="variable">#x9664</span>;<span class="subst">&amp;</span><span class="variable">#x6700</span>;<span class="subst">&amp;</span><span class="variable">#x540E</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;version<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="variable">#x5916</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5176</span>;<span class="subst">&amp;</span><span class="variable">#x4ED6</span>;<span class="subst">&amp;</span><span class="variable">#x53C2</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x4E0E</span>;<span class="built_in">set</span>, add<span class="subst">&amp;</span><span class="variable">#x7B49</span>;<span class="subst">&amp;</span><span class="variable">#x547D</span>;<span class="subst">&amp;</span><span class="variable">#x4EE4</span>;<span class="subst">&amp;</span><span class="variable">#x76F8</span>;<span class="subst">&amp;</span><span class="variable">#x540C</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;version<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x503C</span>;<span class="subst">&amp;</span><span class="variable">#x9700</span>;<span class="subst">&amp;</span><span class="variable">#x8981</span>;<span class="subst">&amp;</span><span class="variable">#x4E0E</span>;gets<span class="subst">&amp;</span><span class="variable">#x83B7</span>;<span class="subst">&amp;</span><span class="variable">#x53D6</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x503C</span>;<span class="subst">&amp;</span><span class="variable">#x76F8</span>;<span class="subst">&amp;</span><span class="variable">#x540C</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5426</span>;<span class="subst">&amp;</span><span class="variable">#x5219</span>;<span class="subst">&amp;</span><span class="variable">#x65E0</span>;<span class="subst">&amp;</span><span class="variable">#x6CD5</span>;<span class="subst">&amp;</span><span class="variable">#x66F4</span>;<span class="subst">&amp;</span><span class="variable">#x65B0</span>;<span class="subst">&amp;</span><span class="variable">#x3002</span>;
incr, decr<span class="subst">&amp;</span><span class="variable">#x53EF</span>;<span class="subst">&amp;</span><span class="variable">#x5BF9</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x578B</span>;<span class="subst">&amp;</span><span class="variable">#x6570</span>;<span class="subst">&amp;</span><span class="variable">#x636E</span>;<span class="subst">&amp;</span><span class="variable">#x8FDB</span>;<span class="subst">&amp;</span><span class="variable">#x884C</span>;<span class="subst">&amp;</span><span class="variable">#x539F</span>;<span class="subst">&amp;</span><span class="variable">#x5B50</span>;<span class="subst">&amp;</span><span class="variable">#x589E</span>;<span class="subst">&amp;</span><span class="variable">#x51CF</span>;<span class="subst">&amp;</span><span class="variable">#x64CD</span>;<span class="subst">&amp;</span><span class="variable">#x4F5C</span>;<span class="subst">&amp;</span><span class="variable">#x3002</span>;
</code></pre><p>&#x5168;&#x5C40;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;</p>
<pre><code>stats
STAT pid <span class="number">10218</span>
STAT <span class="tag">time</span> <span class="number">1432611519</span>
STAT curr_connections <span class="number">6</span>
STAT total_connections <span class="number">9</span>
STAT connection_structures <span class="number">7</span>
STAT reserved_fds <span class="number">10</span>
STAT cmd_get <span class="number">5</span>
STAT cmd_set <span class="number">1</span>
STAT cmd_flush <span class="number">0</span>
STAT cmd_touch <span class="number">0</span>
STAT get_hits <span class="number">3</span>
STAT get_misses <span class="number">2</span>
STAT delete_misses <span class="number">0</span>
STAT delete_hits <span class="number">0</span>
...
END
</code></pre><h2 id="Memcached&#x96C6;&#x7FA4;">Memcached&#x96C6;&#x7FA4;</h2><p>Memcached&#x672C;&#x8EAB;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x5BB9;&#x9519;&#x5904;&#x7406;&#xFF0C;&#x5BF9;&#x6545;&#x969C;&#x8282;&#x70B9;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x5B8C;&#x5168;&#x53D6;&#x51B3;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x5BF9;Memcached&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x8BF4;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x666E;&#x901A;&#x7684;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#xFF08;&#x54C8;&#x5E0C;&#x53D6;&#x6A21;&#xFF09;&#x6765;&#x5BFB;&#x627E;&#x76EE;&#x6807;Server&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x5728;&#x6709;&#x7F13;&#x5B58;&#x8282;&#x70B9;&#x5931;&#x6548;&#x65F6;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x5927;&#x9762;&#x79EF;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x4E0D;&#x53EF;&#x7528;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/1fb1cec.png" alt=""></p>
<p><img src="http://taojinke.github.io/img/20150703/1fb1f5d.png" alt=""></p>
<p>&#x5F53;Server3&#x5931;&#x6548;&#x540E;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x6839;&#x636E;&#x53EF;&#x7528;Server&#x6570;&#x91CF;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x7F13;&#x5B58;&#x7684;&#x76EE;&#x6807;Server&#xFF0C;&#x8FD9;&#x65F6;&#xFF0C;Key&#x7684;&#x54C8;&#x5E0C;&#x503C;&#x4E3A;10&#x7684;&#x6570;&#x636E;&#x88AB;&#x6307;&#x5B9A;&#x4E3A;&#x7531;Server1&#x7EF4;&#x62A4;&#xFF0C;&#x8FD9;&#x65F6;&#x539F;&#x672C;Server2&#x4E0A;&#x53EF;&#x7528;&#x7684;&#x7F13;&#x5B58;&#x4E5F;&#x65E0;&#x6548;&#x4E86;&#x3002;</p>
<h4 id="&#x4E00;&#x81F4;&#x6027;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;">&#x4E00;&#x81F4;&#x6027;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;</h4><p>&#x4E00;&#x81F4;&#x6027;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#x89E3;&#x51B3;&#x4E86;&#x5728;&#x52A8;&#x6001;&#x53D8;&#x5316;&#x7684;&#x7F13;&#x5B58;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5B9A;&#x4F4D;&#x76EE;&#x6807;Server&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x901A;&#x5E38;&#x7684;&#x5B9E;&#x73B0;&#x53EF;&#x5C06;&#x5B83;&#x60F3;&#x50CF;&#x6210;&#x4E00;&#x4E2A;&#x95ED;&#x5408;&#x7684;&#x73AF;&#x5F62;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/1fb21ce.png" alt=""></p>
<p>&#x5F53;&#x6709;&#x8282;&#x70B9;&#x5931;&#x6548;&#x65F6;&#xFF0C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x53EA;&#x6709;&#x539F;&#x672C;&#x5206;&#x914D;&#x5230;&#x5931;&#x6548;&#x8282;&#x70B9;&#x7684;&#x7F13;&#x5B58;&#x4F1A;&#x88AB;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/1fb21ce.png" alt=""></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Memcached/">Memcached</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fea1cd/" title="memcache的一致性hash算法使用 -" itemprop="url">memcache的一致性hash算法使用 -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="&#x4E00;&#x3001;&#x6982;&#x8FF0;">&#x4E00;&#x3001;&#x6982;&#x8FF0;</h4><p>1&#x3001;&#x6211;&#x4EEC;&#x7684;memcache&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x8FD9;&#x91CC;&#x6211;&#x770B;&#x7684;spymemcache&#x7684;&#x6E90;&#x7801;&#xFF09;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;ketama&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x8282;&#x70B9;&#x7684;&#x9009;&#x62E9;&#x3002;&#x4E0E;&#x5E38;&#x89C4;&#x7684;hash&#x7B97;&#x6CD5;&#x601D;&#x8DEF;&#x4E0D;&#x540C;&#xFF0C;&#x53EA;&#x662F;&#x5BF9;&#x6211;&#x4EEC;&#x8981;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;key&#x8FDB;&#x884C;hash&#x8BA1;&#x7B97;&#xFF0C;&#x5206;&#x914D;&#x5230;&#x4E0D;&#x540C;&#x8282;&#x70B9;&#x5B58;&#x50A8;&#x3002;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;&#x662F;&#x5BF9;&#x6211;&#x4EEC;&#x8981;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;hash&#x8BA1;&#x7B97;&#xFF0C;&#x8FDB;&#x800C;&#x786E;&#x8BA4;&#x6BCF;&#x4E2A;key&#x7684;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x3002;</p>
<h4 id="2&#x3001;&#x5E38;&#x89C4;hash&#x7B97;&#x6CD5;&#x7684;&#x5E94;&#x7528;&#x4EE5;&#x53CA;&#x5176;&#x5F0A;&#x7AEF;">2&#x3001;&#x5E38;&#x89C4;hash&#x7B97;&#x6CD5;&#x7684;&#x5E94;&#x7528;&#x4EE5;&#x53CA;&#x5176;&#x5F0A;&#x7AEF;</h4><p>&#x6700;&#x5E38;&#x89C4;&#x7684;&#x65B9;&#x5F0F;&#x83AB;&#x8FC7;&#x4E8E;hash&#x53D6;&#x6A21;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x6BD4;&#x5982;&#x96C6;&#x7FA4;&#x4E2D;&#x53EF;&#x7528;&#x673A;&#x5668;&#x9002;&#x91CF;&#x4E3A;N&#xFF0C;&#x90A3;&#x4E48;key&#x503C;&#x4E3A;K&#x7684;&#x7684;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x8BE5;&#x8DEF;&#x7531;&#x5230;hash(K) mod N&#x5BF9;&#x5E94;&#x7684;&#x673A;&#x5668;&#x3002;&#x7684;&#x786E;&#xFF0C;&#x8FD9;&#x79CD;&#x7ED3;&#x6784;&#x662F;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x4E5F;&#x662F;&#x5B9E;&#x7528;&#x7684;&#x3002;&#x4F46;&#x662F;&#x5728;&#x4E00;&#x4E9B;&#x9AD8;&#x901F;&#x53D1;&#x5C55;&#x7684;web&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4ECD;&#x6709;&#x4E9B;&#x7F3A;&#x9677;&#x3002;&#x968F;&#x7740;&#x7CFB;&#x7EDF;&#x8BBF;&#x95EE;&#x538B;&#x529B;&#x7684;&#x589E;&#x957F;&#xFF0C;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#x4E0D;&#x5F97;&#x4E0D;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7684;&#x65B9;&#x5F0F;&#x63D0;&#x9AD8;&#x96C6;&#x7FA4;&#x7684;&#x76F8;&#x5E94;&#x901F;&#x5EA6;&#x548C;&#x6570;&#x636E;&#x627F;&#x8F7D;&#x91CF;&#x3002;&#x589E;&#x52A0;&#x673A;&#x5668;&#x610F;&#x5473;&#x7740;&#x6309;&#x7167;hash&#x53D6;&#x6A21;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5728;&#x589E;&#x52A0;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7684;&#x8FD9;&#x4E00;&#x65F6;&#x523B;&#xFF0C;&#x5927;&#x91CF;&#x7684;&#x7F13;&#x5B58;&#x547D;&#x4E0D;&#x4E2D;&#xFF0C;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5EFA;&#x7ACB;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x8FDB;&#x884C;&#x6574;&#x4F53;&#x7684;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x8FC1;&#x79FB;&#xFF0C;&#x77AC;&#x95F4;&#x4F1A;&#x7ED9;DB&#x5E26;&#x6765;&#x6781;&#x9AD8;&#x7684;&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;&#xFF0C;&#x8BBE;&#x7F6E;&#x5BFC;&#x81F4;DB&#x670D;&#x52A1;&#x5668;&#x5B95;&#x673A;&#x3002;</p>
<h4 id="3&#x3001;&#x8BBE;&#x8BA1;&#x5206;&#x5E03;&#x5F0F;cache&#x7CFB;&#x7EDF;&#x65F6;&#xFF0C;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;&#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x54EA;&#x4E9B;&#x95EE;&#x9898;&#xFF1F;">3&#x3001;&#x8BBE;&#x8BA1;&#x5206;&#x5E03;&#x5F0F;cache&#x7CFB;&#x7EDF;&#x65F6;&#xFF0C;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;&#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x54EA;&#x4E9B;&#x95EE;&#x9898;&#xFF1F;</h4><p>&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x8BBE;&#x8BA1;&#xFFFD;&#xFFFD;&#xFFFD;&#x5FC3;&#x70B9;&#xFF1A;&#x5728;&#x8BBE;&#x8BA1;&#x5206;&#x5E03;&#x5F0F;cache&#x7CFB;&#x7EDF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BA9;key&#x7684;&#x5206;&#x5E03;&#x5747;&#x8861;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x589E;&#x52A0;cache server&#x540E;&#xFF0C;cache&#x7684;&#x8FC1;&#x79FB;&#x505A;&#x5230;&#x6700;&#x5C11;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x7684;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;ketama&#x7684;&#x505A;&#x6CD5;&#x662F;&#xFF1A;&#x9009;&#x62E9;&#x5177;&#x4F53;&#x7684;&#x673A;&#x5668;&#x8282;&#x70B9;&#x4E0D;&#x5728;&#x53EA;&#x4F9D;&#x8D56;&#x9700;&#x8981;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684;key&#x7684;hash&#x672C;&#x8EAB;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x673A;&#x5668;&#x8282;&#x70B9;&#x672C;&#x8EAB;&#x4E5F;&#x8FDB;&#x884C;&#x4E86;hash&#x8FD0;&#x7B97;&#x3002;</p>
<h4 id="&#x4E8C;&#x3001;&#x4E00;&#x81F4;&#x6027;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#x60C5;&#x666F;&#x63CF;&#x8FF0;&#xFF08;&#x8F6C;&#x8F7D;&#xFF09;">&#x4E8C;&#x3001;&#x4E00;&#x81F4;&#x6027;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#x60C5;&#x666F;&#x63CF;&#x8FF0;&#xFF08;&#x8F6C;&#x8F7D;&#xFF09;</h4><h4 id="1&#x3001;_hash&#x673A;&#x5668;&#x8282;&#x70B9;">1&#x3001; hash&#x673A;&#x5668;&#x8282;&#x70B9;</h4><p>&#x9996;&#x5148;&#x6C42;&#x51FA;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7684;hash&#x503C;&#xFF08;&#x600E;&#x4E48;&#x7B97;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7684;hash&#xFF1F;ip&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;hash&#x7684;&#x53C2;&#x6570;&#x5427;&#x3002;&#x3002;&#x5F53;&#x7136;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x65B9;&#x6CD5;&#x4E86;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5176;&#x5206;&#x5E03;&#x5230;0&#xFF5E;2^32&#x7684;&#x4E00;&#x4E2A;&#x5706;&#x73AF;&#x4E0A;&#xFF08;&#x987A;&#x65F6;&#x9488;&#x5206;&#x5E03;&#xFF09;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/1fe7f9f.gif" alt="0_1313570990ExQL"></p>
<p>&#x56FE;&#x4E00;</p>
<p>&#x96C6;&#x7FA4;&#x4E2D;&#x6709;&#x673A;&#x5668;&#xFF1A;A , B, C, D, E&#x4E94;&#x53F0;&#x673A;&#x5668;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x5B9A;&#x7684;hash&#x7B97;&#x6CD5;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x5206;&#x5E03;&#x5230;&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#x7684;&#x73AF;&#x4E0A;&#x3002;</p>
<h4 id="2&#x3001;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;">2&#x3001;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;</h4><p>&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x5199;&#x5165;&#x7F13;&#x5B58;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5176;&#x4E2D;Key&#x503C;&#x4E3A;K&#xFF0C;&#x8BA1;&#x7B97;&#x5668;hash&#x503C;Hash(K)&#xFF0C; Hash(K) &#x5BF9;&#x5E94;&#x4E8E;&#x56FE; &#x2013; 1&#x73AF;&#x4E2D;&#x7684;&#x67D0;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x70B9;&#x5BF9;&#x5E94;&#x6CA1;&#x6709;&#x6620;&#x5C04;&#x5230;&#x5177;&#x4F53;&#x7684;&#x67D0;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x8282;&#x70B9;&#xFF0C;&#x90A3;&#x4E48;&#x987A;&#x65F6;&#x9488;&#x67E5;&#x627E;&#xFF0C;&#x76F4;&#x5230;&#x7B2C;&#x4E00;&#x6B21;&#x627E;&#x5230;&#x6709;&#x6620;&#x5C04;&#x673A;&#x5668;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x8BE5;&#x8282;&#x70B9;&#x5C31;&#x662F;&#x786E;&#x5B9A;&#x7684;&#x76EE;&#x6807;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x4E86;2^32&#x4ECD;&#x7136;&#x627E;&#x4E0D;&#x5230;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x547D;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x8282;&#x70B9;&#x3002;&#x6BD4;&#x5982; Hash(K) &#x7684;&#x503C;&#x4ECB;&#x4E8E;A~B&#x4E4B;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x547D;&#x4E2D;&#x7684;&#x673A;&#x5668;&#x8282;&#x70B9;&#x5E94;&#x8BE5;&#x662F;B&#x8282;&#x70B9;&#xFF08;&#x5982;&#x4E0A;&#x56FE; &#xFF09;&#x3002;</p>
<h4 id="3&#x3001;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x7684;&#x5904;&#x7406;">3&#x3001;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x7684;&#x5904;&#x7406;</h4><p>&#x5982;&#x4E0A;&#x56FE; &#x2013; 1&#xFF0C;&#x5728;&#x539F;&#x6709;&#x96C6;&#x7FA4;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x6B32;&#x589E;&#x52A0;&#x4E00;&#x53F0;&#x673A;&#x5668;F&#xFF0C;&#x589E;&#x52A0;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x8BA1;&#x7B97;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7684;Hash&#x503C;&#xFF0C;&#x5C06;&#x673A;&#x5668;&#x6620;&#x5C04;&#x5230;&#x73AF;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/1fe8210.gif" alt="0_1313571008YJ5Q"></p>
<p>&#x56FE;&#x4E8C;</p>
<p>&#x589E;&#x52A0;&#x673A;&#x5668;&#x8282;&#x70B9;F&#x4E4B;&#x540E;&#xFF0C;&#x8BBF;&#x95EE;&#x7B56;&#x7565;&#x4E0D;&#x6539;&#x53D8;&#xFF0C;&#x4F9D;&#x7136;&#x6309;&#x7167;&#xFF08;2&#xFF09;&#x4E2D;&#x7684;&#x65B9;&#x5F0F;&#x8BBF;&#x95EE;&#xFF0C;&#x6B64;&#x65F6;&#x7F13;&#x5B58;&#x547D;&#x4E0D;&#x4E2D;&#x7684;&#x60C5;&#x51B5;&#x4F9D;&#x7136;&#x4E0D;&#x53EF;&#x907F;&#x514D;&#xFF0C;&#x4E0D;&#x80FD;&#x547D;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x662F;hash(K)&#x5728;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x4EE5;&#x524D;&#x843D;&#x5728;C&#xFF5E;F&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x3002;&#x5C3D;&#x7BA1;&#x4F9D;&#x7136;&#x5B58;&#x5728;&#x8282;&#x70B9;&#x589E;&#x52A0;&#x5E26;&#x6765;&#x7684;&#x547D;&#x4E2D;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x6BD4;&#x8F83;&#x4F20;&#x7EDF;&#x7684; hash&#x53D6;&#x6A21;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x81F4;&#x6027;hash&#x5DF2;&#x7ECF;&#x5C06;&#x4E0D;&#x547D;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x964D;&#x5230;&#x4E86;&#x6700;&#x4F4E;&#x3002;</p>
<p>Consistent Hashing&#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x6291;&#x5236;&#x4E86;hash&#x952E;&#x7684;&#x91CD;&#x65B0;&#x5206;&#x5E03;&#x3002;&#x53E6;&#x5916;&#x8981;&#x53D6;&#x5F97;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x5F80;&#x5F80;&#x5728;&#x670D;&#x52A1;&#x5668;&#x6570;&#x91CF;&#x6BD4;&#x8F83;&#x5C11;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x589E;&#x52A0;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x6765;&#x4FDD;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#x80FD;&#x5747;&#x5300;&#x7684;&#x5206;&#x5E03;&#x5728;&#x5706;&#x73AF;&#x4E0A;&#x3002;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;&#x4E00;&#x822C;&#x7684;hash&#x65B9;&#x6CD5;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6620;&#x5C04;&#x5730;&#x70B9;&#x7684;&#x5206;&#x5E03;&#x975E;&#x5E38;&#x4E0D;&#x5747;&#x5300;&#x3002;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x7269;&#x7406;&#x8282;&#x70B9;&#xFF08;&#x670D;&#x52A1;&#x5668;&#xFF09;&#x5728;&#x5706;&#x4E0A;&#x5206;&#x914D;100&#xFF5E;200&#x4E2A;&#x70B9;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x6291;&#x5236;&#x5206;&#x5E03;&#x4E0D;&#x5747;&#x5300;&#xFF0C;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x51CF;&#x5C0F;&#x670D;&#x52A1;&#x5668;&#x589E;&#x51CF;&#x65F6;&#x7684;&#x7F13;&#x5B58;&#x91CD;&#x65B0;&#x5206;&#x5E03;&#x3002;&#x7528;&#x6237;&#x6570;&#x636E;&#x6620;&#x5C04;&#x5728;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x5C31;&#x8868;&#x793A;&#x7528;&#x6237;&#x6570;&#x636E;&#x771F;&#x6B63;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x662F;&#x5728;&#x8BE5;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x4EE3;&#x8868;&#x7684;&#x5B9E;&#x9645;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;&#x4E0B;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x56FE;&#x63CF;&#x8FF0;&#x4E86;&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x53F0;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x589E;&#x52A0;&#x7684;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/1fe8481.gif" alt="0_1313571021fffF"></p>
<p>&#x56FE;&#x4E09;</p>
<p>x&#x8F74;&#x8868;&#x793A;&#x7684;&#x662F;&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x53F0;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x6269;&#x5C55;&#x7684;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x500D;&#x6570;(scale)&#xFF0C;y&#x8F74;&#x662F;&#x5B9E;&#x9645;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5F53;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x91CF;&#x5F88;&#x5C0F;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x66F4;&#x5927;&#x7684;&#x865A;&#x62DF;&#x8282;&#x70B9;&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x9700;&#x8981;&#x66F4;&#x5C11;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x4ECE;&#x56FE;&#x4E0A;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5728;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x6709;10&#x53F0;&#x65F6;&#xFF0C;&#x5DEE;&#x4E0D;&#x591A;&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x589E;&#x52A0;100~200&#x4E2A;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x624D;&#x80FD;&#x8FBE;&#x5230;&#x771F;&#x6B63;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<h4 id="&#x4E09;&#x3001;&#x4EE5;spymemcache&#x6E90;&#x7801;&#x6765;&#x6F14;&#x793A;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x5E94;&#x7528;">&#x4E09;&#x3001;&#x4EE5;spymemcache&#x6E90;&#x7801;&#x6765;&#x6F14;&#x793A;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x5E94;&#x7528;</h4><p>1&#x3001;&#x4E0A;&#x8FB9;&#x63CF;&#x8FF0;&#x7684;&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#x6709;&#x4E2A;&#x6F5C;&#x5728;&#x7684;&#x95EE;&#x9898;&#x662F;: </p>
<p>&#xFF08;1&#xFF09;&#x3001;&#x5C06;&#x8282;&#x70B9;hash&#x540E;&#x4F1A;&#x4E0D;&#x5747;&#x5300;&#x5730;&#x5206;&#x5E03;&#x5728;&#x73AF;&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x5927;&#x91CF;key&#x5728;&#x5BFB;&#x627E;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x4F1A;&#x5B58;&#x5728;key&#x547D;&#x4E2D;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x6982;&#x7387;&#x5DEE;&#x522B;&#x8F83;&#x5927;&#xFF0C;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x6709;&#x6548;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<p>&#xFF08;2&#xFF09;&#x3001;&#x5982;&#x6709;&#x4E09;&#x4E2A;&#x8282;&#x70B9;Node1,Node2,Node3&#xFF0C;&#x5206;&#x5E03;&#x5728;&#x73AF;&#x4E0A;&#x65F6;&#x4E09;&#x4E2A;&#x8282;&#x70B9;&#x6328;&#x7684;&#x5F88;&#x8FD1;&#xFF0C;&#x843D;&#x5728;&#x73AF;&#x4E0A;&#x7684;key&#x5BFB;&#x627E;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x5927;&#x91CF;key&#x987A;&#x65F6;&#x9488;&#x603B;&#x662F;&#x5206;&#x914D;&#x7ED9;Node2&#xFF0C;&#x800C;&#x5176;&#x5B83;&#x4E24;&#x4E2A;&#x8282;&#x70B9;&#x88AB;&#x627E;&#x5230;&#x7684;&#x6982;&#x7387;&#x90FD;&#x4F1A;&#x5F88;&#x5C0F;&#x3002;</p>
<p>2&#x3001;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x53EF;&#x4EE5;&#x6709;: </p>
<p>&#x6539;&#x5584;Hash&#x7B97;&#x6CD5;&#xFF0C;&#x5747;&#x5300;&#x5206;&#x914D;&#x5404;&#x8282;&#x70B9;&#x5230;&#x73AF;&#x4E0A;&#xFF1B;&#xFF3B;&#x5F15;&#x6587;&#xFF3D;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x7269;&#x7406;&#x8282;&#x70B9;&#xFF08;&#x670D;&#x52A1;&#x5668;&#xFF09;&#x5728;&#x5706;&#x4E0A;&#x5206;&#x914D;100&#xFF5E;200&#x4E2A;&#x70B9;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x6291;&#x5236;&#x5206;&#x5E03;&#x4E0D;&#x5747;&#x5300;&#xFF0C;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x51CF;&#x5C0F;&#x670D;&#x52A1;&#x5668;&#x589E;&#x51CF;&#x65F6;&#x7684;&#x7F13;&#x5B58;&#x91CD;&#x65B0;&#x5206;&#x5E03;&#x3002;&#x7528;&#x6237;&#x6570;&#x636E;&#x6620;&#x5C04;&#x5728;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x5C31;&#x8868;&#x793A;&#x7528;&#x6237;&#x6570;&#x636E;&#x771F;&#x6B63;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x662F;&#x5728;&#x8BE5;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x4EE3;&#x8868;&#x7684;&#x5B9E;&#x9645;&#x7269;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;</p>
<p>&#x5728;&#x67E5;&#x770B;Spy Memcached client&#x65F6;&#xFF0C;&#x53D1;&#x73B0;&#x5B83;&#x91C7;&#x7528;&#x4E00;&#x79CD;&#x79F0;&#x4E3A;Ketama&#x7684;Hash&#x7B97;&#x6CD5;&#xFF0C;&#x4EE5;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x89E3;&#x51B3;Memcached&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x95EE;&#x9898;&#x3002;</p>
<h4 id="3&#x3001;&#x6E90;&#x7801;&#x8BF4;&#x660E;">3&#x3001;&#x6E90;&#x7801;&#x8BF4;&#x660E;</h4><p>&#x8BE5;client&#x91C7;&#x7528;TreeMap&#x5B58;&#x50A8;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;&#x6A21;&#x62DF;&#x4E00;&#x4E2A;&#x73AF;&#x5F62;&#x7684;&#x903B;&#x8F91;&#x5173;&#x7CFB;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x73AF;&#x4E2D;&#xFF0C;&#x8282;&#x70B9;&#x4E4B;&#x524D;&#x662F;&#x5B58;&#x5728;&#x987A;&#x5E8F;&#x5173;&#x7CFB;&#x7684;&#xFF0C;&#x6240;&#x4EE5;TreeMap&#x7684;key&#x5FC5;&#x987B;&#x5B9E;&#x73B0;Comparator&#x63A5;&#x53E3;&#x3002;&#x90A3;&#x8282;&#x70B9;&#x662F;&#x600E;&#x6837;&#x653E;&#x5165;&#x8FD9;&#x4E2A;&#x73AF;&#x4E2D;&#x7684;&#x5462;&#xFF1F; </p>
<ol>
<li>&#xA0;&#xA0; protected void setKetamaNodes(List&lt;MemcachedNode&gt; nodes) {&#xA0;&#xA0;</li>
<li>TreeMap&lt;Long, MemcachedNode&gt; newNodeMap = new TreeMap&lt;Long, MemcachedNode&gt;();&#xA0;&#xA0;</li>
<li>int numReps= config.getNodeRepetitions();&#xA0;&#xA0;</li>
<li>for(MemcachedNode node : nodes) {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; // Ketama does some special work with md5 where it reuses chunks.&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; if(hashAlg == HashAlgorithm.KETAMA_HASH) {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for(int i=0; i&lt;numReps / 4; i++) {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; byte[] digest=HashAlgorithm.computeMd5(config.getKeyForNode(node, i));&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for(int h=0;h&lt;4;h++) {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; Long k = ((long)(digest[3+h*4]&amp;0xFF) &lt;&lt; 24)&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | ((long)(digest[2+h*4]&amp;0xFF) &lt;&lt; 16)&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | ((long)(digest[1+h*4]&amp;0xFF) &lt;&lt; 8)&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; | (digest[h*4]&amp;0xFF);&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; newNodeMap.put(k, node);&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; getLogger().debug(&#x201C;Adding node %s in position %d&#x201D;, node, k);&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; } else {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; for(int i=0; i&lt;numReps; i++) {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; newNodeMap.put(hashAlg.hash(config.getKeyForNode(node, i)), node);&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;</li>
<li>}&#xA0;&#xA0;</li>
<li>assert newNodeMap.size() == numReps * nodes.size();&#xA0;&#xA0;</li>
<li>ketamaNodes = newNodeMap;&#xA0;</li>
</ol>
<p>&#x4E0A;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x5927;&#x6982;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5F52;&#x7EB3;:&#x56DB;&#x4E2A;&#x865A;&#x62DF;&#x7ED3;&#x70B9;&#x4E3A;&#x4E00;&#x7EC4;&#xFF0C;&#x4EE5;getKeyForNode&#x65B9;&#x6CD5;&#x5F97;&#x5230;&#x8FD9;&#x7EC4;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x7684;name&#xFF0C;Md5&#x7F16;&#x7801;&#x540E;&#xFF0C;&#x6BCF;&#x4E2A;&#x865A;&#x62DF;&#x7ED3;&#x70B9;&#x5BF9;&#x5E94;Md5&#x7801;16&#x4E2A;&#x5B57;&#x8282;&#x4E2D;&#x7684;4&#x4E2A;&#xFF0C;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;long&#x578B;&#x6570;&#x503C;&#xFF0C;&#x505A;&#x4E3A;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x7ED3;&#x70B9;&#x5728;&#x73AF;&#x4E2D;&#x7684;&#x60DF;&#x4E00;key&#x3002;&#x7B2C;10&#x884C;k&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Long&#x578B;&#x7684;&#x5462;&#xFF1F;&#x5C31;&#x662F;&#x56E0;&#x4E3A;Long&#x578B;&#x5B9E;&#x73B0;&#x4E86;Comparator&#x63A5;&#x53E3;&#x3002;</p>
<p>&#x5904;&#x7406;&#x5B8C;&#x6B63;&#x5F0F;&#x7ED3;&#x70B9;&#x5728;&#x73AF;&#x4E0A;&#x7684;&#x5206;&#x5E03;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;key&#x5728;&#x73AF;&#x4E0A;&#x5BFB;&#x627E;&#x8282;&#x70B9;&#x7684;&#x6E38;&#x620F;&#x4E86;&#x3002;</p>
<p>&#xFFFD;&#xFFFD;&#xFFFD;&#x4E8E;&#x6BCF;&#x4E2A;key&#x8FD8;&#x662F;&#x5F97;&#x5B8C;&#x6210;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;:&#x8BA1;&#x7B97;&#x51FA;Md5&#xFF0C;&#x6839;&#x636E;Md5&#x7684;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#xFF0C;&#x901A;&#x8FC7;Kemata Hash&#x7B97;&#x6CD5;&#x5F97;&#x5230;key&#x5728;&#x8FD9;&#x4E2A;&#x73AF;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<ol>
<li>MemcachedNode getNodeForKey(long hash) {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; final MemcachedNode rv;&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; if(!ketamaNodes.containsKey(hash)) {&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; // Java 1.6 adds a ceilingKey method, but I&#x2019;m still stuck in 1.5&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; // in a lot of places, so I&#x2019;m doing this myself.&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; SortedMap&lt;Long, MemcachedNode&gt; tailMap=getKetamaNodes().tailMap(hash);&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if(tailMap.isEmpty()) {&#xA0;&#xA0;</li>
<li>hash=getKetamaNodes().firstKey();&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; } else {&#xA0;&#xA0;</li>
<li>hash=tailMap.firstKey();&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; }&#xA0;&#xA0;</li>
<li>rv=getKetamaNodes().get(hash);&#xA0;&#xA0;</li>
<li>&#xA0;&#xA0;&#xA0; return rv;&#xA0;&#xA0;</li>
<li>}&#xA0;</li>
</ol>
<p>&#x4E0A;&#x8FB9;&#x4EE3;&#x7801;&#x7684;&#x5B9E;&#x73B0;&#x5C31;&#x662F;&#x5728;&#x73AF;&#x4E0A;&#x987A;&#x65F6;&#x9488;&#x67E5;&#x627E;&#xFF0C;&#x6CA1;&#x627E;&#x5230;&#x5C31;&#x53BB;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x77E5;&#x9053;&#x5BF9;&#x5E94;&#x7684;&#x7269;&#x7406;&#x8282;&#x70B9;&#x4E86;&#x3002;</p>
<h4 id="&#x56DB;&#x3001;&#x5E94;&#x7528;&#x573A;&#x666F;&#x5206;&#x6790;">&#x56DB;&#x3001;&#x5E94;&#x7528;&#x573A;&#x666F;&#x5206;&#x6790;</h4><p>1&#x3001;memcache&#x7684;add&#x65B9;&#x6CD5;&#xFF1A;&#x901A;&#x8FC7;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;&#x786E;&#x8BA4;&#x5F53;&#x524D;&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x5E94;&#x7684;cacheserver&#x7684;hash&#x503C;&#x4EE5;&#x53CA;&#x8981;&#x5B58;&#x50A8;&#x6570;&#x636E;key&#x7684;hash&#x8FDB;&#x884C;&#x5BF9;&#x5E94;&#xFF0C;&#x786E;&#x8BA4;cacheserver&#xFF0C;&#x83B7;&#x53D6;connection&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5B58;&#x50A8;</p>
<p>2&#x3001;memcache&#x7684;get&#x65B9;&#x6CD5;&#xFF1A;&#x901A;&#x8FC7;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;&#x786E;&#x8BA4;&#x5F53;&#x524D;&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x5E94;&#x7684;cacheserver&#x7684;hash&#x503C;&#x4EE5;&#x53CA;&#x8981;&#x63D0;&#x53D6;&#x6570;&#x636E;&#x7684;hash&#x503C;&#xFF0C;&#x8FDB;&#x800C;&#x786E;&#x8BA4;&#x5B58;&#x50A8;&#x7684;cacheserver&#xFF0C;&#x83B7;&#x53D6;connection&#x8FDB;&#x884C;&#x6570;&#x636E;&#x63D0;&#x53D6;</p>
<h4 id="&#x4E94;&#x3001;&#x603B;&#x7ED3;">&#x4E94;&#x3001;&#x603B;&#x7ED3;</h4><p>1&#x3001;&#x4E00;&#x81F4;&#x6027;hash&#x7B97;&#x6CD5;&#x53EA;&#x662F;&#x5E2E;&#x6211;&#x4EEC;&#x51CF;&#x5C11;cache&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x673A;&#x5668;&#x6570;&#x91CF;&#x589E;&#x51CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;cache&#x7684;&#x6570;&#x636E;&#x80FD;&#x8FDB;&#x884C;&#x6700;&#x5C11;&#x91CD;&#x5EFA;&#x3002;&#x53EA;&#x8981;cache&#x96C6;&#x7FA4;&#x7684;server&#x6570;&#x91CF;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x5FC5;&#x7136;&#x4EA7;&#x751F;&#x6570;&#x636E;&#x547D;&#x4E2D;&#x7684;&#x95EE;&#x9898;</p>
<p>2&#x3001;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x5206;&#x5E03;&#x5747;&#x8861;&#x95EE;&#x9898;&#xFF0C;&#x901A;&#x8FC7;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x7684;&#x601D;&#x60F3;&#x6765;&#x8FBE;&#x5230;&#x5747;&#x8861;&#x5206;&#x914D;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x6211;&#x4EEC;cache server&#x8282;&#x70B9;&#x8D8A;&#x5C11;&#x5C31;&#x8D8A;&#x9700;&#x8981;&#x865A;&#x62DF;&#x8282;&#x70B9;&#x8FD9;&#x4E2A;&#x65B9;&#x5F0F;&#x6765;&#x5747;&#x8861;&#x8D1F;&#x8F7D;&#x3002;</p>
<p>3&#x3001;&#x6211;&#x4EEC;&#x7684;cache&#x5BA2;&#x6237;&#x7AEF;&#x6839;&#x672C;&#x4E0D;&#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;map&#x6765;&#x8BB0;&#x5F55;&#x6BCF;&#x4E2A;key&#x5B58;&#x50A8;&#x5728;&#x54EA;&#x91CC;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;key&#x7684;hash&#x548C;cacheserver&#xFF08;&#x4E5F;&#x8BB8;ip&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF09;&#x7684;hash&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x7684;key&#x5E94;&#x8BE5;&#x5B58;&#x50A8;&#x5728;&#x54EA;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x3002;</p>
<p>4&#x3001;&#x5F53;&#x6211;&#x4EEC;&#x7684;cache&#x8282;&#x70B9;&#x5D29;&#x6E83;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x5FC5;&#x5B9A;&#x4E22;&#x5931;&#x90E8;&#x5206;cache&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x8981;&#x6839;&#x636E;&#x6D3B;&#x7740;&#x7684;cache server&#x548C;key&#x8FDB;&#x884C;&#x65B0;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x5339;&#x914D;&#x8BA1;&#x7B97;&#x3002;&#x6709;&#x53EF;&#x80FD;&#x5BF9;&#x90E8;&#x5206;&#x6CA1;&#x6709;&#x4E22;&#x5931;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x8981;&#x505A;&#x91CD;&#x5EFA;&#x2026;</p>
<p>5&#x3001;&#x81F3;&#x4E8E;&#x6B63;&#x5E38;&#x5230;&#x8FBE;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x4F55;&#x627E;&#x5230;key&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x5C31;&#x662F;cache server&#x672C;&#x8EAB;&#x7684;&#x5185;&#x90E8;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x6B64;&#x5904;&#x4E0D;&#x505A;&#x63CF;&#x8FF0;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x9488;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#x4EE5;&#x53CA;&#x63D0;&#x53D6;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x4E86;&#x6D41;&#x7A0B;&#x5C55;&#x793A;&#x3002;</p>
<p>&#x8F6C;&#x8F7D;&#x81EA;&#xFF1A; <a href="http://blog.csdn.net/kongqz/article/details/6695417" target="_blank" rel="external">http://blog.csdn.net/kongqz/article/details/6695417</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Memcached/">Memcached</a><a href="/tags/Nosql/">Nosql</a><a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fae736/" title="Memcached(一)、HelloWorld -" itemprop="url">Memcached(一)、HelloWorld -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>&#x4E00;&#x3001;&#x7B80;&#x4ECB;</p>
<p>&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x67B6;&#x6784;&#x79BB;&#x4E0D;&#x5F00;&#x7F13;&#x5B58;&#xFF0C;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x4F7C;&#x4F7C;&#x8005;&#x5F53;&#x5C5E;memcached&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x4E0D;&#x540C;&#x7684;key hash&#x5230;&#x4E0D;&#x540C;&#x7684;memcached&#x670D;&#x52A1;&#x5668;&#x4E2D;&#xFF0C;&#x800C;&#x83B7;&#x53D6;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x5230;&#x76F8;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x96C6;&#x7FA4;&#x540C;&#x6B65;&#xFF0C;&#x4E5F;&#x5C31;&#x7701;&#x53BB;&#x4E86;&#x96C6;&#x7FA4;&#x95F4;&#x540C;&#x6B65;&#x7684;&#x5F00;&#x9500;&#x548C;&#x5EF6;&#x8FDF;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x76F8;&#x5BF9;&#x4E8E;ehcache&#x7B49;&#x7F13;&#x5B58;&#x6765;&#x8BF4;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#x5E94;&#x7528;&#xFF0C;&#x5177;&#x6709;&#x66F4;&#x5F3A;&#x7684;&#x6A2A;&#x5411;&#x4F38;&#x7F29;&#x80FD;&#x529B;&#x3002;</p>
<p>&#x4E8C;&#x3001;&#x5BA2;&#x6237;&#x7AEF;</p>
<p>&#x9009;&#x62E9;&#x4E00;&#x4E2A;memcached&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x7528;&#x7684;&#x662F;memcached client for java&#xFF08;&#x89C1;&#x9644;&#x4EF6;&#xFF09;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x8FD8;&#x6709;Spymemcached&#xFF0C;&#x56FD;&#x4EA7;&#x7684;&#x6709;xmemcached&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x975E;java&#x9886;&#x57DF;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<p>&#x4E09;&#x3001;HelloWorld</p>
<p>memcached.properties:</p>
<pre><code><span class="setting">servers=<span class="value">localhost:<span class="number">11211</span></span></span>
<span class="setting">failover=<span class="value"><span class="keyword">true</span></span></span>
<span class="setting">initConn=<span class="value"><span class="number">10</span></span></span>
<span class="setting">minConn=<span class="value"><span class="number">5</span></span></span>
<span class="setting">maxConn=<span class="value"><span class="number">250</span></span></span>
<span class="setting">maintSleep=<span class="value"><span class="number">30</span></span></span>
<span class="setting">nagle=<span class="value"><span class="keyword">false</span></span></span>
<span class="setting">socketTO=<span class="value"><span class="number">3000</span></span></span>
<span class="setting">aliveCheck=<span class="value"><span class="keyword">true</span></span></span>
</code></pre><p>&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x7C7B;&#xFF1A;</p>
<pre><code>public class MemcachedMain {
    @BeforeClass
    public static void setUpBeforeClass<span class="params">()</span> throws Exception {
       initPool<span class="params">()</span>;
    }
    @AfterClass
    public static void tearDownAfterClass<span class="params">()</span> throws Exception {
    }
    @Before
    public void setUp<span class="params">()</span> throws Exception {
    }
    @After
    public void tearDown<span class="params">()</span> throws Exception {
    }
    private static void initPool<span class="params">()</span> throws Exception{
        Properties props = getProperties<span class="params">()</span>;
        String[] servers = <span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;servers&amp;quot;)</span>)</span>.split<span class="params">(&amp;quot;,&amp;quot;)</span>;
<span class="comment">//        String[] servers = {&amp;quot;192.168.137.200:11211&amp;quot;};</span>
        SockIOPool pool = SockIOPool.getInstance<span class="params">()</span>;
        pool.setServers<span class="params">(servers)</span>;
        pool.setFailover<span class="params">(Boolean.valueOf<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;failover&amp;quot;)</span>)</span>)</span>;
        pool.setInitConn<span class="params">(Integer.parseInt<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;initConn&amp;quot;)</span>)</span>)</span>;
        pool.setMinConn<span class="params">(Integer.parseInt<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;minConn&amp;quot;)</span>)</span>)</span>;
        pool.setMaxConn<span class="params">(Integer.parseInt<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;maxConn&amp;quot;)</span>)</span>)</span>;
        pool.setMaintSleep<span class="params">(Integer.parseInt<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;maintSleep&amp;quot;)</span>)</span>)</span>;
        pool.setNagle<span class="params">(Boolean.valueOf<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;magle&amp;quot;)</span>)</span>)</span>;
        pool.setSocketTO<span class="params">(Integer.parseInt<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;socketTO&amp;quot;)</span>)</span>)</span>;
        pool.setAliveCheck<span class="params">(Boolean.valueOf<span class="params">(<span class="params">(String)</span>props.get<span class="params">(&amp;quot;aliveCheck&amp;quot;)</span>)</span>)</span>;
        pool.initialize<span class="params">()</span>;
    }
    private static Properties getProperties<span class="params">()</span> throws Exception{
        Properties props = new Properties<span class="params">()</span>;
        InputStream in = MemcachedMain.class.getResourceAsStream<span class="params">(&amp;quot;/memcached.properties&amp;quot;)</span>;
        props.load<span class="params">(in)</span>;
        return props;
    }
    @Test
    public void memcachedHelloworld<span class="params">()</span> throws Exception{
        MemCachedClient client = new MemCachedClient<span class="params">()</span>;
        <span class="keyword">for</span> <span class="params">(int i = <span class="number">0</span>; i &amp;lt; <span class="number">10</span>; i++)</span> {
           boolean success = client.set<span class="params">(&amp;quot;&amp;quot; + i, &amp;quot;Memcached Hello world!&amp;quot;)</span>;
           String result = <span class="params">(String)</span> client.get<span class="params">(&amp;quot;&amp;quot; + i)</span>;
           System.out.println<span class="params">(String.format<span class="params">(&amp;quot;get<span class="params">( %d )</span>: %s&amp;quot;, i, result)</span>)</span>;
        }
    }
}
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Java/">Java</a><a href="/tags/Memcached/">Memcached</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fd8699/" title="通过MySQL的UDFs和Trigger操作Memcached -" itemprop="url">通过MySQL的UDFs和Trigger操作Memcached -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:31.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p> &#x901A;&#x8FC7;MySQL&#x7684;UDFs&#x548C;Trigger&#x64CD;&#x4F5C;Memcached </p>
<p>UDFs&#x662F;User Defined Functions&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x8868;&#x793A;MySQL&#x7684;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x4ECE;MySQL 5.0&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#x7684;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8BBF;&#x95EE;Memcached&#x5199;&#x5165;&#x6216;&#x8005;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x3002;&#x6B64;&#x5916;&#xFF0C;MySQL&#x4ECE;5.1&#x7248;&#x672C;&#x5F00;&#x59CB;&#x652F;&#x6301;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x5728;&#x89E6;&#x53D1;&#x5668;&#x4E2D;&#x4F7F;&#x7528;UDFs&#x76F4;&#x63A5;&#x66F4;&#x65B0;Memcached&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x964D;&#x4F4E;&#x4E86;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x548C;&#x7F16;&#x5199;&#x7684;&#x590D;&#x6742;&#x6027;&#x3002;&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;UDFs&#x7684;&#x5B89;&#x88C5;&#x548C;&#x4F7F;&#x7528;&#x3002;</p>
<p>UDFs&#x5B89;&#x88C5; </p>
<p>&#x5B89;&#x88C5;UDFs&#xFF0C;&#x9700;&#x8981;&#x4F9D;&#x6B21;&#x5B89;&#x88C5;MySQL&#x3001;libevent&#x3001;memcached&#x3001;libmemcached&#x3001;memcached_functions_sql&#x3002;</p>
<h4 id="1-_&#x5B89;&#x88C5;mysql-5-6-24-tar-gz">1. &#x5B89;&#x88C5;mysql-5.6.24.tar.gz</h4><p>&#x53C2;&#x7167;&#x4E4B;&#x524D;&#x7684;&#x535A;&#x6587; <a href="http://ultrasql.blog.51cto.com/9591438/1640997" target="_blank" rel="external">&#x300A;InnoDB memcached&#x63D2;&#x4EF6;&#x90E8;&#x7F72;&#x300B;</a> &#x4E2D;MySQL&#x5B89;&#x88C5;&#x90E8;&#x5206;&#x3002; </p>
<h4 id="2-_&#x5B89;&#x88C5;libevent-2-0-22-stable-tar-gz&#x548C;&#x5B89;&#x88C5;memcached-1-4-22-tar-gz">2. &#x5B89;&#x88C5;libevent-2.0.22-stable.tar.gz&#x548C;&#x5B89;&#x88C5;memcached-1.4.22.tar.gz</h4><p>&#x53C2;&#x7167;&#x4E4B;&#x524D;&#x7684;&#x535A;&#x6587; <a href="http://ultrasql.blog.51cto.com/9591438/1632179" target="_blank" rel="external">&#x300A;Memcached 1.4.22&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#x300B;</a> &#x3002; </p>
<h4 id="3-_&#x5B89;&#x88C5;libmemcached-0-34-tar-gz">3. &#x5B89;&#x88C5;libmemcached-0.34.tar.gz</h4><p>memcached functions for mysql&#x5B98;&#x7F51;&#x53D1;&#x5E03;&#x7684;1.1&#x7248;&#x672C;&#x662F;09&#x5E74;&#x7684;&#xFF0C;&#x53EA;&#x517C;&#x5BB9;libmemcached0.34&#x7248;&#x672C;&#x3002;</p>
<pre><code>mkdir -p <span class="regexp">/usr/</span>local/libmemcached
wget <span class="string">https:</span><span class="comment">//launchpad.net/libmemcached/1.0/0.34/+download/libmemcached-0.34.tar.gz</span>
tar zxvf libmemcached-<span class="number">0.34</span>.tar.gz
cd libmemcached-<span class="number">0.34</span>
.<span class="regexp">/configure --prefix=/</span>usr<span class="regexp">/local/</span>libmemcached --with-memcached=<span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>memcached
make
make install
</code></pre><h4 id="4-_&#x5B89;&#x88C5;memcached_functions_mysql">4. &#x5B89;&#x88C5;memcached_functions_mysql</h4><pre><code>wget <span class="string">https:</span><span class="comment">//launchpad.net/memcached-udfs/trunk/1.1/+download/memcached_functions_mysql-1.1.tar.gz</span>
tar xvf memcached_functions_mysql-<span class="number">1.1</span>.tar.gz
cd memcached_functions_mysql-<span class="number">1.1</span>
.<span class="regexp">/configure --prefix=/</span>usr<span class="regexp">/local/</span>memcache_mysql --with-mysql=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>bin<span class="regexp">/mysql_config --with-libmemcached=/</span>usr<span class="regexp">/local/</span>libmemcached
make
make install
</code></pre><h4 id="5-_&#x62F7;&#x8D1D;lib&#x6587;&#x4EF6;&#x5230;mysql&#x7684;plugin&#x4E0B;&#x9762;">5. &#x62F7;&#x8D1D;lib&#x6587;&#x4EF6;&#x5230;mysql&#x7684;plugin&#x4E0B;&#x9762;</h4><pre><code>cp <span class="regexp">/usr/</span>local<span class="regexp">/memcache_mysql/</span>lib<span class="regexp">/libmemcached_functions* /u</span>sr<span class="regexp">/local/my</span>sql<span class="regexp">/lib/</span>plugin
</code></pre><h4 id="6-_&#x914D;&#x7F6E;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;">6. &#x914D;&#x7F6E;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;</h4><pre><code>echo <span class="subst">&amp;</span>quot;/usr/<span class="built_in">local</span>/lib<span class="subst">&amp;</span>quot; <span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">gt</span>; /etc/ld<span class="built_in">.</span>so<span class="built_in">.</span>conf
ldconfig
</code></pre><h4 id="7-_&#x6DFB;&#x52A0;memcache_UDF_&#x51FD;&#x6570;">7. &#x6DFB;&#x52A0;memcache UDF &#x51FD;&#x6570;</h4><pre><code>mysql &amp;lt<span class="comment">; ./sql/install_functions.sql</span>
</code></pre><p>&#x5907;&#x6CE8;&#xFF1A;</p>
<p>&#x9996;&#x6B21;&#x9700;&#x8981;&#x4F7F;&#x7528;CREATE FUNCTION&#x6765;&#x521D;&#x59CB;&#x5316;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x3002;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x521D;&#x59CB;&#x5316;&#x6240;&#x6709;MySQL&#x63D0;&#x4F9B;&#x7684;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#xFF1A;</p>
<p>&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x5728;MySQL&#x7684;SQL&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x6267;&#x884C;memcached_functions_mysql&#x6E90;&#x7801;&#x76EE;&#x5F55;&#x4E0B;&#x7684;sql/install_functions.sql&#x3002;&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x8FD0;&#x884C;memcached_functions_mysql&#x6E90;&#x7801;&#x76EE;&#x5F55;&#x4E0B;&#x7684;utils/install.pl&#x8FD9;&#x4E2A;Perl&#x811A;&#x672C;&#xFF0C;&#x628A;memcache function&#x4F5C;&#x4E3A;UDFs&#x52A0;&#x5165;MySQL&#x3002;</p>
<h4 id="8-_&#x6267;&#x884C;&#x4E0B;&#x9762;SQL&#x547D;&#x4EE4;&#xFF0C;&#x67E5;&#x770B;&#x5B89;&#x88C5;&#x662F;&#x5426;&#x6210;&#x529F;&#x3002;">8. &#x6267;&#x884C;&#x4E0B;&#x9762;SQL&#x547D;&#x4EE4;&#xFF0C;&#x67E5;&#x770B;&#x5B89;&#x88C5;&#x662F;&#x5426;&#x6210;&#x529F;&#x3002;</h4><pre><code>mysql&amp;gt; select name,dl from mysql.func;
+------------------------------+---------------------------------+
|<span class="string"> name </span>|<span class="string"> dl </span>|
+------------------------------+---------------------------------+
|<span class="string"> memc_add </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_add_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_servers_set </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_server_count </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_set </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_set_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_cas </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_cas_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_get </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_get_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_get_cas </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_get_cas_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_delete </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_delete_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_append </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_append_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_prepend </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_prepend_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_increment </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_decrement </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_replace </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_replace_by_key </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_servers_behavior_set </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_servers_behavior_get </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_behavior_set </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_behavior_get </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_list_behaviors </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_list_hash_types </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_list_distribution_types </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_udf_version </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_libmemcached_version </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_stats </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_stat_get_keys </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
|<span class="string"> memc_stat_get_value </span>|<span class="string"> libmemcached_functions_mysql.so </span>|
+------------------------------+---------------------------------+
34 rows in set (0.00 sec)
</code></pre><p>&#x4F7F;&#x7528;Trigger&#x64CD;&#x4F5C;Memcached </p>
<h4 id="1-_&#x521B;&#x5EFA;&#x4E24;&#x5F20;&#x8868;">1. &#x521B;&#x5EFA;&#x4E24;&#x5F20;&#x8868;</h4><p>&#x65B0;&#x5EFA;&#x4E24;&#x5F20;&#x8868;&#xFF1A;urls&#x548C;results&#xFF0C;&#x66F4;&#x65B0;urls&#x8868;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4F7F;&#x7CFB;&#x7EDF;&#x81EA;&#x52A8;&#x66F4;&#x65B0;Memcached&#x7684;&#x5185;&#x5BB9;&#x3002;results&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x66F4;&#x65B0;Memcached&#x5931;&#x8D25;&#x7684;&#x8BB0;&#x5F55;&#x3002;</p>
<p>SQL&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code><span class="operator"><span class="keyword">use</span> test;</span>
<span class="operator"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> urls;</span>
<span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`urls`</span> (
<span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,
<span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> &amp;apos;</span>&amp;apos;,
PRIMARY KEY (`id`)
);
<span class="operator"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> results;</span>
<span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`results`</span> (
<span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,
<span class="string">`result`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> &amp;apos;</span>error&amp;apos;,
`time` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`)
);
</code></pre><h4 id="2-_&#x5EFA;&#x7ACB;3&#x4E2A;trigger">2. &#x5EFA;&#x7ACB;3&#x4E2A;trigger</h4><p>&#x5F53;&#x5411;urls&#x8868;&#x4E2D;&#x63D2;&#x5165;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5BF9;Memcached&#x6267;&#x884C;set&#x64CD;&#x4F5C;&#x3002;trigger&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>DELIMITER //
<span class="operator"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> url_mem_insert;</span>
<span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> url_mem_insert
<span class="keyword">BEFORE</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> urls
<span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> <span class="keyword">BEGIN</span>
<span class="keyword">set</span> @mm = memc_set(NEW.id, NEW.url);</span>
if @mm &amp;lt;&amp;gt; 0 then
<span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> results(id) <span class="keyword">values</span>(NEW.id);</span>
<span class="operator"><span class="keyword">end</span> <span class="keyword">if</span>;</span>
<span class="operator"><span class="keyword">END</span> //
DELIMITER ;</span>
</code></pre><p>&#x5F53;&#x5BF9;urls&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x65F6;&#xFF0C;&#x5BF9;Memcached&#x6267;&#x884C;replace&#x64CD;&#x4F5C;&#x3002;trigger&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>DELIMITER //
<span class="operator"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> url_mem_update;</span>
<span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> url_mem_update
<span class="keyword">BEFORE</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> urls
<span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> <span class="keyword">BEGIN</span>
<span class="keyword">set</span> @mm = memc_replace(OLD.id,NEW.url);</span>
if @mm &amp;lt;&amp;gt; 0 then
<span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> results(id) <span class="keyword">values</span>(OLD.id);</span>
<span class="operator"><span class="keyword">end</span> <span class="keyword">if</span>;</span>
<span class="operator"><span class="keyword">END</span> //
DELIMITER ;</span>
</code></pre><p>&#x5F53;&#x5BF9;urls&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5BF9;Memcached&#x6267;&#x884C;delete&#x64CD;&#x4F5C;&#x3002;trigger&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>DELIMITER //
<span class="operator"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> url_mem_delete;</span>
<span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> url_mem_delete
<span class="keyword">BEFORE</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> urls
<span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> <span class="keyword">BEGIN</span>
<span class="keyword">set</span> @mm = memc_delete(OLD.ID);</span>
if @mm &amp;lt;&amp;gt; 0 then
<span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> results(id) <span class="keyword">values</span>(OLD.id);</span>
<span class="operator"><span class="keyword">end</span> <span class="keyword">if</span>;</span>
<span class="operator"><span class="keyword">END</span> //
DELIMITER ;</span>
</code></pre><h4 id="3-_&#x8BBE;&#x7F6E;Memcached&#x76F8;&#x5173;&#x53C2;&#x6570;">3. &#x8BBE;&#x7F6E;Memcached&#x76F8;&#x5173;&#x53C2;&#x6570;</h4><p>&#x8BBE;&#x7F6E;UDFs&#x64CD;&#x4F5C;Memcaced&#x670D;&#x52A1;&#x5668;&#x7684;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x3002;</p>
<pre><code><span class="header">mysql&amp;gt; SELECT memc_servers_set(&amp;apos;192.168.11.52:11211&amp;apos;);
+-----------------------------------------+</span>
<span class="header">| memc_servers_set(&amp;apos;192.168.11.52:11211&amp;apos;) |
+-----------------------------------------+</span>
<span class="header">| 0 |
+-----------------------------------------+</span>
1 row in set (0.07 sec)
<span class="header">mysql&amp;gt;select memc_server_count();
+---------------------+</span>
<span class="header">| memc_server_count() |
+---------------------+</span>
<span class="header">| 1 |
+---------------------+</span>
1 row in set (0.00 sec)
</code></pre><p>&#x5728;MySQL&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x5217;&#x51FA;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;Memcached&#x53C2;&#x6570;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x548C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>mysql&amp;gt;select memc_list_behaviors()\G
<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> 1. row <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>
memc_list_behaviors():
MEMCACHED SERVER BEHAVIORS
MEMCACHED_BEHAVIOR_SUPPORT_CAS
MEMCACHED_BEHAVIOR_NO_BLOCK
MEMCACHED_BEHAVIOR_TCP_NODELAY
MEMCACHED_BEHAVIOR_HASH
MEMCACHED_BEHAVIOR_CACHE_LOOKUPS
MEMCACHED_BEHAVIOR_SOCKET_SEND_SIZE
MEMCACHED_BEHAVIOR_SOCKET_RECV_SIZE
MEMCACHED_BEHAVIOR_BUFFER_REQUESTS
MEMCACHED_BEHAVIOR_KETAMA
MEMCACHED_BEHAVIOR_POLL_TIMEOUT
MEMCACHED_BEHAVIOR_RETRY_TIMEOUT
MEMCACHED_BEHAVIOR_DISTRIBUTION
MEMCACHED_BEHAVIOR_BUFFER_REQUESTS
MEMCACHED_BEHAVIOR_USER_DATA
MEMCACHED_BEHAVIOR_SORT_HOSTS
MEMCACHED_BEHAVIOR_VERIFY_KEY
MEMCACHED_BEHAVIOR_CONNECT_TIMEOUT
MEMCACHED_BEHAVIOR_KETAMA_WEIGHTED
MEMCACHED_BEHAVIOR_KETAMA_HASH
MEMCACHED_BEHAVIOR_BINARY_PROTOCOL
MEMCACHED_BEHAVIOR_SND_TIMEOUT
MEMCACHED_BEHAVIOR_RCV_TIMEOUT
MEMCACHED_BEHAVIOR_SERVER_FAILURE_LIMIT
MEMCACHED_BEHAVIOR_IO_MSG_WATERMARK
MEMCACHED_BEHAVIOR_IO_BYTES_WATERMARK
1 row in set (0.00 sec)
</code></pre><p>&#x8BBE;&#x7F6E;MEMCACHED_BEHAVIOR_NO_BLOCK&#x4E3A;&#x6253;&#x5F00;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x6837;&#x5728;Memcached&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF08;&#x4E0D;&#x80FD;&#x8FDE;&#x63A5;&#xFF09;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x63D2;&#x5165;MySQL&#x4E2D;&#xFF0C;&#x4F46;&#x6709;&#x62A5;&#x9519;&#x63D0;&#x793A;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#x6B64;&#x503C;&#xFF0C;&#x90A3;&#x4E48;Memcached&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x9700;&#x8981;&#x7B49;&#x5230;Memcached&#x5931;&#x8D25;&#x8D85;&#x65F6;&#x540E;&#x624D;&#x53EF;&#x4EE5;&#x63D2;&#x5165;&#x5230;&#x8868;&#x4E2D;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x53D1;&#x751F;&#x3002;</p>
<pre><code><span class="header">mysql&amp;gt;select memc_servers_behavior_set(&amp;apos;MEMCACHED_BEHAVIOR_NO_BLOCK&amp;apos;,&amp;apos;1&amp;apos;);
+--------------------------------------------------------------+</span>
<span class="header">| memc_servers_behavior_set(&amp;apos;MEMCACHED_BEHAVIOR_NO_BLOCK&amp;apos;,&amp;apos;1&amp;apos;) |
+--------------------------------------------------------------+</span>
<span class="header">| 0 |
+--------------------------------------------------------------+</span>
1 row in set (0.00 sec)
<span class="header">mysql&amp;gt;select memc_servers_behavior_set(&amp;apos;MEMCACHED_BEHAVIOR_TCP_NODELAY&amp;apos;,&amp;apos;1&amp;apos;);
+-----------------------------------------------------------------+</span>
<span class="header">| memc_servers_behavior_set(&amp;apos;MEMCACHED_BEHAVIOR_TCP_NODELAY&amp;apos;,&amp;apos;1&amp;apos;) |
+-----------------------------------------------------------------+</span>
<span class="header">| 0 |
+-----------------------------------------------------------------+</span>
1 row in set (0.00 sec)
</code></pre><h4 id="4-_&#x5BF9;memcached_functions_mysql&#x7684;&#x7B80;&#x5355;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;">4. &#x5BF9;memcached_functions_mysql&#x7684;&#x7B80;&#x5355;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;</h4><p>1&#xFF09;&#x5411;&#x8868;urls&#x4E2D;&#x63D2;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x770B;Memcached&#x662F;&#x5426;&#x5BF9;&#x6570;&#x636E;&#x6267;&#x884C;set&#x64CD;&#x4F5C;&#x3002;</p>
<pre><code>mysql&amp;gt;insert into urls (id,url) values (1, &amp;apos;http://www.test.com.cn&amp;apos;);
Query OK, 1 row affected, 1 warning (0.00 sec)
<span class="header">mysql&amp;gt; select memc_get(&amp;apos;1&amp;apos;);
+------------------------+</span>
<span class="header">| memc_get(&amp;apos;1&amp;apos;) |
+------------------------+</span>
<span class="header">| http://www.test.com |
+------------------------+</span>
1 row in set (0.00 sec)

1&amp;gt;telnet 192.168.11.52 11211
Trying 192.168.11.52...
Connected to 192.168.11.52 (192.168.11.52).
Escape character is &amp;apos;^]&amp;apos;.
get 1
VALUE 1 0 22
http://www.test.com.cn
END
</code></pre><p>2&#xFF09;&#x66F4;&#x65B0;&#x8868;urls&#x91CC;&#x9762;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x8BE2;Memcached&#x4E2D;&#x662F;&#x5426;&#x4E5F;&#x8FDB;&#x884C;&#x4E86;&#x66F4;&#x65B0;&#x3002;</p>
<pre><code>mysql&amp;gt;update test.urls set url=&amp;apos;http://blog.test.com.cn&amp;apos; where id=1;
Query OK, 1 row affected, 1 warning (0.00 sec)
Rows matched: 1 Changed: 1 Warnings: 0
<span class="header">mysql&amp;gt; select memc_replace(&amp;apos;1&amp;apos;,&amp;apos;http://blog.test.com.cn&amp;apos;);
+---------------------------------------------+</span>
<span class="header">| memc_replace(&amp;apos;1&amp;apos;,&amp;apos;http://blog.test.com.cn&amp;apos;) |
+---------------------------------------------+</span>
<span class="header">| 0 |
+---------------------------------------------+</span>
1 row in set (0.00 sec)
<span class="header">mysql&amp;gt; select memc_get(&amp;apos;1&amp;apos;);
+-------------------------+</span>
<span class="header">| memc_get(&amp;apos;1&amp;apos;) |
+-------------------------+</span>
<span class="header">| http://blog.test.com.cn |
+-------------------------+</span>
1 row in set (0.00 sec)

1&amp;gt;telnet 192.168.11.52 11211
Trying 192.168.11.52...
Connected to 192.168.11.52(192.168.11.52).
Escape character is &amp;apos;^]&amp;apos;.
get 1
VALUE 1 0 23
http://blog.test.com.cn
END
</code></pre><p>3&#xFF09;&#x5220;&#x9664;&#x8868;urls&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x770B;Memcached&#x662F;&#x5426;&#x4E5F;&#x5C06;&#x8BE5;&#x6570;&#x636E;&#x5220;&#x9664;&#x4E86;&#x3002;</p>
<pre><code>mysql&amp;gt;delete from test.urls where id=1;
Query OK, 1 row affected, 1 warning (0.00 sec)
Rows matched: 1 Changed: 1 Warnings: 0
<span class="header">mysql&amp;gt; select memc_get(&amp;apos;1&amp;apos;);
+---------------+</span>
<span class="header">| memc_get(&amp;apos;1&amp;apos;) |
+---------------+</span>
<span class="header">| NULL |
+---------------+</span>
1 row in set (0.00 sec)

1&amp;gt;telnet 192.168.11.52 11211
Trying 192.168.11.52...
Connected to 192.168.11.52 (192.168.11.52).
Escape character is &amp;apos;^]&amp;apos;.
get 1
END
</code></pre><h4 id="5-_&#x4F7F;&#x7528;memcached_functions_mysql&#x7684;&#x7ECF;&#x9A8C;&#x4E0E;&#x6280;&#x5DE7;">5. &#x4F7F;&#x7528;memcached_functions_mysql&#x7684;&#x7ECF;&#x9A8C;&#x4E0E;&#x6280;&#x5DE7;</h4><p>memcached_functions_mysql&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x73AF;&#x5883;&#x7684;&#x5DEE;&#x522B;&#xFF0C;&#x5728;&#x5B9E;&#x8DF5;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x8BF8;&#x591A;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4E0B;&#x9762;&#x603B;&#x7ED3;&#x4E86;&#x4E00;&#x4E9B;&#x5728;&#x4F7F;&#x7528;memcached_functions_mysq&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x548C;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#x3002;</p>
<p>1) MySQL&#x91CD;&#x542F;&#x95EE;&#x9898;</p>
<p>&#x5982;&#x679C;MySQL&#x670D;&#x52A1;&#x5668;&#x51FA;&#x73B0;&#x91CD;&#x542F;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x8FDE;&#x63A5;Memcached&#x5173;&#x7CFB;&#xFF08;SELECT memc_servers_set(&apos;192.168.11.52:11211&apos;))&#x3002;</p>
<p>2) &#x7A0B;&#x5E8F;BUG&#x95EE;&#x9898;</p>
<p>memcached_functions_mysql&#x7684;&#x6E90;&#x7A0B;&#x5E8F;&#x6709;&#x53EF;&#x80FD;&#x5B58;&#x5728;bug&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5BFC;&#x81F4;MySQL&#x7684;&#x5931;&#x8D25;&#x3002;&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x8BFB;&#x8005;&#x8981;&#x5C3D;&#x91CF;&#x9009;&#x62E9;&#x6E90;&#x7A0B;&#x5E8F;&#x7684;&#x7A33;&#x5B9A;&#x7248;&#x672C;&#x3002;</p>
<p>3) &#x7F51;&#x7EDC;&#x56E0;&#x7D20;</p>
<p>&#x7F51;&#x7EDC;&#x56E0;&#x7D20;&#x662F;&#x6307;MySQL&#x548C;Memcached&#x662F;&#x5426;&#x5904;&#x5728;&#x540C;&#x4E00;&#x4E2A;IDC&#x3001;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x7F51;&#x7EDC;&#x6027;&#x80FD;&#x662F;&#x5426;&#x5F88;&#x597D;&#x3002;&#x7F51;&#x7EDC;&#x6027;&#x80FD;&#x8D8A;&#x597D;&#xFF0C;&#x5219;&#x901F;&#x5EA6;&#x8D8A;&#x5FEB;&#x3002;&#x4F7F;&#x7528;&#x672C;&#x673A;&#x7684;Memcached&#x53EF;&#x4EE5;&#x9002;&#x5F53;&#x51CF;&#x5C11;&#x7F51;&#x7EDC;&#x5F00;&#x9500;&#x3002;</p>
<p>4) &#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x91CF;</p>
<p>&#x63D2;&#x5165;&#x6570;&#x636E;&#x91CF;&#x7684;&#x5927;&#x5C0F;&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x65B9;&#x9762;&#xFF1A;&#x5411;MySQL&#x63D2;&#x5165;&#x6BCF;&#x6761;&#x8BB0;&#x5F55;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5411;Memcached&#x4E2D;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x66F4;&#x65B0;MySQL&#x3001;Memcached&#x7684;&#x6570;&#x636E;&#x8D8A;&#x5927;&#xFF0C;&#x66F4;&#x65B0;&#x7684;&#x901F;&#x5EA6;&#x8D8A;&#x6162;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8981;&#x505A;&#x597D;&#x524D;&#x671F;&#x89C4;&#x5212;&#x3002;</p>
<p>5) &#x5EF6;&#x65F6;&#x95EE;&#x9898;</p>
<p>&#x5982;&#x679C;MySQL&#x6240;&#x5728;&#x7684;&#x673A;&#x5668;&#x4F7F;&#x7528;&#x7684;&#x8D44;&#x6E90;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x66F4;&#x65B0;Memcached&#x8FC7;&#x4E8E;&#x7F13;&#x6162;&#xFF0C;&#x5373;&#x51FA;&#x73B0;&#x7C7B;&#x4F3C;m/s&#x7684;&#x5EF6;&#x65F6;&#x95EE;&#x9898;&#x3002;</p>
<p>6) &#x5BB9;&#x707E;&#x95EE;&#x9898;</p>
<p>&#x5982;&#x679C;MySQL&#x548C;Memcached&#x4E2D;&#x6709;&#x5B95;&#x673A;&#x60C5;&#x51B5;&#x51FA;&#x73B0;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x8003;&#x8651;&#x600E;&#x4E48;&#x6062;&#x590D;&#xFF0C;&#x6839;&#x636E;&#x524D;&#x4E00;&#x5C0F;&#x8282;&#x7684;&#x6D4B;&#x8BD5;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8003;&#x8651;&#xFF1A;&#x5EFA;&#x4E00;&#x5F20;&#x9519;&#x8BEF;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x66F4;&#x65B0;mc&#x65F6;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x81EA;&#x52A8;&#x628A;&#x66F4;&#x65B0;&#x9519;&#x8BEF;&#x7684;&#x8BB0;&#x5F55;&#x63D2;&#x5230;&#x8FD9;&#x5F20;&#x8868;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x67E5;&#x8BE2;&#x8FD9;&#x5F20;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x54EA;&#x4E9B;&#x6570;&#x636E;&#x5728;&#x4EC0;&#x4E48;&#x65F6;&#x95F4;&#x51FA;&#x73B0;&#x8FC7;&#x66F4;&#x65B0;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x5982;&#x679C;memcached_functions_mysql&#x5E94;&#x7528;&#x4E8E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#xFF0C;&#x9700;&#x8981;&#x8003;&#x8651;&#x76D1;&#x63A7;&#x548C;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x65F6;&#x7684;&#x6062;&#x590D;&#x5DE5;&#x4F5C;&#xFF08;&#x5199;&#x597D;&#x811A;&#x672C;&#x4EE5;&#x5B8C;&#x5584;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;&#xFF09;&#x3002;</p>
<p>7) MySQL&#x81EA;&#x8EAB;&#x56E0;&#x7D20;</p>
<p>&#x5982;&#x6267;&#x884C;&#x7684;MySQL&#x8BED;&#x53E5;&#x7684;&#x6548;&#x7387;&#x4EE5;&#x53CA;&#x8FDE;&#x63A5;MySQL&#x7684;client&#x7A0B;&#x5E8F;&#xFF08;php&#xFF09;&#x7684;&#x8FDE;&#x63A5;&#x5F00;&#x9500;&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x90FD;&#x9700;&#x8981;&#x8003;&#x8651;&#x3002;</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Memcached/">Memcached</a><a href="/tags/MySQL/">MySQL</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1fa6ab3/" title="在windows上编译memcached v1.4.24 (用cygwin) -" itemprop="url">在windows上编译memcached v1.4.24 (用cygwin) -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:30.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="&#x7F16;&#x8BD1;&#x73AF;&#x5883;">&#x7F16;&#x8BD1;&#x73AF;&#x5883;</h2><p>cygwin x86 &#x5F53;&#x524D;&#x6700;&#x65B0; win7 x64 sp1</p>
<h2 id="&#x6210;&#x54C1;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;(ldd&#x8F93;&#x51FA;)">&#x6210;&#x54C1;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;(ldd&#x8F93;&#x51FA;)</h2><pre><code>$ ldd <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>memcached
    ntdll.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>SysWOW64/ntdll.dll (<span class="number">0x77780000</span>)
    kernel32.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>syswow64/kernel32.dll (<span class="number">0x76fa0000</span>)
    KERNELBASE.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>syswow64/KERNELBASE.dll (<span class="number">0x76b30000</span>)
    ADVAPI32.DLL =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>syswow64/ADVAPI32.DLL (<span class="number">0x75770000</span>)
    msvcrt.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>syswow64/msvcrt.dll (<span class="number">0x75810000</span>)
    sechost.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>SysWOW64/sechost.dll (<span class="number">0x769e0000</span>)
    RPCRT4.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>syswow64/RPCRT4.dll (<span class="number">0x770d0000</span>)
    SspiCli.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>syswow64/SspiCli.dll (<span class="number">0x75110000</span>)
    CRYPTBASE.dll =&amp;gt; <span class="regexp">/cygdrive/</span>c<span class="regexp">/Windows/</span>syswow64/CRYPTBASE.dll (<span class="number">0x75100000</span>)
    cygwin1.dll =&amp;gt; <span class="regexp">/usr/</span>bin/cygwin1.dll (<span class="number">0x61000000</span>)
    cyggcc_s-<span class="number">1.</span>dll =&amp;gt; <span class="regexp">/usr/</span>bin/cyggcc_s-<span class="number">1.</span>dll (<span class="number">0x6fdb0000</span>)
    cygevent-<span class="number">2</span>-<span class="number">0</span>-<span class="number">5.</span>dll =&amp;gt; <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>cygevent-<span class="number">2</span>-<span class="number">0</span>-<span class="number">5.</span>dll (<span class="number">0x63ec0000</span>)
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4F9D;&#x8D56;&#x4E86;libevent</p>
<h2 id="&#x7F16;&#x8BD1;libevent">&#x7F16;&#x8BD1;libevent</h2><pre><code><span class="keyword">cd</span> /tmp
wget http<span class="variable">s:</span>//sourceforge.net/projects/levent/<span class="keyword">files</span>/libevent/libevent-<span class="number">2.0</span>/libevent-<span class="number">2.0</span>.<span class="number">22</span>-stable.tar.gz
tar xf libevent-<span class="number">2.0</span>.<span class="number">22</span>-stable.tar.gz
<span class="keyword">cd</span> libevent-<span class="number">2.0</span>.<span class="number">22</span>-stable
./configure --prefix=/usr/local
<span class="keyword">make</span> <span class="keyword">all</span>
<span class="keyword">make</span>  install
</code></pre><p>&#x5168;&#x7A0B;&#x65E0;&#x5F02;&#x5E38;&#x901A;&#x8FC7;</p>
<h2 id="&#x7F16;&#x8BD1;memcached">&#x7F16;&#x8BD1;memcached</h2><pre><code><span class="keyword">cd</span> /tmp
wget wget http:<span class="comment">//memcached.org/latest</span>
tar xf latest
<span class="keyword">cd</span> memcached-1.4.24/
chmod 777 configure
./configure
</code></pre><p>configure &#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;,&#x9700;&#x8981;&#x4FEE;&#x6539;Makefile,&#x4E0D;&#x7136;&#x7F16;&#x8BD1;&#x4F1A;&#x5931;&#x8D25;</p>
<p>&#x5927;&#x6982;&#x662F;326&#x884C;,&#x5220;&#x6389;-Werror, &#x7ED3;&#x679C;&#x5982;&#x4E0B;</p>
<pre><code><span class="attribute">CFLAGS </span>=<span class="string"> -g -O2 -pthread -pthread -Wall -pedantic -Wmissing-prototypes -Wmissing-declarations -Wredundant-decls</span>
</code></pre><p>&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x5269;&#x4F59;&#x7684;&#x7F16;&#x8BD1;</p>
<pre><code><span class="built_in">make</span>
<span class="built_in">make</span> install
</code></pre><h2 id="&#x5B8C;&#x6210;,&#x542F;&#x52A8;&#x4E00;&#x4E0B;">&#x5B8C;&#x6210;,&#x542F;&#x52A8;&#x4E00;&#x4E0B;</h2><pre><code><span class="title">memcached</span> -vv
</code></pre><p>&#x8F93;&#x51FA;&#x4E00;&#x5806;log,&#x7136;&#x540E;&#x7528;telnet&#x8BBF;&#x95EE;&#x4E00;&#x4E0B;,&#x6B63;&#x5E38;,&#x641E;&#x5B9A;.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Cygwin/">Cygwin</a><a href="/tags/Memcached/">Memcached</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/03/1f9ebbf/" title="质量度量平台性能优化-4 -" itemprop="url">质量度量平台性能优化-4 -</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="edwin" target="_blank" itemprop="author">edwin</a>
		
  <p class="article-time">
    <time datetime="2015-07-03T02:09:30.000Z" itemprop="datePublished"> 发表于 2015-07-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>&#x5728;&#x8D28;&#x91CF;&#x5EA6;&#x91CF;&#x5E73;&#x53F0;&#x4E2D;&#xFF0C;&#x6709;&#x5C11;&#x6570;&#x51E0;&#x4E2A;&#x9875;&#x9762;&#x6253;&#x5F00;&#x901F;&#x5EA6;&#x662F;&#x5F88;&#x6162;&#x7684;&#xFF08;&#x4E0D;&#x8FC7;&#x7531;&#x4E8E;&#x7528;&#x6237;&#x91CF;&#x4E0D;&#x5927;&#xFF0C;&#x4EE5;&#x524D;&#x4E5F;&#x6CA1;&#x5173;&#x6CE8;&#xFF09;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x9700;&#x8981;&#x5BF9;&#x5927;&#x91CF;&#x7684;&#x6570;&#x636E;&#x505A;&#x8FD0;&#x7B97;&#x5206;&#x6790;&#x624D;&#x5C55;&#x73B0;&#x51FA;&#x7ED3;&#x679C;&#xFF0C;&#x8FD9;&#x51E0;&#x5929;&#x505A;&#x4E86;&#x4E00;&#x4E0B;&#x4F18;&#x5316;&#x3002;&#x65B9;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x51E0;&#x4E2A;&#x5F88;&#x6162;&#x7684;&#x9875;&#x9762;&#x90FD;&#x662F;&#x53EA;&#x8BFB;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F7F;&#x7528;memcached&#x7F13;&#x5B58;&#x4E00;&#x4E0B;&#x6570;&#x636E;&#xFF0C;&#x6548;&#x679C;&#x4F1A;&#x975E;&#x5E38;&#x7684;&#x597D;&#x3002;</p>
<p>Django&#x4E2D;&#x5F88;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;Cache&#xFF0C;&#x5148;&#x9700;&#x8981;&#x5B89;&#x88C5;python-memcached&#x8FD9;&#x4E2A;python&#x5305;&#xFF0C;&#x5728;settings.py&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre><code>CACHES = {
    &amp;apos<span class="comment">;default&amp;apos;: {</span>
        &amp;apos<span class="comment">;BACKEND&amp;apos;: &amp;apos;django.core.cache.backends.memcached.MemcachedCache&amp;apos;,</span>
        &amp;apos<span class="comment">;LOCATION&amp;apos;: &amp;apos;192.168.1.2:11211&amp;apos;,</span>
    }
}
</code></pre><p>&#x5176;&#x4E2D;192.168.1.2:11211&#x5C31;&#x662F;&#x642D;&#x5EFA;&#x7684;memcached&#x670D;&#x52A1;&#xFF08;&#x642D;&#x5EFA;&#x65B9;&#x6CD5;&#x4E5F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF09;&#x3002;</p>
<p>&#x7136;&#x540E;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5148;&#x53BB;cache&#x4E2D;&#x53D6;&#x4E00;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D6;&#x5230;&#xFF0C;&#x5C31;&#x91CD;&#x65B0;&#x4ECE;&#x539F;&#x59CB;&#x53D6;&#x5230;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5373;&#x53EF;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#xFF1A;</p>
<pre><code>from django.core.cache import <span class="operator"><span class="keyword">cache</span>
def get_web_status(<span class="keyword">start</span>, <span class="keyword">end</span>):
    &amp;apos;</span>&amp;apos;&amp;apos;
    @summary: get the web HTTP status data.
              it will <span class="operator"><span class="keyword">call</span> the remote AEW (<span class="keyword">in</span> product env).
    @param <span class="keyword">start</span>: the <span class="keyword">start</span> <span class="built_in">date</span>.  <span class="keyword">Not</span> used yet.
    @param <span class="keyword">end</span>: the <span class="keyword">end</span> <span class="built_in">date</span>.  <span class="keyword">Not</span> used yet.
    @<span class="keyword">return</span>: a list <span class="keyword">of</span> the web HTTP <span class="keyword">status</span> <span class="keyword">count</span> <span class="keyword">data</span>.
    &amp;apos;</span>&amp;apos;&amp;apos;
    key = &amp;apos;weekly_web_status&amp;apos;
    ret = <span class="operator"><span class="keyword">cache</span>.<span class="keyword">get</span>(<span class="keyword">key</span>)
    <span class="keyword">if</span> <span class="keyword">not</span> ret:
        try:
            remote_api = &amp;apos;</span>http://10.1.1.2:8080/api/remote/weekly_web_status&amp;apos;
            days = 7
            remote_url = &amp;apos;%s?days=%s&amp;apos; % (remote_api, days)
            doc = urllib.urlopen(remote_url)
            ret = json.loads(doc.read())[&amp;apos;detail&amp;apos;]
            <span class="operator"><span class="keyword">cache</span>.<span class="keyword">set</span>(<span class="keyword">key</span>, ret, <span class="number">1</span>*<span class="number">3600</span>)
        <span class="keyword">except</span>:
            pass
    <span class="keyword">return</span> ret</span>
</code></pre><p>&#x7531;&#x4E8E;&#x6211;&#x7684;&#x6570;&#x636E;&#x662F;&#x4ECE;DW&#x90E8;&#x95E8;&#x6765;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x662F;&#x6BCF;&#x5929;&#x66F4;&#x65B0;&#x4E00;&#x6B21;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x7A0D;&#x5FAE;&#x7684;&#x5EF6;&#x8FDF;&#x4E0D;&#x654F;&#x611F;&#xFF0C;cache&#x8BBE;&#x7F6E;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x662F;1&#x5C0F;&#x65F6;&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x8FD8;&#x5728;&#x540E;&#x53F0;&#x6709;&#x4E2A;job&#x5728;&#x6BCF;&#x5929;&#x51CC;&#x6668;&#x5C31;&#x53BB;&#x83B7;&#x53D6;&#x6700;&#x65B0;&#x7684;&#x6570;&#x636E;&#x5E76;set&#x5230;memcached&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x5929;&#x7B2C;&#x4E00;&#x4E2A;&#x4EBA;&#x8BBF;&#x95EE;&#x65F6;&#x4E5F;&#x4E0D;&#x4F1A;&#x592A;&#x6162;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x4E86;Cache&#x6548;&#x679C;&#x975E;&#x5E38;&#x660E;&#x663E;&#xFF0C;&#x4EE5;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;API&#x4E3A;&#x4F8B;&#xFF0C;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/1f9d355.jpg" alt=""></p>
<p>&#x5728;&#x6CA1;&#x6709;&#x4F7F;&#x7528;cache&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x53BB;&#x8C03;&#x7528;&#x5916;&#x90E8;&#x7684;API&#xFF08;&#x8FDB;&#x884C;&#x7684;&#x662F;&#x5B9E;&#x65F6;&#x8BA1;&#x7B97;&#x7EDF;&#x8BA1;&#x5206;&#x6790;&#xFF09;&#xFF0C;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x5728;30s&#x5DE6;&#x53F3;&#xFF08;&#x2299;&#xFE4F;&#x2299;b&#x6C57;&#xFF09;&#xFF0C;&#x4F7F;&#x7528;cache&#x540E;&#x7F29;&#x77ED;&#x4E3A;6ms&#xFF1B;&#x5728;&#x4F7F;&#x7528;1&#x4E2A;&#x5E76;&#x53D1;&#x538B;&#x6D4B;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;TPS&#x63D0;&#x5347;300&#x500D;&#x3002;100&#x5E76;&#x53D1;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;memcached&#x7684;API&#x7684;TPS&#x8FBE;&#x5230;866&#xFF0C;&#x8FD8;&#x4E0D;&#x9519;&#x7684;~ &#xFF08;&#x670D;&#x52A1;&#x8DD1;&#x5728;4&#x6838;4GB&#x5185;&#x5B58;&#x7684;&#x865A;&#x62DF;&#x673A;&#x4E0A;&#xFF09;&#x3002;</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/transcribe/">transcribe</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/HTTP-Cache/">HTTP Cache</a><a href="/tags/Memcached/">Memcached</a><a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/17/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><a class="page-number" href="/page/20/">20</a><span class="space">&hellip;</span><a class="page-number" href="/page/59/">59</a><a class="extend next" rel="next" href="/page/19/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/transcribe/" title="transcribe">transcribe<sup>587</sup></a></li>
		  
		
		  
			<li><a href="/categories/日志/" title="日志">日志<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/ZooKeeper/" title="ZooKeeper">ZooKeeper<sup>80</sup></a></li>
			
		
			
				<li><a href="/tags/Node-js/" title="Node.js">Node.js<sup>75</sup></a></li>
			
		
			
				<li><a href="/tags/Memcached/" title="Memcached">Memcached<sup>71</sup></a></li>
			
		
			
				<li><a href="/tags/JVM/" title="JVM">JVM<sup>65</sup></a></li>
			
		
			
				<li><a href="/tags/io-js/" title="io.js">io.js<sup>35</sup></a></li>
			
		
			
				<li><a href="/tags/Spring-MVC/" title="Spring MVC">Spring MVC<sup>33</sup></a></li>
			
		
			
				<li><a href="/tags/数据库/" title="数据库">数据库<sup>32</sup></a></li>
			
		
			
				<li><a href="/tags/Gulp/" title="Gulp">Gulp<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>28</sup></a></li>
			
		
			
				<li><a href="/tags/Nosql/" title="Nosql">Nosql<sup>27</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C++">C++<sup>24</sup></a></li>
			
		
			
				<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>23</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/开源/" title="开源">开源<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/Redis/" title="Redis">Redis<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/程序员/" title="程序员">程序员<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/Dubbo/" title="Dubbo">Dubbo<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/Net/" title=".Net">.Net<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/源码分析/" title="源码分析">源码分析<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/Ubuntu/" title="Ubuntu">Ubuntu<sup>9</sup></a></li>
			
		
		</ul>
</div>


<div class="weiboshow">
	<p class="asidetitle">新浪微博</p>
	<iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1289635200&verifier=e6bef170&dpc=1"></iframe>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/512316815" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/sblig" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/sblig" target="_blank" title="fblog">fblog</a> © 2015
		
		<a href="/about" target="_blank" title="edwin">edwin</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
