<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[dianzi blog]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://taojinke.github.io/"/>
  <updated>2015-07-03T14:09:57.588Z</updated>
  <id>http://taojinke.github.io/</id>
  
  <author>
    <name><![CDATA[edwin]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[Automate Your Mac Via SMS using JavaScript for Automation, Node.js and Twilio -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f6aec7/"/>
    <id>http://taojinke.github.io/2015/07/03/2f6aec7/</id>
    <published>2015-07-03T02:09:57.000Z</published>
    <updated>2015-07-03T14:09:57.588Z</updated>
    <content type="html"><![CDATA[<p> JavaScript is eating the programming world. Look around and you&#x2019;ll see JavaScript in places people never would&#x2019;ve expected 10 years ago. There&#x2019;s JavaScript running on servers. There are more front-end JavaScript frameworks than you can shake a stick at. And there&#x2019;s even JavaScript onmy dog! Lucky me because I love JavaScript. </p>
<p>A few months ago at <a href="http://brooklynjs.com" target="_blank" rel="external">BrooklynJS</a> I was super excited to discover a new way I can use JavaScript. <a href="https://twitter.com/alanmoo" target="_blank" rel="external">Alan Mooiman</a> gave a great talking showing how you can use JavaScript to automate your Mac. After seeing Alan&#x2019;s talk I wondered,&#xA0;could I write a script to take some action on my Mac via SMS? Spoiler alert: yes! yes I can!</p>
<p>This post is all about learning how to automate your Mac via SMS message. The actual task we automate could be one of countless options but for the sake of simplicity we&#x2019;re going to write an app that sends an iMessage message from the messages app when an SMS comes in.</p>
<h4 id="Our_Tools">Our Tools</h4><ul>
<li><a href="https://nodejs.org/" target="_blank" rel="external">Node.js</a> &#xA0;&#x2013; We&#x2019;ll be using node to receive our incoming SMS message from Twilio.</li>
<li>JavaScript for Automation &#x2013; It&#x2019;s like AppleScript but it&#x2019;s JavaScript.</li>
<li>OSX &gt;= 10.10 &#x2013; JavaScript for Automation requires Yosemite or higher.</li>
<li>Twilio &#x2013; Need an account?Sign up for free!</li>
</ul>
<p>Sending iMessages with JavaScript </p>
<p>We&#x2019;ll&#xA0;start by working on the automation portion of our application. We&#x2019;ll use <a href="https://developer.apple.com/library/mac/releasenotes/InterapplicationCommunication/RN-JavaScriptForAutomation/" target="_blank" rel="external">JavaScript for Automation</a> to make this happen. JavaScript for Automation allows you to do the things you would historically use AppleScript for using JavaScript. Pretty rad, right? </p>
<p>Writing this in Apple&#x2019;s Script Editor will make it easy for us to quickly test our code. If you&#x2019;re a Vim lover like me, I know it&#x2019;ll be tough but you can do it!</p>
<p>Once we open Script Editor we need to switch our language from AppleScript to JavaScript.</p>
<p>Now we can start writing our code. Since we&#x2019;re keeping it basic we only need 3 lines of code:</p>
<pre><code>var messages = <span class="constant">Application</span>(&amp;apos;<span class="constant">Messages</span>&amp;apos;);

var buddy = messages.services[&amp;quot;<span class="constant">E</span><span class="symbol">:%REPLACE_WITH_YOUR_IMESSAGE_EMAIL%&amp;quot</span>;].buddies[&amp;quot;%<span class="constant">REPLACE_WITH_BUDDYS_EMAIL</span>%&amp;quot;];

messages.send(&amp;quot;<span class="constant">JavaScript</span> sent this message!&amp;quot;, {<span class="symbol">to:</span> buddy});
</code></pre><p>Make sure your replace the first element with the e-mail address you use for iMessage but keep the preceding &#x201C;E:&#x201D;. For example, mine would be &#x201C;E:ricky@twilio.com&#x201D;.&#xA0;Are you unsure what your iMessage email is? In the Messages application press &#x201C;cmd ,&#x201D; and then click on the accounts tab. Replace the second element with the address of a buddy you&#x2019;d like to message&#xA0;or if you don&#x2019;t want to spam your friend during testing you can send a message to yourself. </p>
<p>Before we run this code let&#x2019;s break it down. On the first line we&#x2019;re getting an object that references the Messages application. The second line we get a reference to our buddy that we want to send a message to. On the last line, we call the send method and pass it the message content we want to send as well as the buddy we&#x2019;re sending to.</p>
<p>Now that we have our code in place we can run it by hitting the big play button in Script Editor (or if you want to be l33 by pressing cmd r). You&#x2019;ll see your message application open and a message is sent to the friend you specified. Oh yeah!</p>
<p><img src="http://taojinke.github.io/img/20150703/2f6917b.gif" alt=""></p>
<p>Hooking It Up To Twilio </p>
<p>Now that we&#x2019;ve automated our mac to send our iMessage it&#x2019;s time to write the code that triggers this automation when a text message comes in via Twilio.</p>
<p>First thing&#x2019;s first, we need to create a new node application. Hop into Terminal and get this bad boy started:</p>
<p> Shell</p>
<pre><code><span class="built_in">mkdir</span> sms-automation
<span class="built_in">cd</span> sms-automation
npm init
</code></pre><p>We&#x2019;re going to be using <a href="http://hapijs.com/" target="_blank" rel="external">hapi.js</a> for this application.&#xA0;If you haven&#x2019;t worked with hapi before, it&#x2019;s a framework that makes building node.js web applications super easy. If you&#x2019;ve worked with express it is a lot like that! In order to use hapi we need to install it: </p>
<p> Shell</p>
<pre><code>npm <span class="keyword">install</span> hapi
</code></pre><p>Now we can create our index.js file that will contain the code for our basic application:</p>
<pre><code><span class="built_in">var</span> Hapi <span class="subst">=</span> <span class="keyword">require</span>(<span class="subst">&amp;</span>apos;hapi<span class="subst">&amp;</span>apos;);

<span class="built_in">var</span> server <span class="subst">=</span> <span class="literal">new</span> Hapi<span class="built_in">.</span>Server();
server<span class="built_in">.</span>connection({
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; host: <span class="subst">&amp;</span>apos;localhost<span class="subst">&amp;</span>apos;,
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; port: <span class="number">8000</span>
});

server<span class="built_in">.</span>start();
</code></pre><p>We&#x2019;ve written the code for a basic server but right now it doesn&#x2019;t do anything. Luckily, we just need one route for our application. We can call the route incoming : </p>
<pre><code><span class="xml">server.route(</span><span class="expression">{
&amp;<span class="begin-block">#xA</span>0; &amp;<span class="begin-block">#xA</span>0; <span class="variable">method</span>: &amp;<span class="begin-block">#x</span>2018;<span class="variable">POST</span>&amp;<span class="begin-block">#x</span>2019;,
&amp;<span class="begin-block">#xA</span>0; &amp;<span class="begin-block">#xA</span>0; <span class="variable">path</span>:&amp;<span class="begin-block">#xA</span>0;&amp;<span class="variable">apos</span>;<span class="end-block">/incoming</span>&amp;<span class="begin-block">#x</span>2019;,
&amp;<span class="begin-block">#xA</span>0; &amp;<span class="begin-block">#xA</span>0; <span class="variable">handler</span>: <span class="variable">function</span> (<span class="variable">request</span>, <span class="variable">reply</span>) {
&amp;<span class="begin-block">#xA</span>0; &amp;<span class="begin-block">#xA</span>0; &amp;<span class="begin-block">#xA</span>0; &amp;<span class="begin-block">#xA</span>0;<span class="variable">reply</span>(&amp;<span class="variable">apos</span>;<span class="variable">hello</span> <span class="variable">world</span>&amp;<span class="variable">apos</span>;);
&amp;<span class="begin-block">#xA</span>0; &amp;<span class="begin-block">#xA</span>0; }</span><span class="xml">
});

server.start();</span>
</code></pre><p>Start up our server and test out our new route:</p>
<p> Shell</p>
<pre><code>node <span class="keyword">index</span>.js
</code></pre><p>You may have&#xA0;noticed that we made our route only respond to POST&#xA0;requests. We can use curl to&#xA0;try&#xA0;this out:</p>
<p> Shell</p>
<pre><code>curl -X POST <span class="string">http:</span><span class="comment">//127.0.0.1:8000/incoming</span>
</code></pre><p>We now see we&#x2019;re getting our beautiful &#x201C;hello world&#x201D; response. But we want to do something that receives information about our incoming message and then executes our JavaScript that sends the message. In order to use that we&#x2019;re going to need to use the <em>exec()</em> function. Warning! The exec function runs a shell command on your local machine so be careful that you make sure users can&#x2019;t do anything malicious if you open this up to the outside world. </p>
<p>In order to use <em>exec()</em> we need to require a couple standard libraries at the top of our index.js file: </p>
<pre><code><span class="built_in">var</span> sys <span class="subst">=</span> <span class="keyword">require</span>(<span class="subst">&amp;</span>apos;sys<span class="subst">&amp;</span>apos;),
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; exec <span class="subst">=</span> <span class="keyword">require</span>(<span class="subst">&amp;</span>apos;child_process<span class="subst">&amp;</span>apos;)<span class="built_in">.</span>exec;
</code></pre><p>Before we write the next part we need to jump back into Script Editor and save the code we wrote earlier in the same directory as our Node.js application.&#xA0;Save it as &#x201C;sendmessage.scpt&#x201D;.&#xA0;Saving a file&#xA0;sounds like it should be easy but the Script Editor dialogue can be confusing. When you go to save you need to click on the down arrow next to the &#x201C;Save As&#x201D; name and you&#x2019;ll have the ability to browse to your folder.</p>
<p>So far we&#x2019;ve only run our automation script via Script Editor but we can also run it from the command line. Jump into terminal and browse the directory where we just saved our file. Now run this command:</p>
<p> Shell</p>
<pre><code>osascript <span class="operator">-l</span> JavaScript ./sendmessage.scpt
</code></pre><p>Again, you&#x2019;ll see our messages application has sent our iMessage for us. This command is fairly basic but I wanted to highlight -l argument. This argument indicates that the script we&#x2019;re running is JavaScript, otherwise the command will think we&#x2019;re running code written in AppleScript and it will crash. </p>
<p>We now have everything in place to call this script from our Node.js application. Go back into&#xA0;index.js and add the following code to call JavaScript for Automation script:</p>
<pre><code><span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; handler: function (request, reply) {
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>;<span class="subst">&amp;</span><span class="variable">#xA0</span>;exec(<span class="subst">&amp;</span>quot;osascript <span class="attribute">-l</span> JavaScript <span class="subst">&amp;</span>quot;   __dirname   <span class="subst">&amp;</span>quot;/sendmessage<span class="built_in">.</span>scpt<span class="subst">&amp;</span>quot;, function(err, stdout, stderr) {
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>;console<span class="built_in">.</span><span class="keyword">log</span>(err);
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; });
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>;reply(<span class="subst">&amp;</span>apos;hello world<span class="subst">&amp;</span>apos;);
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; }
</code></pre><p>This route will get called by Twilio whenever someone sends an SMS message to our app. We want to respond to that message indicating that our SMS was received. We can do that usingTwiML. TwiML allows us to provide some basic instructions of what Twilio should do with an incoming message or phone call. We could use the <a href="https://github.com/twilio/twilio-node" target="_blank" rel="external">Twilio Node.js helper library</a> to generate our TwiML but since TwiML is actually XML we&#x2019;re going to just hardcode in our response to avoid adding another dependency: </p>
<pre><code><span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; path:<span class="subst">&amp;</span>apos;/incoming<span class="subst">&amp;</span>apos;,
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; handler: function (request, reply) {
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>;exec(<span class="subst">&amp;</span>quot;osascript <span class="attribute">-l</span> JavaScript <span class="subst">&amp;</span>quot;   __dirname   <span class="subst">&amp;</span>quot;/sendmessage<span class="built_in">.</span>scpt<span class="subst">&amp;</span>quot;, function(err, stdout, stderr) {
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; console<span class="built_in">.</span><span class="keyword">log</span>(err);
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>;});
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>;reply(<span class="subst">&amp;</span>apos;<span class="subst">&amp;</span><span class="literal">lt</span>;Response<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;Message<span class="subst">&amp;</span><span class="literal">gt</span>;Thanks<span class="subst">!</span> Sending iMessage now<span class="subst">!&amp;</span><span class="literal">lt</span>;/Message<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/Response<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span>apos;);
<span class="subst">&amp;</span><span class="variable">#xA0</span>; <span class="subst">&amp;</span><span class="variable">#xA0</span>; }
</code></pre><p>Twilio needs to be able to access our application so we need to expose our local host to the outside world. Fortunately, we can use one of my favorite tools called <a href="https://ngrok.com" target="_blank" rel="external">ngrok</a> to make this happen. If you haven&#x2019;t used this tool before, <a href="https://ngrok.com/download" target="_blank" rel="external">download and install ngrok</a> . </p>
<p>With ngrok installed, we can run the following command to expose our localhost to the outside world:</p>
<p> Shell</p>
<pre><code>ngrok <span class="keyword">http</span> <span class="number">8000</span>
</code></pre><p>Make note of the url ngrok created for your application then head to yourTwilio dashboard. If you don&#x2019;t already have a phone number you&#x2019;d like to use for your application then <a href="https://www.twilio.com/user/account/phone-numbers/search" target="_blank" rel="external">buy a new phone number</a> . Once you have a phone number set the SMS Request URL to the /incoming route on our application: </p>
<p><img src="http://taojinke.github.io/img/20150703/2f6917b.png" alt=""></p>
<p>The moment of truth. Send an SMS message to your application and watch as your Messages app opens and sends an iMessage. Party time!</p>
<p>You can find the completed code for our application <a href="https://github.com/rickyrobinett/sms-automation" target="_blank" rel="external">on GitHub</a> . </p>
<p>Hackers Gonna Hack </p>
<p>You&#x2019;ve now&#xA0;built a basic example showing how you can automate your Mac via SMS. And we&#x2019;re doing it all using JavaScript! What will you build now that you have this ability? Here are a couple ideas:</p>
<ul>
<li>SMS to have your computer open Photobooth snap a picture and send back to you via MMS</li>
<li>SMS your computer and get it to say something (using terminal say) to scare people in your house</li>
</ul>
<p>Are you looking for a way to improve the iMessage application we built together today? Try replacing the hard coded text we&#x2019;re sending each time with the body of the SMS message you&#x2019;re sending in.</p>
<p>Have any questions or what to show me the latest project you&#x2019;ve hacked together? Drop a note in the comments below or holler at me on twitter ( <a href="http://twitter.com/rickyrobinett" target="_blank" rel="external">@rickyrobinett</a> ). </p>
]]></content>
    <summary type="html">
    <![CDATA[<p> JavaScript is eating the programming world. Look around and you&#x2019;ll see JavaScript in places people never would&#x2019;ve expected]]>
    </summary>
    
      <category term="MacOS" scheme="http://taojinke.github.io/tags/MacOS/"/>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[借助Nodejs探究WebSocket -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f4aba4/"/>
    <id>http://taojinke.github.io/2015/07/03/2f4aba4/</id>
    <published>2015-07-03T02:09:57.000Z</published>
    <updated>2015-07-03T14:09:57.436Z</updated>
    <content type="html"><![CDATA[<p>&#x6587;&#x7AE0;&#x5BFC;&#x8BFB;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x3001;&#x6982;&#x8FF0;-what&apos;s WebSocket?</li>
<li>&#x4E8C;&#x3001;&#x8FD0;&#x884C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;WebSocket&#x5BA2;&#x6237;&#x7AEF;+&#x4F7F;&#x7528;ws&#x6A21;&#x5757;&#x642D;&#x5EFA;&#x7684;&#x7B80;&#x5355;&#x670D;&#x52A1;&#x5668;</li>
<li>&#x4E09;&#x3001;Node&#x4E2D;&#x7684;WebSocket</li>
<li>&#x56DB;&#x3001;socket.io</li>
<li>&#x4E94;&#x3001;&#x6269;&#x5C55;&#x9605;&#x8BFB;</li>
</ul>
<h3 id="&#x4E00;&#x3001;&#x6982;&#x8FF0;-what&apos;s_WebSocket?">&#x4E00;&#x3001;&#x6982;&#x8FF0;-what&apos;s WebSocket?</h3><h4 id="1-1_&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x9700;&#x8981;WebSocket&#x8FD9;&#x6837;&#x7684;&#x5B9E;&#x65F6;&#x7684;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#xFF1F;">1.1 &#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x9700;&#x8981;WebSocket&#x8FD9;&#x6837;&#x7684;&#x5B9E;&#x65F6;&#x7684;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#xFF1F;</h4><p>WebSocket&#x662F;web&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x7684;&#x4E00;&#x79CD;&#xFF0C;&#x50CF;&#x6211;&#x4EEC;&#x719F;&#x77E5;&#x7684;HTTP&#x534F;&#x8BAE;&#x4E5F;&#x662F;web&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#x7684;&#x4E00;&#x79CD;&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x77E5;&#x9053;HTTP&#x534F;&#x8BAE;&#x662F;&#x4E00;&#x79CD;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x5176;&#x670D;&#x52A1;&#x7AEF;&#x672C;&#x8EAB;&#x4E0D;&#x5177;&#x5907;&#x8BC6;&#x522B;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x5FC5;&#x987B;&#x501F;&#x52A9;&#x5916;&#x90E8;&#x7684;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#x6BD4;&#x5982;&#x8BF4;session&#x548C;cookie&#xFF0C;&#x624D;&#x80FD;&#x4E0E;&#x7279;&#x5B9A;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4FDD;&#x6301;&#x901A;&#x4FE1;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6211;&#x4EEC;&#x6240;&#x53D1;&#x9001;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;HTTP&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x5E26;&#x4E0A;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x4E00;&#x4E9B;&#x76F8;&#x5E94;&#x7684;&#x4FE1;&#x606F;&#x8FD8;&#x6709;cookie&#xFF0C;&#x8FD9;&#x660E;&#x663E;&#x4F1A;&#x589E;&#x52A0;&#x6211;&#x4EEC;&#x4F20;&#x8F93;&#x7684;&#x4FE1;&#x606F;&#x7684;&#x4F53;&#x91CF;&#x4ECE;&#x800C;&#x5E26;&#x6765;&#x4E00;&#x5B9A;&#x7684;&#x7F51;&#x7EDC;&#x5EF6;&#x8FDF;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x5BF9;&#x901A;&#x4FE1;&#x7684;&#x5B9E;&#x65F6;&#x6027;&#x8981;&#x6C42;&#x6BD4;&#x8F83;&#x9AD8;&#x7684;&#x5E94;&#x7528;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x4E0D;&#x53EF;&#x5FCD;&#x53D7;&#x7684;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#x804A;&#x5929;&#x7A0B;&#x5E8F;&#x6216;&#x8005;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;&#x5B9E;&#x65F6;&#x5C0F;&#x6E38;&#x620F;&#x3002;&#x6700;&#x90C1;&#x95F7;&#x7684;&#x5374;&#x8FD8;&#x662F;&#x8FD9;&#x4E9B;&#x5934;&#x4FE1;&#x606F;&#x548C;cookie&#x5F80;&#x5F80;&#x5BF9;&#x4E8E;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x6765;&#x8BF4;&#x662F;&#x591A;&#x4F59;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x867D;&#x7136;&#x6211;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x90FD;&#x5E26;&#x4E86;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x662F;&#x670D;&#x52A1;&#x5668;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4EA4;&#x4E92;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x6839;&#x672C;&#x7528;&#x4E0D;&#x4E0A;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x6539;&#x5584;HTTP&#x8BF7;&#x6C42;&#x7684;&#x8FD9;&#x79CD;&#x7F51;&#x7EDC;&#x5EF6;&#x8FDF;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E5F;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E9B;&#x9002;&#x5E94;&#x4E0D;&#x540C;&#x9700;&#x6C42;&#x7684;&#x5176;&#x4ED6;&#x7684;[web&#x901A;&#x4FE1;]&#x65B9;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#xFF1A;&#x8F6E;&#x8BE2;&#xFF0C;&#x957F;&#x8F6E;&#x8BE2;( <a href="http://en.wikipedia.org/wiki/Push_technology#Long_polling" target="_blank" rel="external">long-polling</a> )&#xFF0C;&#x6570;&#x636E;&#x6D41;&#xFF0C;EventSouce&#x7B49;&#x7B49;&#xFF0C;WebSocket&#x4FBF;&#x662F;&#x5176;&#x4E2D;&#x4E00;&#x79CD;&#x3002; </p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x5927;&#x591A;&#x6570;&#x57FA;&#x4E8E;&#x56E0;&#x7279;&#x7F51;&#xFF08;&#x6216;&#x8005;&#x5C40;&#x57DF;&#x7F51;&#xFF09;&#x7684;&#x7F51;&#x7EDC;&#x94FE;&#x63A5;&#x901A;&#x5E38;&#x90FD;&#x5305;&#x542B;&#x957F;&#x8FDE;&#x63A5;&#x548C;&#x57FA;&#x4E8E;TCP&#x5957;&#x63A5;&#x5B57;&#x7684;&#x53CC;&#x5411;&#x6D88;&#x606F;&#x4EA4;&#x6362;&#x3002;&#x4F46;&#x662F;TCP&#x534F;&#x8BAE;&#x662F;&#x5C5E;&#x4E8E;&#x6700;&#x5E95;&#x5C42;&#x7684;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#x4E86;&#xFF0C;&#x8BA9;&#x4E00;&#x4E9B;&#x4E0D;&#x80FD;&#x4FE1;&#x4EFB;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x811A;&#x672C;&#x53BB;&#x8BBF;&#x95EE;&#x5E95;&#x5C42;&#x7684;TCP&#x5957;&#x63A5;&#x5B57;&#x663E;&#x7136;&#x662F;&#x4E0D;&#x592A;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x56E0;&#x6B64;WebSocket&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x79CD;&#x8F83;&#x4E3A;&#x5B89;&#x5168;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x7AEF;&#x811A;&#x672C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x652F;&#x6301;WebSocket&#x534F;&#x8BAE;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x521B;&#x5EFA;&#x53CC;&#x5411;&#x7684;&#x5957;&#x63A5;&#x5B57;&#x8FDE;&#x63A5;&#x3002;&#x4ECE;&#x800C;&#x4F7F;&#x5B9E;&#x65F6;&#x901A;&#x4FE1;&#x7684;&#x67D0;&#x4E9B;&#x7F51;&#x7EDC;&#x64CD;&#x4F5C;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x3002;</p>
<h4 id="1-2_WebSocket&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;">1.2 WebSocket&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;</h4><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86;WebSocket&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#xFF0C;&#x5141;&#x8BB8;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x5168;&#x53CC;&#x5DE5;&#xFF08;full-duplex&#xFF09;&#x7684;&#x5B9E;&#x65F6;&#x901A;&#x4FE1;&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x4F8B;&#x5B50;&#x7279;&#x522B;&#x597D;&#xFF1A;HTTP&#x534F;&#x8BAE;&#x50CF;&#x53D1;&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#xFF0C;&#x53D1;&#x51FA;&#x540E;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x5BF9;&#x65B9;&#x56DE;&#x4FE1;&#xFF1B;WebSocket&#x5219;&#x662F;&#x50CF;&#x6253;&#x7535;&#x8BDD;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x5411;&#x5BF9;&#x65B9;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x5B58;&#x7740;&#x4E00;&#x6761;&#x6301;&#x7EED;&#x6253;&#x5F00;&#x7684;&#x6570;&#x636E;&#x901A;&#x9053;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E00;&#x4E0B;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;WebSocket&#x534F;&#x8BAE;&#x901A;&#x4FE1;&#x7684;&#x8BF7;&#x6C42;&#x5934;&#x548C;&#x54CD;&#x5E94;&#x5934;(&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x5B9E;&#x4F8B;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x5934;)&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f41b99.png" alt=""></p>
<p>&#x5176;&#x4E2D;&#x4E0E;WebSocket&#x534F;&#x8BAE;&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre><code><span class="number">1</span> Upgrade:websocket<span class="subst">-------</span>HTTP1<span class="built_in">.1</span><span class="subst">&amp;</span><span class="variable">#x534F</span>;<span class="subst">&amp;</span><span class="variable">#x8BAE</span>;<span class="subst">&amp;</span><span class="variable">#x89C4</span>;<span class="subst">&amp;</span><span class="variable">#x5B9A</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;Upgrade<span class="subst">&amp;</span><span class="variable">#x5934</span>;<span class="subst">&amp;</span><span class="variable">#x4FE1</span>;<span class="subst">&amp;</span><span class="variable">#x606F</span>;<span class="subst">&amp;</span><span class="variable">#x8868</span>;<span class="subst">&amp;</span><span class="variable">#x793A</span>;<span class="subst">&amp;</span><span class="variable">#x5C06</span>;<span class="subst">&amp;</span><span class="variable">#x901A</span>;<span class="subst">&amp;</span><span class="variable">#x4FE1</span>;<span class="subst">&amp;</span><span class="variable">#x534F</span>;<span class="subst">&amp;</span><span class="variable">#x8BAE</span>;<span class="subst">&amp;</span><span class="variable">#x4ECE</span>;HTTP/<span class="number">1.1</span><span class="subst">&amp;</span><span class="variable">#x8F6C</span>;<span class="subst">&amp;</span><span class="variable">#x5411</span>;<span class="subst">&amp;</span><span class="variable">#x8BE5</span>;<span class="subst">&amp;</span><span class="variable">#x9879</span>;<span class="subst">&amp;</span><span class="variable">#x6240</span>;<span class="subst">&amp;</span><span class="variable">#x6307</span>;<span class="subst">&amp;</span><span class="variable">#x5B9A</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x534F</span>;<span class="subst">&amp;</span><span class="variable">#x8BAE</span>;<span class="subst">&amp;</span><span class="variable">#xFF1B</span>;
<span class="number">2</span> Connection:Upgrade<span class="subst">------&amp;</span><span class="variable">#x8868</span>;<span class="subst">&amp;</span><span class="variable">#x793A</span>;<span class="subst">&amp;</span><span class="variable">#x6D4F</span>;<span class="subst">&amp;</span><span class="variable">#x89C8</span>;<span class="subst">&amp;</span><span class="variable">#x5668</span>;<span class="subst">&amp;</span><span class="variable">#x901A</span>;<span class="subst">&amp;</span><span class="variable">#x77E5</span>;<span class="subst">&amp;</span><span class="variable">#x670D</span>;<span class="subst">&amp;</span><span class="variable">#x52A1</span>;<span class="subst">&amp;</span><span class="variable">#x5668</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5982</span>;<span class="subst">&amp;</span><span class="variable">#x679C</span>;<span class="subst">&amp;</span><span class="variable">#x5141</span>;<span class="subst">&amp;</span><span class="variable">#x8BB8</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x5C31</span>;<span class="subst">&amp;</span><span class="variable">#x5C06</span>;<span class="subst">&amp;</span><span class="variable">#x901A</span>;<span class="subst">&amp;</span><span class="variable">#x4FE1</span>;<span class="subst">&amp;</span><span class="variable">#x534F</span>;<span class="subst">&amp;</span><span class="variable">#x8BAE</span>;<span class="subst">&amp;</span><span class="variable">#x5347</span>;<span class="subst">&amp;</span><span class="variable">#x7EA7</span>;<span class="subst">&amp;</span><span class="variable">#x5230</span>;websocket<span class="subst">&amp;</span><span class="variable">#x534F</span>;<span class="subst">&amp;</span><span class="variable">#x8BAE</span>;<span class="subst">&amp;</span><span class="variable">#xFF1B</span>;
<span class="number">3</span> Origin<span class="subst">------------------&amp;</span><span class="variable">#x7528</span>;<span class="subst">&amp;</span><span class="variable">#x4E8E</span>;<span class="subst">&amp;</span><span class="variable">#x9A8C</span>;<span class="subst">&amp;</span><span class="variable">#x8BC1</span>;<span class="subst">&amp;</span><span class="variable">#x6D4F</span>;<span class="subst">&amp;</span><span class="variable">#x89C8</span>;<span class="subst">&amp;</span><span class="variable">#x5668</span>;<span class="subst">&amp;</span><span class="variable">#x57DF</span>;<span class="subst">&amp;</span><span class="variable">#x540D</span>;<span class="subst">&amp;</span><span class="variable">#x662F</span>;<span class="subst">&amp;</span><span class="variable">#x5426</span>;<span class="subst">&amp;</span><span class="variable">#x5728</span>;<span class="subst">&amp;</span><span class="variable">#x670D</span>;<span class="subst">&amp;</span><span class="variable">#x52A1</span>;<span class="subst">&amp;</span><span class="variable">#x5668</span>;<span class="subst">&amp;</span><span class="variable">#x8BB8</span>;<span class="subst">&amp;</span><span class="variable">#x53EF</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x8303</span>;<span class="subst">&amp;</span><span class="variable">#x56F4</span>;<span class="subst">&amp;</span><span class="variable">#x5185</span>;;
<span class="number">4</span> Sec<span class="attribute">-WebSocket</span><span class="attribute">-Key</span><span class="subst">-------&amp;</span><span class="variable">#x5219</span>;<span class="subst">&amp;</span><span class="variable">#x662F</span>;<span class="subst">&amp;</span><span class="variable">#x7528</span>;<span class="subst">&amp;</span><span class="variable">#x4E8E</span>;<span class="subst">&amp;</span><span class="variable">#x63E1</span>;<span class="subst">&amp;</span><span class="variable">#x624B</span>;<span class="subst">&amp;</span><span class="variable">#x534F</span>;<span class="subst">&amp;</span><span class="variable">#x8BAE</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x5BC6</span>;<span class="subst">&amp;</span><span class="variable">#x94A5</span>;<span class="subst">&amp;</span><span class="variable">#xFF0C</span>;<span class="subst">&amp;</span><span class="variable">#x662F</span>;base64<span class="subst">&amp;</span><span class="variable">#x7F16</span>;<span class="subst">&amp;</span><span class="variable">#x7801</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="number">16</span><span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x8282</span>;<span class="subst">&amp;</span><span class="variable">#x968F</span>;<span class="subst">&amp;</span><span class="variable">#x673A</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x7B26</span>;<span class="subst">&amp;</span><span class="variable">#x4E32</span>;;  
</code></pre><p>5 Sec-WebSocket-Accept——&#x662F;&#x670D;&#x52A1;&#x5668;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4F9B;&#x7684;Sec-WebSocket-Key&#x5B57;&#x7B26;&#x4E32;&#x540E;&#x9762;&#xFF0C;&#x6DFB;&#x52A0;&#x201C;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&#x201D; &#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x53D6;sha-1&#x7684;hash&#x503C;&#x3002;&#x6D4F;&#x89C8;&#x5668;&#x5C06;&#x5BF9;&#x8FD9;&#x4E2A;&#x503C;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF0C;&#x4EE5;&#x8BC1;&#x660E;&#x786E;&#x5B9E;&#x662F;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x5668;&#x56DE;&#x5E94;&#x4E86;webSocket&#x8BF7;&#x6C42;&#xFF1B;<br>6.Sec-WebSocket-Location—&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x8FD8;&#x6709;&#x8FD9;&#x4E2A;&#x54CD;&#x5E94;&#x6D88;&#x606F;&#x5934;&#x7528;&#x6765;&#x8868;&#x793A;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x7684;WebSocket&#x7F51;&#x5740;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4F8B;&#x5B50;&#x4E2D;&#x8BBE;&#x7F6E;&#x4E86;127.0.0.1&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x4FE1;&#x606F;&#x7701;&#x7565;&#x6389;&#x4E86;&#x3002;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;WebSocket&#x63E1;&#x624B;&#x7684;&#x8FC7;&#x7A0B;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;WebSocket&#x8FDE;&#x63A5;&#x3002;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x770B;&#x8D77;&#x6765;&#x662F;&#x8FD9;&#x4E2A;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f41e0a.png" alt=""></p>
<p>&#x5B8C;&#x6210;&#x63E1;&#x624B;&#x4EE5;&#x540E;&#xFF0C;WebSocket&#x534F;&#x8BAE;&#x5C31;&#x5728;TCP&#x534F;&#x8BAE;&#x4E4B;&#x4E0A;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x4F20;&#x9001;&#x6570;&#x636E;&#x4E86;&#x3002;</p>
<p>websocket&#x534F;&#x8BAE;&#x7528;ws&#x8868;&#x793A;&#xFF0C;&#x52A0;&#x5BC6;&#x7684;websocket&#x534F;&#x8BAE;&#x7528;wss&#x534F;&#x8BAE;&#xFF0C;&#x5C31;&#x50CF;&#x666E;&#x901A;&#x7684;HTTP&#x534F;&#x8BAE;&#x7528;http&#x8868;&#x793A;&#xFF0C;&#x52A0;&#x5BC6;&#x7684;HTTP&#x534F;&#x8BAE;&#x7528;https&#x8868;&#x793A;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x5B9E;&#x4F8B;&#x770B;&#x4E00;&#x4E0B;websocket&#x7684;&#x4E0D;&#x540C;&#x5B9E;&#x73B0;&#x662F;&#x5982;&#x4F55;&#x5E94;&#x7528;&#x7684;&#x3002;</p>
<h3 id="&#x4E8C;&#x3001;&#xA0;&#x8FD0;&#x884C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;WebSocket&#x5BA2;&#x6237;&#x7AEF;+&#x4F7F;&#x7528;ws&#x6A21;&#x5757;&#x642D;&#x5EFA;&#x7684;&#x7B80;&#x5355;&#x670D;&#x52A1;&#x5668;">&#x4E8C;&#x3001;&#xA0;&#x8FD0;&#x884C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;WebSocket&#x5BA2;&#x6237;&#x7AEF;+&#x4F7F;&#x7528;ws&#x6A21;&#x5757;&#x642D;&#x5EFA;&#x7684;&#x7B80;&#x5355;&#x670D;&#x52A1;&#x5668;</h3><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8DD1;&#x8D77;&#x6765;&#x8FD9;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#x770B;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x7F16;&#x5199;&#x8FD0;&#x884C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;WebSocket&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x770B;&#x5B83;&#x662F;&#x600E;&#x6837;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x4EA4;&#x4E92;&#x7684;&#x3002;</p>
<h4 id="2-1_&#x8FD0;&#x884C;&#x5B9E;&#x4F8B;">2.1 &#x8FD0;&#x884C;&#x5B9E;&#x4F8B;</h4><p>&#x6211;&#x4EEC;&#x628A;&#x5BA2;&#x6237;&#x7AEF;&#x4EE3;&#x7801;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4EE3;&#x7801;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x7136;&#x540E;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;8080&#xFF0C;&#x518D;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x6211;&#x4EEC;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4EE3;&#x7801;&#x5373;&#x53EF;&#x770B;&#x5230;&#x6548;&#x679C;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4EE3;&#x7801;&#x5199;&#x5728;html&#x6587;&#x4EF6;&#x4E2D;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f4207b.gif" alt=""></p>
<pre><code> <span class="number">1</span> var onOpen = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
 <span class="number">2</span>                 console.<span class="built_in">log</span><span class="params">(&amp;quot;Socket opened.&amp;quot;)</span>;
 <span class="number">3</span>                 socket.send<span class="params">(&amp;quot;Hi, Server!&amp;quot;)</span>;
 <span class="number">4</span>             },
 <span class="number">5</span>             onClose = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
 <span class="number">6</span>                 console.<span class="built_in">log</span><span class="params">(&amp;quot;Socket closed.&amp;quot;)</span>;
 <span class="number">7</span>             },
 <span class="number">8</span> 
 <span class="number">9</span> 
<span class="number">10</span>             onMessage = <span class="function"><span class="keyword">function</span><span class="params">(data)</span> {</span>
<span class="number">11</span>                 console.<span class="built_in">log</span><span class="params">(&amp;quot;We get signal:&amp;quot;)</span>;
<span class="number">12</span>                 console.<span class="built_in">log</span><span class="params">(data)</span>;
<span class="number">13</span>             },
<span class="number">14</span> 
<span class="number">15</span> 
<span class="number">16</span>             onError = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
<span class="number">17</span>                 console.<span class="built_in">log</span><span class="params">(&amp;quot;We got an error.&amp;quot;)</span>;
<span class="number">18</span>             },
<span class="number">19</span> 
<span class="number">20</span>             
<span class="number">21</span>             socket = new WebSocket<span class="params">(&amp;quot;ws://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span>/&amp;quot;)</span>;
<span class="number">22</span> 
<span class="number">23</span>         socket.onopen = onOpen;
<span class="number">24</span>         socket.onclose = onClose;
<span class="number">25</span>         socket.onerror = onError;
<span class="number">26</span>         socket.onmessage = onMessage;
</code></pre><p> View Code</p>
<p>[ <a href="https://github.com/zhangmengxue/Node-KOA/blob/master/websocket/simpleclient.html" target="_blank" rel="external">&#x67E5;&#x770B;&#x6E90;&#x7801;</a> ] </p>
<p>&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5B83;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x5E76;&#x4E14;&#x76D1;&#x542C;open&#x548C;messege&#x7B49;&#x4E8B;&#x4EF6;&#xFF0C;&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5F97;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x54CD;&#x5E94;&#x3002;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;js&#x4EE3;&#x7801;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f4255d.gif" alt=""></p>
<pre><code> <span class="number">1</span> <span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(&amp;apos;ws&amp;apos;).Server;
 <span class="number">2</span> <span class="keyword">var</span> wss = <span class="keyword">new</span> WebSocketServer({ port: <span class="number">8080</span> });
 <span class="number">3</span> 
 <span class="number">4</span> wss.on(&amp;apos;connection&amp;apos;, <span class="function"><span class="keyword">function</span> <span class="title">connection</span>(<span class="params">ws</span>) </span>{
 <span class="number">5</span>   ws.on(&amp;apos;message&amp;apos;, <span class="function"><span class="keyword">function</span> <span class="title">incoming</span>(<span class="params">message</span>) </span>{
 <span class="number">6</span>     <span class="built_in">console</span>.log(&amp;apos;received: %s&amp;apos;, message);
 <span class="number">7</span>   });
 <span class="number">8</span> 
 <span class="number">9</span>   ws.send(&amp;apos;something&amp;apos;);
<span class="number">10</span> });
</code></pre><p> View Code</p>
<p>[ <a href="https://github.com/zhangmengxue/Node-KOA/blob/master/websocket/simpleWSserver.js" target="_blank" rel="external">&#x67E5;&#x770B;&#x6E90;&#x7801;</a> ] </p>
<p>&#x8FD9;&#x4E2A;&#x7B80;&#x5355;&#x7684;websocket&#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528;&#x4E86;[ <a href="https://github.com/websockets/ws" target="_blank" rel="external">ws&#x6A21;&#x5757;</a> ]&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5B89;&#x88C5;&#x8FC7;&#xFF0C;&#x8981;&#x5148;&#x5B89;&#x88C5;&#x4E00;&#x4E0B;&#xFF1A; </p>
<pre><code><span class="number">1</span> sudo npm <span class="keyword">install</span> ws
</code></pre><p>&#x7136;&#x540E;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;&#xFF1A;</p>
<pre><code>1 <span class="tag">node</span> <span class="tag">simpleWSserver</span><span class="class">.js</span>
</code></pre><p>&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;</p>
<p>&#x6D4F;&#x89C8;&#x5668;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f4255d.jpg" alt=""></p>
<p>&#x547D;&#x4EE4;&#x884C;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f42cb0.jpg" alt=""></p>
<p>&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x770B;&#x8D77;&#x6765;&#x662F;&#x8FD9;&#x4E2A;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f42cb0.jpg" alt=""></p>
<h4 id="2-2_&#x8FD0;&#x884C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;websocket&#x5BA2;&#x6237;&#x7AEF;">2.2 &#x8FD0;&#x884C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;websocket&#x5BA2;&#x6237;&#x7AEF;</h4><p>&#x6211;&#x4EEC;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;websocket&#x4E3B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x65E0;&#x975E;&#x662F;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#xFF1A;</p>
<pre><code>1 &amp;<span class="id">#x5EFA</span>;&amp;<span class="id">#x7ACB</span>;&amp;<span class="id">#x8FDE</span>;&amp;<span class="id">#x63A5</span>;&amp;<span class="id">#x548C</span>;&amp;<span class="id">#x5173</span>;&amp;<span class="id">#x95ED</span>;&amp;<span class="id">#x8FDE</span>;&amp;<span class="id">#x63A5</span>; 
2 &amp;<span class="id">#x53D1</span>;&amp;<span class="id">#x9001</span>;&amp;<span class="id">#x6570</span>;&amp;<span class="id">#x636E</span>;&amp;<span class="id">#x548C</span>;&amp;<span class="id">#x63A5</span>;&amp;<span class="id">#x6536</span>;&amp;<span class="id">#x6570</span>;&amp;<span class="id">#x636E</span>;
3 &amp;<span class="id">#x5904</span>;&amp;<span class="id">#x7406</span>;&amp;<span class="id">#x9519</span>;&amp;<span class="id">#x8BEF</span>;
</code></pre><p>&#x5BF9;&#x5E94;&#x7684;&#x4F1A;&#x89E6;&#x53D1;&#x4EE5;&#x4E0B;&#x7684;&#x4E8B;&#x4EF6;&#xFF1A;</p>
<pre><code>1 onopen
2 onmessage
3 onclose
4 onerror
</code></pre><p>2.2.1 &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x548C;&#x5173;&#x95ED;&#x8FDE;&#x63A5;</p>
<p>&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x65B0;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;WebSocket&#x7684;&#x5B9E;&#x4F8B;&#x5C31;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#xFF1A;</p>
<pre><code><span class="number">1</span> <span class="keyword">if</span>(<span class="built_in">window</span>.WebSocket != <span class="literal">undefined</span>) {
<span class="number">2</span>     <span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(&amp;quot;ws:<span class="comment">//127.0.0.1:8080/&amp;quot;);</span>
<span class="number">3</span> }
</code></pre><p>&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x540E;&#x7684;WebSocket&#x5B9E;&#x4F8B;&#x6709;&#x4E00;&#x4E2A;readyState&#x5C5E;&#x6027;&#xFF0C;&#x7528;&#x6765;&#x6807;&#x8BC6;&#x5F53;&#x524D;&#x7684;&#x72B6;&#x6001;&#xFF1A;</p>
<pre><code>0<span class="tag">-</span>&amp;<span class="id">#x6B63</span>;&amp;<span class="id">#x5728</span>;&amp;<span class="id">#x8FDE</span>;&amp;<span class="id">#x63A5</span>;
1<span class="tag">-</span>&amp;<span class="id">#x8FDE</span>;&amp;<span class="id">#x63A5</span>;&amp;<span class="id">#x6210</span>;&amp;<span class="id">#x529F</span>;
2<span class="tag">-</span>&amp;<span class="id">#x6B63</span>;&amp;<span class="id">#x5728</span>;&amp;<span class="id">#x5173</span>;&amp;<span class="id">#x95ED</span>;
3<span class="tag">-</span>&amp;<span class="id">#x5173</span>;&amp;<span class="id">#x95ED</span>;&amp;<span class="id">#x6210</span>;&amp;<span class="id">#x529F</span>;
</code></pre><p>&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x540E;&#x4F1A;&#x89E6;&#x53D1;onopen&#x4E8B;&#x4EF6;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x6570;&#x636E;&#x4E86;&#xFF1A;</p>
<pre><code><span class="number">1</span> var onOpen = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
<span class="number">2</span>       console.<span class="built_in">log</span><span class="params">(&amp;quot;Socket opened.&amp;quot;)</span>;
<span class="number">3</span>       socket.send<span class="params">(&amp;quot;Hi, Server!&amp;quot;)</span>;
<span class="number">4</span>  }
<span class="number">5</span> socket.onopen = onOpen;
</code></pre><p>&#x8981;&#x662F;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x51FA;&#x53D1;onclose&#x4E8B;&#x4EF6;&#xFF1A;</p>
<pre><code>1 var onClose = function() {
2         console.log(&amp;quot;Socket <span class="keyword">closed</span>.&amp;quot;);
3   }
4 socket.onclose = onClose;
</code></pre><p>2.2.2 &#x53D1;&#x9001;&#x6570;&#x636E;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;</p>
<p>&#x5728;&#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#x6210;&#x529F;&#x540E;&#x89E6;&#x53D1;&#x7684;onopen&#x4E8B;&#x4EF6;&#x4E2D;&#x6211;&#x4EEC;&#x901A;&#x8FC7;send()&#x65B9;&#x6CD5;&#x53D1;&#x9001;&#x6570;&#x636E;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<pre><code><span class="number">1</span> <span class="keyword">socket</span>.<span class="keyword">send</span>(&amp;quot;Hi, Server!&amp;quot;);
</code></pre><p>&#x9664;&#x4E86;&#x53D1;&#x9001;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Blob &#x6216; ArrayBuffer &#x5BF9;&#x8C61;&#x53D1;&#x9001;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x3002;&#x4E0D;&#x4EC5;&#x5982;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x53D1;&#x9001;JSON&#x6570;&#x636E;&#xFF1A;</p>
<pre><code> <span class="number">1</span>  <span class="keyword">var</span> onOpen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
 <span class="number">2</span>       <span class="keyword">var</span> msg = {
 <span class="number">3</span>          type: &amp;quot;message&amp;quot;,
 <span class="number">4</span>          text: &amp;quot;something&amp;quot;,
 <span class="number">5</span>          id:   &amp;quot;number&amp;quot;,
 <span class="number">6</span>          date: <span class="built_in">Date</span>.now()
 <span class="number">7</span>       };
 <span class="number">8</span> 
 <span class="number">9</span>    <span class="comment">// Send the msg object as a JSON-formatted string.</span>
<span class="number">10</span>    socket.send(<span class="built_in">JSON</span>.stringify(msg));
<span class="number">11</span>   }
<span class="number">12</span>  socket.onopen = onOpen;
</code></pre><p>&#x8FD9;&#x65F6;&#x4F1A;&#x89E6;&#x53D1;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;message&#x4E8B;&#x4EF6;&#xFF1A;</p>
<pre><code><span class="number">1</span> ws.<span class="keyword">on</span>(&amp;apos;<span class="keyword">message</span>&amp;apos;, <span class="function"><span class="keyword">function</span> <span class="title">incoming</span><span class="params">(<span class="keyword">message</span>)</span> <span class="comment">{
2     console.log(&amp;apos;received: %s&amp;apos;, message);
3   }</span>);</span>
</code></pre><p>&#x540C;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x53D1;&#x6765;&#x4FE1;&#x606F;&#x7684;&#x65F6;&#x5019;&#xFF1A;</p>
<pre><code><span class="function">1 ws.<span class="title">send</span><span class="params">(&amp;apos;something&amp;apos;)</span></span>;
</code></pre><p>&#x4E5F;&#x4F1A;&#x89E6;&#x53D1;&#x5BA2;&#x6237;&#x7AEF;&#x7684;onmessage&#x4E8B;&#x4EF6;&#xFF1A;</p>
<pre><code><span class="number">1</span> var onMessage = <span class="function"><span class="keyword">function</span><span class="params">(data)</span> {</span>
<span class="number">2</span>         console.<span class="built_in">log</span><span class="params">(&amp;quot;We get signal:&amp;quot;)</span>;
<span class="number">3</span>         console.<span class="built_in">log</span><span class="params">(data)</span>;
<span class="number">4</span>   }
<span class="number">5</span> socket.onmessage = onMessage;
</code></pre><p>2.2.3 &#x5904;&#x7406;&#x9519;&#x8BEF;</p>
<p>&#x53D1;&#x751F;&#x7684;&#x9519;&#x8BEF;&#x4F1A;&#x89E6;&#x53D1;onerror&#x4E8B;&#x4EF6;&#xFF1A;</p>
<pre><code><span class="number">1</span> <span class="keyword">var</span> onError = <span class="function"><span class="keyword">function</span><span class="params">()</span> <span class="comment">{
2      console.log(&amp;quot;We got an error.&amp;quot;);
3  }</span>
4 <span class="title">socket</span>.<span class="title">onerror</span> = <span class="title">onError</span>;</span>
</code></pre><h3 id="&#x4E09;&#x3001;Node&#x4E2D;&#x7684;WebSocket">&#x4E09;&#x3001;Node&#x4E2D;&#x7684;WebSocket</h3><p>WebSocket&#x5728;Node&#x4E2D;&#x7684;&#x5B9E;&#x73B0;[ <a href="https://github.com/theturtle32/WebSocket-Node" target="_blank" rel="external">WebSocket-Node</a> ]&#x4F7F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;Nodejs&#x4E2D;&#x4F7F;&#x7528;websokcet&#x5F00;&#x53D1;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5B9E;&#x65F6;&#x4EA4;&#x4E92;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x5B9E;&#x65F6;&#x4EA4;&#x6362;&#x968F;&#x673A;&#x6570;&#x7684;&#x4F8B;&#x5B50;&#x770B;&#x770B;&#x5B83;&#x662F;&#x600E;&#x4E48;&#x5DE5;&#x4F5C;&#x7684;&#xFF1A; </p>
<p>&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<pre><code><span class="tag">node</span> <span class="tag">socketserver</span><span class="class">.js</span>
</code></pre><p>[ <a href="https://github.com/zhangmengxue/Node-KOA/blob/master/websocket/socketserver.js" target="_blank" rel="external">&#x67E5;&#x770B;&#x6E90;&#x7801;</a> ] </p>
<p>&#x542F;&#x52A8;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;</p>
<pre><code><span class="tag">node</span> <span class="tag">socketclient</span><span class="class">.js</span>
</code></pre><p>[ <a href="https://github.com/zhangmengxue/Node-KOA/blob/master/websocket/socketclient.js" target="_blank" rel="external">&#x67E5;&#x770B;&#x6E90;&#x7801;</a> ] </p>
<p><img src="http://taojinke.github.io/img/20150703/2f42f21.jpg" alt=""></p>
<p><img src="http://taojinke.github.io/img/20150703/2f43192.jpg" alt=""></p>
<h3 id="&#x56DB;&#x3001;socket-io">&#x56DB;&#x3001;socket.io</h3><p>&#x73B0;&#x5728;&#x5F88;&#x6D41;&#x884C;&#x7684;websocket&#x7684;&#x5B9E;&#x73B0;socket.io&#x540C;&#x6837;&#x5305;&#x62EC;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x4E24;&#x90E8;&#x5206;&#x3002;&#x5B83;&#x4E0D;&#x4EC5;&#x7B80;&#x5316;&#x4E86;&#x63A5;&#x53E3;&#xFF0C;&#x4F7F;&#x5F97;&#x64CD;&#x4F5C;&#x66F4;&#x5BB9;&#x6613;&#xFF0C;&#x800C;&#x4E14;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x4E0D;&#x652F;&#x6301;WebSocket&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x964D;&#x4E3A;Ajax&#x8FDE;&#x63A5;&#xFF0C;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x4FDD;&#x8BC1;&#x4E86;&#x517C;&#x5BB9;&#x6027;&#x3002;&#x5B83;&#x7684;&#x76EE;&#x6807;&#x662F;&#x7EDF;&#x4E00;&#x901A;&#x4FE1;&#x673A;&#x5236;&#xFF0C;&#x4F7F;&#x5F97;&#x6240;&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x79FB;&#x52A8;&#x8BBE;&#x5907;&#x90FD;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x901A;&#x4FE1;&#x3002;</p>
<h4 id="4-1&#xA0;socket-io&#x4E0E;WebSocket&#x7684;&#x533A;&#x522B;&#x5728;&#x54EA;&#x91CC;&#x5462;&#xFF1F;&#xA0;">4.1&#xA0;socket.io&#x4E0E;WebSocket&#x7684;&#x533A;&#x522B;&#x5728;&#x54EA;&#x91CC;&#x5462;&#xFF1F;&#xA0;</h4><p>websocket&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x5BF9;&#x8C61;&#xFF0C;websocket api&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4F9B;&#x7ED9;&#x6211;&#x4EEC;&#x7684;&#x7528;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x670D;&#x52A1;&#x5668;&#x5B9E;&#x65F6;&#x901A;&#x4FE1;&#x7684;&#x63A5;&#x53E3;&#x3002;</p>
<p>websocket&#x5728;node&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#x4F7F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F00;&#x53D1;&#x670D;&#x52A1;&#x7AEF;&#x7A0B;&#x5E8F;&#x65F6;&#x4F7F;&#x7528;websocket&#x7684;&#x7279;&#x6027;&#x3002;</p>
<p>&#x5728;&#x6211;&#x4EEC;&#x4F7F;&#x7528;websocket&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4F9B;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x4E9B;&#x517C;&#x5BB9;&#x6027;&#x548C;&#x652F;&#x6301;&#x6027;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5BF9;&#x7A0B;&#x5E8F;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x73AF;&#x5883;&#x6216;&#x5C40;&#x9650;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x4E86;&#x89E3;&#x7684;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF1A;</p>
<p>[ <a href="http://stackoverflow.com/questions/10112178/differences-between-socket-io-and-websockets" target="_blank" rel="external">Differences between socket.io and websocket</a> ] &#x3002;&#x800C;socket.io&#x5219;&#x662F;&#x8FDB;&#x5316;&#x4E86;&#x7684;websocket api&#x3002;socket.io&#x5EFA;&#x7ACB;&#x5728;websocket&#x4E4B;&#x4E0A;&#xFF0C;&#x5B83;&#x5728;&#x5408;&#x9002;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;websocket&#x3002; </p>
<h4 id="4-2_socket-io&#x5B9E;&#x73B0;&#x804A;&#x5929;&#x5BA4;">4.2 socket.io&#x5B9E;&#x73B0;&#x804A;&#x5929;&#x5BA4;</h4><p>&#x4F7F;&#x7528;websocket&#x6216;socket.io&#x53EF;&#x4EE5;&#x4ECE;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x804A;&#x5929;&#x5BA4;&#x7A0B;&#x5E8F;&#x5F00;&#x59CB;&#x3002;&#x5BF9;&#x4E8E;socket.io&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x3002;</p>
<p>&#x57FA;&#x4E8E; <a href="https://nodejs.org/" target="_blank" rel="external">node</a> &#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;express&#x548C;socket.io&#xFF1A; </p>
<pre><code>1 npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save express@4.10.2</span>
<span class="number">2</span> npm <span class="keyword">install</span> <span class="comment">--save socket.io</span></span>
</code></pre><p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5199;&#x804A;&#x5929;&#x7A0B;&#x5E8F;&#x4E86;&#x3002;&#x5B83;&#x9700;&#x8981;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x804A;&#x5929;&#x7A97;&#x53E3;&#x548C;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x548C;&#x5206;&#x53D1;&#x6D88;&#x606F;&#x7684;&#x670D;&#x52A1;&#x5668;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E09;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5206;&#x522B;&#x65B0;&#x5EFA;&#xFF1A;package.json,index.js,index.html.</p>
<p>package.json:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f43192.gif" alt=""></p>
<pre><code><span class="number">1</span> {
<span class="number">2</span>   &amp;quot;<span class="property">name</span>&amp;quot;: &amp;quot;chat-<span class="type">application</span>&amp;quot;,
<span class="number">3</span>   &amp;quot;<span class="property">version</span>&amp;quot;: &amp;quot;<span class="number">0.0</span>.1&amp;quot;,
<span class="number">4</span>   &amp;quot;description&amp;quot;: &amp;quot;<span class="keyword">my</span> <span class="keyword">first</span> socket.io app&amp;quot;,
<span class="number">5</span>   &amp;quot;dependencies&amp;quot;: {
<span class="number">6</span>     &amp;quot;socket.io&amp;quot;: &amp;quot;^<span class="number">1.3</span>.5&amp;quot;
<span class="number">7</span>   }
<span class="number">8</span> }
</code></pre><p> View Code</p>
<p>index.js:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f43403.gif" alt=""></p>
<pre><code><span class="xml"> 1 var app = require(&amp;apos;express&amp;apos;)();
 2 var http = require(&amp;apos;http&amp;apos;).Server(app);
 3 var io = require(&amp;apos;socket.io&amp;apos;)(http);
 4 
 5 app.get(&amp;apos;/&amp;apos;, function(req, res)</span><span class="expression">{
 6   <span class="variable">res.sendfile</span>(&amp;<span class="variable">apos</span>;<span class="variable">index.html</span>&amp;<span class="variable">apos</span>;);
 7 }</span><span class="xml">);
 8 
 9 io.on(&amp;apos;connection&amp;apos;, function(socket)</span><span class="expression">{
10   <span class="variable">console.log</span>(&amp;<span class="variable">apos</span>;<span class="variable">a</span> <span class="variable">user</span> <span class="variable">connected</span>&amp;<span class="variable">apos</span>;);
11   //&amp;<span class="begin-block">#x</span>76<span class="variable">D</span>1;&amp;<span class="begin-block">#x</span>542<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">BA</span>2;&amp;<span class="begin-block">#x</span>6237;&amp;<span class="begin-block">#x</span>7<span class="variable">AEF</span>;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>6<span class="variable">D</span>88;&amp;<span class="begin-block">#x</span>606<span class="variable">F</span>;
12   <span class="variable">socket.on</span>(&amp;<span class="variable">apos</span>;<span class="variable">chat</span> <span class="variable">message</span>&amp;<span class="variable">apos</span>;, <span class="variable">function</span>(<span class="variable">msg</span>){
13       //&amp;<span class="begin-block">#x</span>7528;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>8<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>06;&amp;<span class="begin-block">#x</span>6<span class="variable">D</span>88;&amp;<span class="begin-block">#x</span>606<span class="variable">F</span>;&amp;<span class="begin-block">#x</span>53<span class="variable">D</span>1;&amp;<span class="begin-block">#x</span>9001;&amp;<span class="begin-block">#x</span>7<span class="variable">ED</span>9;&amp;<span class="begin-block">#x</span>6<span class="variable">BCF</span>;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>2<span class="variable">A</span>;&amp;<span class="begin-block">#x</span>4<span class="variable">EBA</span>;&amp;<span class="begin-block">#xFF</span>0<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>5305;&amp;<span class="begin-block">#x</span>62<span class="variable">EC</span>;&amp;<span class="begin-block">#x</span>53<span class="variable">D</span>1;&amp;<span class="begin-block">#x</span>9001;&amp;<span class="begin-block">#x</span>8005;
14     <span class="variable">io.emit</span>(&amp;<span class="variable">apos</span>;<span class="variable">chat</span> <span class="variable">message</span>&amp;<span class="variable">apos</span>;, <span class="variable">msg</span>);
15   }</span><span class="xml">);
16   socket.on(&amp;apos;disconnect&amp;apos;, function()</span><span class="expression">{
17     <span class="variable">console.log</span>(&amp;<span class="variable">apos</span>;<span class="variable">user</span> <span class="variable">disconnected</span>&amp;<span class="variable">apos</span>;);
18   }</span><span class="xml">);
19 });
20 
21 http.listen(3000, function()</span><span class="expression">{
22   <span class="variable">console.log</span>(&amp;<span class="variable">apos</span>;<span class="variable">listening</span> <span class="variable">on</span> *:3000&amp;<span class="variable">apos</span>;);
23 }</span><span class="xml">);</span>
</code></pre><p> View Code</p>
<p>index.html:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f43674.gif" alt=""></p>
<pre><code> <span class="number">1</span> <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!</span>doctype html<span class="subst">&amp;</span><span class="literal">gt</span>;
 <span class="number">2</span> <span class="subst">&amp;</span><span class="literal">lt</span>;html<span class="subst">&amp;</span><span class="literal">gt</span>;
 <span class="number">3</span>   <span class="subst">&amp;</span><span class="literal">lt</span>;head<span class="subst">&amp;</span><span class="literal">gt</span>;
 <span class="number">4</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;title<span class="subst">&amp;</span><span class="literal">gt</span>;Socket<span class="built_in">.</span>IO chat<span class="subst">&amp;</span><span class="literal">lt</span>;/title<span class="subst">&amp;</span><span class="literal">gt</span>;
 <span class="number">5</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;style<span class="subst">&amp;</span><span class="literal">gt</span>;
 <span class="number">6</span>       <span class="subst">*</span> { margin: <span class="number">0</span>; padding: <span class="number">0</span>; box<span class="attribute">-sizing</span>: border<span class="attribute">-box</span>; }
 <span class="number">7</span>       body { font: <span class="number">13</span>px Helvetica, Arial; }
 <span class="number">8</span>       form { background: <span class="variable">#000</span>; padding: <span class="number">3</span>px; position: fixed; bottom: <span class="number">0</span>; width: <span class="number">100</span><span class="subst">%</span>; }
 <span class="number">9</span>       form input { border: <span class="number">0</span>; padding: <span class="number">10</span>px; width: <span class="number">90</span><span class="subst">%</span>; margin<span class="attribute">-right</span>: <span class="built_in">.</span><span class="number">5</span><span class="subst">%</span>; }
<span class="number">10</span>       form button { width: <span class="number">9</span><span class="subst">%</span>; background: rgb(<span class="number">130</span>, <span class="number">224</span>, <span class="number">255</span>); border: <span class="literal">none</span>; padding: <span class="number">10</span>px; }
<span class="number">11</span>       <span class="variable">#messages</span> { <span class="built_in">list</span><span class="attribute">-style</span><span class="attribute">-type</span>: <span class="literal">none</span>; margin: <span class="number">0</span>; padding: <span class="number">0</span>; }
<span class="number">12</span>       <span class="variable">#messages</span> li { padding: <span class="number">5</span>px <span class="number">10</span>px; }
<span class="number">13</span>       <span class="variable">#messages</span> li:nth<span class="attribute">-child</span>(odd) { background: <span class="variable">#eee</span>; }
<span class="number">14</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;/style<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">15</span>   <span class="subst">&amp;</span><span class="literal">lt</span>;/head<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">16</span>   <span class="subst">&amp;</span><span class="literal">lt</span>;body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">17</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;ul id<span class="subst">=&amp;</span>quot;messages<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/ul<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">18</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;form action<span class="subst">=&amp;</span>quot;<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">19</span>       <span class="subst">&amp;</span><span class="literal">lt</span>;input id<span class="subst">=&amp;</span>quot;m<span class="subst">&amp;</span>quot; autocomplete<span class="subst">=&amp;</span>quot;off<span class="subst">&amp;</span>quot; <span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;button<span class="subst">&amp;</span><span class="literal">gt</span>;Send<span class="subst">&amp;</span><span class="literal">lt</span>;/button<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">20</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;/form<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">21</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;https:<span class="comment">//cdn.socket.io/socket.io-1.2.0.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;</span>
<span class="number">22</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;http:<span class="comment">//code.jquery.com/jquery-1.11.1.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;</span>
<span class="number">23</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">24</span>       <span class="built_in">var</span> socket <span class="subst">=</span> io();
<span class="number">25</span>       $(<span class="subst">&amp;</span>apos;form<span class="subst">&amp;</span>apos;)<span class="built_in">.</span>submit(function(){
<span class="number">26</span>         <span class="comment">//io.emit&amp;#x63D0;&amp;#x4F9B;&amp;#x7ED9;&amp;#x6211;&amp;#x4EEC;&amp;#x53EF;&amp;#x4EE5;&amp;#x53D1;&amp;#x9001;&amp;#x7ED9;&amp;#x6240;&amp;#x6709;&amp;#x4EBA;&amp;#x7684;&amp;#x4E8B;&amp;#x4EF6;io.emit(&amp;apos;some event&amp;apos;, { for: &amp;apos;everyone&amp;apos; });</span>
<span class="number">27</span>         socket<span class="built_in">.</span>emit(<span class="subst">&amp;</span>apos;chat message<span class="subst">&amp;</span>apos;, $(<span class="subst">&amp;</span>apos;<span class="variable">#m</span><span class="subst">&amp;</span>apos;)<span class="built_in">.</span>val());
<span class="number">28</span>         $(<span class="subst">&amp;</span>apos;<span class="variable">#m</span><span class="subst">&amp;</span>apos;)<span class="built_in">.</span>val(<span class="subst">&amp;</span>apos;<span class="subst">&amp;</span>apos;);
<span class="number">29</span>         <span class="keyword">return</span> <span class="literal">false</span>;
<span class="number">30</span>       });
<span class="number">31</span>       socket<span class="built_in">.</span><span class="keyword">on</span>(<span class="subst">&amp;</span>apos;chat message<span class="subst">&amp;</span>apos;, function(msg){
<span class="number">32</span>         $(<span class="subst">&amp;</span>apos;<span class="variable">#messages</span><span class="subst">&amp;</span>apos;)<span class="built_in">.</span>append($(<span class="subst">&amp;</span>apos;<span class="subst">&amp;</span><span class="literal">lt</span>;li<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span>apos;)<span class="built_in">.</span>text(msg));
<span class="number">33</span>       });
<span class="number">34</span>     <span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">35</span>   <span class="subst">&amp;</span><span class="literal">lt</span>;/body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="number">36</span> <span class="subst">&amp;</span><span class="literal">lt</span>;/html<span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><p> View Code</p>
<p>&#x5148;&#x8FD0;&#x884C;&#xFF1A;</p>
<pre><code>node <span class="keyword">index</span>.js
</code></pre><p>&#x5728;&#x6253;&#x5F00;&#x4E24;&#x4E2A;<a href="http://localhost:3000&#x7684;&#x7A97;&#x53E3;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x804A;&#x5929;&#x4E86;&amp;#xFF1A" target="_blank" rel="external">http://localhost:3000&#x7684;&#x7A97;&#x53E3;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x804A;&#x5929;&#x4E86;&amp;#xFF1A</a>;</p>
<p><img src="http://taojinke.github.io/img/20150703/2f438e5.gif" alt=""></p>
<p><img src="http://taojinke.github.io/img/20150703/2f43b56.jpg" alt=""></p>
<p>[ <a href="https://github.com/zhangmengxue/Node-KOA/tree/master/websocket/chat-application" target="_blank" rel="external">&#x67E5;&#x770B;&#x6E90;&#x4EE3;&#x7801;</a> ] </p>
<p>socket.io&#x5B98;&#x7F51;&#x4E0A;&#x6709;&#x5F88;&#x8BE6;&#x7EC6;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x548C;&#x6559;&#x7A0B;&#xFF1A;[ <a href="http://socket.io/docs/" target="_blank" rel="external">socket.io doc</a> ] </p>
<h3 id="&#x4E94;&#x3001;&#x6269;&#x5C55;&#x9605;&#x8BFB;">&#x4E94;&#x3001;&#x6269;&#x5C55;&#x9605;&#x8BFB;</h3><p>[ <a href="http://javascript.ruanyifeng.com/htmlapi/websocket.html" target="_blank" rel="external">&#x6D4F;&#x89C8;&#x5668;&#x5BF9;&#x8C61;-WebSocket</a> ] </p>
<p>[web&#x901A;&#x4FE1;] </p>
<p>[&#x7EC6;&#x8BF4;WebSocket] </p>
<p>[ <a href="https://developer.mozilla.org/en-US/docs/WebSockets" target="_blank" rel="external">WebSocket MDN</a> ] </p>
<p>[ <a href="https://github.com/theturtle32/WebSocket-Node" target="_blank" rel="external">WebSocket-Node implementation</a> ] </p>
<p>[ <a href="http://buildnewgames.com/websockets/" target="_blank" rel="external">A Guide For WebSocket</a> ] </p>
<p>[ <a href="http://socket.io/" target="_blank" rel="external">socket.IO</a> ] </p>
<p>[ <a href="https://developer.mozilla.org/en-US/docs/WebSockets/Writing_WebSocket_client_applications" target="_blank" rel="external">writing websocket client</a> ] </p>
<p>[ <a href="http://stackoverflow.com/questions/10112178/differences-between-socket-io-and-websockets" target="_blank" rel="external">deferences between socket.io and websocket</a> ] </p>
<p>[ <a href="http://davidwalsh.name/websocket" target="_blank" rel="external">websocket and socketio</a> ] </p>
<p>[ <a href="http://socket.io/get-started/chat/" target="_blank" rel="external">socket.io application</a> ] </p>
]]></content>
    <summary type="html">
    <![CDATA[<p>&#x6587;&#x7AE0;&#x5BFC;&#x8BFB;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x3001;&#x6982;&#x8FF0;-what&apos;s WebSocket?</li>
<li>&#x4E8C;&#x3001;&#]]>
    </summary>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="WebSocket" scheme="http://taojinke.github.io/tags/WebSocket/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[How to Grunt and Gulp Your Way to Workflow Automation -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f37324/"/>
    <id>http://taojinke.github.io/2015/07/03/2f37324/</id>
    <published>2015-07-03T02:09:57.000Z</published>
    <updated>2015-07-03T14:09:57.244Z</updated>
    <content type="html"><![CDATA[<p>This article is part of a web dev series from Microsoft. Thank you for supporting the partners who make SitePoint possible.</p>
<p>When you are new to front-end development and start mastering HTML5, CSS and JavaScript, the obvious next step is to put your hands on tools that most developers use to stay sane in this complex space. You too deserve to have more flexibility and features while writing your CSS sheets by using Less. You too deserve to optimize bandwidth by minifying your JS code. You too deserve to be able to automatically check that your JS code is good using JSHint. You deserve all this good stuff.</p>
<p>So you start to use all these great tools by hand; running more and more command lines manually. Sometimes, you forget to run the Less compiler. Sometimes you forget to run JSHint and a bug is shipped&#x2026;</p>
<p>And suddenly you find yourself wondering: is there any solution to automate all these tools? How can you create a repeatable workflow to prevent you from doing mistakes?</p>
<p>Obviously a solution exists, and two tools in particular are waiting for you to get started: <strong>Grunt</strong> and <strong>Gulp</strong> . </p>
<p>As a newbie using these tools, you are wondering how they work and which one to use, aren&#x2019;t you? Well perfect then, you are reading the right article!</p>
<h2 id="The_Sample_We&#x2019;ll_Use">The Sample We&#x2019;ll Use</h2><p>I will give you the basis for using Grunt and Gulp using a really simple example that you can download here: <a href="http://aka.ms/gruntgulpplugin?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">http://aka.ms/gruntgulpplugin</a></p>
<p>It is a simple web site composed of three files:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f307b8.png" alt=""></p>
<p>Styles.less define the CSS sheet in a richer manner that what you can do using standard CSS file. In the end we use the Less compiler to create a styles.css file. Using less, we are able for instance to use variables in the css file: </p>
<p><img src="http://taojinke.github.io/img/20150703/2f30a29.png" alt=""></p>
<p>Get more info about Less here: <a href="http://lesscss.org/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">http://lesscss.org/</a></p>
<p>The JavaScript and HTML code are really simple. The page should look like this:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f30c9a.png" alt=""></p>
<h2 id="Understanding_Node-js_Package_Manager">Understanding Node.js Package Manager</h2><p>You need to understand first how Node.JS Package Manager (npm) works.</p>
<p>Npm is the tool provided with Node.JS. It is used to get tools and frameworks while automatically resolving their dependencies.</p>
<p>For instance, to use less and compile it into a web usable CSS file, you first need to install less using this command:</p>
<pre><code>npm <span class="keyword">install</span> -g <span class="operator">less</span>
</code></pre><p><em>Note: To get the npm command line, you have to install nodejs from</em><a href="http://nodejs.org/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">http://nodejs.org/</a></p>
<p>Once this is done you can run this command to compile .less files into .css:</p>
<pre><code><span class="tag">lessc</span> <span class="tag">styles</span><span class="class">.less</span> &amp;<span class="tag">gt</span>; <span class="tag">styles</span><span class="class">.css</span>
</code></pre><p>Npm uses a file that it creates and store on the local folder it is working: package.json . This file is using the JavaScript Object Notation (JSON) format to let npm know which tool and version is installed and the frameworks used by the current project (which is represented by the current folder). </p>
<p>This file is important for Grunt and Gulp because it will contain the list of plugins downloaded and usable in your automation workflow.</p>
<p>To create an empty package.json file you can use the following npm command:</p>
<pre><code><span class="built_in">npm</span> init
</code></pre><p>You will go through some questions that you can answer using the default option, then you will be all set to start.</p>
<p>In this file you will have two kinds of dependencies:</p>
<ul>
<li>The ones needed for the execution of your web app / nodejs app</li>
<li>The ones needed for the development phase (like Less) and which are used to compile / check your code</li>
</ul>
<p>Npm basically gives you three ways to install packages:</p>
<ul>
<li>Globally on your machine using the &#x2013;g or-global option</li>
<li>For execution purpose, locally on your project folder using no options (only npm install [tools or framework])</li>
<li>For dev purpose, locally on your project folder using the —save-dev option</li>
</ul>
<p>The third one will create a devDependencies section / property inside the package.json file. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f318cf.png" alt=""></p>
<h2 id="Grunt">Grunt</h2><h3 id="What_is_grunt?">What is grunt?</h3><p>Grunt is a pioneer in the JavaScript automation workflow area. There are a lot of <a href="http://gruntjs.com/who-uses-grunt?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">known Grunt users</a> like Twitter, jQuery and Modernizr. </p>
<p>The basic principle for Grunt is to give us an easy way to run tasks . A task is a set of code files and configuration files already created for you. You can get new tasks by installing Grunt plugins that you will get using npm. You can find a plugin for pretty much every tool you might use, such as <a href="https://www.npmjs.com/package/grunt-contrib-less?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Less</a> and <a href="https://www.npmjs.com/package/grunt-contrib-jshint?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">JSHint</a> . </p>
<p>To run Grunt, you have to create a Gruntfile in which you specify which tasks you want to run and the configuration for each of them. Once this is done, you only have to run the grunt command line specifying the task you want to run (default or a specific one) and it will do it automatically. </p>
<p>Now let&#x2019;s go through a step by step guide to set up all this.</p>
<h3 id="Step_1-_Create_the_package-json_file">Step 1. Create the package.json file</h3><p>Use npm to init the file: </p>
<pre><code><span class="built_in">npm</span> init
</code></pre><p>You will have to answer a few questions like the project name and what is the default .js file. You can also choose to create the file manually and setting its content to:</p>
<pre><code><span class="collection">{
  &amp;quot;name&amp;quot;: &amp;quot;project-name&amp;quot;,
  &amp;quot;devDependencies&amp;quot;: <span class="collection">{}</span>,
  &amp;quot;dependencies&amp;quot;: <span class="collection">{}</span>
}</span>
</code></pre><h3 id="Step_2-_Install_Grunt_globally_and_locally">Step 2. Install Grunt globally and locally</h3><p>You need to install Grunt globally to get the command line and locally to initialize everything needed for the project.</p>
<p>Run:</p>
<pre><code>npm <span class="keyword">install</span> -g grunt
</code></pre><p>Then run it locally:</p>
<pre><code>npm install grunt --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>Note: Do not forget the &#x2013;dev part for it to be specified as a devDependencie in the package.json file. </p>
<h3 id="Step_3-_Create_the_gruntFile-js">Step 3. Create the gruntFile.js</h3><p>Grunt works using a file named gruntFile.js. This file contains everything needed by Grunt, that is to say:</p>
<ul>
<li>Configuration for tasks</li>
<li>Custom tasks</li>
<li>Task loading</li>
</ul>
<p>Grunt expect the file to export a single function which take one parameter named grunt . You will use this object to perform all Grunt related actions. </p>
<p>Here is a minimal gruntfile that only read the package.json file and create a default task which runs nothing. </p>
<p>Note: place the file in the project folder, side by side with the package.json file </p>
<pre><code><span class="function"><span class="keyword">module</span>.<span class="title">exports</span> =</span> <span class="function"><span class="keyword">function</span><span class="params">(grunt)</span> {</span>

  <span class="comment">// Project configuration.</span>
  grunt.initConfig<span class="params">({
    pkg: grunt.file.readJSON<span class="params">(&amp;apos;package.json&amp;apos;)</span>,
  })</span>;

  <span class="comment">// Default task(s).</span>
  grunt.registerTask<span class="params">(&amp;apos;default&amp;apos;, [])</span>;

};
</code></pre><p>You can execute it to be sure everything is configured correctly.</p>
<p>To do that, open a command prompt on the project folder and run:</p>
<pre><code>grunt
</code></pre><p>You should see something like this:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f31b40.png" alt=""></p>
<h3 id="Step_4-_Add_your_first_task:_JSHint">Step 4. Add your first task: JSHint</h3><p>Now that your Gruntfile is ready, the next step is to add a plugin and use it. All plugins can be found here: <a href="http://gruntjs.com/plugins?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">http://gruntjs.com/plugins</a> . One of the common tasks performed in a Gruntfile is checking if the JavaScript syntax is correct. To do that, we usually use JSHint. </p>
<p>Let&#x2019;s add is to your grunt workflow.</p>
<p>If you search for JShint on the grunt plugins page, you will find grunt-contrib-jshint ( <a href="https://www.npmjs.com/package/grunt-contrib-jshint?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">here</a> ) which corresponds to what we need! </p>
<p>In the project folder, run:</p>
<pre><code>npm install grunt-contrib-jshint --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>One this is done you have to add it in your Gruntfile.js. There are two simple steps for that:</p>
<ul>
<li>Load the plugin</li>
<li>Configure the task</li>
</ul>
<p>To load the plugin, use the loadNpmTasks function: </p>
<pre><code><span class="comment">// Load the plugin that provides the &amp;quot;jshint&amp;quot; task</span>
grunt.loadNpmTasks<span class="params">(&amp;apos;grunt-contrib-jshint&amp;apos;)</span>;
</code></pre><p>The configuration is done in the initConfig function where you have to add a new property to the object given in parameter. This have to be the name of the task you want to add and is related to the plugin you use. The best way to know that name and the list of available options for the task is to have a look at the plugin documentation. You will always find a well-documented sample. </p>
<p>For instance, in our sample we want to check all the JavaScript files except the gruntfile.js . We also want to activate a set of rules to check in the JavaScript files like eqeqeq to ensure we use triple equals when needed. </p>
<p>Here is the initConfig function modified:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f31b40.png" alt=""></p>
<p>You can run your task by using the following command line (where you specify the task name as a parameter for grunt ): </p>
<pre><code><span class="title">grunt</span> jshint
</code></pre><p>The result is here:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f31db1.png" alt=""></p>
<p>You just have to run that command and it will automatically prompt you for any errors it encounter.</p>
<p>Congratulation, you now have a task automated in your grunt workflow!</p>
<h3 id="Step_5-_Add_a_second_task:_Less_compilation">Step 5. Add a second task: Less compilation</h3><p>Your JShint task works well but it is a little bit alone in the workflow. Usually, we are using tools like grunt to run more than one task.</p>
<p>It is really easy to add more of them as you just have to follow the same steps. Let&#x2019;s say you now want to add the compilation for your less file inside the automated process. If you search in the grunt plugins, you will find a grunt-contrib-less plugin that you can install on your project folder:</p>
<pre><code>npm <span class="keyword">install</span> grunt-contrib-<span class="operator">less</span> --save-dev
</code></pre><p>Like for the jshint task, you have to add the configuration:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f32022.png" alt=""></p>
<p>Then, load the task:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f32022.png" alt=""></p>
<p>You can now run Grunt and specify the less task: this will launch only less. That is OK but you want to run all the tasks right? That is the role of the default task. </p>
<p>When you just run grunt without specifying any task it will search for a default task and run all the task specified in its array. You can modify it to run less and jshint . Note that to add a group of tasks like default your need to call the registerTask function: </p>
<p><img src="http://taojinke.github.io/img/20150703/2f32293.png" alt=""></p>
<p>From now, when you run:</p>
<pre><code>grunt
</code></pre><p>It will run jshint, then less:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f32293.png" alt=""></p>
<p>You can add any task you want, and you can also specify other group of task like default and call them by passing their name as an argument to the grunt command line. </p>
<p>Easy right?</p>
<h3 id="Step_6-_Use_watch_so_you_do_not_have_to_run_grunt_manually">Step 6. Use watch so you do not have to run grunt manually</h3><p>Now, you are a happy developer. All you repetitive tasks are automated inside a grunt workflow and you just have to run grunt for them to execute. But that can be done even more easily. That can be done automatically.</p>
<p>To do that, you can add a specific task named watch . This task will constantly inspect your working folder and, based on rules, when a file is modified, grunt will run an associated task. </p>
<p>First, install watch in your project folder:</p>
<p>npm install grunt-contrib-watch &#x2013;save-dev</p>
<p>Load it like all other tasks using the loadNpmTasks function and configure it. The config part is a bit different here because you need to specify a configuration for each task you want to cover using watch . </p>
<p><img src="http://taojinke.github.io/img/20150703/2f32504.png" alt=""></p>
<p>You can find the full documentation for this task here: <a href="https://www.npmjs.com/package/grunt-contrib-watch?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">https://www.npmjs.com/package/grunt-contrib-watch</a></p>
<p>When you want to activate watch you only have to run the following command: </p>
<p>grunt watch</p>
<p>And it will execute tasks each time a file is changed and this file is in the scope of watched files for the specific task.</p>
<p><img src="http://taojinke.github.io/img/20150703/2f32504.png" alt=""></p>
<p>And that&#x2019;s it! You now know everything to create automated workflow using grunt.</p>
<h2 id="Gulp">Gulp</h2><p>What is Gulp?</p>
<p>Gulp is an alternative to grunt. It is a bit more recent and has a reputation as being more flexible than grunt. Before choosing which one you will use, let&#x2019;s have a look at how gulp works.</p>
<p>Gulp ( <a href="http://gulpjs.com/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">http://gulpjs.com/</a> ) is a workflow automation tool. Like grunt, it works using npm and the package.json file. All available plugins will also be downloaded using npm and added as devDependencies in the package.json file. </p>
<p>One of the main differences with Gulp is that it uses streams. A stream is a set of functions through which a file will go and be modified in memory . The file will be written on the disk only at the end of the process so it is more efficient. Grunt tasks, on the other hand, work as silos and cannot be chained. </p>
<p>Let&#x2019;s have a quick look at how Gulp works by following a few easy steps.</p>
<h3 id="Step_1-_Create_the_package-json_file-1">Step 1. Create the package.json file</h3><p>Similar to Grunt, you first have to create the package.json file. You can use the exact same technique you used for the grunt sample. </p>
<h3 id="Step_2-_Install_Gulp_and_gulp-util_globally_and_locally">Step 2. Install Gulp and gulp-util globally and locally</h3><p>Once the package.json file is created, install gulp globally and locally using:</p>
<pre><code>npm <span class="keyword">install</span> -g gulp
</code></pre><p>and</p>
<pre><code>npm install gulp --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>This will install the gulp command line and everything needed to run a gulp workflow.</p>
<p>You then have to install gulp utils which contains common function shared by other plugins:</p>
<pre><code>npm install gulp-util --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>Finally, create the minimum gulp file which will look like this:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f32775.png" alt=""></p>
<p>As you can see it is a bit different from the grunt syntax. In gulp, plugins are loaded using the require syntax as you might be used to if you are a nodeJS developer. There is also a default task defined using the gulp.task function. </p>
<p>If you run the gulp command line using a command prompt in the project folder, you should see a result like this: </p>
<p><img src="http://taojinke.github.io/img/20150703/2f329e6.png" alt=""></p>
<h3 id="Step_3-_Using_your_first_task:_Less_compilation">Step 3. Using your first task: Less compilation</h3><p>To use a plugin in gulp, you use the same function as the one we used to create the default task. This is because you do not have to use a specific name to create a task. You just call gulp.task, set the name you want and give it a JavaScript function as a second parameter. When gulp runs the task, it will run this function. </p>
<p>To use a plugin, you call it using the name you chose when require -ing it. Usually, you call it as part of a streaming workflow which generally starts with a selection of files. This is done with the gulp.src function. It will select a bunch of files and return a stream that can be used by another function using pipe . That is how you can chain multiple actions without writing them to the disk. You just pass the stream from one plugin to another. </p>
<p>Here is a simple sample for less:</p>
<p><img src="http://taojinke.github.io/img/20150703/2f32c57.png" alt=""></p>
<p>We first require (&#x2018;gulp-less&#x2019;) to load the less plugin for gulp. (We got it using npm install gulp-less —save-dev ). </p>
<p>Then gulp.src will select all the .less files, we &#x2018;pipe&#x2019; it to the less() function and it finally is &#x2018;piped&#x2019; to gulp.dest which indicates where to write the result. As gulp.src can select more than one file, gulp.dest specifies a folder. </p>
<p>Once you understand the piping model, you can easily get the same result as the one we got using grunt.</p>
<p>The power of gulp is that you can create custom task in which you call more than one plugin and where you can associate them the way you want.</p>
<p>Note: there is obviously also a gulp-watch plugin you can use to automated the launch of your workflow! </p>
<h2 id="Conclusion:_which_one_to_choose?">Conclusion: which one to choose?</h2><p>I hope that you have now a clearer understanding of why you need an automation workflow and how you can use grunt or gulp to get it. </p>
<p>Choosing one of them is more related to the task you want to achieve.</p>
<p>Grunt is easy to use. You do not have to understand the piping system and achieving simple task will be more straight-forward. It is a really mature tool, used by a lot of known editors and developers and there is a lot of plugins available.</p>
<p>Once that said, the way gulp is designed can give you a lot of flexibility. It has existed for quite some time now and even if you won&#x2019;t find as many plugins as you will for grunt, all the classic ones are available for gulp.</p>
<p>If you are using a really standard workflow with common steps like jshint, uglifying, css validating etc., Grunt is a good choice. If you are up to more complicated tasks, gulp will be a good wingman.</p>
<h2 id="More_information">More information</h2><ul>
<li>Grunt website: <a href="http://gruntjs.com/" target="_blank" rel="external">http://</a><a href="http://gruntjs.com/" target="_blank" rel="external">com/</a></li>
<li>Gulp website : <a href="http://gulpjs.com" target="_blank" rel="external">http://</a><a href="http://gulpjs.com" target="_blank" rel="external">com</a></li>
<li>Use grunt inside Microsoft Visual Studio:<a href="http://www.asp.net/vnext/overview/aspnet-vnext/grunt-and-bower-in-visual-studio-2015?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">http://www.asp.net/vnext/overview/aspnet-vnext/grunt-and-bower-in-visual-studio-2015</a></li>
</ul>
<h2 id="More_hands-on_with_JavaScript">More hands-on with JavaScript</h2><p>Microsoft has a bunch of free learning on many open source JavaScript topics and we&#x2019;re on a mission to create a lot more with <a href="http://blogs.windows.com/msedgedev/2015/04/29/introducing-microsoft-edge-the-browser-built-for-windows-10/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Microsoft Edge</a> . Here are some to check-out: </p>
<ul>
<li><a href="http://channel9.msdn.com/events/WebPlatformSummit/2015?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Microsoft Edge Web Summit 2015</a> (a complete series of what to expect with the new browser, new web platform features, and guest speakers from the community)</li>
<li><a href="http://www.microsoftvirtualacademy.com/training-courses/best-of-build-and-windows-10?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Build of //BUILD/ and Windows 10</a> (including the new JavaScript engine for sites and apps)</li>
<li><a href="http://channel9.msdn.com/Events/WebPlatformSummit/2015/Advancing-JavaScript-without-breaking-the-web?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Advancing JavaScript without Breaking the Web</a> (Christian Heilmann&#x2019;s recent keynote)</li>
<li><a href="http://channel9.msdn.com/Events/Build/2015/2-665?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Hosted Web Apps and Web Platform Innovations</a> (a deep-dive on topics like manifold.JS)</li>
<li><a href="http://channel9.msdn.com/Series/Practical-Performance-Tips-to-Make-Your-HTMLJavaScript-Faster/06?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Practical Performance Tips to Make your HTML/JavaScript Faster</a> (a 7-part series from responsive design to casual games to performance optimization)</li>
<li><a href="http://www.microsoftvirtualacademy.com/training-courses/the-modern-web-platform-jump-start?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">The Modern Web Platform JumpStart</a> (the fundamentals of HTML, CSS, and JS)</li>
</ul>
<p>And some free tools to get started: <a href="https://code.visualstudio.com/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Visual Studio Code</a> , <a href="http://azure.microsoft.com/en-us/pricing/free-trial/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Azure Trial</a> , and <a href="http://dev.modern.ie/?utm_source=SitePoint&amp;utm_medium=article34&amp;utm_campaign=SitePoint" target="_blank" rel="external">cross-browser testing tools</a> &#x2013; all available for Mac, Linux, or Windows. </p>
<p>This article is part of the web dev tech series from Microsoft. We&#x2019;re excited to share <a href="http://blogs.windows.com/msedgedev/2015/04/29/introducing-microsoft-edge-the-browser-built-for-windows-10/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">Microsoft Edge</a> and the new <a href="http://blogs.windows.com/msedgedev/2015/02/26/a-break-from-the-past-the-birth-of-microsofts-new-web-rendering-engine/?WT.mc_id=13410-DEV-sitepoint-article34" target="_blank" rel="external">EdgeHTML rendering engine</a> with you. Get free virtual machines or test remotely on your Mac, iOS, Android, or Windows device @ <a href="http://dev.modern.ie/?utm_source=SitePoint&amp;utm_medium=article34&amp;utm_campaign=SitePoint" target="_blank" rel="external">modern.IE</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>This article is part of a web dev series from Microsoft. Thank you for supporting the partners who make SitePoint possible.</p>
<p>When y]]>
    </summary>
    
      <category term="Grunt" scheme="http://taojinke.github.io/tags/Grunt/"/>
    
      <category term="Gulp" scheme="http://taojinke.github.io/tags/Gulp/"/>
    
      <category term="工作流" scheme="http://taojinke.github.io/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[A Gulp.js tutorial -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f2ef4e/"/>
    <id>http://taojinke.github.io/2015/07/03/2f2ef4e/</id>
    <published>2015-07-03T02:09:57.000Z</published>
    <updated>2015-07-03T14:09:57.244Z</updated>
    <content type="html"><![CDATA[<p>Gulp is a build tool that helps you automate your development workflow. In this article, we will dive deep into Gulp to show you how to use it effectively to create a simple workflow.</p>
<p>Let&#x2019;s get started.</p>
<h2 id="Installing_Gulp">Installing Gulp</h2><p>We&#x2019;ll start off the process by installing Gulp onto your computer. Gulp requires you to have Node.js and Node Package Manager (NPM) installed on your system, so if you haven&#x2019;t gotten them yet, just head over to <a href="https://nodejs.org" target="_blank" rel="external">Node.js&#x2019;s website</a> and download the installer. </p>
<p>Once you&#x2019;re done installing Node.js and NPM, you can install Gulp by typing the following command in the command line:</p>
<pre><code>$ sudo npm <span class="keyword">install</span> gulp -g
<span class="comment"># <span class="doctag"><span class="keyword">Note</span></span>: Only Mac users require the `sudo` keyword</span>
</code></pre><p>This command installs gulp globally and allows you to use the gulp command anywhere on your computer. </p>
<p>We&#x2019;re now done with installing Gulp and we can move on to create a new project that uses Gulp.</p>
<h2 id="Creating_a_Gulp_Project">Creating a Gulp Project</h2><p>Let&#x2019;s create a folder named project as we work through this article. Once you have created the folder, you&#x2019;ll want to run npm init in it. </p>
<pre><code>$ <span class="built_in">npm</span> init
</code></pre><p>This npm init command asks you a few questions and creates a package.json file to store information about dependencies that you&#x2019;ll use in this project. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2a39f.png" alt=""></p>
<p>The first dependency in our project is Gulp since we&#x2019;re using it as our build tool. You&#x2019;ll have to install gulp within the project folder by augmenting the install code slightly: </p>
<pre><code>$ npm install gulp --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>See that we have removed sudo from the command and replaced the -g flag with the —save-dev flag? </p>
<p>This —save-dev flag tells NPM to install gulp locally in (a dev term for within) the project, and save this dependency information in the package.json file. </p>
<p>Since we&#x2019;re installing a package locally, we don&#x2019;t have a need for administrator rights and hence the sudo was dropped. Removing this sudo is important and could potentially cause errors if you don&#x2019;t. </p>
<p>Now, if you take a look at your package.json file, you should see that Gulp has been added as a dev dependency. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2a39f.png" alt=""></p>
<p>You should also see a gulp folder within the new node_modules folder that was created when you ran the npm install gulp —save-dev command. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2a610.png" alt=""></p>
<p>Next, we&#x2019;ll have to create a gulpfile.js file to store all our Gulp configurations. </p>
<p>There&#x2019;s one more thing to do before we start configuring Gulp to create a workflow. We have to make sure we&#x2019;re clear on how the project is structured.</p>
<h2 id="Determining_Project_Structure">Determining Project Structure</h2><p>Let&#x2019;s start off with a generic structure for a webapp:</p>
<pre><code>project/
  <span class="string">|- app/</span>
      <span class="string">|- css/</span>
      <span class="string">|- fonts/</span>
      <span class="string">|- images/ </span>
      <span class="string">|- index.html</span>
      <span class="string">|- js/ </span>
      <span class="string">|- scss/</span>
  <span class="string">|- dist/</span>
  <span class="string">|- gulpfile.js</span>
  <span class="string">|- node_modules/</span>
  <span class="string">|- package.json</span>
</code></pre><p>In this structure, the app folder will store all our written code, and the dist folder will be used to store code that&#x2019;s production-ready. </p>
<p>Don&#x2019;t worry if your actual projects has a structure that&#x2019;s different from the current one we&#x2019;re using right now. Once you&#x2019;ve gotten the hang of Gulp, you&#x2019;ll see how to tweak the gulpfile to work with your structure easily. So let&#x2019;s work with this structure for now.</p>
<p>Once you&#x2019;ve created the project structure with the corresponding folders, we can proceed on to writing your first Gulp task.</p>
<h2 id="Writing_Your_First_Task">Writing Your First Task</h2><p>To configure Gulp, you&#x2019;ll first have to require gulp within your gulpfile.js : </p>
<pre><code><span class="comment">// Requiring Gulp</span>
<span class="keyword">var</span> gulp = <span class="built_in">require</span>(&amp;apos;gulp&amp;apos;); 
</code></pre><p>This require statement tells Node.js to look under the node_modules folder, find a package named gulp and pass it to the gulp variable. </p>
<p>Once we have this gulp variable, we can use it to write different Gulp tasks. Here&#x2019;s the basic syntax of a gulp task. </p>
<pre><code><span class="comment">// Basic Gulp task syntax</span>
gulp.task(&amp;apos;task-name&amp;apos;, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
  <span class="comment">// Stuff here</span>
})
</code></pre><p>Let&#x2019;s write a task named &#x2018;hello&#x2019; for a start, and let the task do a log that says &#x201C;Hello Zell!&#x201D;.</p>
<pre><code><span class="comment">// Basic Gulp task syntax</span>
gulp.task(&amp;apos;hello&amp;apos;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(&amp;apos;Hello Zell!&amp;apos;);
})
</code></pre><p>The task name is important since you&#x2019;ll be able to use the task anywhere else in the Gulpfile to run the task.</p>
<p>You can also use run a task with the command line by using gulp plus the name of the task. </p>
<pre><code><span class="variable">$ </span>gulp hello
</code></pre><p>You should see a log from the terminal saying &#x201C;Hello Zell!&#x201D; once you ran the code in the terminal.</p>
<p><img src="http://taojinke.github.io/img/20150703/2f2a610.png" alt=""></p>
<p>In reality, gulp tasks are slightly more complex that what we have written so far. You&#x2019;ll have to use two other gulp methods, gulp.src and gulp.dest . </p>
<h2 id="Creating_a_Real_Task">Creating a Real Task</h2><p>Here&#x2019;s what a real task may look like:</p>
<pre><code>gulp.task<span class="comment">(&amp;apos;task-name&amp;apos;, function ()</span> {
  gulp.src<span class="comment">(&amp;apos;src&amp;apos;)</span> <span class="comment">// Get source files with gulp.src</span>
    .pipe<span class="comment">(somePlugin()</span>) <span class="comment">// Sends it through a gulp plugin</span>
    .pipe<span class="comment">(gulp.dest(&amp;apos;dest&amp;apos;)</span>) <span class="comment">// Outputs the file in the destination folder</span>
})
</code></pre><p>Let&#x2019;s put this template to use with a real example where we compile Sass to CSS. I&#x2019;ll explain how to set up the task while we&#x2019;re at it.</p>
<p>First, we&#x2019;ll need to install a gulp plugin, gulp-sass , to compile Sass to CSS. We can install it with the npm install command with the —save-dev flag like what we did above. </p>
<pre><code>$ npm install gulp-sass --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>We will then need to require this plugin in the gulpfile.</p>
<pre><code><span class="keyword">var</span> gulp = <span class="built_in">require</span>(&amp;apos;gulp&amp;apos;);
<span class="comment">// Requires the gulp-sass plugin</span>
<span class="keyword">var</span> sass = <span class="built_in">require</span>(&amp;apos;gulp-sass&amp;apos;);
</code></pre><p>Now, create a styles.scss file within the app/scss folder and give it some styles to convert from Sass to CSS. </p>
<pre><code><span class="comment">// Scss</span>
<span class="class">.testing</span> {
  <span class="attribute">display</span>: flex;
  <span class="attribute">width</span>: <span class="function">percentage</span>(<span class="number">5</span>/<span class="number">7</span>); 
  <span class="comment">// Percentage is a Sass function that will be evaluated to CSS when compiled</span>
}
</code></pre><p>This styles.scss file will be converted into CSS by passing through the gulp-sass plugin we installed. After passing through the plugin, it&#x2019;ll be created as styles.css in the app/css folder. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2a881.png" alt=""></p>
<p>Here&#x2019;s how the task would look like:</p>
<pre><code>gulp.task<span class="comment">(&amp;apos;sass&amp;apos;, function()</span> {
  gulp.src<span class="comment">(&amp;apos;app/scss/styles.scss&amp;apos;)</span> <span class="comment">// Gets the styles.scss file</span>
    .pipe<span class="comment">(sass()</span>) <span class="comment">// Passes it through a gulp-sass task</span>
    .pipe<span class="comment">(gulp.dest(&amp;apos;app/css&amp;apos;)</span>) <span class="comment">// Outputs it in the css folder</span>
});
</code></pre><p>We can test this sass task by running it in the command line. </p>
<pre><code><span class="variable">$ </span>gulp sass
</code></pre><p>Now, if you take a look at the styles.css file in app/css , you&#x2019;ll see that the percentage() function has been evaluated into the following code: </p>
<pre><code><span class="class">.testing</span> <span class="rules">{
  <span class="rule"><span class="attribute">display</span>:<span class="value"> flex</span></span>;
  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">71.42857%</span></span></span>; }</span>
</code></pre><p>This means our styles.scss file has successfully been compiled into CSS. </p>
<h2 id="Adding_more_functionality_to_the_sass_task">Adding more functionality to the sass task</h2><p>Just compiling from Sass to CSS isn&#x2019;t good enough. Sometimes it makes more sense to add more plugins to make thing simpler for us. One of the best plugins that you&#x2019;ll ever use when converting from Sass to CSS is <a href="https://github.com/postcss/autoprefixer" target="_blank" rel="external">autoprefixer</a> ,which helps you write vendor prefixes according to <a href="http://www.caniuse.com" target="_blank" rel="external">caniuse</a> . </p>
<p>Let&#x2019;s try adding autoprefixer to our sass task. </p>
<p>To do so, we&#x2019;ll have to install the gulp plugin for autoprefixer.</p>
<pre><code>$ npm install gulp-autoprefixer --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>Then we&#x2019;ll have to require autoprefixer . </p>
<pre><code><span class="keyword">var</span> gulp = <span class="built_in">require</span>(&amp;apos;gulp&amp;apos;);
<span class="keyword">var</span> sass = <span class="built_in">require</span>(&amp;apos;gulp-sass&amp;apos;);
<span class="comment">// Requiring autoprefixer</span>
<span class="keyword">var</span> autoprefixer = <span class="built_in">require</span>(&amp;apos;gulp-autoprefixer&amp;apos;);
</code></pre><p>Autoprefixer is usually placed after Sass is compiled into CSS. In Gulp, we&#x2019;ll want to add another .pipe() so the resultant CSS gets passed through autoprefixer before it&#x2019;s created as styles.css in app/css . </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2a881.png" alt=""></p>
<p>The modified code is hence:</p>
<pre><code>gulp.task<span class="params">(&amp;apos;sass&amp;apos;, function<span class="params">()</span> {
  gulp.src<span class="params">(&amp;apos;app/scss/styles.scss&amp;apos;)</span> 
    .pipe<span class="params">(sass<span class="params">()</span>)</span> 
    .pipe<span class="params">(autoprefixer<span class="params">()</span>)</span> // Passes it through gulp-autoprefixer 
    .pipe<span class="params">(gulp.dest<span class="params">(&amp;apos;app/css&amp;apos;)</span>)</span>
})</span>
</code></pre><p>Now if you run gulp sass again, you&#x2019;ll notice that the output in the styles.css file has changed to include vendor prefixes for the display flex property: </p>
<pre><code><span class="class">.testing</span> <span class="rules">{
  <span class="rule"><span class="attribute">display</span>:<span class="value"> -webkit-box</span></span>;
  <span class="rule"><span class="attribute">display</span>:<span class="value"> -webkit-flex</span></span>;
  <span class="rule"><span class="attribute">display</span>:<span class="value"> -ms-flexbox</span></span>;
  <span class="rule"><span class="attribute">display</span>:<span class="value"> flex</span></span>;
  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">71.42857%</span></span></span>; }</span>
</code></pre><p>Another task that&#x2019;ll help you out during development is to add sourcemaps.</p>
<p>A sourcemap is a string of information that tells the browser where different sections of the code is stored. With a CSS sourcemap, you can easily locate the original source code of specific lines of CSS just by checking out the inspector.</p>
<p><img src="http://taojinke.github.io/img/20150703/2f2aaf2.png" alt=""></p>
<p>To add sourcemaps to the sass task, we&#x2019;ll have to install the gulp-sourcemaps plugin. </p>
<pre><code>$ npm install gulp-sourcemaps --<span class="built_in">save</span>-<span class="built_in">dev</span>


<span class="comment">// Requiring Sourcemaps</span>
<span class="built_in">var</span> sourcemaps = require(&amp;apos;gulp-sourcemaps&amp;apos;);
</code></pre><p>The process to adding sourcemaps to our sass task is slightly different from adding autoprefixer. We&#x2019;ll have to add two pipes instead of one. </p>
<p>First, we&#x2019;ll need to initialize the sourcemap plugin right after getting source files from gulp.</p>
<p>Then, we&#x2019;ll have to let the files pass through gulp-sass and gulp-autoprefixer before writing the sourcemaps at the end of the css file. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2aaf2.png" alt=""></p>
<pre><code>gulp.task<span class="params">(&amp;apos;sass&amp;apos;, function<span class="params">()</span> {
  gulp.src<span class="params">(&amp;apos;app/scss/styles.scss&amp;apos;)</span> // Gets the styles.scss file
    .pipe<span class="params">(sourcemaps.init<span class="params">()</span>)</span> // Initialize sourcemap plugin
    .pipe<span class="params">(sass<span class="params">()</span>)</span>
    .pipe<span class="params">(autoprefixer<span class="params">()</span>)</span> 
    .pipe<span class="params">(sourcemaps.write<span class="params">()</span>)</span> // Writing sourcemaps 
    .pipe<span class="params">(gulp.dest<span class="params">(&amp;apos;app/css&amp;apos;)</span>)</span>
})</span>
</code></pre><p>Now if you run gulp sass on the terminal, you should be able to see that Gulp has written a sourcemap at the end of your CSS file. </p>
<pre><code><span class="class">.testing</span> <span class="rules">{
  <span class="rule"><span class="attribute">display</span>:<span class="value"> -webkit-box</span></span>;
  <span class="rule"><span class="attribute">display</span>:<span class="value"> -webkit-flex</span></span>;
  <span class="rule"><span class="attribute">display</span>:<span class="value"> -ms-flexbox</span></span>;
  <span class="rule"><span class="attribute">display</span>:<span class="value"> flex</span></span>;
  <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">71.42857%</span></span></span>; }</span>

<span class="comment">/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0eWxlcy5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UscUJBQWM7RUFBZCxzQkFBYztFQUFkLHFCQUFjO0VBQWQsY0FBYztFQUNkLGlCQUFpQixFQUZUIiwiZmlsZSI6InN0eWxlcy5jc3MiLCJzb3VyY2VzQ29udGVudCI6WyIudGVzdGluZyB7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIHdpZHRoOiBwZXJjZW50YWdlKDUvNyk7XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9 */</span>
</code></pre><h2 id="Automatically_update_the_CSS_file_when_you_save">Automatically update the CSS file when you save</h2><p>Now it&#x2019;s quite some work to run the gulp sass task whenever we want to compile Sass to CSS. Wouldn&#x2019;t it be awesome if Gulp would run it automatically? </p>
<p>Gulp can do that! You&#x2019;ll just have to let Gulp check whether the styles.scss file was changed when you save it. This checking process is called watching in programming terms. </p>
<p>Gulp does this watching by providing us with a watch method that allows you to run any task whenever a file is changed. </p>
<pre><code>// Gulp watch <span class="keyword">syntax</span>
gulp.watch(&amp;apos;<span class="keyword">files</span>-<span class="keyword">to</span>-watch&amp;apos;, [&amp;apos;tasks&amp;apos;, &amp;apos;<span class="keyword">to</span>&amp;apos;, &amp;apos;run&amp;apos;]); 
</code></pre><p>Instead of just watching the Sass files alone, you&#x2019;ll often want to watch many types of files and run different tasks during a development process. In order to achieve that, we can create a watch gulp task that watches different files. </p>
<pre><code>gulp.task(&amp;apos;watch&amp;apos;, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  gulp.watch(&amp;apos;app/scss/styles.scss&amp;apos;, [&amp;apos;sass&amp;apos;]);
  <span class="comment">// ... Other watchers</span>
});
</code></pre><p>Now if you run the watch command you&#x2019;ll see that gulp immediately starts watching your files for changes.</p>
<p><img src="http://taojinke.github.io/img/20150703/2f2ad63.png" alt=""></p>
<p>And if you change a line in styles.scss , Gulp will automatically run the sass task. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2ad63.gif" alt=""></p>
<p>There&#x2019;s only one thing that&#x2019;s lacking here. Gulp didn&#x2019;t run the sass task first before running watch , which means the CSS might not be the most updated one. Hence, we&#x2019;ll want to make sure the watch task runs after the sass task. </p>
<p>We can do so by adding a second parameter to the watch task. This second parameter is an array of tasks that must be completed before Gulp runs watch . </p>
<pre><code>gulp.task(&amp;apos;watch&amp;apos;, [&amp;apos;sass&amp;apos;], <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  gulp.watch(&amp;apos;app/scss/styles.scss&amp;apos;, [&amp;apos;sass&amp;apos;]);
  <span class="comment">// ... Other watchers</span>
}); 
</code></pre><p>Now if you run the watch task, you&#x2019;ll see that Gulp tells the command line to first run the sass task, followed by the watch task. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2ad63.png" alt=""></p>
<p>Since we&#x2019;re already watching and recompiling Sass files when it&#x2019;s changed, why not bring it further and reload the browser each time the file is saved?</p>
<h2 id="Automatically_Refreshing_the_Browser_when_you_save">Automatically Refreshing the Browser when you save</h2><p>Having the browser automatically refreshing when you save a file is a task that saves you lots of time and hand-ache.</p>
<p>The best project for refreshing the browser right now is <a href="http://www.browsersync.io" target="_blank" rel="external">Browser Sync</a> , and we can use with Gulp easily. </p>
<p>First, we&#x2019;ll have to install Browser Sync.</p>
<pre><code>$ npm install browser-sync --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>You&#x2019;ll notice that there&#x2019;s no more gulp- prefix when installing Browser Sync. This is because Browser Sync can be made to work with Gulp right out of the box; you don&#x2019;t need a Gulp plugin. </p>
<p>We&#x2019;ll have to require Browser Sync, as usual. </p>
<pre><code><span class="label">var</span> <span class="keyword">browserSync </span>= <span class="preprocessor">require</span>(&amp;apos<span class="comment">;browser-sync&amp;apos;);</span>
</code></pre><p>Browser Sync spins up a local server to load static HTML files. We&#x2019;ll have to provide it with some initial configurations so it knows where to find our index.html file. </p>
<p>Let&#x2019;s make a browserSync task for spinning up this server. </p>
<pre><code><span class="comment">// Start browserSync server</span>
gulp.task(&amp;apos;browserSync&amp;apos;, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  browserSync({
    server: {
      baseDir: &amp;apos;app&amp;apos;
    }
  })
})
</code></pre><p>Next, we&#x2019;ll need to change the sass task slightly to allow Browser Sync to inject new CSS into the HTML. To do so, we&#x2019;ll hav eto add a return before gulp.src and we&#x2019;ll have to .pipe() a Browser Sync reload method. </p>
<pre><code>gulp.task<span class="params">(&amp;apos;sass&amp;apos;, function<span class="params">()</span> {
  return gulp.src<span class="params">(&amp;apos;app/scss/styles.scss&amp;apos;)</span> // added return 
    .pipe<span class="params">(sourcemaps.init<span class="params">()</span>)</span>
    .pipe<span class="params">(sass<span class="params">()</span>)</span>
    .pipe<span class="params">(autoprefixer<span class="params">()</span>)</span>
    .pipe<span class="params">(sourcemaps.write<span class="params">()</span>)</span>
    .pipe<span class="params">(gulp.dest<span class="params">(&amp;apos;app/css&amp;apos;)</span>)</span>
    // Reloading the stream
    .pipe<span class="params">(browserSync.reload<span class="params">({
      stream: <span class="literal">true</span>
    })</span>)</span>;
})</span>;
</code></pre><p>We&#x2019;ll also have to make sure the browserSync task runs before the watch task. </p>
<pre><code>gulp.task(&amp;apos;watch&amp;apos;, [&amp;apos;browserSync&amp;apos;, &amp;apos;sass&amp;apos;], <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  gulp.watch(&amp;apos;app/scss/styles.scss&amp;apos;, [&amp;apos;sass&amp;apos;]);
});
</code></pre><p>If you run gulp watch in the terminal now, you&#x2019;ll see that browserSync and sass runs concurrently, followed by watch . In addition, a browser pops up to show you the current index.html file. </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2afd4.png" alt=""></p>
<p>So if you change the styles.scss file and save&#x2026; </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2afd4.gif" alt=""></p>
<p>Viola! </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2b245.gif" alt=""></p>
<p>Since we&#x2019;re already watching for changes and refreshing the browser when we save styles.scss , why not do it for index.html as well? </p>
<pre><code><span class="component">gulp.task(&amp;apos;watch&amp;apos;, [&amp;apos;sass&amp;apos;], function() {
  gulp<span class="string">.watch(&amp;apos</span>;app/scss/styles<span class="string">.scss&amp;apos</span>;, [&amp;apos;sass&amp;apos;]);
  gulp<span class="string">.watch(&amp;apos</span>;app/index<span class="string">.html&amp;apos</span>;, [browserSync<span class="string">.reload])</span>;
}</span>); 
</code></pre><p>Now that&#x2019;s an example of a decent workflow that converts Sass to CSS. Of course, there&#x2019;s a lot of improvements you can make to it. For instance, you can configure options for each of the plugins used, and you can also watch more files with some node globbing knowledge.</p>
<p>We&#x2019;ll cover those in the next article </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2b4b6.gif" alt=""></p>
<p>Now let&#x2019;s do a quick summary.</p>
<h2 id="Wrapping_Up">Wrapping Up</h2><p>So in this article we learned how to install Gulp and we learn to set up a basic task with Gulp.</p>
<p>Then we went ahead and setup a real task by adding different gulp plugins to the mix.</p>
<p>Eventually, we made it much better by watching the files for change and refreshing the browser whenever possible.</p>
<p>There&#x2019;s still a whole lot more to configuring Gulp, but we&#x2019;ll pause here for now. Let&#x2019;s continue in the next article.</p>
<p>What is one thing you&#x2019;ve learned about Gulp in this tutorial? Let me know in the comments below!</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Gulp is a build tool that helps you automate your development workflow. In this article, we will dive deep into Gulp to show you how to u]]>
    </summary>
    
      <category term="Gulp" scheme="http://taojinke.github.io/tags/Gulp/"/>
    
      <category term="Sass" scheme="http://taojinke.github.io/tags/Sass/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[The long road to Async/Await in JavaScript -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f40811/"/>
    <id>http://taojinke.github.io/2015/07/03/2f40811/</id>
    <published>2015-07-03T02:09:57.000Z</published>
    <updated>2015-07-03T14:09:57.436Z</updated>
    <content type="html"><![CDATA[<p> This is a comparison of different methods for performing asynchronous control flow in JavaScript, specifically <strong>Callbacks</strong> , <strong>Promises</strong> , <strong>Generators</strong> / <strong>Yields</strong> (ES6), and <strong>Async</strong> / <strong>Await</strong> (ES7).&#xA0;To follow along be sure you understand how the <a href="https://thomashunter.name/blog/the-javascript-event-loop-presentation/" target="_blank" rel="external">JavaScript Event Loop</a> works and what it means&#xA0;when code is executed synchronously in the current stack, or shoved into the queue to be executed asynchronously in the future. </p>
<p>In the following contrived examples, publishLevel() is our main application code (perhaps something we&#x2019;d see in a <strong>Controller</strong> ), whereas&#xA0; getUser() , canCreate() , and saveLevel() are functions&#xA0;nested deeper in our application (perhaps in our <strong>Model</strong> s). </p>
<p>Compatibility:&#xA0;Keep in mind that anything marked as <strong>ES6</strong> will require Node.js &gt;= 0.12 with the —harmony flag enabled, or any version of io.js &gt;= 1.0. <a href="https://kangax.github.io/compat-table/es6/" target="_blank" rel="external">Browser support for ES6</a> is anything but spectacular and you&#x2019;ll likely need&#xA0;to transpile. Anything marked as <strong>ES7</strong> will definitely require a transpile for either Browser or Node.js. </p>
<h2 id="Stage_0:_Synchronous&#xA0;Code">Stage 0: Synchronous&#xA0;Code</h2><p>This of course is not Asynchronous code&#xA0;but&#xA0;it does show us&#xA0;eloquent syntax. If you&#x2019;re used to writing applications in, say, PHP, all of your code looks like this. This is the cleanest&#xA0;way one can write code and have it execute sequentially.</p>
<p>In the publishLevel() function we execute a function, get the result, pass it to the next function, run a branch, all in the current stack, all using minimal syntax.</p>
<pre><code><span class="keyword">var</span> level_result = publishLevel(<span class="number">12</span>, {data: <span class="literal">true</span>});
<span class="built_in">console</span>.log(level_result);

<span class="function"><span class="keyword">function</span> <span class="title">publishLevel</span>(<span class="params">user_id, level_data</span>) </span>{
  <span class="keyword">var</span> user = getUser(user_id);
  <span class="keyword">var</span> can_create = canCreate(user);

  <span class="keyword">if</span> (!can_create) {
    <span class="keyword">return</span> <span class="literal">null</span>;
  }

  <span class="keyword">var</span> level = saveLevel(user, level_data);

  <span class="keyword">return</span> level;
}

<span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">user_id</span>) </span>{
  <span class="keyword">return</span> {
    id: user_id,
    nickname: &amp;apos;tlhunter&amp;apos;
  };
}

<span class="function"><span class="keyword">function</span> <span class="title">canCreate</span>(<span class="params">user</span>) </span>{
  <span class="keyword">return</span> user.id === <span class="number">12</span>;
}

<span class="function"><span class="keyword">function</span> <span class="title">saveLevel</span>(<span class="params">user, data</span>) </span>{
  <span class="keyword">return</span> {
    id: <span class="number">100</span>,
    owner: user.nickname,
    data: data
  };
}
</code></pre><h2 id="Stage_1:_Callbacks">Stage 1: Callbacks</h2><p>This is the defacto approach&#xA0;used in&#xA0;Node.js applications where sequential&#xA0;asynchronous operations need to happen. As more function calls need to happen your code starts to nest even deeper. This phenomenon is affectionately known as callback hell.</p>
<p>What happens if you want to add another operation in the middle? You&#x2019;ve got to re-nest all subsequent tasks within the new operation. Over time&#xA0;your code begins&#xA0;to flare outward, and those git-blame&#x2019;s start to lie.</p>
<pre><code>publishLevel(<span class="number">12</span>, {data: <span class="literal">true</span>}, <span class="function"><span class="keyword">function</span>(<span class="params">level_result</span>) </span>{
  <span class="built_in">console</span>.log(level_result);
});

<span class="function"><span class="keyword">function</span> <span class="title">publishLevel</span>(<span class="params">user_id, level_data, cb</span>) </span>{
  getUser(user_id, <span class="function"><span class="keyword">function</span>(<span class="params">user</span>) </span>{
    canCreate(user, <span class="function"><span class="keyword">function</span>(<span class="params">can_create</span>) </span>{
      <span class="keyword">if</span> (!can_create) {
        <span class="keyword">return</span> cb(<span class="literal">null</span>);
      }
      saveLevel(user, level_data, <span class="function"><span class="keyword">function</span>(<span class="params">level</span>) </span>{
        cb(level);
      });
    });
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">user_id, cb</span>) </span>{
  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    cb({
      id: user_id,
      nickname: &amp;apos;tlhunter&amp;apos;
    });
  }, <span class="number">100</span>);
}

<span class="function"><span class="keyword">function</span> <span class="title">canCreate</span>(<span class="params">user, cb</span>) </span>{
  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    cb(user.id === <span class="number">12</span>);
  }, <span class="number">100</span>);
}

<span class="function"><span class="keyword">function</span> <span class="title">saveLevel</span>(<span class="params">user, data, cb</span>) </span>{
  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    cb({
      id: <span class="number">100</span>,
      owner: user.nickname,
      data: data
    });
  }, <span class="number">100</span>);
}
</code></pre><h2 id="Stage_2:_Promises_(ES6&#xA0;or&#xA0;ES5_+_Polyfill)">Stage 2: Promises (ES6&#xA0;or&#xA0;ES5 + Polyfill)</h2><p>This is the approach used by a large codebase I&#x2019;ve been working with lately. While we don&#x2019;t get Promises until ES6, ES5 can use them thanks to polyfills such as <a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="external">Bluebird</a> . </p>
<p>The benefit of using Promises is&#xA0;we don&#x2019;t need to continually nest functions, and adding new work in the middle is as simple as adding a few extra lines.</p>
<p>In my opinion the syntax is a bit ugly. Chaining .then() calls from previous executions and calling&#xA0;the next bit of asynchronous work within the same function just doesn&#x2019;t feel right.</p>
<pre><code>publishLevel(<span class="number">12</span>, {data: <span class="literal">true</span>}).then(<span class="function"><span class="keyword">function</span>(<span class="params">level_result</span>) </span>{
  <span class="built_in">console</span>.log(level_result);
});

<span class="function"><span class="keyword">function</span> <span class="title">publishLevel</span>(<span class="params">user_id, level_data, cb</span>) </span>{
  <span class="keyword">var</span> user = <span class="literal">null</span>;
  <span class="keyword">return</span> getUser(user_id).then(<span class="function"><span class="keyword">function</span>(<span class="params">_user</span>) </span>{
    user = _user;
    <span class="keyword">return</span> canCreate(_user);
  }).then(<span class="function"><span class="keyword">function</span>(<span class="params">can_create</span>) </span>{
    <span class="keyword">if</span> (!can_create) {
      <span class="keyword">return</span> <span class="literal">null</span>;
    }

    <span class="keyword">return</span> saveLevel(user, level_data);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">user_id</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: user_id,
        nickname: &amp;apos;tlhunter&amp;apos;
      });
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">canCreate</span>(<span class="params">user</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve(user.id === <span class="number">12</span>);
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">saveLevel</span>(<span class="params">user, data</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: <span class="number">100</span>,
        owner: user.nickname,
        data: data
      });
    }, <span class="number">100</span>);
  });
}
</code></pre><p>Promises everywhere is certainly more fun than Promises somewhere. If you&#x2019;re planning on heavily using Promises with Node.js, check out <a href="https://github.com/normalize/mz" target="_blank" rel="external">mz,</a> which will Promisify the Node.js API. </p>
<h2 id="Stage_3:_Generators/Yields_(ES6)">Stage 3: Generators/Yields (ES6)</h2><p>ES6 gives us <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators" target="_blank" rel="external">Generator</a> functions which we can <strong>yield</strong> . When a function yields it is temporarily paused while the caller gets to do something with the yielded value. These were designed with&#xA0;doing iteration-based tasks in mind, yielding simple values, but here we&#x2019;re going to yield Promises! </p>
<p>This is the first time&#xA0;we see code able to get executed in a different stack&#xA0;yet exist within the same function scope. Of course this new paradigm requires a new syntax. Generator functions have a <strong>*</strong> in their declaration, and we make use of the&#xA0;new&#xA0; <strong>yield</strong> keyword. </p>
<p>These <em>can</em> be used for doing control flow, but it&#x2019;s really intended for iteration work, as you&#x2019;ll see in this next example where I run a whole bunch of ugly code to manually keep the generator alive: </p>
<pre><code><span class="keyword">var</span> generator = publishLevel(<span class="number">12</span>, {data: <span class="literal">true</span>});

generator.next().value.then(<span class="function"><span class="keyword">function</span>(<span class="params">user</span>) </span>{
   <span class="keyword">return</span> generator.next(user).value.then(<span class="function"><span class="keyword">function</span>(<span class="params">can_create</span>) </span>{
     <span class="keyword">return</span> generator.next(can_create).value.then(<span class="function"><span class="keyword">function</span>(<span class="params">level_result</span>) </span>{
       <span class="built_in">console</span>.log(level_result);
     });
   });
 });

<span class="function"><span class="keyword">function</span> * <span class="title">publishLevel</span>(<span class="params">user_id, level_data</span>) </span>{
  <span class="keyword">var</span> user = <span class="keyword">yield</span> getUser(user_id);
  <span class="keyword">var</span> can_create = <span class="keyword">yield</span> canCreate(user);

  <span class="keyword">if</span> (!can_create) {
    <span class="keyword">return</span> <span class="literal">null</span>;
  }

  <span class="keyword">var</span> level = <span class="keyword">yield</span> saveLevel(user, level_data);

  <span class="keyword">return</span> level;
}

<span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">user_id</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: user_id,
        nickname: &amp;apos;tlhunter&amp;apos;
      });
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">canCreate</span>(<span class="params">user</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve(user.id === <span class="number">12</span>);
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">saveLevel</span>(<span class="params">user, data</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: <span class="number">100</span>,
        owner: user.nickname,
        data: data
      });
    }, <span class="number">100</span>);
  });
}
</code></pre><p>Notice this intimate knowledge we need to know about the function we&#x2019;re calling! We take the result, pass it into another generator.next() call as an argument (this becomes the result of the yielded assignment). </p>
<p>Objects returned by generators have a .next() method, with a .done and .value attribute. If done is true, then the generators work is finished&#xA0;(the final return), however if done is false then there&#x2019;s more work to happen&#xA0;(the preceding yield&#x2019;s).&#xA0;The calling function is given the intermediate yield values, and has to know to continue the execution of the generator. While this is great for doing iteration work, it&#x2019;s tedious&#xA0;from the perspective of doing asynchronous control flow. </p>
<h2 id="Stage_4:_Async/Await_(ES7)">Stage 4: Async/Await (ES7)</h2><p>Async / Await is amazing, the mecca of working with asynchronous code in JavaScript. Personally I think it&#x2019;s a shame we got Generators in ES6 instead of this. The solution is so eloquent that it will forever change the way we write JavaScript.</p>
<p>Internally it works with Promises. When the promise returned by an await&#xA0;resolves the code in the function will continue executing, and the resolved value will be provided.</p>
<pre><code>publishLevel(<span class="number">12</span>, {data: <span class="literal">true</span>}).then(<span class="function"><span class="keyword">function</span>(<span class="params">level_data</span>) </span>{
  <span class="built_in">console</span>.log(level_data);
});

<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">publishLevel</span>(<span class="params">user_id, level_data</span>) </span>{
  <span class="keyword">var</span> user = <span class="keyword">await</span> getUser(user_id);
  <span class="keyword">var</span> can_create = <span class="keyword">await</span> canCreate(user);

  <span class="keyword">if</span> (!can_create) {
    <span class="keyword">return</span> <span class="literal">null</span>;
  }

  <span class="keyword">var</span> level = <span class="keyword">await</span> saveLevel(user, level_data);

  <span class="keyword">return</span> level;
}

<span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">user_id</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: user_id,
        nickname: &amp;apos;tlhunter&amp;apos;
      });
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">canCreate</span>(<span class="params">user</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve(user.id === <span class="number">12</span>);
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">saveLevel</span>(<span class="params">user, data</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: <span class="number">100</span>,
        owner: user.nickname,
        data: data
      });
    }, <span class="number">100</span>);
  });
}
</code></pre><p>You can transpile this down to ES5 today using Babel:</p>
<pre><code>$ npm install babel-<span class="keyword">runtime</span>
$ babel --stage=<span class="number">1</span> --optional <span class="keyword">runtime</span> <span class="built_in">input</span>.es7.js &amp;gt; output.es5.js
</code></pre><p>What does this code look like after transpilation?</p>
<pre><code>&amp;apos;use strict&amp;apos;;

<span class="keyword">var</span> _regeneratorRuntime = <span class="built_in">require</span>(&amp;apos;babel-runtime/regenerator&amp;apos;)[&amp;apos;<span class="keyword">default</span>&amp;apos;];

<span class="keyword">var</span> _Promise = <span class="built_in">require</span>(&amp;apos;babel-runtime/core-js/promise&amp;apos;)[&amp;apos;<span class="keyword">default</span>&amp;apos;];

publishLevel(<span class="number">12</span>, { data: <span class="literal">true</span> }).then(<span class="function"><span class="keyword">function</span> (<span class="params">level_data</span>) </span>{
  <span class="built_in">console</span>.log(level_data);
});

<span class="function"><span class="keyword">function</span> <span class="title">publishLevel</span>(<span class="params">user_id, level_data</span>) </span>{
  <span class="keyword">var</span> user, can_create, level;
  <span class="keyword">return</span> _regeneratorRuntime.async(<span class="function"><span class="keyword">function</span> <span class="title">publishLevel$</span>(<span class="params">context$1$0</span>) </span>{
    <span class="keyword">while</span> (<span class="number">1</span>) <span class="keyword">switch</span> (context$<span class="number">1</span>$<span class="number">0.</span>prev = context$<span class="number">1</span>$<span class="number">0.</span>next) {
      <span class="keyword">case</span> <span class="number">0</span>:
        context$<span class="number">1</span>$<span class="number">0.</span>next = <span class="number">2</span>;
        <span class="keyword">return</span> _regeneratorRuntime.awrap(getUser(user_id));

      <span class="keyword">case</span> <span class="number">2</span>:
        user = context$<span class="number">1</span>$<span class="number">0.</span>sent;
        context$<span class="number">1</span>$<span class="number">0.</span>next = <span class="number">5</span>;
        <span class="keyword">return</span> _regeneratorRuntime.awrap(canCreate(user));

      <span class="keyword">case</span> <span class="number">5</span>:
        can_create = context$<span class="number">1</span>$<span class="number">0.</span>sent;

        <span class="keyword">if</span> (can_create) {
          context$<span class="number">1</span>$<span class="number">0.</span>next = <span class="number">8</span>;
          <span class="keyword">break</span>;
        }

        <span class="keyword">return</span> context$<span class="number">1</span>$<span class="number">0.</span>abrupt(&amp;apos;<span class="keyword">return</span>&amp;apos;, <span class="literal">null</span>);

      <span class="keyword">case</span> <span class="number">8</span>:
        context$<span class="number">1</span>$<span class="number">0.</span>next = <span class="number">10</span>;
        <span class="keyword">return</span> _regeneratorRuntime.awrap(saveLevel(user, level_data));

      <span class="keyword">case</span> <span class="number">10</span>:
        level = context$<span class="number">1</span>$<span class="number">0.</span>sent;
        <span class="keyword">return</span> context$<span class="number">1</span>$<span class="number">0.</span>abrupt(&amp;apos;<span class="keyword">return</span>&amp;apos;, level);

      <span class="keyword">case</span> <span class="number">12</span>:
      <span class="keyword">case</span> &amp;apos;end&amp;apos;:
        <span class="keyword">return</span> context$<span class="number">1</span>$<span class="number">0.</span>stop();
    }
  }, <span class="literal">null</span>, <span class="keyword">this</span>);
}

<span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">user_id</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> _Promise(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
      resolve({
        id: user_id,
        nickname: &amp;apos;tlhunter&amp;apos;
      });
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">canCreate</span>(<span class="params">user</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> _Promise(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
      resolve(user.id === <span class="number">12</span>);
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">saveLevel</span>(<span class="params">user, data</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> _Promise(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
      resolve({
        id: <span class="number">100</span>,
        owner: user.nickname,
        data: data
      });
    }, <span class="number">100</span>);
  });
}
</code></pre><p>I&#x2019;m not sure how performant this code is. Certainly once JavaScript engines natively support Async / Await&#xA0;it&#x2019;ll be fast, but the output from Babel I&#x2019;m not too sure.</p>
<h2 id="Stage_3-5:_Generators/Yields&#xA0;+_co_(ES6)">Stage 3.5: Generators/Yields&#xA0;+ co (ES6)</h2><p>I put this one out of order so you&#x2019;d first see how awesome Async / Await is, and what the <a href="https://github.com/tj/co" target="_blank" rel="external">co</a> module&#xA0;attempts to emulate. </p>
<p>Async / Await is great&#xA0;but we can&#x2019;t use it today without complex&#xA0;transpilations! Generators are neat, but they require manual executions of .next() ! Luckily there&#x2019;s a sweet library called <strong>co</strong> which can sort of provide us the best of both worlds (transpile-free if you&#x2019;re running modern Node). It&#x2019;ll run .next() for us, and if we return Promises, when they resolve the generator will continue. Finally once the final return is called, that value is the final resolved value of the co-wrapped generator. </p>
<pre><code><span class="keyword">var</span> co = <span class="built_in">require</span>(&amp;apos;co&amp;apos;);

publishLevel(<span class="number">12</span>, {data: <span class="literal">true</span>}).then(<span class="function"><span class="keyword">function</span>(<span class="params">level_data</span>) </span>{
  <span class="built_in">console</span>.log(level_data);
});

<span class="function"><span class="keyword">function</span> <span class="title">publishLevel</span>(<span class="params">user_id, level_data</span>) </span>{
  <span class="keyword">return</span> co(<span class="function"><span class="keyword">function</span> * <span class="title">publishLevel</span>(<span class="params"></span>) </span>{
    <span class="keyword">var</span> user = <span class="keyword">yield</span> getUser(user_id);
    <span class="keyword">var</span> can_create = <span class="keyword">yield</span> canCreate(user);

    <span class="keyword">if</span> (!can_create) {
      <span class="keyword">return</span> <span class="literal">null</span>;
    }

    <span class="keyword">var</span> level = <span class="keyword">yield</span> saveLevel(user, level_data);

    <span class="keyword">return</span> level;
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params">user_id</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: user_id,
        nickname: &amp;apos;tlhunter&amp;apos;
      });
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">canCreate</span>(<span class="params">user</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve(user.id === <span class="number">12</span>);
    }, <span class="number">100</span>);
  });
}

<span class="function"><span class="keyword">function</span> <span class="title">saveLevel</span>(<span class="params">user, data</span>) </span>{
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>{
    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      resolve({
        id: <span class="number">100</span>,
        owner: user.nickname,
        data: data
      });
    }, <span class="number">100</span>);
  });
}
</code></pre><p>The solution isn&#x2019;t as eloquent as the Async/Await version. We need an additional function level and a library. But overall it&#x2019;s a nice alternative to nested callbacks or verbose Promises.</p>
<h2 id="tl;dr">tl;dr</h2><ul>
<li><strong>Stage 1: Callbacks</strong> shows us how nested callbacks give us control over Asynchronous code <ul>
<li>Pro&#x2019;s: ES5, Simple to understand, Node.js API works this way</li>
<li>Con&#x2019;s: Messy refactors, code nesting levels jump around</li>
</ul>
</li>
<li><strong>Stage 2: Promises</strong> gives us the power of callbacks but keeps code from getting out of hand <ul>
<li>Pro&#x2019;s: ES5&#xA0;with polyfill, nesting is under control</li>
<li>Con&#x2019;s: Verbose syntax</li>
</ul>
</li>
<li><strong>Stage 3: Generators/Yields</strong> describes generators and how they can get a bit messy <ul>
<li>Pro&#x2019;s:&#xA0;Works great with iterators, parts of functions can be executed in future</li>
<li>Con&#x2019;s: ES6 or transpile, painful to manually manage execution</li>
</ul>
</li>
<li><strong>Stage 3.5: Generators/Yields + co</strong> is a great solution you can use today <ul>
<li>Pro&#x2019;s: The advantage of using Generators without manually managing yields</li>
<li>Con&#x2019;s: ES6 or transpile</li>
</ul>
</li>
<li><strong>Stage 4: Async/Await</strong> is an amazing solution you can use tomorrow <ul>
<li>Pro&#x2019;s: Eloquent syntax</li>
<li>Con&#x2019;s: ES7 currently requires transpile regardless of environment</li>
</ul>
</li>
</ul>
<p>Pick your poison!</p>
]]></content>
    <summary type="html">
    <![CDATA[<p> This is a comparison of different methods for performing asynchronous control flow in JavaScript, specifically <strong>Callbacks</strong]]>
    </summary>
    
      <category term="ECMAScript" scheme="http://taojinke.github.io/tags/ECMAScript/"/>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[This Week's Node.js News - Issue 93 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2ecf21a/"/>
    <id>http://taojinke.github.io/2015/07/03/2ecf21a/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.493Z</updated>
    <content type="html"><![CDATA[<p>Asif Ahmed</p>
<p><a href="https://scotch.io/tutorials/building-a-real-time-markdown-viewer?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Let&apos;s Build a Real-Time Markdown Editor with Node.js</a></p>
<p>A walkthrough of building a live, multi-user Markdown editor using Express and ShareJS, an operational transform library. </p>
<p>Vincit Oy</p>
<p><a href="http://www.vincit.fi/blog/introducing-moron-js-a-new-orm-for-node-js/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Introducing Moron.js: A New SQL-Friendly ORM</a></p>
<p>An ORM that takes the approach that SQL is good and makes it easy to use the full power of SQL in all situations. This is a thorough introduction. </p>
<p>github</p>
<p><a href="https://github.com/npm/npm/releases/tag/v3.0.0?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">npm 3.0 (Beta) Released</a></p>
<p>A new multi-stage installer, a change in how dependencies will be nested, and numerous bug fixes and breaking changes. </p>
<p>Frontend Masters &#xA0;&#xA0; Sponsored</p>
<p><a href="https://frontendmasters.com/workshops/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">A Week of Full Stack JavaScript Workshops</a></p>
<p>Build full stack apps in JS with Scott Moss:</p>
<ul>
<li><p><a href="https://frontendmasters.com/workshops/angular-components-es6/" target="_blank" rel="external">2-Days on Angular, Components and ES6</a></p>
</li>
<li><p><a href="https://frontendmasters.com/workshops/api-design-nodejs/" target="_blank" rel="external">3-Days on API Design in Node.js</a></p>
</li>
</ul>
<p><em>Join us (all or part) of the week July 20-25th.</em></p>
<p>Andrew Stewart</p>
<p><a href="http://cylonjs.com/blog/2015/07/01/cylon-1.1.0-big-cleanup/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Cylon.js 1.1.0 Released</a></p>
<p>Cylon.js is a JavaScript robotics framework. It&#x2019;s been refactored and now also has improved support for the Parrot Bebop drone and numerous Nest products. </p>
<p>Nicolas Froidure</p>
<p><a href="http://insertafter.com/en/blog/native-node-module.html?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Create Native NodeJS Modules and Fallback to Emscripten if Necessary</a></p>
<p>An interesting idea. Create modules that rely on natively compiled libraries first, but on unsupported platforms, fall back to a JavaScript version compiled with Emscripten. </p>
<p>Vishal Kumar</p>
<p><a href="http://blog.codeship.com/running-mean-web-application-docker-containers-aws/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Running A MEAN App in Docker Containers on AWS</a></p>
<p>A step by step tutorial on setting up a Node and Express-based app on an Amazon EC2 server using Docker. </p>
<p>Jobs</p>
<ul>
<li><a href="https://datahero.com/jobs/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Fullstack Engineer At DataHero (San Francisco, CA)</a><br>Join a startup that is at the center of cloud computing, data visualization, and machine learning! Recently raised series A funding, the winner of 2014 Strata Startup is looking for awesome engineers help us build our intelligent data visualization platform. &#xA0; DataHero</li>
<li><a href="https://moviepilot.workable.com/jobs/42655?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Senior Frontend Developer at MoviePilot.com</a><br>Hi, we are moviepilot.com, the world&#x2019;s largest community for fans to talk about pop culture. We are looking for a nice person who happens to be a Frontend Dev and enjoys building things using tools like React &amp; Node. &#xA0; moviepilot . com</li>
<li><a href="http://www.toptal.com/developers?utm_source=node_weekly&amp;utm_medium=cpm-newsletter&amp;utm_campaign=node_weekly_job" target="_blank" rel="external">Freelance with Companies like Airbnb, IDEO, &amp; JPMorgan</a><br>Work with top clients, set your own rates, and work from anywhere as an elite Toptal Node.js developer. Join the most exclusive network of top software engineers in the world. &#xA0; Toptal</li>
</ul>
<p>In brief</p>
<ul>
<li><a href="http://dailyjs.com/2015/07/01/node-long-term-support-working-group/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Node Long-Term Support Working Group Update</a> &#xA0; news &#xA0; DailyJS</li>
<li><a href="https://strongloop.com/strongblog/whats-new-in-the-loopback-node-js-framework-june-2015/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">What&#x2019;s New in the LoopBack Node.js Framework &#x2013; June 2015</a> &#xA0; news &#xA0; StrongLoop</li>
<li><a href="http://www.sitepoint.com/how-to-grunt-and-gulp-your-way-to-workflow-automation/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">How to Grunt and Gulp Your Way to Workflow Automation</a> &#xA0; tutorial &#xA0; Etienne Margraff</li>
<li><a href="https://stormpath.com/blog/how-to-build-an-api-service-with-nodejs/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Build An API Service in Node.js with Stormpath, Twilio and Stripe</a> &#xA0; tutorial<br>A complete walkthrough covering how to rapidly build an API service that uses SMS to provide up to date information about Bitcoin prices. &#xA0; Randall Degges</li>
<li><a href="http://www.sitepoint.com/displaying-images-on-a-dot-matrix-led-display-with-node-js/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Displaying Images on a Dot Matrix LED Display with Node.js</a> &#xA0; tutorial<br>Using Arduino and a Freetronics 32&#xD7;16 dot matrix display. &#xA0; Patrick Catanzariti</li>
<li><a href="http://www.sitepoint.com/connecting-the-iot-and-node-js-to-ifttt/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Connecting the IoT and Node.js to IFTTT</a> &#xA0; tutorial<br>&#x201C;To experiment with sending triggers to IFTTT, we will toggle a LIFX lightbulb on and off via an Arduino powered light switch.&#x201D; &#xA0; Patrick Catanzariti</li>
<li><a href="http://dailyjs.com/2015/07/02/small-modules-complexity-over-size/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">Small Modules: Tales from a Serial Module Author</a> &#xA0; opinion &#xA0; Sindre Sorhus</li>
<li><a href="https://www.youtube.com/watch?v=mGh3lW9oAgk" target="_blank" rel="external">npm Registry Deep Dive</a> &#xA0; video &#xA0; CJ Silverio</li>
<li><a href="http://wallabyjs.com/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">TDD/BDD with realtime code coverage for JavaScript</a> &#xA0; tools<br>Wallaby.js provides an instant feedback from your tests right inside your code editor. &#xA0; Wallaby.js &#xA0;&#xA0; Sponsored</li>
<li><a href="https://github.com/azproduction/node-mc?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">node-mc: Midnight Commander Written on the React/Node Stack</a> &#xA0; code<br>Midnight Commander is an open source cross platform visual file manager. &#xA0; Mikhail Davydov</li>
<li><a href="https://github.com/kristjanmik/ios-nodejs-s3-streamer?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">ios-nodejs-s3-streamer: Objective C Client and Node Server for iOS to Server Streaming</a> &#xA0; code &#xA0; Kristj&#xE1;n Ingi Mikaelsson</li>
<li><a href="https://www.npmjs.com/package/grunt-spec?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">grunt-spec: Facilitate A Workflow for Developing AMD Modules using TDD</a> &#xA0; code &#xA0; Jon Acker</li>
<li><a href="https://github.com/PillowPillow/yaml-config-loader?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">yaml-config-loader: YAML Configuration Loader for Node</a> &#xA0; code &#xA0; Nicolas Gaignoux</li>
<li><a href="https://raygun.io/?utm_source=link&amp;utm_medium=email-node-weekly&amp;utm_campaign=cooperp" target="_blank" rel="external">Your business relies on healthy software - Try Raygun</a> &#xA0; tools<br>Raygun alerts you in real-time when users are experiencing issues, giving you full diagnostic information in order to locate the root cause - fast! &#xA0; Raygun &#xA0;&#xA0; Sponsored</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>Asif Ahmed</p>
<p><a href="https://scotch.io/tutorials/building-a-real-time-markdown-viewer?utm_source=nodeweekly&amp;utm_medium=email" t]]>
    </summary>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[A Code Boot Camp for Underprivileged Kids -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f10224/"/>
    <id>http://taojinke.github.io/2015/07/03/2f10224/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.896Z</updated>
    <content type="html"><![CDATA[<p>A science center in Johannesburg, South Africa, has opened the doors to a five-month course in Linux-based Web apps and entrepreneurial skills. The training is available free of charge to underprivileged students from nearby townships; if it&apos;s successful, it will be rolled out nationwide.The Sci-Bono Discovery Center, based in Newtown, has been a strong supporter of education for school children and youth of the townships since it opened in 2006. At first the curriculum focused on educational support in the traditional subjects of science and mathematics. As time passed, the Center began to teach IT skills to high school graduates who were applying to university. This week, it has taken a giant leap into the realm of Web development with a world-class training line-up.It&apos;s an opportunity that many of the Center&apos;s students otherwise never would see, with poverty levels in the townships making it impossible to attend courses run by commercial training providers.The intensive five-month course was developed by French skills development firm Simplon, which recently was involved in the highly successful Africa Code Week. The course focuses on Linux-based Web app stacks. The training starts with Linux administration, and then students learn to produce working Ruby on Rails apps. They will learn to develop with Node.js and Meteor.js as well. Along the way, they also will be learning front-end skills such as HTML, JavaScript and CSS. By the end, they will have a well-rounded foundation in full stack development and completed projects to show off in their portfolios.The project is based on the topics that Simplon uses in its French coding boot camps, which have been very successful in France. One third of Simplon&apos;s graduates are employed, and another third are involved in startups of their own (which explains Simplon&apos;s nickname: &quot;The Startup Factory&quot;).The choice of Linux, Ruby, Rails and Node.js means that these students will be learning to use technology that is cutting-edge and completely open source. That&apos;s not just a happy coincidence. On a continent with many developing economies, FOSS is not just a moral choice. For many startups, restrictive and expensive software licenses would make it impossible to operate at all.The project leaders are excited about the changes that will be stimulated by this project, especially if it is adopted in other science centers throughout the country. With computer hardware availability and Internet access improving across the continent, Africa already is the fastest growing ICT region on Earth. With a horde of newly trained developers, ready to work with a cutting-edge open-source software stack, this will be one big step to close the technology gap with the West. And, with so many new developers able to contribute to open-source projects, it&apos;s a move that will benefit all of us.</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>A science center in Johannesburg, South Africa, has opened the doors to a five-month course in Linux-based Web apps and entrepreneurial s]]>
    </summary>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="Ruby" scheme="http://taojinke.github.io/tags/Ruby/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Dealing with long paths -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2ef5e38/"/>
    <id>http://taojinke.github.io/2015/07/03/2ef5e38/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.739Z</updated>
    <content type="html"><![CDATA[<p> You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could&apos;ve run into this problem locally or on end users&apos; machines. We&apos;ve created a simple little module called <a href="https://github.com/Teamwork/gulp-path-length" target="_blank" rel="external">gulp-path-length</a> to give you a helping hand with this. </p>
<p><img src="http://taojinke.github.io/img/20150703/2ef4d21.gif" alt=""></p>
<h2 id="npm">npm</h2><p>Neither this problem nor our solution is exclusive to <a href="https://nodejs.org/" target="_blank" rel="external">Node.js</a> , but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by <a href="https://www.npmjs.com/" target="_blank" rel="external">npm</a> package maintainers but even <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" target="_blank" rel="external">the design of npm itself is a problem from the get-go</a> . </p>
<p>npm stores your dependencies (listed in your package.json ) in a node_modules directory. If those dependencies have dependencies of their own, they&apos;re stored in their own node_modules directory (i.e. your-project/node_modules/a/node_modules/b/ ) and so on recursively. It&apos;s nice, but in hindsight, it&apos;s obviously incompatible with Windows&apos;s path length limit. </p>
<h3 id="Delete_delete_delete">Delete delete delete</h3><p>Most people have probably been lucky enough to only have come across this problem when trying to delete dependencies and then Windows complains that the path is too long.</p>
<p>A simple way around this is to take a module halfway down deep into your dependency graph (i.e. node_modules/a/node_modules/b/node_modules/c/…/node_modules/h/ ) in Windows Explorer and move it somewhere closer to the root (e.g. node_modules/ ) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit. </p>
<p>There are also some tools which could help. I&apos;ve noticed that you can delete really long paths while using <a href="http://www.7-zip.org/" target="_blank" rel="external">7-Zip</a> File Manager to browse files. </p>
<h3 id="Runtime_errors">Runtime errors</h3><p>If you&apos;ve ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level node_modules and not a node_modules directory n levels deep. Make sure to install the correct version and test thoroughly. </p>
<p>There are also a few Node modules out there which &quot;flatten&quot; your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So, be careful.</p>
<h3 id="Can&apos;t_npm_fix_this?">Can&apos;t npm fix this?</h3><p>You might see people reference Windows APIs (which support long paths) as a possible fix but it is <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" target="_blank" rel="external">very unlikely</a> this will be fixed in npm. <a href="https://docs.npmjs.com/cli/dedupe" target="_blank" rel="external">npm dedupe</a><em>should</em> help with this too but it&apos;s not reliable in my experience. This has been fixed as of <a href="https://github.com/npm/npm/releases/tag/v3.0.0" target="_blank" rel="external">npm 3.0.0</a> . </p>
<p>Your dependencies will now be installed <em>maximally</em> flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project&apos;s node_modules folder with no nesting. You&apos;ll only see modules nested underneath one another when two (or more) modules have conflicting dependencies. </p>
<p>Excuse me…</p>
<p><img src="http://taojinke.github.io/img/20150703/2ef4d21.gif" alt=""></p>
<h2 id="Manually_checking_for_exceedingly_long_paths">Manually checking for exceedingly long paths</h2><p>Up until now, we&apos;ve had to routinely check for long paths using <a href="https://pathlengthchecker.codeplex.com/" target="_blank" rel="external">Path Length Checker</a> (on Windows) but a manual check is not good enough as stuff can still slip through the net. </p>
<h2 id="Introducing_gulp-path-length">Introducing gulp-path-length</h2><p>So, we&apos;ve created a simple <a href="http://gulpjs.com" target="_blank" rel="external">Gulp</a> plugin help with this; <a href="https://github.com/Teamwork/gulp-path-length" target="_blank" rel="external">gulp-path-length</a> . You could use it like this in a Gulp task: </p>
<pre><code><span class="keyword">var</span> gulp = <span class="keyword">require</span>(&amp;apos;gulp&amp;apos;);  
<span class="keyword">var</span> pathLength = <span class="keyword">require</span>(&amp;apos;gulp-path-length&amp;apos;);

gulp.task(&amp;apos;<span class="keyword">default</span>&amp;apos;, <span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">{  
    gulp.src(&amp;apos;./example/path/to/directory/**&amp;apos;, {read: false}</span>)
        .<span class="title">pipe</span><span class="params">(pathLength()</span>);</span> 
});
</code></pre><p>If all is well, nothing will happen. If you have a path exceeding 256 characters, the Gulp task will stop and an error will reveal the offending path. This is really fast either way as Gulp doesn&apos;t need to read the contents of the files. The limit can be changed with a parameter; i.e. .pipe(pathLength({ maxLength: 50 }); . </p>
<p>This is fine if it&apos;s just for you locally, but there are bigger fish to fry.</p>
<h2 id="Distributed_long_paths">Distributed long paths</h2><p>What if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It&apos;s one thing having issues locally or within a team, it&apos;s a whole other thing to have path length problems in production on end users&apos; machines.</p>
<p>We&apos;ve run into this withTeamwork Chat for Windows as it&apos;s built on <a href="https://github.com/nwjs/nw.js" target="_blank" rel="external">NW.js</a> (formerly node-webkit) and can contain long paths (i.e. dependencies from npm). Depending on how long the current user&apos;s username was, the user might&apos;ve seen something like this when they tried to launch Teamwork Chat: </p>
<p><img src="http://taojinke.github.io/img/20150703/2ef4f92.png" alt=""></p>
<p>A dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of <a href="https://github.com/mllrsohn/node-webkit-builder" target="_blank" rel="external">node-webkit-builder</a> , I know we&apos;re not the only ones who have faced this problem. </p>
<h3 id="Is_there_anything_we_can_do?">Is there anything we can do?</h3><p>Once the code is shipped, it&apos;s too late. Luckily, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. We&apos;ve added a rewrite option to gulp-path-length for simulating paths to prevent this problem ever ocurring again; </p>
<pre><code><span class="keyword">var</span> gulp = <span class="keyword">require</span>(&amp;apos;gulp&amp;apos;);  
<span class="keyword">var</span> pathLength = <span class="keyword">require</span>(&amp;apos;gulp-path-length&amp;apos;);
gulp.task(&amp;apos;<span class="keyword">default</span>&amp;apos;, <span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">{  
    gulp.src(&amp;apos;./example/path/to/directory/**&amp;apos;, {read: false}</span>)
        .<span class="title">pipe</span><span class="params">(pathLength({
            rewrite: {
                match: &amp;apos;./example/path/<span class="keyword">to</span>/directory/&amp;apos;,
                replacement: &amp;apos;C:\\Users\\a-long-username-here\\AppData\\<span class="keyword">And</span>\\So\\<span class="keyword">On</span>&amp;apos;
            }
        })</span>);</span> 
});
</code></pre><p>So, it doesn&apos;t matter where you are on your filesystem or which operating system you&apos;re using, it will test the length of files (which belong to the given rewrite.match directory) as if they&apos;re in a specific directory on Windows (i.e. rewrite.replacement ). The outcome would be the same for any developer on the team. </p>
<p>You could run this before you ship your code but we&apos;ve added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of <a href="https://lodash.com/" target="_blank" rel="external">lodash</a> modules), they&apos;ll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step. </p>
<p>Are we missing anything here? Feel free to send us a pull-request or create an issue over at the gulp-path-length <a href="https://github.com/Teamwork/gulp-path-length" target="_blank" rel="external">GitHub repository</a> . </p>
]]></content>
    <summary type="html">
    <![CDATA[<p> You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could&apos;ve run into this pr]]>
    </summary>
    
      <category term="Gulp" scheme="http://taojinke.github.io/tags/Gulp/"/>
    
      <category term="Windows" scheme="http://taojinke.github.io/tags/Windows/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Ready Steady Gulp -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2ef3999/"/>
    <id>http://taojinke.github.io/2015/07/03/2ef3999/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.739Z</updated>
    <content type="html"><![CDATA[<h3 id="Installation">Installation</h3><h4 id="NodeJS_and_NPM_must_be_installed-">NodeJS and NPM must be installed.</h4><p>Gulp needs to be installed both globally( for command line usage ) and locally into our&#xA0;project( for creating project tasks )</p>
<h4 id="Global_Installation">Global Installation</h4><p> Shell</p>
<pre><code>sudo npm <span class="keyword">install</span> -g gulp
</code></pre><h4 id="Local_Installation">Local Installation</h4><p> ZSH</p>
<pre><code>cd <span class="built_in">path</span>/to/your/<span class="literal">project</span>/<span class="literal">root</span>
npm install gulp --save-dev
</code></pre><h3 id="Hello_World!">Hello World!</h3><p>Assuming our&#xA0;project directory is   my  -  project   , create a   gulpfile  .  js   file in it. All gulp tasks reside in this file. </p>
<p>Now, we create our first task that prints out <strong>Hello.</strong></p>
<p> JavaScript</p>
<pre><code>// require gulp. this <span class="keyword">is</span> why we install gulp locally.
var gulp = require(&amp;quot;gulp&amp;quot;);

// <span class="keyword">say</span> hello
gulp.task(&amp;quot;sayHello&amp;quot;, function(){
    console.log(&amp;quot;Hello&amp;quot;);
});
</code></pre><ul>
<li>First, we require&#xA0;   gulp   &#xA0;so we can use gulp&#x2019;s API for creating tasks.</li>
<li>Next, we create a task using&#xA0;   gulp  .  task   method with the <strong>task name</strong> being   sayHello   &#xA0; and an anonymous function that defines what   sayHello   &#xA0;does. In this case, we just print out <strong>Hello</strong></li>
</ul>
<h3 id="Executing_a_Task">Executing a Task</h3><p>Most of the work with gulp happens on the command line. To run a task, we navigate to our project directory( or the directory containing   gulpfile  .  js   ) and ask gulp to run a specific task. </p>
<pre><code>my-project
    /gulpfile.js  &amp;lt;- YOU GOTTA BE <span class="keyword">WHERE</span> THIS <span class="keyword">FILE</span> IS
</code></pre><p> Shell</p>
<pre><code>cd <span class="keyword">my</span>-project
gulp sayHello
</code></pre><p>Did you see what happened? It might look something like this&#x2026;</p>
<p> ZSH</p>
<pre><code>$ <span class="atom">gulp</span> <span class="atom">sayHello</span>
[<span class="number">15</span>:<span class="number">30</span>:<span class="number">28</span>] <span class="name">Using</span> <span class="atom">gulpfile</span> ~/<span class="atom">code</span>/<span class="atom">my</span>-<span class="atom">project</span>/<span class="atom">gulpfile</span>.<span class="atom">js</span>
[<span class="number">15</span>:<span class="number">30</span>:<span class="number">28</span>] <span class="name">Starting</span> &amp;<span class="atom">apos</span>;<span class="atom">sayHello</span>&amp;<span class="atom">apos</span>;...
<span class="name">Hello</span>
[<span class="number">15</span>:<span class="number">30</span>:<span class="number">28</span>] <span class="name">Finished</span> &amp;<span class="atom">apos</span>;<span class="atom">sayHello</span>&amp;<span class="atom">apos</span>; <span class="atom">after</span> <span class="number">83</span> &amp;#<span class="atom">x3BC</span>;<span class="atom">s</span>
</code></pre><p>Following along? Great!</p>
<h3 id="Dependent_Tasks">Dependent Tasks</h3><p>It&#x2019;s easy to make one task wait for another to finish. This is done by passing an array of tasks as the second parameter to   gulp  .  task   method. </p>
<p> JavaScript</p>
<pre><code>// <span class="keyword">say</span> world after saying hello <span class="keyword">is</span> done
gulp.task(&amp;quot;sayWorld&amp;quot;,<span class="comment">[&amp;apos;sayHello&amp;apos;]</span>, function(){
    console.log(&amp;quot;World!&amp;quot;);
});
</code></pre><p>Move over to terminal and execute   gulp  world   . </p>
<h3 id="The&#xA0;Default_Task">The&#xA0;Default Task</h3><p>If we move over to terminal and&#xA0;execute   gulp   , without specifying a task name, it looks for the   default   task. Go ahead! give it a try. </p>
<p> JavaScript</p>
<pre><code>gulp.task(&amp;quot;<span class="keyword">default</span>&amp;quot;, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
    console.<span class="built_in">log</span>(&amp;quot;La la la<span class="comment">!&amp;quot;);</span>
});
</code></pre><h3 id="Exploring_Gulp&#x2019;s_API">Exploring Gulp&#x2019;s API</h3><p>Gulp has 3 other methods   .  src   ,   .  dest   &amp;   .  watch   apart from   .  task   . We&#x2019;ll look into those by trying to minify CSS, a real world use case for gulp. </p>
<p>Before we go ahead, we need to know a little more about how gulp works. Gulp generates a stream from the files we pass in via   gulp  .  src   method. We then   pipe   the stream through various processors like <strong>minify</strong> , <strong>uglify</strong> , <strong>sass</strong> , <strong>sourcemaps</strong> etc. Remember, all the processing done, is still on the generated stream and not written to disk. To do that, we use   gulp  .  dest   . </p>
<h4 id="Minify_CSS">Minify CSS</h4><p>Create a <strong>style.css</strong> in&#xA0; <strong>css</strong> directory and put the following content. </p>
<p> CSS</p>
<pre><code>*<span class="rules">{
  <span class="rule"><span class="attribute">box-sizing</span>:<span class="value"> border-box</span></span>;
  <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span></span></span>;
  <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span></span></span>;
}</span>
<span class="tag">body</span>, <span class="tag">html</span><span class="rules">{
  <span class="rule"><span class="attribute">height </span>:<span class="value"> <span class="number">100%</span></span></span>;
}</span>
</code></pre><p>We will install [gulp-minify-css plugin][0] to do the minification. </p>
<p> JavaScript</p>
<pre><code>npm install gulp-minify-css --<span class="built_in">save</span>-<span class="built_in">dev</span>
</code></pre><p>In <strong>gulpfile.js</strong> , we require this module just like we did it for <strong>gulp</strong> . </p>
<p> JavaScript</p>
<pre><code><span class="reserved">var</span> minify = <span class="built_in">require</span>(&amp;apos;gulp-minify-css&amp;apos;);
</code></pre><p> JavaScript</p>
<pre><code><span class="comment">// minify css</span>
gulp.task<span class="params">(&amp;quot;css:minify&amp;quot;, function<span class="params">()</span>{
  gulp.src<span class="params">(&amp;quot;css/style.css&amp;quot;)</span>
    .pipe<span class="params">(minify<span class="params">()</span>)</span>
    .pipe<span class="params">(gulp.dest<span class="params">(&amp;quot;min&amp;quot;)</span>)</span>;
})</span>
</code></pre><p>So what did we do?</p>
<ol>
<li>We create a new task named   css  :  minify   &#xA0; (namespacing is&#xA0;good).</li>
<li>We tell gulp which sources to use to build the stream to process using   gulp  .  src   &#xA0; and passing in the file path.</li>
<li>We then   pipe   &#xA0; the generated stream through the   minify   &#xA0; process.</li>
<li>Finally, we pipe the processed stream through   gulp  .  dest   &#xA0;which then writes the new, minified   style  .  css   &#xA0; inside   min   &#xA0; directory.</li>
</ol>
<p>The last thing I want to mention is how to watch files for changes. In our example, we&#x2019;ll setup a   watch   task and look for changes in <strong>css</strong> files. Whenever that happens, we would want the   css  :  minify   task to run automatically. Here&#x2019;s how. </p>
<p> JavaScript</p>
<pre><code>// watch <span class="keyword">for</span> <span class="keyword">changes</span> in <span class="keyword">source</span>
gulp.task(&amp;quot;watch&amp;quot;, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
  gulp.watch(&amp;quot;css/style.css&amp;quot;,[&amp;apos;<span class="keyword">cs</span><span class="variable">s:minify</span>&amp;apos;]);
})
</code></pre><p>On terminal execute   gulp  watch   . It may look like the the prompt has hanged but it&#x2019;s actually watching for file changes. Let&#x2019;s go ahead and add some new rules in <strong>style.css</strong> , save it and see what happens! </p>
<p>In the next post, I&#x2019;ll write&#xA0;about file include patterns, various recipes for doing things like sass compilation, generating sourcemaps, cleaning directories before running tasks and more. Stay tuned!</p>
<p>[0]: <a href="http://blog.imaginea.com/ready-steady-gulp/http://*{" target="_blank" rel="external">http://blog.imaginea.com/ready-steady-gulp/http://*{</a>   box-sizing: border-box;   padding: 0;   margin: 0; } body, html{   height : 100%; }</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="Installation">Installation</h3><h4 id="NodeJS_and_NPM_must_be_installed-">NodeJS and NPM must be installed.</h4><p>Gulp needs to be ]]>
    </summary>
    
      <category term="Gulp" scheme="http://taojinke.github.io/tags/Gulp/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[gulp简易入坑 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f28da6/"/>
    <id>http://taojinke.github.io/2015/07/03/2f28da6/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:57.244Z</updated>
    <content type="html"><![CDATA[<p> &#x672C;&#x6587;&#x540C;&#x6B65;&#x81EA;&#x6211;&#x7684;&#x535A;&#x5BA2; <a href="http://www.reeoo.co/archives/gulpjs.html" target="_blank" rel="external">Reeoo&apos;s Coding Blog</a></p>
<p>&#x5728;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x4E4B;&#x524D;&#xFF0C;&#x524D;&#x7AEF;&#x6784;&#x5EFA;&#x6211;&#x4E00;&#x76F4;&#x5728;&#x7528; grunt &#xFF0C;&#x6709;&#x4E00;&#x5929;&#x540C;&#x5B66;&#x7ED9;&#x6211;&#x8BF4;&#x7528; gulp &#x5427;&#xFF0C;&#x6BD4; grunt &#x66F4;&#x597D;&#x7528;&#xFF0C;&#x4E8E;&#x662F;&#x4E4E;&#x6211;&#x51B3;&#x5B9A;&#x7814;&#x7A76;&#x4E00;&#x756A;&#xFF0C;&#xFFFD;&#xFFFD;&#xFFFD;&#x770B;&#x8FD9;&#x8D27;&#x5230;&#x5E95;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x597D;&#x4E1C;&#x897F;&#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/2f2027d.png" alt=""></p>
<h2 id="Gulp_vs_Grunt">Gulp vs Grunt</h2><p>&#x5148;&#x6765;&#x8BF4;&#x8BF4; grunt &#xFF0C;&#x5728;&#x4F7F;&#x7528;grunt&#x4E4B;&#x524D;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x6709;&#x4E00;&#x4E2A; Gruntfile.js &#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x76EE;&#x524D;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x5927;&#x6982;&#x662F;&#x8FD9;&#x4E48;&#x4E2A;&#x6837;&#x5B50;&#xFF1A; </p>
<pre><code><span class="xml">&amp;apos;use strict&amp;apos;;

module.exports = function(grunt) </span><span class="expression">{
  <span class="variable">grunt.initConfig</span>({
    <span class="variable">pkg</span>: <span class="variable">grunt.file.readJSON</span>(&amp;<span class="variable">apos</span>;<span class="variable">package.json</span>&amp;<span class="variable">apos</span>;),
    <span class="variable">cssmin</span>: {
      <span class="variable">minify</span>: {
        <span class="variable">expand</span>: <span class="variable">true</span>,
        <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">css</span>/&amp;<span class="variable">apos</span>;,
        <span class="variable">src</span>: [&amp;<span class="variable">apos</span>;*<span class="variable">.css</span>&amp;<span class="variable">apos</span>;, &amp;<span class="variable">apos</span>;!*<span class="variable">.min.css</span>&amp;<span class="variable">apos</span>;],
        <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">css</span>/&amp;<span class="variable">apos</span>;,
        <span class="variable">ext</span>: &amp;<span class="variable">apos</span>;<span class="variable">.min.css</span>&amp;<span class="variable">apos</span>;
      }</span><span class="xml">,
      my_target: </span><span class="expression">{
        <span class="variable">files</span>: [{
          <span class="variable">expand</span>: <span class="variable">true</span>,
          <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/style</span>/&amp;<span class="variable">apos</span>;,
          <span class="variable">src</span>: [&amp;<span class="variable">apos</span>;*<span class="variable">.css</span>&amp;<span class="variable">apos</span>;, &amp;<span class="variable">apos</span>;!*<span class="variable">.min.css</span>&amp;<span class="variable">apos</span>;],
          <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/style</span>/&amp;<span class="variable">apos</span>;
        }</span><span class="xml">]
      }
    },
    copy: </span><span class="expression">{
      <span class="variable">main</span>: {
        <span class="variable">files</span>: [
          {
            <span class="variable">expand</span>: <span class="variable">true</span>,
            <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/views</span>/&amp;<span class="variable">apos</span>;,
            <span class="variable">src</span>: [&amp;<span class="variable">apos</span>;**&amp;<span class="variable">apos</span>;],
            <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/views</span>/&amp;<span class="variable">apos</span>;
          }</span><span class="xml">, </span><span class="expression">{
            <span class="variable">expand</span>: <span class="variable">true</span>,
            <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/img</span>/&amp;<span class="variable">apos</span>;,
            <span class="variable">src</span>: [&amp;<span class="variable">apos</span>;**&amp;<span class="variable">apos</span>;],
            <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/img</span>/&amp;<span class="variable">apos</span>;
          }</span><span class="xml">, </span><span class="expression">{
            <span class="variable">expand</span>: <span class="variable">true</span>,
            <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span>/&amp;<span class="variable">apos</span>;,
            <span class="variable">src</span>: [&amp;<span class="variable">apos</span>;<span class="variable">main.html</span>&amp;<span class="variable">apos</span>;],
            <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span>/&amp;<span class="variable">apos</span>;
          }</span><span class="xml">, </span><span class="expression">{
            <span class="variable">expand</span>: <span class="variable">true</span>,
            <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span>/&amp;<span class="variable">apos</span>;,
            <span class="variable">src</span>: [&amp;<span class="variable">apos</span>;*<span class="variable">.txt</span>&amp;<span class="variable">apos</span>;],
            <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span>/&amp;<span class="variable">apos</span>;
          }</span><span class="xml">
        ]
      }
    },
    uglify: </span><span class="expression">{
      <span class="variable">buildall</span>: {
        //&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>53;&amp;<span class="variable">apos</span>;<span class="variable">minify</span>&amp;<span class="variable">apos</span>;&amp;<span class="begin-block">#x</span>4<span class="variable">EFB</span>;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>1;&amp;<span class="begin-block">#x</span>8<span class="variable">FD</span>0;&amp;<span class="begin-block">#x</span>884<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>65<span class="variable">F</span>6;<span class="variable">Grunt</span>&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>06;&amp;<span class="begin-block">#x</span>81<span class="variable">EA</span>;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>8;&amp;<span class="begin-block">#x</span>5728;&amp;<span class="variable">quot</span>;<span class="variable">lib</span>/&amp;<span class="variable">quot</span>;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>0<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>641<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">D</span>22;&amp;<span class="variable">quot</span>;**/*<span class="variable">.js</span>&amp;<span class="variable">quot</span>;, &amp;<span class="begin-block">#x</span>7136;&amp;<span class="begin-block">#x</span>540<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>6784;&amp;<span class="begin-block">#x</span>5<span class="variable">EFA</span>;&amp;<span class="begin-block">#x</span>9002;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>53;&amp;<span class="begin-block">#x</span>7684;<span class="variable">src-dest</span>&amp;<span class="begin-block">#x</span>6587;&amp;<span class="begin-block">#x</span>4<span class="variable">EF</span>6;&amp;<span class="begin-block">#x</span>6620;&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>04;&amp;<span class="begin-block">#xFF</span>0<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>56<span class="variable">E</span>0;&amp;<span class="begin-block">#x</span>6<span class="variable">B</span>64;&amp;<span class="begin-block">#x</span>4<span class="variable">F</span>60;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>0<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>9700;&amp;<span class="begin-block">#x</span>8981;&amp;<span class="begin-block">#x</span>5728;&amp;<span class="begin-block">#x</span>6587;&amp;<span class="begin-block">#x</span>4<span class="variable">EF</span>6;&amp;<span class="begin-block">#x</span>6<span class="variable">DFB</span>;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>0;&amp;<span class="begin-block">#x</span>6216;&amp;<span class="begin-block">#x</span>8005;&amp;<span class="begin-block">#x</span>79<span class="variable">FB</span>;&amp;<span class="begin-block">#x</span>9664;&amp;<span class="begin-block">#x</span>65<span class="variable">F</span>6;&amp;<span class="begin-block">#x</span>66<span class="variable">F</span>4;&amp;<span class="begin-block">#x</span>65<span class="variable">B</span>0;<span class="variable">Gruntfile</span>
        <span class="variable">files</span>: [{
          <span class="variable">expand</span>: <span class="variable">true</span>, //&amp;<span class="begin-block">#x</span>542<span class="variable">F</span>;&amp;<span class="begin-block">#x</span>7528;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>8;&amp;<span class="begin-block">#x</span>6001;&amp;<span class="begin-block">#x</span>6269;&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>55;
          <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/config</span>/&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>6279;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>76<span class="variable">F</span>8;&amp;<span class="begin-block">#x</span>5<span class="variable">BF</span>9;<span class="variable">lib</span>&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>55;&amp;<span class="begin-block">#x</span>7684;<span class="variable">src</span>&amp;<span class="begin-block">#x</span>6765;&amp;<span class="begin-block">#x</span>6<span class="variable">E</span>90;
          <span class="variable">src</span>: &amp;<span class="variable">apos</span>;**/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>5<span class="variable">B</span>9<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>9645;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>6<span class="variable">A</span>21;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>0<span class="variable">F</span>;
          <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/config</span>/&amp;<span class="variable">apos</span>; //&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>6807;&amp;<span class="begin-block">#x</span>8<span class="variable">DEF</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>84;&amp;<span class="begin-block">#x</span>524<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>00;
        }</span><span class="xml">, </span><span class="expression">{
          <span class="variable">expand</span>: <span class="variable">true</span>, //&amp;<span class="begin-block">#x</span>542<span class="variable">F</span>;&amp;<span class="begin-block">#x</span>7528;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>8;&amp;<span class="begin-block">#x</span>6001;&amp;<span class="begin-block">#x</span>6269;&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>55;
          <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/controllers</span>/&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>6279;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>76<span class="variable">F</span>8;&amp;<span class="begin-block">#x</span>5<span class="variable">BF</span>9;<span class="variable">lib</span>&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>55;&amp;<span class="begin-block">#x</span>7684;<span class="variable">src</span>&amp;<span class="begin-block">#x</span>6765;&amp;<span class="begin-block">#x</span>6<span class="variable">E</span>90;
          <span class="variable">src</span>: &amp;<span class="variable">apos</span>;**/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>5<span class="variable">B</span>9<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>9645;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>6<span class="variable">A</span>21;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>0<span class="variable">F</span>;
          <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/js</span><span class="end-block">/controllers</span>/&amp;<span class="variable">apos</span>; //&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>6807;&amp;<span class="begin-block">#x</span>8<span class="variable">DEF</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>84;&amp;<span class="begin-block">#x</span>524<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>00;
        }</span><span class="xml">, </span><span class="expression">{
          <span class="variable">expand</span>: <span class="variable">true</span>, //&amp;<span class="begin-block">#x</span>542<span class="variable">F</span>;&amp;<span class="begin-block">#x</span>7528;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>8;&amp;<span class="begin-block">#x</span>6001;&amp;<span class="begin-block">#x</span>6269;&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>55;
          <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/directive</span>/&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>6279;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>76<span class="variable">F</span>8;&amp;<span class="begin-block">#x</span>5<span class="variable">BF</span>9;<span class="variable">lib</span>&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>55;&amp;<span class="begin-block">#x</span>7684;<span class="variable">src</span>&amp;<span class="begin-block">#x</span>6765;&amp;<span class="begin-block">#x</span>6<span class="variable">E</span>90;
          <span class="variable">src</span>: &amp;<span class="variable">apos</span>;**/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>5<span class="variable">B</span>9<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>9645;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>6<span class="variable">A</span>21;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>0<span class="variable">F</span>;
          <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/js</span><span class="end-block">/directive</span>/&amp;<span class="variable">apos</span>; //&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>6807;&amp;<span class="begin-block">#x</span>8<span class="variable">DEF</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>84;&amp;<span class="begin-block">#x</span>524<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>00;
        }</span><span class="xml">, </span><span class="expression">{
          <span class="variable">expand</span>: <span class="variable">true</span>, //&amp;<span class="begin-block">#x</span>542<span class="variable">F</span>;&amp;<span class="begin-block">#x</span>7528;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>8;&amp;<span class="begin-block">#x</span>6001;&amp;<span class="begin-block">#x</span>6269;&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>55;
          <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/filter</span>/&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>6279;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>76<span class="variable">F</span>8;&amp;<span class="begin-block">#x</span>5<span class="variable">BF</span>9;<span class="variable">lib</span>&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>55;&amp;<span class="begin-block">#x</span>7684;<span class="variable">src</span>&amp;<span class="begin-block">#x</span>6765;&amp;<span class="begin-block">#x</span>6<span class="variable">E</span>90;
          <span class="variable">src</span>: &amp;<span class="variable">apos</span>;**/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>5<span class="variable">B</span>9<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>9645;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>6<span class="variable">A</span>21;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>0<span class="variable">F</span>;
          <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/js</span><span class="end-block">/filter</span>/&amp;<span class="variable">apos</span>; //&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>6807;&amp;<span class="begin-block">#x</span>8<span class="variable">DEF</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>84;&amp;<span class="begin-block">#x</span>524<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>00;
        }</span><span class="xml">, </span><span class="expression">{
          <span class="variable">expand</span>: <span class="variable">true</span>, //&amp;<span class="begin-block">#x</span>542<span class="variable">F</span>;&amp;<span class="begin-block">#x</span>7528;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>8;&amp;<span class="begin-block">#x</span>6001;&amp;<span class="begin-block">#x</span>6269;&amp;<span class="begin-block">#x</span>5<span class="variable">C</span>55;
          <span class="variable">cwd</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/service</span>/&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>6279;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>76<span class="variable">F</span>8;&amp;<span class="begin-block">#x</span>5<span class="variable">BF</span>9;<span class="variable">lib</span>&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>55;&amp;<span class="begin-block">#x</span>7684;<span class="variable">src</span>&amp;<span class="begin-block">#x</span>6765;&amp;<span class="begin-block">#x</span>6<span class="variable">E</span>90;
          <span class="variable">src</span>: &amp;<span class="variable">apos</span>;**/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, //&amp;<span class="begin-block">#x</span>5<span class="variable">B</span>9<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>9645;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>6<span class="variable">A</span>21;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>0<span class="variable">F</span>;
          <span class="variable">dest</span>: &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/js</span><span class="end-block">/service</span>/&amp;<span class="variable">apos</span>; //&amp;<span class="begin-block">#x</span>76<span class="variable">EE</span>;&amp;<span class="begin-block">#x</span>6807;&amp;<span class="begin-block">#x</span>8<span class="variable">DEF</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>84;&amp;<span class="begin-block">#x</span>524<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>00;
        }</span><span class="xml">]
      },
      builda: </span><span class="expression">{
        <span class="variable">files</span>: {
          &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/js</span><span class="end-block">/app.js</span>&amp;<span class="variable">apos</span>;: [&amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/app.js</span>&amp;<span class="variable">apos</span>;],
          &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/js</span><span class="end-block">/libs</span><span class="end-block">/bridge.</span>1<span class="variable">.</span>1<span class="variable">.</span>0<span class="variable">.js</span>&amp;<span class="variable">apos</span>;: [&amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/libs</span><span class="end-block">/bridge.</span>1<span class="variable">.</span>1<span class="variable">.</span>0<span class="variable">.js</span>&amp;<span class="variable">apos</span>;]
        }</span><span class="xml">
      },
      release: </span><span class="expression">{
        <span class="variable">files</span>: {
          &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/build</span><span class="end-block">/js</span><span class="end-block">/libs</span><span class="end-block">/libs.min.js</span>&amp;<span class="variable">apos</span>;: [&amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/libs</span><span class="end-block">/zepto.</span>20140520<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/libs</span><span class="end-block">/angular.min.js</span>&amp;<span class="variable">apos</span>;, &amp;<span class="variable">apos</span>;<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/libs</span>/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, &amp;<span class="variable">apos</span>;!<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/libs</span><span class="end-block">/bridge.</span>1<span class="variable">.</span>1<span class="variable">.</span>0<span class="variable">.js</span>&amp;<span class="variable">apos</span>;, &amp;<span class="variable">apos</span>;!<span class="variable">..</span><span class="end-block">/js</span><span class="end-block">/libs</span><span class="end-block">/libs.min.js</span>&amp;<span class="variable">apos</span>;]
        }</span><span class="xml">
      }
    }
  });
  grunt.loadNpmTasks(&amp;apos;grunt-contrib-copy&amp;apos;);
  grunt.loadNpmTasks(&amp;apos;grunt-contrib-jshint&amp;apos;); //&amp;#x68C0;&amp;#x67E5;js&amp;#x8BED;&amp;#x6CD5;&amp;#x9519;&amp;#x8BEF;
  grunt.loadNpmTasks(&amp;apos;grunt-contrib-concat&amp;apos;); //&amp;#x5408;&amp;#x5E76;&amp;#x6587;&amp;#x4EF6;
  grunt.loadNpmTasks(&amp;apos;grunt-contrib-uglify&amp;apos;); //&amp;#x538B;&amp;#x7F29;&amp;#x4EE3;&amp;#x7801;
  grunt.loadNpmTasks(&amp;apos;grunt-contrib-cssmin&amp;apos;); //css&amp;#x538B;&amp;#x7F29;

  grunt.registerTask(&amp;apos;default&amp;apos;, [&amp;apos;copy&amp;apos;, &amp;apos;cssmin&amp;apos;, &amp;apos;uglify&amp;apos;]);

};</span>
</code></pre><p>&#x518D;&#x6765;&#x770B; gulp &#x7684;&#xFF0C; gulp &#x9700;&#x8981;&#x4E00;&#x4E2A; gulpfile.js &#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x76EE;&#x524D;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x6837;&#x5B50;&#xFF1A; </p>
<pre><code>var gulp = require(&amp;apos;gulp&amp;apos;),//gulp&amp;<span class="symbol">#x57FA</span>;&amp;<span class="symbol">#x7840</span>;&amp;<span class="symbol">#x5E93</span>;
    concat = require(&amp;apos;gulp-concat&amp;apos;),//&amp;<span class="symbol">#x5408</span>;&amp;<span class="symbol">#x5E76</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;
    cssmin = require(&amp;apos;gulp-minify-css&amp;apos;),//&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;css
    htmlmin = require(&amp;quot;gulp-htmlmin&amp;quot;),//&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;html
    jsmin = require(&amp;apos;gulp-uglify&amp;apos;),//&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;js
    rename = require(&amp;apos;gulp-rename&amp;apos;),//&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x540D</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;
    clean = require(&amp;quot;gulp-clean&amp;quot;),//&amp;<span class="symbol">#x6E05</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x76EE</span>;&amp;<span class="symbol">#x5F55</span>;
    replace = require(&amp;apos;gulp-replace&amp;apos;),//&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x672C</span>;&amp;<span class="symbol">#x66FF</span>;&amp;<span class="symbol">#x6362</span>;
    processhtml = require(&amp;apos;gulp-processhtml&amp;apos;),//&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;html&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;
    addsrc = require(&amp;apos;gulp-add-src&amp;apos;),//&amp;<span class="symbol">#x6DFB</span>;&amp;<span class="symbol">#x52A0</span>;&amp;<span class="symbol">#x989D</span>;&amp;<span class="symbol">#x5916</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x6D41</span>;
    option = {
        <span class="method">buildPath:</span> &amp;quot;../dist&amp;quot;//&amp;<span class="symbol">#x6784</span>;&amp;<span class="symbol">#x5EFA</span>;&amp;<span class="symbol">#x76EE</span>;&amp;<span class="symbol">#x5F55</span>;
    };
//&amp;<span class="symbol">#x6784</span>;&amp;<span class="symbol">#x5EFA</span>;&amp;<span class="symbol">#x76EE</span>;&amp;<span class="symbol">#x5F55</span>;&amp;<span class="symbol">#x6E05</span>;&amp;<span class="symbol">#x7406</span>;
gulp.task(&amp;quot;clean&amp;quot;, function (done) {
    //return cache.clearAll(done);
    return gulp.src(option.buildPath, {
        <span class="method">read:</span> <span class="keyword">false</span>
    })
    .pipe(clean({<span class="method">force:</span> <span class="keyword">true</span>}));
})
gulp.task(&amp;quot;imgcopy&amp;quot;, function () {//&amp;<span class="symbol">#x56FE</span>;&amp;<span class="symbol">#x7247</span>;&amp;<span class="symbol">#x62F7</span>;&amp;<span class="symbol">#x8D1D</span>;
    gulp.src(&amp;quot;../img/**/*&amp;quot;)
    .pipe(gulp.dest(option.buildPath + &amp;apos;/img/&amp;apos;))
})
//js&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;
gulp.task(&amp;apos;jsmin&amp;apos;, function () {
    gulp.src([&amp;quot;../js/**/**/*.js&amp;quot;,&amp;apos;!../js/libs/*.js&amp;apos;])
        .pipe(jsmin())
        .pipe(gulp.dest(option.buildPath+ &amp;quot;/js/&amp;quot;))
});
//&amp;<span class="symbol">#x9700</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x5408</span>;&amp;<span class="symbol">#x5E76</span>;&amp;<span class="symbol">#x548C</span>;&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;
gulp.task(&amp;apos;concat&amp;apos;, function () {
    gulp.src([&amp;apos;../js/libs/angular.min.js&amp;apos;,&amp;apos;../js/libs/*.js&amp;apos;, &amp;apos;!../js/libs/bridge*.js&amp;apos;])
        .pipe(concat(&amp;apos;libs.min.js&amp;apos;))
        .pipe(jsmin())
        .pipe(addsrc(&amp;apos;../js/libs/bridge*.js&amp;apos;))
        .pipe(jsmin())
        .pipe(gulp.dest(option.buildPath + &amp;quot;/js/libs/&amp;quot;))
});
gulp.task(&amp;quot;processhtml&amp;quot;, function () {
    var date = new <span class="class">Date</span>().getTime();
    gulp.src(&amp;apos;../main.html&amp;apos;)
        .pipe(replace(/_VERSION_/gi, date))
        .pipe(processhtml())
        .pipe(htmlmin({
            <span class="method">collapseWhitespace:</span> <span class="keyword">true</span>
        }))
        .pipe(gulp.dest(option.buildPath + &amp;apos;/&amp;apos;))
})
//&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;css
gulp.task(&amp;quot;cssmin&amp;quot;, function () {
    gulp.src(&amp;quot;../style/*.css&amp;quot;)
        .pipe(cssmin())
        .pipe(gulp.dest(option.buildPath + &amp;apos;/style&amp;apos;))
})
//&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;html&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;
gulp.task(&amp;quot;htmlmin&amp;quot;, function () {
    gulp.src(&amp;apos;../views/**/*.html&amp;apos;)
        .pipe(htmlmin({
            <span class="method">collapseWhitespace:</span> <span class="keyword">true</span>
        }))
        .pipe(gulp.dest(option.buildPath + &amp;apos;/views&amp;apos;))
})
// &amp;<span class="symbol">#x9ED8</span>;&amp;<span class="symbol">#x8BA4</span>;&amp;<span class="symbol">#x4EFB</span>;&amp;<span class="symbol">#x52A1</span>; &amp;<span class="symbol">#x6E05</span>;&amp;<span class="symbol">#x7A7A</span>;&amp;<span class="symbol">#x56FE</span>;&amp;<span class="symbol">#x7247</span>;&amp;<span class="symbol">#x3001</span>;&amp;<span class="symbol">#x6837</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x3001</span>;js&amp;<span class="symbol">#x5E76</span>;&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x5EFA</span>; &amp;<span class="symbol">#x8FD0</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x8BED</span>;&amp;<span class="symbol">#x53E5</span>; gulp
gulp.task(&amp;apos;default&amp;apos;, [&amp;apos;clean&amp;apos;], function () {
    gulp.start(&amp;apos;jsmin&amp;apos;, &amp;apos;cssmin&amp;apos;, &amp;apos;processhtml&amp;apos;, &amp;quot;htmlmin&amp;quot;, &amp;apos;imgcopy&amp;apos;, &amp;apos;concat&amp;apos;);
});
</code></pre><p>Grunt &#x5904;&#x7406;&#x4EFB;&#x52A1;&#x7684;&#x6D41;&#x7A0B;&#xFF1A; </p>
<p><img src="http://taojinke.github.io/img/20150703/2f204ee.png" alt=""></p>
<p>gulp &#x5904;&#x7406;&#x4EFB;&#x52A1;&#xFF1A; </p>
<p><img src="http://taojinke.github.io/img/20150703/2f204ee.png" alt=""></p>
<p>&#x5199; Gruntfile.js &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x8981;&#x6309;&#x7167;&#x522B;&#x4EBA;&#x5B9A;&#x597D;&#x7684;&#x89C4;&#x5219;&#x6765;&#x5199;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x89C4;&#x5219;&#xFF08; JSON &#x683C;&#x5F0F;&#xFF09;&#x53EF;&#x80FD;&#x90FD;&#x4E0D;&#x5C3D;&#x76F8;&#x540C;&#xFF0C;&#x800C;&#x5199; gulpfile.js &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x4E86;&#x89E3;4&#x4E2A;gulp&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x5373;&#x4F7F;&#x4F60;&#x8981;&#x5199;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;&#x6BD4;&#x5982;&#x9879;&#x76EE;&#x7684;&#x6784;&#x5EFA;&#x76EE;&#x5F55;&#x662F;&#x54EA;&#x91CC;&#xFF0C;css&#x6587;&#x4EF6;&#x7684;&#x76EE;&#x5F55;&#x53C8;&#x662F;&#x54EA;&#x4E2A;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5199;&#x4E2A;JSON&#x6765;&#x6807;&#x660E;&#xFF09;&#xFF0C;&#x90A3;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x4E5F;&#x662F;&#x638C;&#x63E1;&#x5728;&#x4F60;&#x81EA;&#x5DF1;&#x7684;&#x624B;&#x91CC;&#xFF0C;&#x60F3;&#x600E;&#x4E48;&#x5199;&#x5C31;&#x600E;&#x4E48;&#x5199;&#xFF0C;&#x6839;&#x672C;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5177;&#x4F53;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x53EA;&#x8981;&#x58F0;&#x660E;&#x5B8C;&#x683C;&#x5F0F;&#xFF0C;&#x5F85;&#x4F1A;&#x81EA;&#x5DF1;&#x7528;&#x5230;&#x7684;&#x65F6;&#x5019;&#x8BB0;&#x5F97;&#x5C31;&#x597D;&#x4E86;&#x3002; grunt &#x662F;&#x57FA;&#x4E8E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6765;&#x505A;&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x800C; gulp &#x91C7;&#x7528;&#x7684;&#x662F;&#x4EE3;&#x7801;&#x4F18;&#x4E8E;&#x914D;&#x7F6E;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x5199;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x5199;&#x4EE3;&#x7801;&#xFF0C;&#x4E2A;&#x4EBA;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x503E;&#x5411;&#x4E8E;&#x540E;&#x8005;&#x3002; </p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x4F7F;&#x7528; grunt &#x7684; I/O &#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E9B;&#x4E2D;&#x95F4;&#x6001;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;A&#x4EFB;&#x52A1;&#x5904;&#x7406;&#x5B8C;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;B&#x4EFB;&#x52A1;&#x4F1A;&#x8BFB;&#x53D6;&#x8FD9;&#x4E2A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x7EE7;&#x7EED;&#x505A;&#x81EA;&#x5DF1;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x7ED9;C&#x4EFB;&#x52A1;&#x7528;&#xFF0C;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;&#xFF0C;&#x5176;&#x5B83;&#x4EFB;&#x52A1;&#x53EF;&#x80FD;&#x4F1A;&#x57FA;&#x4E8E;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x518D;&#x505A;&#x5904;&#x7406;&#x5E76;&#x751F;&#x6210;&#x6700;&#x7EC8;&#x7684;&#x6784;&#x5EFA;&#x540E;&#x6587;&#x4EF6;&#x3002; </p>
<p>&#x800C;&#x4F7F;&#x7528; gulp &#x7684;&#x4F18;&#x52BF;&#x5C31;&#x662F;&#x5229;&#x7528;&#x6D41;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x7BA1;&#x9053;&#x5C06;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x548C;&#x64CD;&#x4F5C;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x6709;&#x4E00;&#x6B21; I/O &#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x6D41;&#x7A0B;&#x66F4;&#x6E05;&#x6670;&#xFF0C;&#x66F4;&#x7EAF;&#x7CB9;&#x3002;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x4E5F;&#x8981;&#x6BD4; grunt &#x5FEB;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6784;&#x5EFA;&#x7684;&#x9879;&#x76EE;&#x5F88;&#x5C0F;&#xFF0C;&#x53EF;&#x80FD;&#x5DEE;&#x8DDD;&#x5C31;&#x4F53;&#x73B0;&#x4E0D;&#x51FA;&#x6765;&#x4E86;&#x3002; </p>
<h2 id="Gulp&#x4E3A;&#x4EC0;&#x4E48;&#x5FEB;">Gulp&#x4E3A;&#x4EC0;&#x4E48;&#x5FEB;</h2><ul>
<li>&#x4F7F;&#x7528; <a href="https://github.com/orchestrator/orchestrator/" target="_blank" rel="external">orchestrator</a> &#x4EFB;&#x52A1;&#x7CFB;&#x7EDF;,&#x6700;&#x5927;&#x9650;&#x5EA6;&#x7684;&#x5E76;&#x53D1;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;.</li>
<li>&#x6BCF;&#x4E2A;plugin&#x53EA;&#x505A;&#x4E00;&#x4EF6;&#x4E8B;,&#x505A;&#x597D;&#x4E00;&#x4EF6;&#x4E8B;, &#x63D0;&#x5347;&#x5904;&#x7406;&#x901F;&#x5EA6;</li>
<li>&#x6D41;&#x5F0F;&#x5904;&#x7406;,&#x6781;&#x5C11;&#x7684;&#x6587;&#x4EF6;IO</li>
</ul>
<h2 id="Gulp-js&#x7684;&#x6838;&#x5FC3;&#x8BBE;&#x8BA1;">Gulp.js&#x7684;&#x6838;&#x5FC3;&#x8BBE;&#x8BA1;</h2><p><a href="http://gulpjs.com" target="_blank" rel="external">gulp&#x5B98;&#x7F51;</a> &#x4E0A;&#x7684;&#x7B80;&#x4ECB;&#x662F;The streaming build system &#xFF0C; </p>
<p>&#x6838;&#x5FC3;&#x7684;&#x8BCD;&#x662F; streaming &#xFF08;&#x6D41;&#x52A8;&#x5F0F;&#xFF09;&#xFF0C; Gulp.js &#x7684;&#x7CBE;&#x9AD3;&#x5728;&#x4E8E;&#x5BF9; Node.js &#x4E2D; Streams API &#x7684;&#x5229;&#x7528;&#xFF0C; </p>
<p>&#x6240;&#x4EE5;&#x60F3;&#x8981;&#x7406;&#x89E3; Gulp.js &#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x7406;&#x89E3; Streams &#xFF0C; streaming &#x5176;&#x5B9E;&#x5C31;&#x662F; Streams &#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C; </p>
<p>&#x4F46;&#x662F;&#x50CF;&#x6211;&#x8FD9;&#x79CD;&#x5BF9; Node.js &#x53EA;&#x662F;&#x4E00;&#x77E5;&#x534A;&#x89E3;&#x7684;&#x5C31;&#x53EA;&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x884C; google &#x3002; </p>
<h2 id="gulp&#x5FEB;&#x901F;&#x4E0A;&#x624B;">gulp&#x5FEB;&#x901F;&#x4E0A;&#x624B;</h2><ol>
<li>&#x9996;&#x5148;&#x786E;&#x4FDD;&#x4F60;&#x5DF2;&#x7ECF;&#x6B63;&#x786E;&#x5B89;&#x88C5;&#x4E86; nodejs &#x73AF;&#x5883;&#x3002;&#x7136;&#x540E;&#x4EE5;&#x5168;&#x5C40;&#x65B9;&#x5F0F;&#x5B89;&#x88C5; gulp &#xFF1A;<br>$ npm install -g gulp</li>
<li>&#x5168;&#x5C40;&#x5B89;&#x88C5; gulp &#x540E;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5728;&#x6BCF;&#x4E2A;&#x8981;&#x4F7F;&#x7528; gulp &#x7684;&#x9879;&#x76EE;&#x4E2D;&#x90FD;&#x5355;&#x72EC;&#x5B89;&#x88C5;&#x4E00;&#x6B21;&#x3002;&#x628A;&#x76EE;&#x5F55;&#x5207;&#x6362;&#x5230;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x6267;&#x884C;&#xFF1A;<br>$ npm install gulp<br>&#x5982;&#x679C;&#x60F3;&#x5728;&#x5B89;&#x88C5;&#x7684;&#x65F6;&#x5019;&#x628A; gulp &#xFFFD;&#xFFFD;&#xFFFD;&#x8FDB;&#x9879;&#x76EE; package.json &#x6587;&#x4EF6;&#x7684;&#x4F9D;&#x8D56;&#x4E2D;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x52A0;&#x4E0A; &#x2013;save-dev &#xFF1A;<br>$ npm install —save-dev gulp</li>
<li><p>&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x521B;&#x5EFA;gulpfile.js&#x6587;&#x4EF6;</p>
<p> var gulp = require(&apos;gulp&apos;);</p>
<p> gulp.task(&apos;default&apos;, function() {<br>   console.log(&apos;hello world&apos;);<br> });</p>
</li>
<li>&#x8FD0;&#x884C;gulp<br>$ gulp<br>&#x9ED8;&#x8BA4;&#x4EFB;&#x52A1;&#x5C06;&#x88AB;&#x8FD0;&#x884C;&#xFF0C;&#x5411;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA; hello world &#x3002;<br>&#x5982;&#x679C;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x4EFB;&#x52A1;, &#x4F7F;&#x7528; gulp taskname &#x547D;&#x4EE4;&#x3002;</li>
</ol>
<h2 id="Gulp_api&#x901F;&#x89C8;">Gulp api&#x901F;&#x89C8;</h2><p>&#x4F7F;&#x7528; gulp &#xFF0C;&#x4EC5;&#x9700;&#x77E5;&#x9053;4&#x4E2A;API&#x5373;&#x53EF;&#xFF1A; gulp.task() , gulp.src() , gulp.dest() , gulp.watch() &#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x80FD;&#x638C;&#x63E1;&#x3002; </p>
<h2 id="gulp-src(globs[,_options])">gulp.src(globs[, options])</h2><p>gulp.src() &#x65B9;&#x6CD5;&#x6B63;&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x6D41;&#x7684;&#xFF0C;&#x4F46;&#x8981;&#x6CE8;&#x610F;&#x8FD9;&#x4E2A;&#x6D41;&#x91CC;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x662F;&#x539F;&#x59CB;&#x7684;&#x6587;&#x4EF6;&#x6D41;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x6587;&#x4EF6;&#x5BF9;&#x8C61;&#x6D41;&#xFF0C;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x6587;&#x4EF6;&#x5BF9;&#x8C61;&#x4E2D;&#x5B58;&#x50A8;&#x7740;&#x539F;&#x59CB;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84;&#x3001;&#x6587;&#x4EF6;&#x540D;&#x3001;&#x5185;&#x5BB9;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x672C;&#x6587;&#x6682;&#x4E0D;&#x5BF9;&#x6587;&#x4EF6;&#x6D41;&#x8FDB;&#x884C;&#x5C55;&#x5F00;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x7B80;&#x5355;&#x7684;&#x7406;&#x89E3;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x8BFB;&#x53D6;&#x4F60;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x6587;&#x4EF6;&#x5C31;&#x884C;&#x4E86;&#xFF0C; globs &#x53C2;&#x6570;&#x662F;&#x6587;&#x4EF6;&#x5339;&#x914D;&#x6A21;&#x5F0F;(&#x7C7B;&#x4F3C;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;)&#xFF0C;&#x7528;&#x6765;&#x5339;&#x914D;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;(&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x540D;)&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002;&#x5F53;&#x6709;&#x591A;&#x4E2A;&#x5339;&#x914D;&#x6A21;&#x5F0F;&#x65F6;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x4E3A;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x3002; </p>
<p>options &#x4E3A;&#x53EF;&#x9009;&#x53C2;&#x6570;&#x3002;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x7528;&#x5230;&#xFF0C;&#x6682;&#x4E0D;&#x8003;&#x8651;&#x3002; </p>
<h3 id="&#x6587;&#x4EF6;&#x5339;&#x914D;&#x6A21;&#x5F0F;">&#x6587;&#x4EF6;&#x5339;&#x914D;&#x6A21;&#x5F0F;</h3><p>Gulp &#x5185;&#x90E8;&#x4F7F;&#x7528;&#x4E86; node-glob &#x6A21;&#x5757;&#x6765;&#x5B9E;&#x73B0;&#x5176;&#x6587;&#x4EF6;&#x5339;&#x914D;&#x529F;&#x80FD;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x5B57;&#x7B26;&#x6765;&#x5339;&#x914D;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x6587;&#x4EF6;&#xFF1A; </p>
<ul>
<li><ul>
<li>&#x5339;&#x914D;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;0&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5B57;&#x7B26;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x5339;&#x914D;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;&#xFF0C;&#x9664;&#x975E;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;&#x51FA;&#x73B0;&#x5728;&#x672B;&#x5C3E; </li>
</ul>
</li>
<li><p>** &#x5339;&#x914D;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;0&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x76EE;&#x5F55;&#x53CA;&#x5176;&#x5B50;&#x76EE;&#x5F55;,&#x9700;&#x8981;&#x5355;&#x72EC;&#x51FA;&#x73B0;&#xFF0C;&#x5373;&#x5B83;&#x5DE6;&#x53F3;&#x4E0D;&#x80FD;&#x6709;&#x5176;&#x4ED6;&#x4E1C;&#x897F;&#x4E86;&#x3002;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x5728;&#x672B;&#x5C3E;&#xFF0C;&#x4E5F;&#x80FD;&#x5339;&#x914D;&#x6587;&#x4EF6;&#x3002; </p>
</li>
<li><p>? &#x5339;&#x914D;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;(&#x4E0D;&#x4F1A;&#x5339;&#x914D;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;) </p>
</li>
<li><p>[…] &#x5339;&#x914D;&#x65B9;&#x62EC;&#x53F7;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x5B57;&#x7B26;&#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#xFF0C;&#x5F53;&#x65B9;&#x62EC;&#x53F7;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E3A;^&#x6216;!&#x65F6;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x4E0D;&#x5339;&#x914D;&#x65B9;&#x62EC;&#x53F7;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x5176;&#x4ED6;&#x5B57;&#x7B26;&#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#xFF0C;&#x7C7B;&#x4F3C;js&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;&#x7528;&#x6CD5; !(pattern|pattern|pattern) &#x5339;&#x914D;&#x4EFB;&#x4F55;&#x4E0E;&#x62EC;&#x53F7;&#x4E2D;&#x7ED9;&#x5B9A;&#x7684;&#x4EFB;&#x4E00;&#x6A21;&#x5F0F;&#x90FD;&#x4E0D;&#x5339;&#x914D;&#x7684; </p>
</li>
<li><p>?(pattern|pattern|pattern) &#x5339;&#x914D;&#x62EC;&#x53F7;&#x4E2D;&#x7ED9;&#x5B9A;&#x7684;&#x4EFB;&#x4E00;&#x6A21;&#x5F0F;0&#x6B21;&#x6216;1&#x6B21;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;js&#x6B63;&#x5219;&#x4E2D;&#x7684; (pattern|pattern|pattern)?  </p>
</li>
<li>+(pattern|pattern|pattern) &#x5339;&#x914D;&#x62EC;&#x53F7;&#x4E2D;&#x7ED9;&#x5B9A;&#x7684;&#x4EFB;&#x4E00;&#x6A21;&#x5F0F;&#x81F3;&#x5C11;1&#x6B21;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;js&#x6B63;&#x5219;&#x4E2D;&#x7684; (pattern|pattern|pattern)+  </li>
<li><p><em>(pattern|pattern|pattern) &#x5339;&#x914D;&#x62EC;&#x53F7;&#x4E2D;&#x7ED9;&#x5B9A;&#x7684;&#x4EFB;&#x4E00;&#x6A21;&#x5F0F;0&#x6B21;&#x6216;&#x591A;&#x6B21;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;js&#x6B63;&#x5219;&#x4E2D;&#x7684;(pattern|pattern|pattern)</em> </p>
</li>
<li><p>@(pattern|pattern|pattern) &#x5339;&#x914D;&#x62EC;&#x53F7;&#x4E2D;&#x7ED9;&#x5B9A;&#x7684;&#x4EFB;&#x4E00;&#x6A21;&#x5F0F;1&#x6B21;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;js&#x6B63;&#x5219;&#x4E2D;&#x7684; (pattern|pattern|pattern)</p>
</li>
</ul>
<p>&#x6587;&#x4EF6;&#x5339;&#x914D;&#x5217;&#x5B50;&#xFF1A;</p>
<ul>
<li><ul>
<li>&#x80FD;&#x5339;&#x914D; reeoo.js , reeoo.css , reeoo , reeoo/ ,&#x4F46;&#x4E0D;&#x80FD;&#x5339;&#x914D; reeoo/reeoo.js  </li>
</ul>
</li>
<li><em>.</em> &#x80FD;&#x5339;&#x914D; reeoo.js , reeoo.css , reeoo.html  </li>
<li><em>/</em>/*.js &#x80FD;&#x5339;&#x914D; r/e/o.js , a/b/c.js ,&#x4E0D;&#x80FD;&#x5339;&#x914D; a/b.js , a/b/c/d.js  </li>
<li><p>** &#x80FD;&#x5339;&#x914D; reeoo , reeoo/reeoo.js , reeoo/reeoo/reeoo.js , reeoo/reeoo/reeoo , reeoo/reeoo/reeoo/reeoo.co ,&#x80FD;&#x7528;&#x6765;&#x5339;&#x914D;&#x6240;&#x6709;&#x7684;&#x76EE;&#x5F55;&#x548C;&#x6587;&#x4EF6; </p>
</li>
<li><p><em>*/</em>.js &#x80FD;&#x5339;&#x914D; reeoo.js , reeoo/reeoo.js , reeoo/reeoo/reeoo.js , reeoo/reeoo/reeoo/reeoo.js  </p>
</li>
<li>reeoo/**/co &#x80FD;&#x5339;&#x914D; reeoo/co , reeoo/ooo/co , reeoo/a/b/co , reeoo/d/g/h/j/k/co  </li>
<li><p>reeoo/<strong>b/co &#x80FD;&#x5339;&#x914D; reeoo/b/co , reeoo/sb/co ,&#x4F46;&#x4E0D;&#x80FD;&#x5339;&#x914D; reeoo/x/sb/co ,&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x5355; </strong> &#x5355;&#x72EC;&#x51FA;&#x73B0;&#x624D;&#x80FD;&#x5339;&#x914D;&#x591A;&#x7EA7;&#x76EE;&#x5F55; </p>
</li>
<li><p>?.js &#x80FD;&#x5339;&#x914D; reeoo.js , reeoo1.js , reeoo2.js  </p>
</li>
<li><p>reeoo?? &#x80FD;&#x5339;&#x914D; reeoo.co , reeooco ,&#x4F46;&#x4E0D;&#x80FD;&#x5339;&#x914D; reeooco/ ,&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x4F1A;&#x5339;&#x914D;&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26; </p>
</li>
<li><p>[reo].js &#x53EA;&#x80FD;&#x5339;&#x914D; r.js , e.js , o.js ,&#x4E0D;&#x4F1A;&#x5339;&#x914D; re.js , reo.js &#x7B49;,&#x6574;&#x4E2A;&#x4E2D;&#x62EC;&#x53F7;&#x53EA;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x5B57;&#x7B26; </p>
</li>
<li><p>[^reo].js &#x80FD;&#x5339;&#x914D; a.js , b.js , c.js &#x7B49;,&#x4E0D;&#x80FD;&#x5339;&#x914D; r.js , e.js , o.js</p>
</li>
</ul>
<p>&#x5F53;&#x6709;&#x591A;&#x79CD;&#x5339;&#x914D;&#x6A21;&#x5F0F;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6570;&#x7EC4;</p>
<pre><code>//&amp;<span class="symbol">#x4F7F</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x7EC4</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x5339</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x79CD</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;
gulp.src([&amp;apos;js/*.js&amp;apos;,&amp;apos;css/*.css&amp;apos;,&amp;apos;*.html&amp;apos;])
</code></pre><p>&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x7684;&#x65B9;&#x5F0F;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x6392;&#x9664;&#x6A21;&#x5F0F;&#xFF0C;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5355;&#x4E2A;&#x5339;&#x914D;&#x6A21;&#x5F0F;&#x524D;&#x52A0;&#x4E0A; ! &#x5373;&#x662F;&#x6392;&#x9664;&#x6A21;&#x5F0F;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x5339;&#x914D;&#x7684;&#x7ED3;&#x679C;&#x4E2D;&#x6392;&#x9664;&#x8FD9;&#x4E2A;&#x5339;&#x914D;&#xFF0C;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x70B9;&#x7684;&#x662F; &#x4E0D;&#x80FD;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20; &#x4E2D;&#x4F7F;&#x7528;&#x6392;&#x9664;&#x6A21;&#x5F0F; </p>
<p>gulp.src([<em>.js,&apos;!r</em>.js&apos;]) &#x5339;&#x914D;&#x6240;&#x6709;js&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x6392;&#x9664;&#x6389;&#x4EE5;r&#x5F00;&#x5934;&#x7684;js&#x6587;&#x4EF6; </p>
<p>gulp.src([&apos;!r<em>.js&apos;,</em>.js]) &#x4E0D;&#x4F1A;&#x6392;&#x9664;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x4E3A;&#x6392;&#x9664;&#x6A21;&#x5F0F;&#x4E0D;&#x80FD;&#x51FA;&#x73B0;&#x5728;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4E2D; </p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5C55;&#x5F00;&#x6A21;&#x5F0F;&#x3002;&#x5C55;&#x5F00;&#x6A21;&#x5F0F;&#x4EE5;&#x82B1;&#x62EC;&#x53F7;&#x4F5C;&#x4E3A;&#x5B9A;&#x754C;&#x7B26;&#xFF0C;&#x6839;&#x636E;&#x5B83;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4F1A;&#x5C55;&#x5F00;&#x4E3A;&#x591A;&#x4E2A;&#x6A21;&#x5F0F;&#xFF0C;&#x6700;&#x540E;&#x5339;&#x914D;&#x7684;&#x7ED3;&#x679C;&#x4E3A;&#x6240;&#x6709;&#x5C55;&#x5F00;&#x7684;&#x6A21;&#x5F0F;&#x76F8;&#x52A0;&#x8D77;&#x6765;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x5C55;&#x5F00;&#x7684;&#x4F8B;&#x5B50;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>r{e,o}c &#x4F1A;&#x5C55;&#x5F00;&#x4E3A; rec , roc  </li>
<li>r{e,}o &#x4F1A;&#x5C55;&#x5F00;&#x4E3A; reo , ro  </li>
<li>r{0..3}o &#x4F1A;&#x5C55;&#x5F00;&#x4E3A; r0o , r1do , r2o , r3o</li>
</ul>
<h2 id="gulp-dest(path[,options])">gulp.dest(path[,options])</h2><p>gulp.dest() &#x65B9;&#x6CD5;&#x662F;&#x7528;&#x6765;&#x5199;&#x6587;&#x4EF6;&#x7684;&#xFF0C; path &#x4E3A;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84;, options &#x4E3A;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x7528;&#x5230;&#xFF0C;&#x6682;&#x4E0D;&#x8003;&#x8651;&#x3002; </p>
<p>&#x8981;&#x60F3;&#x4F7F;&#x7528;&#x597D; gulp.dest() &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x8981;&#x7406;&#x89E3;&#x7ED9;&#x5B83;&#x4F20;&#x5165;&#x7684;&#x8DEF;&#x5F84;&#x53C2;&#x6570;&#x4E0E;&#x6700;&#x7EC8;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x5173;&#x7CFB;&#x3002; </p>
<p>gulp &#x7684;&#x4F7F;&#x7528;&#x6D41;&#x7A0B;&#x4E00;&#x822C;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#xFF1A;&#x9996;&#x5148;&#x901A;&#x8FC7; gulp.src() &#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5904;&#x7406;&#x7684;&#x6587;&#x4EF6;&#x6D41;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x6587;&#x4EF6;&#x6D41;&#x901A;&#x8FC7; pipe &#x65B9;&#x6CD5;&#x5BFC;&#x5165;&#x5230; gulp &#x7684;&#x63D2;&#x4EF6;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x628A;&#x7ECF;&#x8FC7;&#x63D2;&#x4EF6;&#x5904;&#x7406;&#x540E;&#x7684;&#x6D41;&#x518D;&#x901A;&#x8FC7; pipe &#x65B9;&#x6CD5;&#x5BFC;&#x5165;&#x5230; gulp.dest() &#x4E2D;&#xFF0C; gulp.dest() &#x65B9;&#x6CD5;&#x5219;&#x628A;&#x6D41;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5199;&#x5165;&#x5230;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x8FD9;&#x91CC;&#x9996;&#x5148;&#x9700;&#x8981;&#x5F04;&#x6E05;&#x695A;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x7ED9; gulp.dest() &#x4F20;&#x5165;&#x7684;&#x8DEF;&#x5F84;&#x53C2;&#x6570;&#xFF0C;&#x53EA;&#x80FD;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x8981;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x6307;&#x5B9A;&#x751F;&#x6210;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5B83;&#x751F;&#x6210;&#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5BFC;&#x5165;&#x5230;&#x5B83;&#x7684;&#x6587;&#x4EF6;&#x6D41;&#x81EA;&#x8EAB;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x6240;&#x4EE5;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x7531;&#x5BFC;&#x5165;&#x5230;&#x5B83;&#x7684;&#x6587;&#x4EF6;&#x6D41;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x5373;&#x4F7F;&#x6211;&#x4EEC;&#x7ED9;&#x5B83;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x5E26;&#x6709;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x8DEF;&#x5F84;&#x53C2;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x4E5F;&#x4F1A;&#x628A;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x540D;&#x5F53;&#x505A;&#x662F;&#x76EE;&#x5F55;&#x540D;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A; </p>
<pre><code>var gulp = require(&amp;apos;gulp&amp;apos;);
gulp.src(&amp;apos;script/jquery.js&amp;apos;)
    .pipe(gulp.dest(&amp;apos;dist/foo.js&amp;apos;));
//&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x7EC8</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; dist/foo.js/jquery.js,&amp;<span class="symbol">#x800C</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x662F</span>;dist/foo.js
</code></pre><p>&#x8981;&#x60F3;&#x6539;&#x53D8;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x63D2;&#x4EF6; gulp-rename</p>
<p>&#x4E0B;&#x9762;&#x8BF4;&#x8BF4;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E0E;&#x6211;&#x4EEC;&#x7ED9; gulp.dest() &#x65B9;&#x6CD5;&#x4F20;&#x5165;&#x7684;&#x8DEF;&#x5F84;&#x53C2;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002; </p>
<p>gulp.dest(path) &#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x662F;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684; path &#x53C2;&#x6570;&#x540E;&#x9762;&#x518D;&#x52A0;&#x4E0A; gulp.src() &#x4E2D;&#x6709;&#x901A;&#x914D;&#x7B26;&#x5F00;&#x59CB;&#x51FA;&#x73B0;&#x7684;&#x90A3;&#x90E8;&#x5206;&#x8DEF;&#x5F84;&#x3002;&#x4F8B;&#x5982;&#xFF1A; </p>
<pre><code>var gulp = reruire(&amp;apos;gulp&amp;apos;);
//&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x5F00</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x73B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x90A3</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; **/*.js
gulp.src(&amp;apos;script/**/*.js&amp;apos;)
    .pipe(gulp.dest(&amp;apos;dist&amp;apos;)); //&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; dist/**/*.js
//&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>; **/*.js &amp;<span class="symbol">#x5339</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x4E3A</span>; jquery/jquery.js ,&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; dist/jquery/jquery.js
</code></pre><p>&#x518D;&#x4E3E;&#x66F4;&#x591A;&#x4E00;&#x70B9;&#x7684;&#x4F8B;&#x5B50;</p>
<pre><code>gulp.src(&amp;apos;script/avalon/avalon.js&amp;apos;) //&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x73B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x60C5</span>;&amp;<span class="symbol">#x51B5</span>;
    .pipe(gulp.dest(&amp;apos;dist&amp;apos;)); //&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; dist/avalon.js

//&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x5F00</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x73B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x90A3</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; **/underscore.js


gulp.src(&amp;apos;script/**/underscore.js&amp;apos;)
    //&amp;<span class="symbol">#x5047</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x5339</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x4E3A</span>;script/util/underscore.js
    .pipe(gulp.dest(&amp;apos;dist&amp;apos;)); //&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; dist/util/underscore.js
gulp.src(&amp;apos;script/*&amp;apos;) //&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x73B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x90A3</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; *
    //&amp;<span class="symbol">#x5047</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x5339</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x4E3A</span>;script/zepto.js
    .pipe(gulp.dest(&amp;apos;dist&amp;apos;)); //&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; dist/zepto.js
&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;&amp;lt;br /&amp;gt;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x5B9A</span>;`gulp.src()`&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x7684</span>;`base`&amp;<span class="symbol">#x5C5E</span>;&amp;<span class="symbol">#x6027</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x66F4</span>;&amp;<span class="symbol">#x7075</span>;&amp;<span class="symbol">#x6D3B</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x6539</span>;&amp;<span class="symbol">#x53D8</span>;`gulp.dest()`&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x3002</span>;
&amp;<span class="symbol">#x5F53</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x5728</span>;`gulp.src()`&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7F6E</span>;`base`&amp;<span class="symbol">#x5C5E</span>;&amp;<span class="symbol">#x6027</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#xFF0C</span>;`base`&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x9ED8</span>;&amp;<span class="symbol">#x8BA4</span>;&amp;<span class="symbol">#x503C</span>;&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x5F00</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x73B0</span>;&amp;<span class="symbol">#x4E4B</span>;&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x90A3</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x4F8B</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#xFF1A</span>;
&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
gulp.src(&amp;apos;app/src/**/*.css&amp;apos;) //&amp;<span class="symbol">#x6B64</span>;&amp;<span class="symbol">#x65F6</span>;base&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x503C</span>;&amp;<span class="symbol">#x4E3A</span>; app/src
&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;&amp;lt;br /&amp;gt;&amp;<span class="symbol">#x4E0A</span>;&amp;<span class="symbol">#x9762</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x8BF4</span>;&amp;<span class="symbol">#x7684</span>;`gulp.dest()`&amp;<span class="symbol">#x6240</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x89C4</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5176</span>;&amp;<span class="symbol">#x5B9E</span>;&amp;<span class="symbol">#x4E5F</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x7ED9</span>;`gulp.dest()`&amp;<span class="symbol">#x4F20</span>;&amp;<span class="symbol">#x5165</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x66FF</span>;&amp;<span class="symbol">#x6362</span>;&amp;<span class="symbol">#x6389</span>;`gulp.src()`&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x7684</span>;`base`&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x7EC8</span>;&amp;<span class="symbol">#x5F97</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x3002</span>;
&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
gulp.src(&amp;apos;app/src/**/*.css&amp;apos;) //&amp;<span class="symbol">#x6B64</span>;&amp;<span class="symbol">#x65F6</span>;base&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x503C</span>;&amp;<span class="symbol">#x4E3A</span>;app/src,&amp;<span class="symbol">#x4E5F</span>;&amp;<span class="symbol">#x5C31</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x8BF4</span>;&amp;<span class="symbol">#x5B83</span>;&amp;<span class="symbol">#x7684</span>;base&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>;app/src
     //&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x8BE5</span>;&amp;<span class="symbol">#x6A21</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x5339</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>; app/src/css/normal.css
    .pipe(gulp.dest(&amp;apos;dist&amp;apos;)) //&amp;<span class="symbol">#x7528</span>;dist&amp;<span class="symbol">#x66FF</span>;&amp;<span class="symbol">#x6362</span>;&amp;<span class="symbol">#x6389</span>;base&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x7EC8</span>;&amp;<span class="symbol">#x5F97</span>;&amp;<span class="symbol">#x5230</span>; dist/css/normal.css
&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;&amp;lt;br /&amp;gt;&amp;<span class="symbol">#x6240</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x6539</span>;&amp;<span class="symbol">#x53D8</span>;`base`&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#xFF0C</span>;`gulp.dest()`&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E5F</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x6539</span>;&amp;<span class="symbol">#x53D8</span>;
&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
gulp.src(script/lib/*.js) //&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7F6E</span>;base&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6B64</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x9ED8</span>;&amp;<span class="symbol">#x8BA4</span>;&amp;<span class="symbol">#x7684</span>;base&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>;script/lib
    //&amp;<span class="symbol">#x5047</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x5339</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x4E3A</span>;script/lib/jquery.js
    .pipe(gulp.dest(&amp;apos;build&amp;apos;)) //&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; build/jquery.js



gulp.src(script/lib/*.js, {<span class="method">base:</span>&amp;apos;script&amp;apos;}) //&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x4E86</span>;base&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6B64</span>;&amp;<span class="symbol">#x65F6</span>;base&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>;script
    //&amp;<span class="symbol">#x5047</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x5339</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x4E3A</span>;script/lib/jquery.js
    .pipe(gulp.dest(&amp;apos;build&amp;apos;)) //&amp;<span class="symbol">#x6B64</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x5F84</span>;&amp;<span class="symbol">#x4E3A</span>; build/lib/jquery.js
</code></pre><p>&#x7528; gulp.dest() &#x628A;&#x6587;&#x4EF6;&#x6D41;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x540E;&#xFF0C;&#x6587;&#x4EF6;&#x6D41;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x3002; </p>
<h2 id="gulp-task(name[,_deps],_fn)">gulp.task(name[, deps], fn)</h2><p>gulp.task &#x65B9;&#x6CD5;&#x7528;&#x6765;&#x5B9A;&#x4E49;&#x4EFB;&#x52A1;&#xFF0C; </p>
<p>name &#x4E3A;&#x4EFB;&#x52A1;&#x540D;&#xFF0C; </p>
<p>deps &#x662F;&#x5F53;&#x524D;&#x5B9A;&#x4E49;&#x7684;&#x4EFB;&#x52A1;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x7684;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;&#xFF0C; </p>
<p>&#x4E3A;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x3002;&#x5F53;&#x524D;&#x5B9A;&#x4E49;&#x7684;&#x4EFB;&#x52A1;&#x4F1A;&#x5728;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#x624D;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4F9D;&#x8D56;&#xFF0C;&#x5219;&#x53EF;&#x7701;&#x7565;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;</p>
<p>fn &#x4E3A;&#x4EFB;&#x52A1;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x4EFB;&#x52A1;&#x8981;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x5199;&#x5728;&#x91CC;&#x9762;&#x3002;&#x8BE5;&#x53C2;&#x6570;&#x4E5F;&#x662F;&#x53EF;&#x9009;&#x7684;&#x3002; </p>
<h2 id="gulp-watch(glob[,_opts],_tasks)">gulp.watch(glob[, opts], tasks)</h2><p>gulp.watch() &#x7528;&#x6765;&#x76D1;&#x89C6;&#x6587;&#x4EF6;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5F53;&#x6587;&#x4EF6;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x5B83;&#x6765;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4F8B;&#x5982;&#x6587;&#x4EF6;&#x538B;&#x7F29;&#x7B49;&#x3002; </p>
<p>glob &#x4E3A;&#x8981;&#x76D1;&#x89C6;&#x7684;&#x6587;&#x4EF6;&#x5339;&#x914D;&#x6A21;&#x5F0F;&#xFF0C;&#x89C4;&#x5219;&#x548C;&#x7528;&#x6CD5;&#x4E0E; gulp.src() &#x65B9;&#x6CD5;&#x4E2D;&#x7684;glob&#x76F8;&#x540C;&#x3002; </p>
<p>opts &#x4E3A;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x914D;&#x7F6E;&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x7528;&#x5230;&#xFF0C;&#x6682;&#x4E0D;&#x8003;&#x8651;&#x3002; </p>
<p>tasks &#x4E3A;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x540E;&#x8981;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4E3A;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C; </p>
<p>gulp.task(&apos;uglify&apos;,function(){ //do something }); gulp.task(&apos;reload&apos;,function(){ //do something }); gulp.watch(&apos;js/<em>*/</em>.js&apos;, [&apos;uglify&apos;,&apos;reload&apos;]);</p>
<p>gulp.watch()&#x8FD8;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF1A;</p>
<pre><code>gulp.<span class="function"><span class="title">watch</span><span class="params">(glob[, opts, cb])</span></span>
</code></pre><p>glob &#x548C; opts &#x53C2;&#x6570;&#x4E0E;&#x7B2C;&#x4E00;&#x79CD;&#x7528;&#x6CD5;&#x76F8;&#x540C; </p>
<p>cb &#x53C2;&#x6570;&#x4E3A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#x6BCF;&#x5F53;&#x76D1;&#x89C6;&#x7684;&#x6587;&#x4EF6;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;,&#x5E76;&#x4E14;&#x4F1A;&#x7ED9;&#x5B83;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5305;&#x542B;&#x4E86;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x7684;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C; type &#x5C5E;&#x6027;&#x4E3A;&#x53D8;&#x5316;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x662F; added , changed , deleted &#xFF1B; path &#x5C5E;&#x6027;&#x4E3A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84; </p>
<p>gulp.watch(&apos;js/<em>*/</em>.js&apos;, function(event){ console.log(event.type); //&#x53D8;&#x5316;&#x7C7B;&#x578B; added&#x4E3A;&#x65B0;&#x589E;,deleted&#x4E3A;&#x5220;&#x9664;&#xFF0C;changed&#x4E3A;&#x6539;&#x53D8; console.log(event.path); //&#x53D8;&#x5316;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84; });</p>
<h2 id="&#x5E38;&#x7528;&#x7684;gulp&#x63D2;&#x4EF6;&#x4ECB;&#x7ECD;">&#x5E38;&#x7528;&#x7684;gulp&#x63D2;&#x4EF6;&#x4ECB;&#x7ECD;</h2><h2 id="js&#x6587;&#x4EF6;&#x538B;&#x7F29;">js&#x6587;&#x4EF6;&#x538B;&#x7F29;</h2><p>&#x4F7F;&#x7528; <a href="https://www.npmjs.com/packages/gulp-uglify/" target="_blank" rel="external">gulp-uglify</a></p>
<p>&#x5B89;&#x88C5;&#xFF1A; npm install —save-dev gulp-uglify<br>&#x7528;&#x6765;&#x538B;&#x7F29; js &#x6587;&#x4EF6;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F; uglify &#x5F15;&#x64CE; </p>
<pre><code><span class="xml">var gulp = require(&amp;apos;gulp&amp;apos;),
    uglify = require(&amp;quot;gulp-uglify&amp;quot;);
gulp.task(&amp;apos;minify-js&amp;apos;, function () </span><span class="expression">{
    <span class="variable">gulp.src</span>(&amp;<span class="variable">apos</span>;<span class="variable">js</span>/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;) /<span class="end-block">/ </span>&amp;<span class="begin-block">#x</span>8981;&amp;<span class="begin-block">#x</span>538<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>29;&amp;<span class="begin-block">#x</span>7684;<span class="variable">js</span>&amp;<span class="begin-block">#x</span>6587;&amp;<span class="begin-block">#x</span>4<span class="variable">EF</span>6;
    <span class="variable">.pipe</span>(<span class="variable">uglify</span>())
    <span class="variable">.pipe</span>(<span class="variable">gulp.dest</span>(&amp;<span class="variable">apos</span>;<span class="variable">dist</span><span class="end-block">/js</span>&amp;<span class="variable">apos</span>;)); //&amp;<span class="begin-block">#x</span>538<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>29;&amp;<span class="begin-block">#x</span>540<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>8<span class="variable">DEF</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>84;
}</span><span class="xml">);</span>
</code></pre><h2 id="&#x91CD;&#x547D;&#x540D;&#x6587;&#x4EF6;">&#x91CD;&#x547D;&#x540D;&#x6587;&#x4EF6;</h2><p>&#x4F7F;&#x7528; <a href="https://www.npmjs.com/packages/gulp-rename/" target="_blank" rel="external">gulp-rename</a></p>
<p>&#x5B89;&#x88C5;&#xFF1A; npm install —save-dev gulp-rename<br>&#x7528;&#x6765;&#x91CD;&#x547D;&#x540D;&#x6587;&#x4EF6;&#x6D41;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x7528; gulp.dest() &#x65B9;&#x6CD5;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x6587;&#x4EF6;&#x6D41;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x60F3;&#x6539;&#x53D8;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x90A3;&#x53EF;&#x4EE5;&#x5728;&#x4E4B;&#x524D;&#x7528; gulp-rename &#x63D2;&#x4EF6;&#x6765;&#x6539;&#x53D8;&#x6587;&#x4EF6;&#x6D41;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002; </p>
<pre><code>var gulp = require<span class="list">(<span class="keyword">&amp;apos</span><span class="comment">;gulp&amp;apos;),</span>
    rename = require<span class="list">(<span class="keyword">&amp;apos</span><span class="comment">;gulp-rename&amp;apos;),</span>
    uglify = require<span class="list">(<span class="keyword">&amp;quot</span><span class="comment">;gulp-uglify&amp;quot;);</span>
gulp.task<span class="list">(<span class="keyword">&amp;apos</span><span class="comment">;rename&amp;apos;, function () {</span>
    gulp.src<span class="list">(<span class="keyword">&amp;apos</span><span class="comment">;js/jquery.js&amp;apos;)</span>
    .pipe<span class="list">(<span class="keyword">uglify</span><span class="list">()</span>)</span>  //&amp;#x538B<span class="comment">;&amp;#x7F29;</span>
    .pipe<span class="list">(<span class="keyword">rename</span><span class="list">(<span class="keyword">&amp;apos</span><span class="comment">;jquery.min.js&amp;apos;)) //&amp;#x4F1A;&amp;#x5C06;jquery.js&amp;#x91CD;&amp;#x547D;&amp;#x540D;&amp;#x4E3A;jquery.min.js</span>
    .pipe<span class="list">(<span class="keyword">gulp</span>.dest<span class="list">(<span class="keyword">&amp;apos</span><span class="comment">;js&amp;apos;));</span>
})</span><span class="comment">;</span></span></span></span></span></span></span></span></span>
</code></pre><h2 id="&#x538B;&#x7F29;css&#x6587;&#x4EF6;">&#x538B;&#x7F29;css&#x6587;&#x4EF6;</h2><p>&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/gulp-minify-css/" target="_blank" rel="external">gulp-minify-css</a></p>
<p>&#x5B89;&#x88C5;&#xFF1A; npm install —save-dev gulp-minify-css<br>&#x8981;&#x538B;&#x7F29; css &#x6587;&#x4EF6;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x63D2;&#x4EF6; </p>
<pre><code><span class="xml">var gulp = require(&amp;apos;gulp&amp;apos;),
    minifyCss = require(&amp;quot;gulp-minify-css&amp;quot;);
gulp.task(&amp;apos;minify-css&amp;apos;, function () </span><span class="expression">{
    <span class="variable">gulp.src</span>(&amp;<span class="variable">apos</span>;<span class="variable">css</span>/*<span class="variable">.css</span>&amp;<span class="variable">apos</span>;) /<span class="end-block">/ </span>&amp;<span class="begin-block">#x</span>8981;&amp;<span class="begin-block">#x</span>538<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>29;&amp;<span class="begin-block">#x</span>7684;<span class="variable">css</span>&amp;<span class="begin-block">#x</span>6587;&amp;<span class="begin-block">#x</span>4<span class="variable">EF</span>6;
    <span class="variable">.pipe</span>(<span class="variable">minifyCss</span>()) //&amp;<span class="begin-block">#x</span>538<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>29;<span class="variable">css</span>
    <span class="variable">.pipe</span>(<span class="variable">gulp.dest</span>(&amp;<span class="variable">apos</span>;<span class="variable">dist</span><span class="end-block">/css</span>&amp;<span class="variable">apos</span>;));
}</span><span class="xml">);</span>
</code></pre><h2 id="html&#x6587;&#x4EF6;&#x538B;&#x7F29;">html&#x6587;&#x4EF6;&#x538B;&#x7F29;</h2><p>&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/gulp-minify-html/" target="_blank" rel="external">gulp-minify-html</a></p>
<p>&#x5B89;&#x88C5;&#xFF1A; npm install —save-dev gulp-minify-html<br>&#x7528;&#x6765;&#x538B;&#x7F29; html &#x6587;&#x4EF6; </p>
<pre><code><span class="xml">var gulp = require(&amp;apos;gulp&amp;apos;),
    minifyHtml = require(&amp;quot;gulp-minify-html&amp;quot;);
gulp.task(&amp;apos;minify-html&amp;apos;, function () </span><span class="expression">{
    <span class="variable">gulp.src</span>(&amp;<span class="variable">apos</span>;<span class="variable">html</span>/*<span class="variable">.html</span>&amp;<span class="variable">apos</span>;) /<span class="end-block">/ </span>&amp;<span class="begin-block">#x</span>8981;&amp;<span class="begin-block">#x</span>538<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>29;&amp;<span class="begin-block">#x</span>7684;<span class="variable">html</span>&amp;<span class="begin-block">#x</span>6587;&amp;<span class="begin-block">#x</span>4<span class="variable">EF</span>6;
    <span class="variable">.pipe</span>(<span class="variable">minifyHtml</span>()) //&amp;<span class="begin-block">#x</span>538<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>7<span class="variable">F</span>29;
    <span class="variable">.pipe</span>(<span class="variable">gulp.dest</span>(&amp;<span class="variable">apos</span>;<span class="variable">dist</span><span class="end-block">/html</span>&amp;<span class="variable">apos</span>;));
}</span><span class="xml">);</span>
</code></pre><h2 id="&#x6587;&#x4EF6;&#x5408;&#x5E76;">&#x6587;&#x4EF6;&#x5408;&#x5E76;</h2><p>&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/gulp-concat/" target="_blank" rel="external">gulp-concat</a></p>
<p>&#x5B89;&#x88C5;&#xFF1A; npm install —save-dev gulp-concat<br>&#x7528;&#x6765;&#x628A;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;,&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x6765;&#x5408;&#x5E76; js &#x6216; css &#x6587;&#x4EF6;&#x7B49;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x51CF;&#x5C11;&#x9875;&#x9762;&#x7684; http &#x8BF7;&#x6C42;&#x6570;&#x4E86; </p>
<pre><code><span class="xml">var gulp = require(&amp;apos;gulp&amp;apos;),
    concat = require(&amp;quot;gulp-concat&amp;quot;);
gulp.task(&amp;apos;concat&amp;apos;, function () </span><span class="expression">{
    <span class="variable">gulp.src</span>(&amp;<span class="variable">apos</span>;<span class="variable">js</span>/*<span class="variable">.js</span>&amp;<span class="variable">apos</span>;)  //&amp;<span class="begin-block">#x</span>8981;&amp;<span class="begin-block">#x</span>5408;&amp;<span class="begin-block">#x</span>5<span class="variable">E</span>76;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>6587;&amp;<span class="begin-block">#x</span>4<span class="variable">EF</span>6;
    <span class="variable">.pipe</span>(<span class="variable">concat</span>(&amp;<span class="variable">apos</span>;<span class="variable">all.js</span>&amp;<span class="variable">apos</span>;))  /<span class="end-block">/ </span>&amp;<span class="begin-block">#x</span>5408;&amp;<span class="begin-block">#x</span>5<span class="variable">E</span>76;&amp;<span class="begin-block">#x</span>5339;&amp;<span class="begin-block">#x</span>914<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>5230;&amp;<span class="begin-block">#x</span>7684;<span class="variable">js</span>&amp;<span class="begin-block">#x</span>6587;&amp;<span class="begin-block">#x</span>4<span class="variable">EF</span>6;&amp;<span class="begin-block">#x</span>5<span class="variable">E</span>76;&amp;<span class="begin-block">#x</span>547<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>540<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>3<span class="variable">A</span>; &amp;<span class="variable">quot</span>;<span class="variable">all.js</span>&amp;<span class="variable">quot</span>;
    <span class="variable">.pipe</span>(<span class="variable">gulp.dest</span>(&amp;<span class="variable">apos</span>;<span class="variable">dist</span><span class="end-block">/js</span>&amp;<span class="variable">apos</span>;));
}</span><span class="xml">);</span>
</code></pre><h2 id="&#x81EA;&#x52A8;&#x5237;&#x65B0;">&#x81EA;&#x52A8;&#x5237;&#x65B0;</h2><p>&#x53EF;&#x4EE5;&#x7ED3;&#x5408; browser-sync &#x505A;&#x591A;&#x7EC8;&#x7AEF;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#xFF0C;&#x8BE6;&#x89C1; <a href="http://reeoo.co/2015/06/25/BrowserSync/" target="_blank" rel="external">BrowserSync&#x524D;&#x7AEF;&#x6D4B;&#x8BD5;&#x5229;&#x5668;</a></p>
<h2 id="&#x5904;&#x7406;html">&#x5904;&#x7406;html</h2><p>&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/gulp-processhtml/" target="_blank" rel="external">gulp-processhtml</a></p>
<p>&#x5B89;&#x88C5;&#xFF1A; npm install —save-dev gulp-processhtml<br>&#x5728;&#x6784;&#x5EFA;&#x65F6;&#x5904;&#x7406;&#x6309;&#x4F60;&#x8BBE;&#x60F3;&#x7684;&#x4FEE;&#x6539; html &#x6587;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#x4F60;&#x6784;&#x5EFA;&#x4E4B;&#x524D;&#x4F60;&#x6709; N &#x4E2A;&#x811A;&#x672C;&#x9700;&#x8981;&#x5F15;&#x5165;&#x5230; html &#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x6784;&#x5EFA;&#x4E4B;&#x540E;&#x53EF;&#x80FD;&#x8FD9; N &#x4E2A;&#x6587;&#x4EF6;&#x88AB;&#x5408;&#x5E76;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5F15;&#x5165;&#x7684;&#x5730;&#x65B9;&#x4E5F;&#x9700;&#x8981;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x8C03;&#x6574;&#xFF0C;&#x90A3;&#x4E48;&#x5DEE;&#x4E2A;&#x63D2;&#x4EF6;&#x5C31;&#x80FD;&#x6D3E;&#x4E0A;&#x7528;&#x573A;&#x4E86;&#x3002; </p>
<p>&#x63D2;&#x4EF6;&#x4F7F;&#x7528;</p>
<pre><code>gulp.task<span class="params">(&amp;quot;processhtml&amp;quot;, function <span class="params">()</span> {
    gulp.src<span class="params">(&amp;apos;../main.html&amp;apos;)</span>
        .pipe<span class="params">(processhtml<span class="params">()</span>)</span>
        .pipe<span class="params">(gulp.dest<span class="params">(option.buildPath + &amp;apos;/&amp;apos;)</span>)</span>
})</span>
</code></pre><p>main.html &#x6784;&#x5EFA;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801; </p>
<pre><code><span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!</span>DOCTYPE html<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;html ng<span class="attribute">-app</span><span class="subst">=&amp;</span>quot;app<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;head lang<span class="subst">=&amp;</span>quot;en<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta charset<span class="subst">=&amp;</span>quot;UTF<span class="subst">-</span><span class="number">8</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;viewport<span class="subst">&amp;</span>quot;
        content<span class="subst">=&amp;</span>quot;width<span class="subst">=</span>device<span class="attribute">-width</span>,initial<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,minimum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,maximum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,user<span class="attribute">-scalable</span><span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;format<span class="attribute">-detection</span><span class="subst">&amp;</span>quot; content<span class="subst">=&amp;</span>quot;telephone<span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/base<span class="built_in">.</span>css<span class="subst">?</span><span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/index<span class="built_in">.</span>css<span class="subst">?</span><span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/head<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!--</span> build:js js/libs/libs<span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js <span class="subst">--&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!--</span>process<span class="attribute">-html</span><span class="subst">&amp;</span><span class="variable">#x63D2</span>;<span class="subst">&amp;</span><span class="variable">#x4EF6</span>;<span class="subst">&amp;</span><span class="variable">#x9700</span>;<span class="subst">&amp;</span><span class="variable">#x8981</span>;<span class="subst">&amp;</span><span class="variable">#x7528</span>;<span class="subst">&amp;</span><span class="variable">#x5230</span>;<span class="subst">&amp;</span><span class="variable">#x8FD9</span>;<span class="subst">&amp;</span><span class="variable">#x4E2A</span>;<span class="subst">&amp;</span><span class="variable">#x6CE8</span>;<span class="subst">&amp;</span><span class="variable">#x91CA</span>;<span class="subst">--</span> <span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/angular<span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/angular<span class="built_in">.</span>touch<span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/zepto<span class="built_in">.20140520</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/angular<span class="built_in">.</span>ui<span class="built_in">.</span>bootstrap<span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/angular<span class="attribute">-sanitize</span><span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/angular<span class="attribute">-ui</span><span class="attribute">-route</span><span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/fastclick<span class="built_in">.0</span><span class="built_in">.6</span><span class="built_in">.7</span><span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/carous<span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!--</span> /build <span class="subst">--&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!--</span>process<span class="attribute">-html</span><span class="subst">&amp;</span><span class="variable">#x63D2</span>;<span class="subst">&amp;</span><span class="variable">#x4EF6</span>;<span class="subst">&amp;</span><span class="variable">#x9700</span>;<span class="subst">&amp;</span><span class="variable">#x8981</span>;<span class="subst">&amp;</span><span class="variable">#x7528</span>;<span class="subst">&amp;</span><span class="variable">#x5230</span>;<span class="subst">&amp;</span><span class="variable">#x8FD9</span>;<span class="subst">&amp;</span><span class="variable">#x4E2A</span>;<span class="subst">&amp;</span><span class="variable">#x6CE8</span>;<span class="subst">&amp;</span><span class="variable">#x91CA</span>;<span class="subst">--&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/html<span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><p>main.html &#x6784;&#x5EFA;&#x4E4B;&#x540E; </p>
<pre><code><span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!</span>DOCTYPE html<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;html ng<span class="attribute">-app</span><span class="subst">=&amp;</span>quot;app<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;head lang<span class="subst">=&amp;</span>quot;en<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta charset<span class="subst">=&amp;</span>quot;UTF<span class="subst">-</span><span class="number">8</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;viewport<span class="subst">&amp;</span>quot;
        content<span class="subst">=&amp;</span>quot;width<span class="subst">=</span>device<span class="attribute">-width</span>,initial<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,minimum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,maximum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,user<span class="attribute">-scalable</span><span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;format<span class="attribute">-detection</span><span class="subst">&amp;</span>quot; content<span class="subst">=&amp;</span>quot;telephone<span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/base<span class="built_in">.</span>css<span class="subst">?</span><span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/index<span class="built_in">.</span>css<span class="subst">?</span><span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/head<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/libs/libs<span class="built_in">.</span><span class="keyword">min</span><span class="built_in">.</span>js<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>; <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!--&amp;</span><span class="variable">#x6CE8</span>;<span class="subst">&amp;</span><span class="variable">#x610F</span>;<span class="subst">&amp;</span><span class="variable">#x8FD9</span>;<span class="subst">&amp;</span><span class="variable">#x91CC</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x53D8</span>;<span class="subst">&amp;</span><span class="variable">#x5316</span>;<span class="subst">--&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/html<span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><h2 id="&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;">&#x5B57;&#x7B26;&#x4E32;&#x66FF;&#x6362;</h2><p>&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/gulp-replace/" target="_blank" rel="external">gulp-replace</a></p>
<p>&#x5B89;&#x88C5;&#xFF1A; npm install —save-dev gulp-replace<br>&#x53EF;&#x4EE5;&#x66FF;&#x6362;html&#x6216;&#x8005;txt&#x7B49;&#x6587;&#x4EF6;&#x5185;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x4E3A;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x6BCF;&#x6B21;&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x4FEE;&#x6539;&#x5F15;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;</p>
<pre><code>gulp.task<span class="params">(&amp;quot;replace&amp;quot;, function <span class="params">()</span> {
    var date = new Date<span class="params">()</span>.getTime<span class="params">()</span>;
    gulp.src<span class="params">(&amp;apos;../main.html&amp;apos;)</span>
        .pipe<span class="params">(replace<span class="params">(/_VERSION_/gi, date)</span>)</span>
        .pipe<span class="params">(gulp.dest<span class="params">(option.buildPath + &amp;apos;/&amp;apos;)</span>)</span>
})</span>
</code></pre><p>main.html &#x6587;&#x4EF6; </p>
<pre><code><span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!</span>DOCTYPE html<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;html ng<span class="attribute">-app</span><span class="subst">=&amp;</span>quot;app<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;head lang<span class="subst">=&amp;</span>quot;en<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta charset<span class="subst">=&amp;</span>quot;UTF<span class="subst">-</span><span class="number">8</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;viewport<span class="subst">&amp;</span>quot;
        content<span class="subst">=&amp;</span>quot;width<span class="subst">=</span>device<span class="attribute">-width</span>,initial<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,minimum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,maximum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,user<span class="attribute">-scalable</span><span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;format<span class="attribute">-detection</span><span class="subst">&amp;</span>quot; content<span class="subst">=&amp;</span>quot;telephone<span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/base<span class="built_in">.</span>css<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/index<span class="built_in">.</span>css<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/head<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/config/config<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/app<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/service/TrackDataService<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/service/APIService<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/service/DService<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/controllers/indexCtrl<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/directive/lazy<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/directive/slider<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/filter/filters<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span>_VERSION_<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/html<span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><p>&#x6784;&#x5EFA;&#x4E4B;&#x540E;&#xFF0C; <em>VERSION</em> &#x88AB;&#x66FF;&#x6362;&#x4E3A;&#x65F6;&#x95F4;&#x6233;&#x3002; </p>
<pre><code><span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!</span>DOCTYPE html<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;html ng<span class="attribute">-app</span><span class="subst">=&amp;</span>quot;app<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;head lang<span class="subst">=&amp;</span>quot;en<span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta charset<span class="subst">=&amp;</span>quot;UTF<span class="subst">-</span><span class="number">8</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;viewport<span class="subst">&amp;</span>quot;
        content<span class="subst">=&amp;</span>quot;width<span class="subst">=</span>device<span class="attribute">-width</span>,initial<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,minimum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,maximum<span class="attribute">-scale</span><span class="subst">=</span><span class="number">1.0</span>,user<span class="attribute">-scalable</span><span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;meta name<span class="subst">=&amp;</span>quot;format<span class="attribute">-detection</span><span class="subst">&amp;</span>quot; content<span class="subst">=&amp;</span>quot;telephone<span class="subst">=</span>no<span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/base<span class="built_in">.</span>css<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="keyword">link</span> rel<span class="subst">=&amp;</span>quot;stylesheet<span class="subst">&amp;</span>quot; href<span class="subst">=&amp;</span>quot;style/index<span class="built_in">.</span>css<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/head<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/ui<span class="attribute">-view</span><span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/body<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/config/config<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/app<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/service/TrackDataService<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/service/APIService<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/service/DService<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/controllers/indexCtrl<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/directive/lazy<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/directive/slider<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;script src<span class="subst">=&amp;</span>quot;js/filter/filters<span class="built_in">.</span>js<span class="subst">?</span>v<span class="subst">=</span><span class="number">1433405631860</span><span class="subst">&amp;</span>quot;<span class="subst">&amp;</span><span class="literal">gt</span>;<span class="subst">&amp;</span><span class="literal">lt</span>;/script<span class="subst">&amp;</span><span class="literal">gt</span>;
<span class="subst">&amp;</span><span class="literal">lt</span>;/html<span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><p>gulp &#x8FD8;&#x6709;&#x5F88;&#x591A;&#x63D2;&#x4EF6;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x53BB; <a href="http://gulpjs.com/plugins/" target="_blank" rel="external">gulp&#x5B98;&#x7F51;</a> &#x67E5;&#x770B; </p>
<h2 id="&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</h2><p>No Need To Grunt, Take A Gulp Of Fresh Air&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C; grunt &#x4E5F;&#x5E76;&#x975E;&#x4E00;&#x65E0;&#x662F;&#x5904;&#xFF0C;&#x4F46;&#x662F;&#x73B0;&#x5728;&#x5C31;&#x662F;&#x559C;&#x6B22; gulp &#xFF0C;&#x518D;&#x4E5F;&#x56DE;&#x4E0D;&#x53BB;&#x4E86;&#x3002; </p>
<p>&#x6700;&#x540E;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#x6211;&#x505A;&#x7684; gulp &#x6784;&#x5EFA;&#x7684; demo &#xFF1A; <a href="https://github.com/ireeoo/gulp-build-project" target="_blank" rel="external">&#x4F20;&#x9001;&#x95E8;</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p> &#x672C;&#x6587;&#x540C;&#x6B65;&#x81EA;&#x6211;&#x7684;&#x535A;&#x5BA2; <a href="http://www.reeoo.co/archives/gulpjs.html" target="_bla]]>
    </summary>
    
      <category term="Gulp" scheme="http://taojinke.github.io/tags/Gulp/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Learn Node.js with 10 hands-on projects -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2edaba6/"/>
    <id>http://taojinke.github.io/2015/07/03/2edaba6/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.543Z</updated>
    <content type="html"><![CDATA[<p> Node.js is a nimble and surprisingly lightweight answer for those looking to create vibrant website operations and network apps. Right now, <a href="http://stck.so/1JxN65m" target="_blank" rel="external">this hands-on Learn Node.js course</a> will get you up to speed on this powerful programming tool for just $19. </p>
<p>Learners who take advantage of the course&apos;s 18+ hours of instruction time will dig deep into the basics of Node.js, building 10 real-life applications that showcase the power and versatility of using Node.js in your own web development projects.</p>
<p>You&apos;ll explore a handful of programming technologies, including Cassandra, MongoDB, Express Framework, HTML/CSS for front end, Nodejs NPM, NoSQL database, column databases, database ORM and Express Framework, as well as asynchronous programming, Karken layer, Drywall user management, Bcrypt encryption, Socket IO &amp; REST APIs.</p>
<p>You&apos;ll be building advanced, streamlined Node.js-infused apps in no time — and <a href="http://stck.so/1JxN65m" target="_blank" rel="external">at 90% off its regular price</a> , this course is the perfect way to round out your development toolbox. </p>
]]></content>
    <summary type="html">
    <![CDATA[<p> Node.js is a nimble and surprisingly lightweight answer for those looking to create vibrant website operations and network apps. Right n]]>
    </summary>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[What's coming in Meteor 1.2, and beyond -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2ed5b15/"/>
    <id>http://taojinke.github.io/2015/07/03/2ed5b15/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.493Z</updated>
    <content type="html"><![CDATA[<p> Universal JavaScript: Adopting ECMAScript 2015 (aka&#xA0;ES6) </p>
<p><a href="http://www.ecma-international.org/ecma-262/6.0/index.html" target="_blank" rel="external">ECMAScript 2015</a> , also known as ES6, is going to be huge for the JavaScript community and for JavaScript adoption. The new version of the language is &quot;the best JavaScript we&apos;ve ever had,&quot; with classes, block scoping, and many other additions. &#xA0;We&apos;re excited that it will bring many new developers to JavaScript by addressing the objections that developers from other backgrounds sometimes raise. </p>
<p>We think anyone writing an app in JavaScript should be using ES2015. &#xA0;So we are making ES2105&#xA0;the official JavaScript of the Meteor platform. &#xA0;Our goal is to make Meteor the best way to use ES2015, and to provide a seamless ES2015 experience across the whole platform and across the client and the server. &#xA0;Meteor 1.2 will be the first step in making that seamless development experience: we&apos;re adding support for all its features except for modules, automatically transpiling JS files with <a href="https://babeljs.io/" target="_blank" rel="external">Babel</a> so they work on all of Meteor&apos;s supported devices and browsers, and changing all our examples and documentation to ES2015. </p>
<p>We hope that you&apos;ll make the switch to ES2015 today, especially given how easy this new support makes it. It really is a huge improvement on JavaScript. But if you&apos;re not ready to switch, or want to transition your codebase gradually, you&apos;ll have that option. You can write some parts of your app in ES2015, some parts without, and adopt ES2015 at your own pace.</p>
<p>Special thanks to <a href="https://twitter.com/benjamn" target="_blank" rel="external">Ben Newman</a> , Meteor core developer and&#xA0; <a href="http://www.ecma-international.org/memento/TC39.htm" target="_blank" rel="external">Ecma TC39</a> standards committee member, for his leadership in this area. </p>
<p>Reactive Rendering: First-class support for Angular and React </p>
<p>Users expect a reactive and responsive app experience, so it&apos;s not surprising there is significant excitement in reactive rendering frameworks and growing momentum behind options like Angular and React. This is great news for developers using JavaScript, and we want to ensure whether you&apos;re using Blaze, React, or Angular you have a great experience with Meteor.</p>
<p>Meteor goes with Angular/React like peanut butter goes with jelly. Reactive rendering is only part of the solution for a fully reactive app with an &apos;Optimistic UI&apos;. &#xA0;Meteor provides everything else that you need to build a complete app, from secure server logic, to a full-stack reactive data system, to PhoneGap build support. &#xA0;And unlike BaaS options, it&apos;s open source. </p>
<p>So Angular and React are joining Blaze as official, supported view layers for Meteor. In fact, the official Meteor tutorial is already available in bothBlazeand&#xA0;Angulareditions, with React coming soon.&#xA0; For more information on the Angular integration, see the&#xA0;Angular Meteor&#xA0;site.  &#xA0; For more on React + Meteor, see our&#xA0; <a href="http://react-in-meteor.readthedocs.org/en/latest/" target="_blank" rel="external">Getting started with React in Meteor</a>&#xA0;page and Sashko&apos;s&#xA0;forum post.</p>
<p>Developer Experience: Faster and more flexible build pipeline </p>
<p>We are always focused on ensuring a great developer experience, which means having a great toolchain. For 1.2, we&apos;re working on making Meteor&apos;s build toolchain faster and more flexible.</p>
<p>Faster is about supporting bigger, more complicated apps, plus ensuring we can accommodate advanced JS build tasks like ES2015&#xA0;and JSX. And we&apos;re building a sophisticated caching system, so even if there is lots of transpiling happening, Meteor does the minimum number of build steps to get your app up to date.</p>
<p>More flexible is about deeper, richer hooks into the build process for plugin authors. This opens up new opportunities for package authors to extend Meteor, like an awesomely integrated way to do custom Bootstrap builds right from inside your Meteor codebase, or linters (code style checkers) that you drop into your app just by adding a package. It also allows us to fix a long-standing limitation with LESS includes that required an awkward workaround.</p>
<p>This toolchain work isn&apos;t always the most glamorous work, but often has some of the most striking impact in delivering a complete end to end solution that takes care of all of the details and works right out of the box, and the great experience that comes with that.</p>
<h3 id="Timeframe_for_Meteor_1-2">Timeframe for Meteor 1.2</h3><p>Meteor 1.2 will ship later this summer. Along the way, you can see our progress and try the new features by following our PRs on GitHub and checking in on theMeteor forums. </p>
<h3 id="Considering_the_road_ahead">Considering the road ahead</h3><p>Beyond what&apos;s in the box for Meteor 1.2, there are many other areas of focus that we&apos;re investigating.</p>
<h3 id="Integration">Integration</h3><p><strong>SQL. &#xA0;</strong> Official SQL support opens up Meteor to another large population of developers. Expect SQL support to be released incrementally, starting with SQL&#xA0;<code>observeChanges</code>&#xA0;and building up to Meteor&apos;s customary full-stack treatment. </p>
<p> <strong>REST and microservices patterns.</strong>  &#xA0; We&apos;ll be looking into better ways of working with data that is coming out of existing backend services. This may take the form of core features or it may take the form of connector packages and pattern guidance. </p>
<h3 id="Application_Architecture">Application Architecture</h3><p> <strong>Building up the stack.</strong> We&apos;ll be pulling features such as routing into core and taking a more opinionated stance on how to structure large Meteor apps. These opinions will be optional but available for teams that want them. Our approach here is to look at package popularity on Atmosphere and the production codebases of&#xA0; <a href="https://www.meteor.com/services/subscription" target="_blank" rel="external">Meteor Developer Subscription</a> customers, and &quot;pave the cowpaths&quot; &#x2013; while also providing any necessary new features that would make life easier. </p>
<p> <strong>ES15 modules.</strong> We will replace Meteor&apos;s homegrown, pre-ES15 namespacing system with shiny, modern ES15 modules. We&apos;re going to try to do this in a way that preserves Rails-style &quot;do what I mean&quot; automatic symbol resolution for developers that want it, while also allowing strict, explicit control of namespacing in situations where that is preferable. </p>
<p> <strong>Testing improvements.</strong> We plan to move Velocity into core and simplify and streamline it. </p>
<p> <strong>Mobile advances.</strong> There are many exciting possibilities in the mobile build toolchain, from new technologies like React Native to a wide range of tooling opportunities relating to cross-platform building and debugging. </p>
<p>With your help, we&apos;ll have more to say about these over the coming months.</p>
<h3 id="Getting_involved">Getting involved</h3><p>We want to hear from you. &#xA0;Please let us know what you think on theMeteor forumsand chime in on&#xA0; <a href="https://github.com/meteor/meteor/pulls?q=is%3Aopen+is%3Apr" target="_blank" rel="external">Meteor PRs</a> . &#xA0;The best way to explore most new ideas is to publish an&#xA0; <a href="https://atmospherejs.com/" target="_blank" rel="external">Atmosphere package;</a> check in on the forums to let everyone know what you&apos;re writing and see what others think. </p>
]]></content>
    <summary type="html">
    <![CDATA[<p> Universal JavaScript: Adopting ECMAScript 2015 (aka&#xA0;ES6) </p>
<p><a href="http://www.ecma-international.org/ecma-262/6.0/index.html]]>
    </summary>
    
      <category term="Meteor" scheme="http://taojinke.github.io/tags/Meteor/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[nodejs爬虫数据抓取乱码问题总结 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2f0091e/"/>
    <id>http://taojinke.github.io/2015/07/03/2f0091e/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.784Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x4E00;&#x3001;&#x975E;UTF-8&#x9875;&#x9762;&#x5904;&#x7406;">&#x4E00;&#x3001;&#x975E;UTF-8&#x9875;&#x9762;&#x5904;&#x7406;</h2><h2 id="1-&#x80CC;&#x666F;">1.&#x80CC;&#x666F;</h2><p>windows-1251&#x7F16;&#x7801;</p>
<p>&#x6BD4;&#x5982;&#x4FC4;&#x8BED;&#x7F51;&#x7AD9;&#xFF1A; <a href="https://vk.com/cciinniikk" target="_blank" rel="external">https://vk.com/cciinniikk</a></p>
<p>&#x53EF;&#x803B;&#x5730;&#x53D1;&#x73B0;&#x662F;&#x8FD9;&#x79CD;&#x7F16;&#x7801;</p>
<p><img src="http://taojinke.github.io/img/20150703/2efee43.png" alt=""></p>
<p>&#x6240;&#x6709;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x8BF4;&#x7684;&#x662F; Windows-1251&#xFF08;cp1251&#xFF09;&#x7F16;&#x7801;&#x4E0E;utf-8&#x7F16;&#x7801;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x5982; gbk&#x5C31;&#x5148;&#x4E0D;&#x8003;&#x8651;&#x5728;&#x5185;&#x4E86;~</p>
<h2 id="2-&#x89E3;&#x51B3;&#x65B9;&#x6848;">2.&#x89E3;&#x51B3;&#x65B9;&#x6848;</h2><h4 id="1-">1.</h4><h4 id="&#x4F7F;&#x7528;js&#x539F;&#x751F;&#x7F16;&#x7801;&#x8F6C;&#x6362;">&#x4F7F;&#x7528;js&#x539F;&#x751F;&#x7F16;&#x7801;&#x8F6C;&#x6362;</h4><p>&#x4F46;&#x662F;&#x6211;&#x73B0;&#x5728;&#x8FD8;&#x6CA1;&#x627E;&#x5230;&#x529E;&#x6CD5;&#x54C8;..</p>
<p>&#x5982;&#x679C;&#x662F;utf-8&#x8F6C;window-1251&#x8FD8;&#x53EF;&#x4EE5; <a href="http://stackoverflow.com/questions/2696481/encoding-conversation-utf-8-to-1251-in-javascript" target="_blank" rel="external">http://stackoverflow.com/questions/2696481/encoding-conversation-utf-8-to-1251-in-javascript</a></p>
<pre><code><span class="keyword">var</span> DMap = {<span class="number">0</span>: <span class="number">0</span>, <span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="number">3</span>: <span class="number">3</span>, <span class="number">4</span>: <span class="number">4</span>, <span class="number">5</span>: <span class="number">5</span>, <span class="number">6</span>: <span class="number">6</span>, <span class="number">7</span>: <span class="number">7</span>, <span class="number">8</span>: <span class="number">8</span>, <span class="number">9</span>: <span class="number">9</span>, <span class="number">10</span>: <span class="number">10</span>, <span class="number">11</span>: <span class="number">11</span>, <span class="number">12</span>: <span class="number">12</span>, <span class="number">13</span>: <span class="number">13</span>, <span class="number">14</span>: <span class="number">14</span>, <span class="number">15</span>: <span class="number">15</span>, <span class="number">16</span>: <span class="number">16</span>, <span class="number">17</span>: <span class="number">17</span>, <span class="number">18</span>: <span class="number">18</span>, <span class="number">19</span>: <span class="number">19</span>, <span class="number">20</span>: <span class="number">20</span>, <span class="number">21</span>: <span class="number">21</span>, <span class="number">22</span>: <span class="number">22</span>, <span class="number">23</span>: <span class="number">23</span>, <span class="number">24</span>: <span class="number">24</span>, <span class="number">25</span>: <span class="number">25</span>, <span class="number">26</span>: <span class="number">26</span>, <span class="number">27</span>: <span class="number">27</span>, <span class="number">28</span>: <span class="number">28</span>, <span class="number">29</span>: <span class="number">29</span>, <span class="number">30</span>: <span class="number">30</span>, <span class="number">31</span>: <span class="number">31</span>, <span class="number">32</span>: <span class="number">32</span>, <span class="number">33</span>: <span class="number">33</span>, <span class="number">34</span>: <span class="number">34</span>, <span class="number">35</span>: <span class="number">35</span>, <span class="number">36</span>: <span class="number">36</span>, <span class="number">37</span>: <span class="number">37</span>, <span class="number">38</span>: <span class="number">38</span>, <span class="number">39</span>: <span class="number">39</span>, <span class="number">40</span>: <span class="number">40</span>, <span class="number">41</span>: <span class="number">41</span>, <span class="number">42</span>: <span class="number">42</span>, <span class="number">43</span>: <span class="number">43</span>, <span class="number">44</span>: <span class="number">44</span>, <span class="number">45</span>: <span class="number">45</span>, <span class="number">46</span>: <span class="number">46</span>, <span class="number">47</span>: <span class="number">47</span>, <span class="number">48</span>: <span class="number">48</span>, <span class="number">49</span>: <span class="number">49</span>, <span class="number">50</span>: <span class="number">50</span>, <span class="number">51</span>: <span class="number">51</span>, <span class="number">52</span>: <span class="number">52</span>, <span class="number">53</span>: <span class="number">53</span>, <span class="number">54</span>: <span class="number">54</span>, <span class="number">55</span>: <span class="number">55</span>, <span class="number">56</span>: <span class="number">56</span>, <span class="number">57</span>: <span class="number">57</span>, <span class="number">58</span>: <span class="number">58</span>, <span class="number">59</span>: <span class="number">59</span>, <span class="number">60</span>: <span class="number">60</span>, <span class="number">61</span>: <span class="number">61</span>, <span class="number">62</span>: <span class="number">62</span>, <span class="number">63</span>: <span class="number">63</span>, <span class="number">64</span>: <span class="number">64</span>, <span class="number">65</span>: <span class="number">65</span>, <span class="number">66</span>: <span class="number">66</span>, <span class="number">67</span>: <span class="number">67</span>, <span class="number">68</span>: <span class="number">68</span>, <span class="number">69</span>: <span class="number">69</span>, <span class="number">70</span>: <span class="number">70</span>, <span class="number">71</span>: <span class="number">71</span>, <span class="number">72</span>: <span class="number">72</span>, <span class="number">73</span>: <span class="number">73</span>, <span class="number">74</span>: <span class="number">74</span>, <span class="number">75</span>: <span class="number">75</span>, <span class="number">76</span>: <span class="number">76</span>, <span class="number">77</span>: <span class="number">77</span>, <span class="number">78</span>: <span class="number">78</span>, <span class="number">79</span>: <span class="number">79</span>, <span class="number">80</span>: <span class="number">80</span>, <span class="number">81</span>: <span class="number">81</span>, <span class="number">82</span>: <span class="number">82</span>, <span class="number">83</span>: <span class="number">83</span>, <span class="number">84</span>: <span class="number">84</span>, <span class="number">85</span>: <span class="number">85</span>, <span class="number">86</span>: <span class="number">86</span>, <span class="number">87</span>: <span class="number">87</span>, <span class="number">88</span>: <span class="number">88</span>, <span class="number">89</span>: <span class="number">89</span>, <span class="number">90</span>: <span class="number">90</span>, <span class="number">91</span>: <span class="number">91</span>, <span class="number">92</span>: <span class="number">92</span>, <span class="number">93</span>: <span class="number">93</span>, <span class="number">94</span>: <span class="number">94</span>, <span class="number">95</span>: <span class="number">95</span>, <span class="number">96</span>: <span class="number">96</span>, <span class="number">97</span>: <span class="number">97</span>, <span class="number">98</span>: <span class="number">98</span>, <span class="number">99</span>: <span class="number">99</span>, <span class="number">100</span>: <span class="number">100</span>, <span class="number">101</span>: <span class="number">101</span>, <span class="number">102</span>: <span class="number">102</span>, <span class="number">103</span>: <span class="number">103</span>, <span class="number">104</span>: <span class="number">104</span>, <span class="number">105</span>: <span class="number">105</span>, <span class="number">106</span>: <span class="number">106</span>, <span class="number">107</span>: <span class="number">107</span>, <span class="number">108</span>: <span class="number">108</span>, <span class="number">109</span>: <span class="number">109</span>, <span class="number">110</span>: <span class="number">110</span>, <span class="number">111</span>: <span class="number">111</span>, <span class="number">112</span>: <span class="number">112</span>, <span class="number">113</span>: <span class="number">113</span>, <span class="number">114</span>: <span class="number">114</span>, <span class="number">115</span>: <span class="number">115</span>, <span class="number">116</span>: <span class="number">116</span>, <span class="number">117</span>: <span class="number">117</span>, <span class="number">118</span>: <span class="number">118</span>, <span class="number">119</span>: <span class="number">119</span>, <span class="number">120</span>: <span class="number">120</span>, <span class="number">121</span>: <span class="number">121</span>, <span class="number">122</span>: <span class="number">122</span>, <span class="number">123</span>: <span class="number">123</span>, <span class="number">124</span>: <span class="number">124</span>, <span class="number">125</span>: <span class="number">125</span>, <span class="number">126</span>: <span class="number">126</span>, <span class="number">127</span>: <span class="number">127</span>, <span class="number">1027</span>: <span class="number">129</span>, <span class="number">8225</span>: <span class="number">135</span>, <span class="number">1046</span>: <span class="number">198</span>, <span class="number">8222</span>: <span class="number">132</span>, <span class="number">1047</span>: <span class="number">199</span>, <span class="number">1168</span>: <span class="number">165</span>, <span class="number">1048</span>: <span class="number">200</span>, <span class="number">1113</span>: <span class="number">154</span>, <span class="number">1049</span>: <span class="number">201</span>, <span class="number">1045</span>: <span class="number">197</span>, <span class="number">1050</span>: <span class="number">202</span>, <span class="number">1028</span>: <span class="number">170</span>, <span class="number">160</span>: <span class="number">160</span>, <span class="number">1040</span>: <span class="number">192</span>, <span class="number">1051</span>: <span class="number">203</span>, <span class="number">164</span>: <span class="number">164</span>, <span class="number">166</span>: <span class="number">166</span>, <span class="number">167</span>: <span class="number">167</span>, <span class="number">169</span>: <span class="number">169</span>, <span class="number">171</span>: <span class="number">171</span>, <span class="number">172</span>: <span class="number">172</span>, <span class="number">173</span>: <span class="number">173</span>, <span class="number">174</span>: <span class="number">174</span>, <span class="number">1053</span>: <span class="number">205</span>, <span class="number">176</span>: <span class="number">176</span>, <span class="number">177</span>: <span class="number">177</span>, <span class="number">1114</span>: <span class="number">156</span>, <span class="number">181</span>: <span class="number">181</span>, <span class="number">182</span>: <span class="number">182</span>, <span class="number">183</span>: <span class="number">183</span>, <span class="number">8221</span>: <span class="number">148</span>, <span class="number">187</span>: <span class="number">187</span>, <span class="number">1029</span>: <span class="number">189</span>, <span class="number">1056</span>: <span class="number">208</span>, <span class="number">1057</span>: <span class="number">209</span>, <span class="number">1058</span>: <span class="number">210</span>, <span class="number">8364</span>: <span class="number">136</span>, <span class="number">1112</span>: <span class="number">188</span>, <span class="number">1115</span>: <span class="number">158</span>, <span class="number">1059</span>: <span class="number">211</span>, <span class="number">1060</span>: <span class="number">212</span>, <span class="number">1030</span>: <span class="number">178</span>, <span class="number">1061</span>: <span class="number">213</span>, <span class="number">1062</span>: <span class="number">214</span>, <span class="number">1063</span>: <span class="number">215</span>, <span class="number">1116</span>: <span class="number">157</span>, <span class="number">1064</span>: <span class="number">216</span>, <span class="number">1065</span>: <span class="number">217</span>, <span class="number">1031</span>: <span class="number">175</span>, <span class="number">1066</span>: <span class="number">218</span>, <span class="number">1067</span>: <span class="number">219</span>, <span class="number">1068</span>: <span class="number">220</span>, <span class="number">1069</span>: <span class="number">221</span>, <span class="number">1070</span>: <span class="number">222</span>, <span class="number">1032</span>: <span class="number">163</span>, <span class="number">8226</span>: <span class="number">149</span>, <span class="number">1071</span>: <span class="number">223</span>, <span class="number">1072</span>: <span class="number">224</span>, <span class="number">8482</span>: <span class="number">153</span>, <span class="number">1073</span>: <span class="number">225</span>, <span class="number">8240</span>: <span class="number">137</span>, <span class="number">1118</span>: <span class="number">162</span>, <span class="number">1074</span>: <span class="number">226</span>, <span class="number">1110</span>: <span class="number">179</span>, <span class="number">8230</span>: <span class="number">133</span>, <span class="number">1075</span>: <span class="number">227</span>, <span class="number">1033</span>: <span class="number">138</span>, <span class="number">1076</span>: <span class="number">228</span>, <span class="number">1077</span>: <span class="number">229</span>, <span class="number">8211</span>: <span class="number">150</span>, <span class="number">1078</span>: <span class="number">230</span>, <span class="number">1119</span>: <span class="number">159</span>, <span class="number">1079</span>: <span class="number">231</span>, <span class="number">1042</span>: <span class="number">194</span>, <span class="number">1080</span>: <span class="number">232</span>, <span class="number">1034</span>: <span class="number">140</span>, <span class="number">1025</span>: <span class="number">168</span>, <span class="number">1081</span>: <span class="number">233</span>, <span class="number">1082</span>: <span class="number">234</span>, <span class="number">8212</span>: <span class="number">151</span>, <span class="number">1083</span>: <span class="number">235</span>, <span class="number">1169</span>: <span class="number">180</span>, <span class="number">1084</span>: <span class="number">236</span>, <span class="number">1052</span>: <span class="number">204</span>, <span class="number">1085</span>: <span class="number">237</span>, <span class="number">1035</span>: <span class="number">142</span>, <span class="number">1086</span>: <span class="number">238</span>, <span class="number">1087</span>: <span class="number">239</span>, <span class="number">1088</span>: <span class="number">240</span>, <span class="number">1089</span>: <span class="number">241</span>, <span class="number">1090</span>: <span class="number">242</span>, <span class="number">1036</span>: <span class="number">141</span>, <span class="number">1041</span>: <span class="number">193</span>, <span class="number">1091</span>: <span class="number">243</span>, <span class="number">1092</span>: <span class="number">244</span>, <span class="number">8224</span>: <span class="number">134</span>, <span class="number">1093</span>: <span class="number">245</span>, <span class="number">8470</span>: <span class="number">185</span>, <span class="number">1094</span>: <span class="number">246</span>, <span class="number">1054</span>: <span class="number">206</span>, <span class="number">1095</span>: <span class="number">247</span>, <span class="number">1096</span>: <span class="number">248</span>, <span class="number">8249</span>: <span class="number">139</span>, <span class="number">1097</span>: <span class="number">249</span>, <span class="number">1098</span>: <span class="number">250</span>, <span class="number">1044</span>: <span class="number">196</span>, <span class="number">1099</span>: <span class="number">251</span>, <span class="number">1111</span>: <span class="number">191</span>, <span class="number">1055</span>: <span class="number">207</span>, <span class="number">1100</span>: <span class="number">252</span>, <span class="number">1038</span>: <span class="number">161</span>, <span class="number">8220</span>: <span class="number">147</span>, <span class="number">1101</span>: <span class="number">253</span>, <span class="number">8250</span>: <span class="number">155</span>, <span class="number">1102</span>: <span class="number">254</span>, <span class="number">8216</span>: <span class="number">145</span>, <span class="number">1103</span>: <span class="number">255</span>, <span class="number">1043</span>: <span class="number">195</span>, <span class="number">1105</span>: <span class="number">184</span>, <span class="number">1039</span>: <span class="number">143</span>, <span class="number">1026</span>: <span class="number">128</span>, <span class="number">1106</span>: <span class="number">144</span>, <span class="number">8218</span>: <span class="number">130</span>, <span class="number">1107</span>: <span class="number">131</span>, <span class="number">8217</span>: <span class="number">146</span>, <span class="number">1108</span>: <span class="number">186</span>, <span class="number">1109</span>: <span class="number">190</span>}
<span class="function"><span class="keyword">function</span> <span class="title">UnicodeToWin1251</span>(<span class="params">s</span>) </span>{
    <span class="keyword">var</span> L = []
    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&amp;lt;s.length; i++) {
        <span class="keyword">var</span> ord = s.charCodeAt(i)
        <span class="keyword">if</span> (!(ord <span class="keyword">in</span> DMap))
            <span class="keyword">throw</span> &amp;quot;Character &amp;quot;+s.charAt(i)+&amp;quot; isn&amp;apos;t supported by win1251!&amp;quot;
        L.push(<span class="built_in">String</span>.fromCharCode(DMap[ord]))
    }
    <span class="keyword">return</span> L.join(&amp;apos;&amp;apos;)
}
</code></pre><p>&#x55EF;&#xFF0C;&#x8FD9;&#x662F;&#x4E2A;&#x597D;&#x529E;&#x6CD5;&#xFF0C;Dmap&#x50A8;&#x5B58;&#x7684;&#x5176;&#x5B9E;&#x5C31;&#x662F;window-1251&#x7F16;&#x7801;&#x548C;unicode&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB; <a href="http://blog.csdn.net/yao_guet/article/details/7070364" target="_blank" rel="external">http://blog.csdn.net/yao_guet/article/details/7070364</a></p>
<p><img src="http://taojinke.github.io/img/20150703/2efee43.png" alt=""></p>
<p>&#x6240;&#x4EE5;&#x672C;&#x6253;&#x7B97;&#x53EA;&#x8981;&#x53CD;&#x7740;&#x6765;&#x5C31;&#x884C;</p>
<p>&#x4F46;&#x4E00;&#x53CD;&#xFF0C;&#x624D;&#x53D1;&#x73B0; charCodeAt &#x65B9;&#x6CD5;&#x53EA;&#x5BF9; unicode&#x6709;&#x6548;&#xFF0C;&#x5176;&#x4ED6;&#x7F16;&#x7801;&#x662F;&#x5982;&#x4F55;&#x6316;&#x6398;&#x51FA;&#x5176;&#x7801;&#x6BB5;&#xFF1F; &#x56E0;&#x4E3A;&#x7528;&#x7684;&#x662F;nodejs &#x6240;&#x4EE5;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x76F8;&#x5E94;&#x6A21;&#x5757;</p>
<h4 id="2-">2.</h4><p>&#x5B89;&#x88C5;&#x4F7F;&#x7528;nodejs&#x6A21;&#x5757;iconv-lite&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x89C1;&#xA0; <a href="https://www.npmjs.com/package/iconv-lite" target="_blank" rel="external">https://www.npmjs.com/package/iconv-lite</a></p>
<p>&#x6309;&#x7167;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x7C7B;&#x4F3C;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;</p>
<pre><code><span class="built_in">var</span> iconv <span class="subst">=</span> <span class="keyword">require</span>(<span class="subst">&amp;</span>apos;iconv<span class="attribute">-lite</span><span class="subst">&amp;</span>apos;);
<span class="built_in">var</span> Buffer <span class="subst">=</span> <span class="keyword">require</span>(<span class="subst">&amp;</span>apos;buffer<span class="subst">&amp;</span>apos;)<span class="built_in">.</span>Buffer;
<span class="comment">// Convert from an encoded windows-1251 to utf-8</span>
<span class="built_in">var</span> str1 <span class="subst">=</span> <span class="subst">&amp;</span>apos;<span class="subst">&amp;</span><span class="variable">#x446</span>;<span class="subst">&amp;</span><span class="variable">#x435</span>;<span class="subst">&amp;</span><span class="variable">#x43D</span>;<span class="subst">&amp;</span><span class="variable">#x43D</span>;<span class="subst">&amp;</span><span class="variable">#x43E</span>;<span class="subst">&amp;</span><span class="variable">#x441</span>;<span class="subst">&amp;</span><span class="variable">#x442</span>;<span class="subst">&amp;</span><span class="variable">#x438</span>; <span class="subst">&amp;</span><span class="variable">#x43D</span>;<span class="subst">&amp;</span><span class="variable">#x438</span>; <span class="subst">&amp;</span><span class="variable">#x432</span>; <span class="subst">&amp;</span>apos;;
<span class="built_in">var</span> buf <span class="subst">=</span> <span class="literal">new</span> Buffer(str1);
<span class="built_in">var</span> str2 <span class="subst">=</span> iconv<span class="built_in">.</span>decode(buf, <span class="subst">&amp;</span>apos;win1251<span class="subst">&amp;</span>apos;);

console<span class="built_in">.</span><span class="keyword">log</span>(str2);
</code></pre><p><img src="http://taojinke.github.io/img/20150703/2efee43.png" alt=""></p>
<p>&#x4F46;&#x51FA;&#x5947;&#x5730;&#x53D1;&#x73B0;&#xFF0C;&#x62A5;&#x9519;&#x65E0;win1251&#x7F16;&#x7801;&#xFF1F;&#x6539;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x51E0;&#x79CD;&#x4E5F;&#x4E0D;&#x884C;..&#x5B98;&#x65B9;&#x5E94;&#x8BE5;&#x6CA1;&#x9519;&#x5427;..&#x4E8E;&#x662F;&#x4F7F;&#x7528; iconv&#x6A21;&#x5757;</p>
<h4 id="3-">3.</h4><p>&#x5B89;&#x88C5;&#x4F7F;&#x7528;nodejs&#x6A21;&#x5757;iconv&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#x89C1;&#xA0; <a href="https://github.com/bnoordhuis/node-iconv" target="_blank" rel="external">https://github.com/bnoordhuis/node-iconv</a></p>
<p>&#x4E00;&#x822C;&#x7B80;&#x5355;&#x4F7F;&#x7528;&#x540E;&#xFF0C;&#x8FD8;&#x662F;&#x4E71;&#x7801; &#x5F62;&#x5982;&#xFF1A; &#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405; &#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405; &#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;&#x43F;&#x457;&#x405;</p>
<p><a href="http://stackoverflow.com/questions/8693400/nodejs-convertinf-from-windows-1251-to-utf-8" target="_blank" rel="external">http://stackoverflow.com/questions/8693400/nodejs-convertinf-from-windows-1251-to-utf-8</a></p>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x4E3A;&#x8F6C;&#x6210;&#x4E8C;&#x8FDB;&#x5236;&#x8BFB;&#x53D6;&#x6570;&#x636E; encoding&#xFF1A;binary &#xA0;&#xFF08;&#x9ED8;&#x8BA4;&#x7684;encoding&#x662F;utf-8)</p>
<pre><code>request<span class="list">({ 
    uri: website_url,
    method: <span class="keyword">&amp;apos</span><span class="comment">;GET&amp;apos;,</span>
    encoding: <span class="keyword">&amp;apos</span><span class="comment">;binary&amp;apos;</span>
}, function <span class="list">(<span class="keyword">error</span>, response, body)</span> {
    body = new Buffer<span class="list">(<span class="keyword">body</span>, <span class="keyword">&amp;apos</span><span class="comment">;binary&amp;apos;);</span>
    conv = new iconv.Iconv<span class="list">(<span class="keyword">&amp;apos</span><span class="comment">;WINDOWS-1251&amp;apos;, &amp;apos;utf8&amp;apos;);</span>
    body = conv.convert<span class="list">(<span class="keyword">body</span>)</span>.toString<span class="list">()</span><span class="comment">;</span>
    }
})</span><span class="comment">;</span></span></span>
</code></pre><p>—&gt;&#x53E6;&#x5916;&#x8981;&#x8BF4;&#x7684;&#x662F;&#xFF0C;iconv&#x7684;&#x4F7F;&#x7528;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x73AF;&#x5883;&#x4F9D;&#x8D56;&#x7684;&#xFF0C;&#x89C1;&#x5B98;&#x65B9;&#x8BF4;&#x660E;&#xFF1A; <a href="https://github.com/TooTallNate/node-gyp" target="_blank" rel="external">https://github.com/TooTallNate/node-gyp</a></p>
<p><img src="http://taojinke.github.io/img/20150703/2eff0b4.png" alt=""></p>
<p>&#x6240;&#x4EE5;&#xFF1A;</p>
<p>&#x7B2C;&#x4E00;&#x9700;&#x8981; <a href="https://www.python.org/downloads/" target="_blank" rel="external">python</a> &#x5BF9;&#x5E94;&#x7248;&#x672C;(&#x5982;2.7&#xFF09;&#x7684;&#x652F;&#x6301; &#xFF1B; </p>
<p>&#x7B2C;&#x4E8C;&#x9700;&#x8981;&#x7F16;&#x8BD1;&#x5DE5;&#x5177;&#x7684;&#x652F;&#x6301;&#xFF08;windows&#x4E0B;&#x51FA;&#x9519;&#x6700;&#x591A;&#xFF09;</p>
<p>&#x51FA;&#x9519;&#x7C7B;&#x4F3C;&#x8FD9;&#x79CD;</p>
<p><img src="http://taojinke.github.io/img/20150703/2eff0b4.gif" alt=""></p>
<p>node&#xFF0C;&#x5982;&#x65E0;&#x7279;&#x5B9A;&#x7248;&#x672C;&#x6216;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;vs2005&#x7F16;&#x8BD1;&#x5DE5;&#x5177;&#xFF08;&#x6240;&#x4EE5;&#x51FA;&#x9519;&#x63D0;&#x793A;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x4E00;&#x822C;&#x4E3A;&#x6309;&#x7167;vs2005&#x548C;framwork sdk2.0)</p>
<p>&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p>
<p>1.&#x5B89;&#x88C5;visual stutio 2010</p>
<p>2.&#x6307;&#x5B9A;vs&#x7F16;&#x8BD1;&#x5DE5;&#x5177;&#x7248;&#x672C;&#xFF08;&#x5982;&#x679C;&#x662F;vs2012&#x5C31;&#x662F;2012&#xFF09;</p>
<p>&#xFF08;&#x6709;&#x4E9B;&#x65F6;&#x5019;&#x4F1A;&#x81EA;&#x52A8;&#x6307;&#x5B9A;&#xFF0C;&#x6240;&#x6709;&#x4E5F;&#x4E0D;&#x4E00;&#x5B9A;&#x9700;&#x8981;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4; npm config set msvs_version 2010 —global&#xFF09;</p>
<p><img src="http://taojinke.github.io/img/20150703/2eff596.pn" alt=""></p>
<p>3.&#x5982;&#x82E5;&#x8FD8;&#x662F;&#x63D0;&#x793A;&#x627E;&#x4E0D;&#x5230; framwork sdk&#xFF0C;&#x53EF;&#x5C06;&#x5176;&#x5B89;&#x88C5;&#x8DEF;&#x5F84;&#x6DFB;&#x52A0;&#x5230;&#x7CFB;&#x7EDF;&#x73AF;&#x5883;&#x53D8;&#x91CF;path&#x4E2D;</p>
<p>&#xFF08;2010&#x5BF9;&#x5E94;sdk4.0&#x7248;&#x672C;,&#x7C7B;&#x4F3C;&#x7684; 2008 sdj3.5 &#xA0;2012 sdk4.5?&#xFF09;</p>
<p><img src="http://taojinke.github.io/img/20150703/2eff807.pn" alt=""></p>
<h2 id="&#x4E8C;&#x3001;gzip&#x9875;&#x9762;&#x5904;&#x7406;">&#x4E8C;&#x3001;gzip&#x9875;&#x9762;&#x5904;&#x7406;</h2><p>&#x6709;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x6A21;&#x62DF;&#x8BF7;&#x6C42;&#x56DE;&#x6765;&#x5C31;&#x4E71;&#x7801;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x7684;Response&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x6709;Content-Encoding:gzip&#xFF0C;&#x6781;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A;&#x9875;&#x9762;&#x88AB;gzip&#x538B;&#x7F29;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x8BF7;&#x6C42;&#x65F6;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x53C2;&#x6570;</p>
<p>gzip:true</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="&#x4E00;&#x3001;&#x975E;UTF-8&#x9875;&#x9762;&#x5904;&#x7406;">&#x4E00;&#x3001;&#x975E;UTF-8&#x9875;&#x9762;&#x5904;&#x7406;</h2><h2]]>
    </summary>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[奇舞周刊第115期（2015-07-03） -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2ec8b90/"/>
    <id>http://taojinke.github.io/2015/07/03/2ec8b90/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.455Z</updated>
    <content type="html"><![CDATA[<ul>
<li><h2 id="&#x539F;&#x7406;&#x5256;&#x6790;">&#x539F;&#x7406;&#x5256;&#x6790;</h2></li>
<li><h3 id="&#x4E00;&#x5F20;&#x56FE;&#x4E86;&#x89E3;JavaScript&#x4E00;&#x5F20;&#x56FE;&#x5E26;&#x4F60;&#x76F4;&#x89C2;&#x4E86;&#x89E3;JavaScript&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x7ED3;&#x6784;&#x3002;"><a href="https://github.com/coodict/javascript-in-one-pic" target="_blank" rel="external">&#x4E00;&#x5F20;&#x56FE;&#x4E86;&#x89E3;JavaScript</a>&#x4E00;&#x5F20;&#x56FE;&#x5E26;&#x4F60;&#x76F4;&#x89C2;&#x4E86;&#x89E3;JavaScript&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x7ED3;&#x6784;&#x3002;</h3><p>&#x539F;&#x7406;&#x5256;&#x6790;  maxzhang&#x63A8;&#x8350;</p>
</li>
<li><h3 id="&#x5C3E;&#x90E8;&#x8C03;&#x7528;&#x4F18;&#x5316;(Tail_call_optimization)&#x5982;&#x679C;&#x6240;&#x6709;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x5C3E;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x6BCF;&#x6B21;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x8C03;&#x7528;&#x8BB0;&#x5F55;&#x53EA;&#x6709;&#x4E00;&#x9879;&#xFF0C;&#x8FD9;&#x5C06;&#x5927;&#x5927;&#x8282;&#x7701;&#x5185;&#x5B58;&#x3002;&#x8FD9;&#x5C31;&#x662F;&quot;&#x5C3E;&#x8C03;&#x7528;&#x4F18;&#x5316;&quot;&#x7684;&#x610F;&#x4E49;&#x3002;"><a href="http://www.ruanyifeng.com/blog/2015/04/tail-call.html" target="_blank" rel="external">&#x5C3E;&#x90E8;&#x8C03;&#x7528;&#x4F18;&#x5316;(Tail call optimization)</a>&#x5982;&#x679C;&#x6240;&#x6709;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x5C3E;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x6BCF;&#x6B21;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x8C03;&#x7528;&#x8BB0;&#x5F55;&#x53EA;&#x6709;&#x4E00;&#x9879;&#xFF0C;&#x8FD9;&#x5C06;&#x5927;&#x5927;&#x8282;&#x7701;&#x5185;&#x5B58;&#x3002;&#x8FD9;&#x5C31;&#x662F;&quot;&#x5C3E;&#x8C03;&#x7528;&#x4F18;&#x5316;&quot;&#x7684;&#x610F;&#x4E49;&#x3002;</h3><p>es6  &#x539F;&#x7406;&#x5256;&#x6790;  maxzhang&#x63A8;&#x8350;</p>
</li>
<li><h3 id="Reactive_Programming&#x5165;&#x95E8;&#x4ECB;&#x7ECD;&#x9AD8;&#x80FD;&#x9884;&#x8B66;&#xFF0C;RP&#x2014;&#x2014;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x6570;&#x636E;&#x6D41;&#x8FDB;&#x884C;&#x7F16;&#x7A0B;&#xFF0C;&#x672C;&#x6587;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x8BE5;&#x601D;&#x60F3;&#x7684;&#x65B9;&#x65B9;&#x9762;&#x9762;&#x3002;"><a href="https://github.com/benjycui/introrx-chinese-edition?utm_source=tuicool" target="_blank" rel="external">Reactive Programming&#x5165;&#x95E8;&#x4ECB;&#x7ECD;</a>&#x9AD8;&#x80FD;&#x9884;&#x8B66;&#xFF0C;RP&#x2014;&#x2014;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x6570;&#x636E;&#x6D41;&#x8FDB;&#x884C;&#x7F16;&#x7A0B;&#xFF0C;&#x672C;&#x6587;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x8BE5;&#x601D;&#x60F3;&#x7684;&#x65B9;&#x65B9;&#x9762;&#x9762;&#x3002;</h3><p>&#x54CD;&#x5E94;&#x5F0F;&#x7F16;&#x7A0B;  &#x539F;&#x7406;&#x5256;&#x6790;  maxzhang&#x63A8;&#x8350;</p>
</li>
<li><h3 id="HTML&#x4E2D;&#x7684;attribute&#x548C;propertyattribute&#x548C;property&#x662F;&#x5E38;&#x5E38;&#x88AB;&#x5F04;&#x6DF7;&#x7684;&#x4E24;&#x4E2A;&#x6982;&#x5FF5;&#x3002;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E24;&#x8005;&#x662F;&#x7B49;&#x6548;&#x7684;&#x3002;&#x5728;web&#x6807;&#x51C6;&#x4E2D;&#xFF0C;&#x5E38;&#x5E38;&#x4F1A;&#x89C4;&#x5B9A;&#x67D0;attribute&#x201C;&#x53CD;&#x5C04;&#x201D;&#x4E86;&#x540C;&#x540D;&#x7684;property&#x3002;&#x4F46;&#x662F;&#x4F8B;&#x5916;&#x7684;&#x60C5;&#x51B5;&#x8FD8;&#x662F;&#x4E0D;&#x5C11;&#x7684;&#x3002;&#x672C;&#x6587;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x4E24;&#x8005;&#x7684;&#x533A;&#x522B;"><a href="http://weibo.com/p/1001603859879528949427" target="_blank" rel="external">HTML&#x4E2D;&#x7684;attribute&#x548C;property</a>attribute&#x548C;property&#x662F;&#x5E38;&#x5E38;&#x88AB;&#x5F04;&#x6DF7;&#x7684;&#x4E24;&#x4E2A;&#x6982;&#x5FF5;&#x3002;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E24;&#x8005;&#x662F;&#x7B49;&#x6548;&#x7684;&#x3002;&#x5728;web&#x6807;&#x51C6;&#x4E2D;&#xFF0C;&#x5E38;&#x5E38;&#x4F1A;&#x89C4;&#x5B9A;&#x67D0;attribute&#x201C;&#x53CD;&#x5C04;&#x201D;&#x4E86;&#x540C;&#x540D;&#x7684;property&#x3002;&#x4F46;&#x662F;&#x4F8B;&#x5916;&#x7684;&#x60C5;&#x51B5;&#x8FD8;&#x662F;&#x4E0D;&#x5C11;&#x7684;&#x3002;&#x672C;&#x6587;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x4E24;&#x8005;&#x7684;&#x533A;&#x522B;</h3><p>&#x539F;&#x7406;&#x5256;&#x6790;  &#x9ED1;MAO_MS&#x63A8;&#x8350;</p>
</li>
<li><h2 id="&#x5947;&#x821E;&#x63A8;&#x8350;">&#x5947;&#x821E;&#x63A8;&#x8350;</h2></li>
<li><h3 id="NodeJS&#x9519;&#x8BEF;&#x5904;&#x7406;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;NodeJS&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x8BA9;&#x4EBA;&#x75DB;&#x82E6;&#xFF0C;&#x5728;&#x5F88;&#x957F;&#x7684;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x91CC;&#xFF0C;&#x5927;&#x91CF;&#x7684;&#x9519;&#x8BEF;&#x88AB;&#x653E;&#x4EFB;&#x4E0D;&#x7BA1;&#x3002;&#x4F46;&#x662F;&#x8981;&#x60F3;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684;Node-js&#x7A0B;&#x5E8F;&#x5C31;&#x5FC5;&#x987B;&#x6B63;&#x786E;&#x7684;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x5E76;&#x4E0D;&#x96BE;&#x5B66;&#x3002;"><a href="http://code.oneapm.com/nodejs/2015/04/13/nodejs-errorhandling/" target="_blank" rel="external">NodeJS&#x9519;&#x8BEF;&#x5904;&#x7406;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</a>NodeJS&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x8BA9;&#x4EBA;&#x75DB;&#x82E6;&#xFF0C;&#x5728;&#x5F88;&#x957F;&#x7684;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x91CC;&#xFF0C;&#x5927;&#x91CF;&#x7684;&#x9519;&#x8BEF;&#x88AB;&#x653E;&#x4EFB;&#x4E0D;&#x7BA1;&#x3002;&#x4F46;&#x662F;&#x8981;&#x60F3;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684;Node.js&#x7A0B;&#x5E8F;&#x5C31;&#x5FC5;&#x987B;&#x6B63;&#x786E;&#x7684;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x5E76;&#x4E0D;&#x96BE;&#x5B66;&#x3002;</h3><p>nodejs &#x9519;&#x8BEF;&#x5904;&#x7406;  &#x5947;&#x821E;&#x63A8;&#x8350;  &#x96E8;&#x591C;&#x5E26;&#x5200;&#x63A8;&#x8350;</p>
</li>
<li><h3 id="&#x3010;React&#x3011;&#x6700;&#x8FD1;&#x4E00;&#x6B21;&#x9879;&#x76EE;&#x7684;&#x603B;&#x7ED3;&#x514B;&#x519B;&#x5927;&#x5927;&#x7684;&#x9879;&#x76EE;&#x603B;&#x7ED3;&#xFF0C;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x5E94;&#x7528;React&#x5B9E;&#x73B0;&#x6A21;&#x677F;&#x7684;&#x7EC4;&#x4EF6;&#x5316;&#x7EC4;&#x7EC7;&#x548C;React&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x53D1;&#x7684;&#x7279;&#x70B9;&#x3002;&#x90FD;&#x662F;&#x5E72;&#x8D27;"><a href="http://www.w3ctech.com/topic/142" target="_blank" rel="external">&#x3010;React&#x3011;&#x6700;&#x8FD1;&#x4E00;&#x6B21;&#x9879;&#x76EE;&#x7684;&#x603B;&#x7ED3;</a>&#x514B;&#x519B;&#x5927;&#x5927;&#x7684;&#x9879;&#x76EE;&#x603B;&#x7ED3;&#xFF0C;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x7684;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x5E94;&#x7528;React&#x5B9E;&#x73B0;&#x6A21;&#x677F;&#x7684;&#x7EC4;&#x4EF6;&#x5316;&#x7EC4;&#x7EC7;&#x548C;React&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x53D1;&#x7684;&#x7279;&#x70B9;&#x3002;&#x90FD;&#x662F;&#x5E72;&#x8D27;</h3><p>React  &#x5947;&#x821E;&#x63A8;&#x8350;  &#x5C0F;&#x64B8;&#x63A8;&#x8350;</p>
</li>
<li><h3 id="&#x4ECE;Script&#x5230;Code_Blocks&#x3001;Code_Behind&#x5230;MVC&#x3001;MVP&#x3001;MVVM&#x5728;&#x4E0D;&#x540C;&#x7684;&#x9700;&#x6C42;&#x4E0B;&#x5176;&#x5B9E;&#x6709;&#x6700;&#x9002;&#x5408;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x901A;&#x5E38;&#x8BA9;&#x6211;&#x4EEC;&#x7EA0;&#x7ED3;&#x7684;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x54EA;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x66F4;&#x597D;&#xFF0C;&#x800C;&#x662F;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x6761;&#x4EF6;&#x4E0D;&#x591F;&#x591A;&#x3002;"><a href="http://www.cnblogs.com/indream/p/3602348.html" target="_blank" rel="external">&#x4ECE;Script&#x5230;Code Blocks&#x3001;Code Behind&#x5230;MVC&#x3001;MVP&#x3001;MVVM</a>&#x5728;&#x4E0D;&#x540C;&#x7684;&#x9700;&#x6C42;&#x4E0B;&#x5176;&#x5B9E;&#x6709;&#x6700;&#x9002;&#x5408;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x901A;&#x5E38;&#x8BA9;&#x6211;&#x4EEC;&#x7EA0;&#x7ED3;&#x7684;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x54EA;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x66F4;&#x597D;&#xFF0C;&#x800C;&#x662F;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x6761;&#x4EF6;&#x4E0D;&#x591F;&#x591A;&#x3002;</h3><p>&#x5947;&#x821E;&#x63A8;&#x8350;  maxzhang&#x63A8;&#x8350;</p>
</li>
<li><h2 id="web&#x4E0E;&#x539F;&#x751F;">web&#x4E0E;&#x539F;&#x751F;</h2></li>
<li><h3 id="&#x3010;&#x7FFB;&#x8BD1;PPK&#x3011;&#x56DE;&#x5E94;&#xFF1A;web&#x5E94;&#x7528;&#x4E0E;&#x672C;&#x5730;&#x5E94;&#x7528;&#x4E4B;&#x4E89;&#x6709;&#x8BA8;&#x8BBA;&#x624D;&#x4F1A;&#x51FA;&#x73B0;&#x601D;&#x60F3;&#x706B;&#x82B1;&#x7684;&#x78B0;&#x649E;&#xFF0C;&#x624D;&#x4F1A;&#x52A0;&#x5FEB;&#x4FC3;&#x8FDB;&#x884C;&#x4E1A;&#x7684;&#x8FDB;&#x6B65;&#x3002;"><a href="http://www.w3ctech.com/topic/1413" target="_blank" rel="external">&#x3010;&#x7FFB;&#x8BD1;PPK&#x3011;&#x56DE;&#x5E94;&#xFF1A;web&#x5E94;&#x7528;&#x4E0E;&#x672C;&#x5730;&#x5E94;&#x7528;&#x4E4B;&#x4E89;</a>&#x6709;&#x8BA8;&#x8BBA;&#x624D;&#x4F1A;&#x51FA;&#x73B0;&#x601D;&#x60F3;&#x706B;&#x82B1;&#x7684;&#x78B0;&#x649E;&#xFF0C;&#x624D;&#x4F1A;&#x52A0;&#x5FEB;&#x4FC3;&#x8FDB;&#x884C;&#x4E1A;&#x7684;&#x8FDB;&#x6B65;&#x3002;</h3><p>web&#x4E0E;&#x539F;&#x751F;</p>
</li>
<li><h3 id="Web&#x4E0E;&#x539F;&#x751F;&#xFF1A;&#x6211;&#x4EEC;&#x5F97;&#x627F;&#x8BA4;&#x5931;&#x8D25;&#x6211;&#x4EEC;&#x4F01;&#x56FE;&#x8D85;&#x8D8A;&#x539F;&#x751F;&#x7684;&#x6B32;&#x671B;&#xFF0C;&#x5DF2;&#x7ECF;&#x50AC;&#x751F;&#x4E86;&#x8FC7;&#x5206;&#x590D;&#x6742;&#x7684;&#x5DE5;&#x5177;&#x94FE;&#xFF0C;&#x62D6;&#x6162;&#x4E86;&#x672C;&#x5E94;&#x7B80;&#x5355;&#x7684;&#x7F51;&#x7AD9;&#x3002;"><a href="http://www.w3ctech.com/topic/1417" target="_blank" rel="external">Web&#x4E0E;&#x539F;&#x751F;&#xFF1A;&#x6211;&#x4EEC;&#x5F97;&#x627F;&#x8BA4;&#x5931;&#x8D25;</a>&#x6211;&#x4EEC;&#x4F01;&#x56FE;&#x8D85;&#x8D8A;&#x539F;&#x751F;&#x7684;&#x6B32;&#x671B;&#xFF0C;&#x5DF2;&#x7ECF;&#x50AC;&#x751F;&#x4E86;&#x8FC7;&#x5206;&#x590D;&#x6742;&#x7684;&#x5DE5;&#x5177;&#x94FE;&#xFF0C;&#x62D6;&#x6162;&#x4E86;&#x672C;&#x5E94;&#x7B80;&#x5355;&#x7684;&#x7F51;&#x7AD9;&#x3002;</h3><p>web&#x4E0E;&#x539F;&#x751F;</p>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<ul>
<li><h2 id="&#x539F;&#x7406;&#x5256;&#x6790;">&#x539F;&#x7406;&#x5256;&#x6790;</h2></li>
<li><h3 id="&#x4E00;&#x5F20;&#x56FE;&#x4E86;&#]]>
    </summary>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Node.js 1.0可以在GitHub和VMs上使用了 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2ec66f1/"/>
    <id>http://taojinke.github.io/2015/07/03/2ec66f1/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.410Z</updated>
    <content type="html"><![CDATA[<p>[&#x539F;&#x6587;&#x53D1;&#x8868;&#x5730;&#x5740;]<a href="http://blogs.msdn.com/b/visualstudio/archive/2015/04/24/node-js-tools-1-0-on-github-and-vms-available.aspx" target="_blank" rel="external"><strong>Node.js Tools 1.0 on GitHub and VMs Available</strong></a></p>
<p>[&#x539F;&#x6587;&#x53D1;&#x8868;&#x65F6;&#x95F4;]24 Apr 2015 8:30 AM</p>
<p>&#x968F;&#x7740;&#x65B0;&#x4E00;&#x5B63;&#x7684;&#x738B;&#x5EA7;&#x6E38;&#x620F;&#x7684;&#x5F00;&#x59CB;&#xFF0C;&#x4EBA;&#x4EEC;&#x5DF2;&#x7ECF;&#x7FD8;&#x9996;&#x4EE5;&#x5F85;&#x63A5;&#x4E0B;&#x6765;&#x5C06;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x3002;&#x4E0D;&#x50CF;&#x4F3C;&#x4E4E;&#x65E0;&#x5904;&#x53EF;&#x53BB;&#x7684;Khaleesi&#xFF0C;Visual Studio&#x4E2D;&#x7684;Node.js&#x6700;&#x8FD1;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5F88;&#x5927;&#x7684;&#x52A8;&#x4F5C;&#x3002;&#x56DE;&#x987E;&#x8FC7;&#x53BB;&#x7684;&#x4E00;&#x4E2A;&#x6708;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x5E03;&#x4E86;<a href="http://blogs.msdn.com/b/visualstudio/archive/2015/03/25/node-js-tools-1-0-for-visual-studio.aspx" target="_blank" rel="external">Node.js Tools 1.0 for Visual Studio</a>&#xFF0C;&#x52A0;&#x5165;&#x4E86;&#x5728;GitHub&#x5BCC;&#x6709;&#x6D3B;&#x529B;&#x7684;&#x5F00;&#x6E90;&#x793E;&#x533A;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x4E86;VM&#x4EE5;&#x4FBF;&#x6240;&#x6709;&#x4EBA;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x4F7F;&#x7528;NTVS.</p>
<p>1.0&#x53D1;&#x5E03;&#x7248;&#x672C;</p>
<p>&#x6211;&#x4EEC;&#x5728;NTVS&#x4E0A;&#x7684;&#x76EE;&#x6807;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x6211;&#x4EEC;&#x60F3;&#x628A;Visual Studio&#x4E2D;&#x7684;&#x5F3A;&#x5927;&#x4E4B;&#x5904;&#x5E26;&#x5230;Node.js&#x4E2D;&#x4EE5;&#x4FBF;&#x4F60;&#x4EEC;&#x53EF;&#x4EE5;&#x6BD4;&#x4EE5;&#x524D;&#x66F4;&#x5FEB;&#x901F;&#x5730;&#x8FD0;&#x884C;&#xFF0C;&#x8C03;&#x8BD5;&#xFF0C;&#x5E76;&#x4E14;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x7A0B;&#x5E8F;&#x3002;&#x7528;&#x6211;&#x4EEC;&#x7684;<a href="https://www.visualstudio.com/en-us/features/node-js-vs.aspx" target="_blank" rel="external">&#x9AD8;&#x7EA7;&#x7684;debugging&#x548C;profilling&#x4F53;&#x9A8C;</a>(&#x5C31;&#x50CF;&#x5141;&#x8BB8;&#x65AD;&#x70B9;&#x8D70;&#x5F88;&#x957F;&#x7684;&#x8DEF;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7684;&#x751F;&#x4EA7;&#x529B;&#x4E00;&#x6837;&#x7B80;&#x5355;&#xFF01;) &#x5BF9;console.log(&#x2026;)&#x8BF4;&#x518D;&#x89C1;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x5B66;&#x5230;&#x66F4;&#x591A;&#x5173;&#x4E8E;NTVS 1.0&#x7248;&#x672C;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;<a href="https://www.visualstudio.com/features/node-js-vs" target="_blank" rel="external">&#x8BBF;&#x95EE;Node.js Tools for Visual Studio</a>&#x3002;&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x770B;&#x89C6;&#x9891;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;<a href="https://www.youtube.com/watch?v=W_1_UqUDx2s" target="_blank" rel="external">Node.js Tools 1.0 for Visual Studio&#x7EB5;&#x89C8;</a></p>
<p>&#x52A0;&#x5165;GitHub&#x4FF1;&#x4E50;&#x90E8;</p>
<p>&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x542C;&#x4E86;&#x4F60;&#x4EEC;&#x7684;&#x5E76;&#x4E14;&#x5F00;&#x59CB;&#x628A;&#x6211;&#x4EEC;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x8F6C;&#x63A5;&#x5230;<a href="https://github.com/Microsoft/nodejstools" target="_blank" rel="external">GitHub</a>&#x4E0A;&#x3002;&#x6700;&#x7E41;&#x5FD9;&#x7684;JavaScript&#x6210;&#x5458;&#x548C;Node.js&#x793E;&#x533A;&#x5DF2;&#x7ECF;&#x5728;GitHub&#x4E0A;&#x5F00;&#x59CB;&#x4E92;&#x52A8;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x5F88;&#x9AD8;&#x5174;&#x6210;&#x4E3A;&#x8BA8;&#x8BBA;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5F7B;&#x5E95;&#x88AB;&#x6765;&#x81EA;&#x793E;&#x533A;&#x7684;<a href="https://github.com/Microsoft/nodejstools/issues?q=is%3Aissue+is%3Aopen" target="_blank" rel="external">&#x53CD;&#x9988;</a>&#x6240;&#x6FC0;&#x52B1; &#x2013; &#x8C22;&#x8C22;&#x4F60;&#x4EEC;&#x52A0;&#x5165;&#x6211;&#x4EEC;&#x7684;&#x8FD9;&#x4E2A;&#x65C5;&#x7A0B;&#x3002;</p>
<p>&#x8BF7;&#x770B;&#x770B;&#x6211;&#x4EEC;&#x7684;<a href="https://github.com/Microsoft/nodejstools/tree/master/Nodejs/Product/Analysis" target="_blank" rel="external">&#x9759;&#x6001;&#x5206;&#x6790;&#x5F15;&#x64CE;</a>&#xFF0C;<a href="https://github.com/Microsoft/nodejstools/issues?q=is%3Aissue+is%3Aopen" target="_blank" rel="external">&#x586B;&#x5199;&#x95EE;&#x9898;</a>&#xFF0C;&#x548C;<a href="https://github.com/Microsoft/nodejstools/pulls?q=is%3Apr+is%3Aclosed" target="_blank" rel="external">&#x4ED4;&#x7EC6;&#x9605;&#x8BFB;&#x6211;&#x4EEC;&#x7684;&#x8BF7;&#x6C42;</a>&#xFF08;&#x6216;&#x8005;&#x66F4;&#x597D;&#x7684;&#x662F;<a href="https://github.com/Microsoft/nodejstools/labels/easy" target="_blank" rel="external">&#x89E3;&#x51B3;&#x4E00;&#x4E2A;&#x6293;&#x4F4F;&#x7684;&#x95EE;&#x9898;</a>&#xFF09;</p>
<p>&#x8BA9;&#x2019;n&#x2019;&#x4E0E;&#x6211;&#x4EEC;&#x7684;VM&#x76F8;&#x4E92;&#x5339;&#x914D;</p>
<p>&#x4F60;&#x6CA1;&#x6709;Windows&#x5417;&#xFF1F;&#x90A3;&#x4E0D;&#x662F;&#x95EE;&#x9898;&#x3002;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x88AB;&#x6B22;&#x8FCE;&#x6765;&#x73A9;Visual Studio&#x4E0A;&#x7684;Node.js&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5728;Visual Studio Community 2013&#x4E0A;&#x7684;Azure&#x4E0A;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;VM&#x955C;&#x50CF;&#xFF0C;Node.js&#x548C;NTVS&#x90FD;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#xFF0C;&#x5728;&#x8C03;&#x914D;&#x8FD9;&#x4E9B;VM&#x8D44;&#x6E90;&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E76;&#x4E14;&#x628A;&#x5B83;&#x8FD0;&#x884C;&#x5728;NTVS&#x4E0A;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x6211;&#x4EEC;<a href="https://www.visualstudio.com/features/node-js-vs" target="_blank" rel="external">&#x652F;&#x6301;&#x7684;&#x7279;&#x6027;</a>&#x53BB;&#x5B9E;&#x9A8C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x8D26;&#x6237;&#x767B;&#x5F55;&#x5F97;&#x5230;<a href="http://azure.microsoft.com/en-us/" target="_blank" rel="external">Azure&#x95E8;&#x6237;</a>&#xFF08;&#x8BF7;&#x5355;&#x51FB;&#x53F3;&#x4E0A;&#x89D2;&#x4E2D;&#x7684;&#x95E8;&#x6237;&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;<a href="http://azure.microsoft.com/en-us/pricing/free-trial/" target="_blank" rel="external">&#x6CE8;&#x518C;</a>&#x4E00;&#x4E2A;&#x514D;&#x8D39;&#x7684;Azure&#x8D26;&#x6237;&#xFF0C;&#x5728;&#x95E8;&#x6237;&#x7684;&#x5DE6;&#x4FA7;&#x9762;&#x677F;&#x4E2D;&#x9009;&#x62E9;&#x865A;&#x62DF;&#x673A;&#x5E76;&#x4E14;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x9875;&#x9762;&#x5E95;&#x90E8;&#x7684;&#x201C;+New&#x201D;&#x521B;&#x5EFA;&#x4E00;&#x53F0;&#x65B0;&#x7684;&#x865A;&#x62DF;&#x673A;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/2ec4c16.png" alt="Create a new VM"></p>
<p><img src="http://taojinke.github.io/img/20150703/2ec4c16.png" alt="NTVS1.0-VM-Select a VM from the gallery"></p>
<p>&#x5BFC;&#x822A;&#x8FDB;&#x5165;Visual Studio&#x5E76;&#x4E14;&#x9009;&#x62E9;&#x201C;Visual Studio Community 2013 Update 4 with Tools for Node.js&#x201D;&#x3002;&#x73B0;&#x5728;&#x53EA;&#x8981;&#x542F;&#x52A8;Visual Studio &#x90A3;&#x4E48;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x51C6;&#x5907;&#x5F00;&#x59CB;&#x4E86;&#xFF01;</p>
<p><img src="http://taojinke.github.io/img/20150703/2ec4e87.png" alt="NTVS1.0-VM-Choose an image"></p>
<p>&#x770B;&#x770B;&#x865A;&#x62DF;&#x53CA;&#x6587;&#x6863;<a href="http://azure.microsoft.com/en-us/documentation/services/virtual-machines/" target="_blank" rel="external">&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x8C03;&#x914D;&#x4F60;&#x7684;&#x865A;&#x62DF;&#x673A;</a>&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x5728;Azure&#x4E0A;&#x7684;VMs&#x6216;&#x8005;<a href="https://www.visualstudio.com/en-us/features/node-js-vs.aspx" target="_blank" rel="external">&#x4ECA;&#x65E5;&#x4E0B;&#x8F7D;</a>&#x4E0A;&#x7684;&#xFF01;&#x8BA9;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x505A;&#x901A;&#x8FC7;<a href="https://github.com/Microsoft/nodejstools/issues?q=is%3Aissue+is%3Aopen" target="_blank" rel="external">&#x5728;GitHub&#x586B;&#x5199;&#x95EE;&#x9898;</a>&#xFF0C;&#x6216;&#x8005;&#x5230;&#x6211;&#x4EEC;&#x7684;<a href="https://twitter.com/NT4VS" target="_blank" rel="external">Twitter</a>&#x4E0A;&#x9AD8;&#x8BC9;&#x6211;&#x4EEC;.</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>[&#x539F;&#x6587;&#x53D1;&#x8868;&#x5730;&#x5740;]<a href="http://blogs.msdn.com/b/visualstudio/archive/2015/04/24/node-js-tools-1-0-on-g]]>
    </summary>
    
      <category term=".Net" scheme="http://taojinke.github.io/tags/Net/"/>
    
      <category term="GitHub" scheme="http://taojinke.github.io/tags/GitHub/"/>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[面向于初学者的Node.js学习笔记 01 搭建静态服务器 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2ee9395/"/>
    <id>http://taojinke.github.io/2015/07/03/2ee9395/</id>
    <published>2015-07-03T02:09:56.000Z</published>
    <updated>2015-07-03T14:09:56.669Z</updated>
    <content type="html"><![CDATA[<p>&#x8BF7;&#x53C2;&#x8003;&#x4E00;&#x4E0B;&#x535A;&#x4E3B;&#x7684;&#x524D;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;</p>
<p><a href="http://www.cnblogs.com/E-WALKER/p/4607409.html" target="_blank" rel="external">&#x5B8C;&#x5168;&#x9762;&#x5411;&#x4E8E;&#x521D;&#x5B66;&#x8005;&#x7684;Node.js&#x6307;&#x5357;</a></p>
<p><a href="http://www.cnblogs.com/E-WALKER/p/4592115.html" target="_blank" rel="external">Node.Js&#x7684;Module System &#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x5E38;&#x7528; Module</a></p>
<p>&#x672C;&#x6587;&#x5B9E;&#x73B0;&#x7684;&#x6548;&#x679C;&#xFF08;&#x6837;&#x5F0F;&#x5C31;&#x6CA1;&#x505A;&#x4E86;&#xFF0C;&#x5927;&#x5BB6;&#x5C06;&#x5C31;&#x4E0B;&#xFF09;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2ee84ef.png" alt=""></p>
<p><img src="http://taojinke.github.io/img/20150703/2ee84ef.png" alt=""></p>
<p>&#x5217;&#x51FA;&#x7684;&#x4EE3;&#x7801;&#x5747;&#x6D4B;&#x8BD5;&#x53EF;&#x7528;&#xFF0C;&#x5927;&#x5BB6;&#x653E;&#x5FC3;&#x3002;</p>
<h2 id="What_is_static_server?">What is static server?</h2><p>&#x9759;&#x6001;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6709;&#x4E86;&#x5B83;&#x5462;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BA9;&#x5916;&#x90E8;&#x8BBF;&#x95EE;&#x5230;&#x54B1;&#x4EEC;&#x7684;&#x9759;&#x6001;&#x7F51;&#x9875;&#x3002;&#x5728;&#x529F;&#x80FD;&#x4E0A;&#xFF1A;&#x5B83;&#x53EF;&#x4EE5;&#x7ED9;&#x7528;&#x6237;&#x53D1;&#x9001;&#x6587;&#x4EF6;&#xFF08;&#x5982;&#xFF1A;HTML, CSS, Js&#x7B49;&#xFF09;&#x3002;&#x6B63;&#x5982;&#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x6240;&#x8BF4;&#xFF1A;</p>
<p>Node.js&#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x662F;&#x50CF;IIS&#xFF0C;Apache&#x4E00;&#x6837;&#x7684;webserver&#xFF0C; <strong>&#x5B83;&#x662F;&#x4E00;&#x4E2A;JavaScript &#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;</strong> &#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x4EAC;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x3002; </p>
<h2 id="File_stucture">File stucture</h2><p><img src="http://taojinke.github.io/img/20150703/2ee8760.png" alt=""></p>
<p>&#x540E;&#x53F0;&#x76EE;&#x5F55;&#x5EFA;&#x7ACB;&#x5982;&#x4E0B;&#xFF0C;&#x6BD4;&#x8F83;&#x5E38;&#x89C4;&#x3002;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x5B9A;&#x4E49;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#xFF0C;&#x4EE3;&#x7801;&#x4E0A;&#x76F8;&#x5E94;&#x5730;&#x65B9;&#x6539;&#x52A8;&#x4E00;&#x4E0B;&#x5C31;&#x597D;&#x3002; </p>
<h2 id="app-js">app.js</h2><p>&#x672C;&#x6587;&#x7684;&#x91CD;&#x70B9;&#x5728;&#x4E8E;&#x63A5;&#x4E0B;&#x6765;&#x7684;server&#x6A21;&#x5757;&#xFF0C;&#x5C31;&#x4E0D;&#x4ECB;&#x7ECD;app.js&#x91CC;&#x7684;&#x4EE3;&#x7801;&#x5566;&#x3002;(&#x628A;&#x4E3B;&#x7EBF;&#x4EE3;&#x7801;&#x5199;&#x5728;app.js&#x4E2D;&#x662F;&#x4E2A;&#x4E0D;&#x6210;&#x6587;&#x7684;&#x7EA6;&#x5B9A;&#xFF0C;&#x65E0;&#x9700;&#x9075;&#x5B88;&#xFF0C;&#xFFFD;&#xFFFD;&#xFFFD;&#x610F;&#xFF0C;&#x968F;&#x610F;&#x3002;&#x3002;&#x3002;)</p>
<pre><code>var http = require(&amp;apos;http&amp;apos;);
var path = require(&amp;apos;path&amp;apos;);
//&amp;<span class="symbol">#x5F15</span>;&amp;<span class="symbol">#x5165</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x81EA</span>;&amp;<span class="symbol">#x5DF1</span>;&amp;<span class="symbol">#x7F16</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x7684</span>;server&amp;<span class="symbol">#x6A21</span>;&amp;<span class="symbol">#x5757</span>;
var server = require(&amp;apos;./server.js&amp;apos;);
http.createServer(function (request, response) {
    //&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x4E0B</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x505A</span>;&amp;<span class="symbol">#x7B80</span>;&amp;<span class="symbol">#x5355</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8DEF</span>;&amp;<span class="symbol">#x7531</span>;    
    if (request.url == &amp;quot;/&amp;quot;) {
        filePath = path.join(__dirname, &amp;apos;/public/index.html&amp;apos;);
    } else {
        filePath = path.join(__dirname, &amp;apos;/public&amp;apos; + request.url);
    }
    server.serveStatic(response, filePath);
}).listen(/*&amp;<span class="symbol">#x4FA6</span>;&amp;<span class="symbol">#x542C</span>;<span class="number">4000</span>&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x53E3</span>;*/<span class="number">4000</span>, function () { 
    console.log(&amp;quot;<span class="class">Server</span> listening on port <span class="number">4000</span>&amp;quot;);
});
</code></pre><h2 id="MIME">MIME</h2><p>&#x9759;&#x6001;&#x670D;&#x52A1;&#x5668;&#x6709;&#x4E00;&#x4E2A;&#x5FC5;&#x987B;&#x5B9E;&#x73B0;&#x7684;&#x529F;&#x80FD;&#x5373;&#x4E3A;&#x5728;HTTP&#x62A5;&#x6587;&#x4E2D;&#x6307;&#x5B9A;MIME type. <a href="http://en.wikipedia.org/wiki/MIME" target="_blank" rel="external">WIKI MIME</a></p>
<p>&#x6211;&#x4EEC;&#x4F1A;&#x5F15;&#x7528;&#x4E00;&#x4E2A;&#x7B2C;&#x4E09;&#x65B9;&#x7EC4;&#x4EF6;mime&#xFF0C;&#x901A;&#x8FC7;npm&#x5B89;&#x88C5;&#xFF0C;&#x8BE5;&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6587;&#x4EF6;&#x7684;extension name&#x6620;&#x5C04;mime type.</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x8BF7;&#x5728;&#x6839;&#x76EE;&#x5F55;&#x8FD0;&#x884C;&#x4E00;&#x4E0B; npm install mime —save</p>
<h2 id="server-js">server.js</h2><pre><code>var fs = require<span class="params">(&amp;apos;fs&amp;apos;)</span>;
<span class="comment">//provide the ability to derive a mime type based on the filename extension</span>
var mime = require<span class="params">(&amp;apos;mime&amp;apos;)</span>;
var cache = {};
<span class="comment">//&amp;#x8FD9;&amp;#x4E0D;&amp;#x662F;IIS&amp;#xFF0C;Apache&amp;#x6240;&amp;#x4EE5;404&amp;#x5FC5;&amp;#x987B;&amp;#x81EA;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E00;&amp;#x4E0B;&amp;#xFF0C;</span>
<span class="function"><span class="keyword">function</span> <span class="title">send404</span><span class="params">(response)</span> {</span>
    response.writeHead<span class="params">(<span class="number">200</span>, { &amp;quot;Content-Type&amp;quot;: &amp;quot;text/html&amp;quot; })</span>;
    response.write<span class="params">(&amp;quot;&amp;lt;h1&amp;gt;ERROR <span class="number">404</span> FILE NOT FOUND&amp;lt;/h1&amp;gt;&amp;quot;)</span>;
    response.end<span class="params">()</span>;
}
<span class="comment">//&amp;#x5411;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x53D1;&amp;#x9001;&amp;#x6587;&amp;#x4EF6;</span>
<span class="function"><span class="keyword">function</span> <span class="title">sendFile</span><span class="params">(response, filePath, fileContents)</span> {</span>
    response.writeHead<span class="params">(<span class="number">200</span>, { &amp;quot;Content-Type&amp;quot;: mime.lookup<span class="params">(filePath)</span> })</span>;
    response.end<span class="params">(fileContents)</span>;
}
<span class="comment">//&amp;#x8FD9;&amp;#x4E2A;&amp;#x51FD;&amp;#x6570;&amp;#x5BFC;&amp;#x51FA;&amp;#xFF0C;&amp;#x7ED9;&amp;#x4E3B;&amp;#x6A21;&amp;#x5757;&amp;#x4F7F;&amp;#x7528;</span>
<span class="function"><span class="keyword">function</span> <span class="title">serveStatic</span><span class="params">(response, absPath)</span> {</span>
    <span class="keyword">if</span> <span class="params">(cache[absPath])</span> {
        sendFile<span class="params">(response, absPath, cache[absPath])</span>;
    } <span class="keyword">else</span> {
        fs.exists<span class="params">(absPath, function <span class="params">(exists)</span> {
            if <span class="params">(exists)</span> {
                fs.readFile<span class="params">(absPath, function <span class="params">(err, data)</span> {
                    if <span class="params">(err)</span> {
                        send404<span class="params">(response)</span>;
                    } else {
                        cache[absPath] = data;
                        sendFile<span class="params">(response, absPath, data)</span>;
                    }
                })</span>;
            }
            else {
                send404<span class="params">(response)</span>;
            }
        })</span>;
    }
}
exports.serveStatic = serveStatic;
</code></pre><p>&#x89E3;&#x91CA;&#x90E8;&#x5206;&#x5982;&#x6CE8;&#x91CA;&#x3002;&#x3002;&#x3002;&#x81F3;&#x6B64;&#xFF0C;&#x7F16;&#x7801;&#x90E8;&#x5206;&#x5C31;&#x5B8C;&#x5566;&#x3002;</p>
<h2 id="How_to_test">How to test</h2><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;./public &#x4E0B;&#x653E;&#x4E00;&#x4E2A;index.html &#x5185;&#x5BB9;&#x968F;&#x610F;&#x3002;&#x3002;&#x3002;node &#x8DD1;&#x8D77;&#x6765;&#x540E;&#xFF0C;&#x53EA;&#x8981;&#x8F93;&#x5165; <a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a> &#x8FD4;&#x56DE;&#x7684;&#x662F;&#x5B83;&#xFF0C;&#x8F93;&#x5165;<a href="http://localhost:4000/XXX&amp;#xA0" target="_blank" rel="external">http://localhost:4000/XXX&amp;#xA0</a>; &#x8FD4;&#x56DE;&#x7684;&#x662F;404&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x9759;&#x6001;&#x670D;&#x52A1;&#x5668;&#x5C31;&#x642D;&#x8D77;&#x6765;&#x4E86;&#x3002;</p>
<h2 id="Summary">Summary</h2><p>&#x8FD9;&#x4E2A;DEMO&#x8FC7;&#x4E8E;&#x7B80;&#x5355;&#xFF0C;&#x5E94;&#x8BE5;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x5927;&#x5BB6;&#x80C3;&#x53E3;&#x3002;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;&#x4F1A;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x642D;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x7684;&#x7F51;&#x7AD9;&#xFF08;&#x4EE5;Restful service&#x4E3A;&#x4F8B;&#xFF09;&#x3002;</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>&#x8BF7;&#x53C2;&#x8003;&#x4E00;&#x4E0B;&#x535A;&#x4E3B;&#x7684;&#x524D;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;</p>
<p><a href="http://w]]>
    </summary>
    
      <category term="Node.js" scheme="http://taojinke.github.io/tags/Node-js/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[【转】 Key/Value之王Memcached初探：三、Memcached解决Session的分布式存储场景的应用 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/279241b/"/>
    <id>http://taojinke.github.io/2015/07/03/279241b/</id>
    <published>2015-07-03T02:09:44.000Z</published>
    <updated>2015-07-03T14:09:44.385Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x4E00;&#x3001;&#x9AD8;&#x53EF;&#x7528;&#x7684;Session&#x670D;&#x52A1;&#x5668;&#x573A;&#x666F;&#x7B80;&#x4ECB;">&#x4E00;&#x3001;&#x9AD8;&#x53EF;&#x7528;&#x7684;Session&#x670D;&#x52A1;&#x5668;&#x573A;&#x666F;&#x7B80;&#x4ECB;</h2><h2 id="1-1_&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65E0;&#x72B6;&#x6001;&#x7279;&#x6027;">1.1 &#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65E0;&#x72B6;&#x6001;&#x7279;&#x6027;</h2><p>&#x5E94;&#x7528;&#x5C42;&#x670D;&#x52A1;&#x5668;&#xFF08;&#x8FD9;&#x91CC;&#x4E00;&#x822C;&#x6307;Web&#x670D;&#x52A1;&#x5668;&#xFF09;&#x5904;&#x7406;&#x7F51;&#x7AD9;&#x5E94;&#x7528;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;&#x5E94;&#x7528;&#x7684;&#x4E00;&#x4E2A;&#x6700;&#x663E;&#x8457;&#x7684;&#x7279;&#x70B9;&#x662F;&#xFF1A; <strong>&#x5E94;&#x7528;&#x7684;&#x65E0;&#x72B6;&#x6001;&#x6027;</strong> &#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/2781c6f.png" alt=""></p>
<p>PS&#xFF1A;&#x63D0;&#x5230;&#x65E0;&#x72B6;&#x6001;&#x7279;&#x6027;&#xFF0C;&#x4E0D;&#x5F97;&#x4E0D;&#x8BF4;&#x4E0B; <strong>Http&#x534F;&#x8BAE;</strong> &#x3002;&#x6211;&#x4EEC;&#x5E38;&#x5E38;&#x542C;&#x5230;&#x8BF4;&#xFF0C;Http&#x662F;&#x4E00;&#x4E2A;&#x65E0;&#x72B6;&#x6001;&#x534F;&#x8BAE;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x7684;&#x8FDE;&#x7EED;&#x4E24;&#x4E2A;&#x8BF7;&#x6C42;&#x4E92;&#x76F8;&#x4E0D;&#x4E86;&#x89E3;&#xFF0C;&#x4ED6;&#x4EEC;&#x7531;&#x6700;&#x65B0;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x73AF;&#x5883;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x9664;&#x4E86;&#x5E94;&#x7528;&#x672C;&#x8EAB;&#x53EF;&#x80FD;&#x5DF2;&#x7ECF;&#x5B58;&#x50A8;&#x5728;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x4FE1;&#x606F;&#x5916;&#xFF0C;&#x8BE5;&#x73AF;&#x5883;&#x4E0D;&#x4FDD;&#x5B58;&#x4E0E;&#x4F1A;&#x8BDD;&#x6709;&#x5173;&#x7684;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;&#x3002;&#x4E4B;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;ASP.NET WebForm&#x5F00;&#x53D1;&#x4E2D;&#x4F1A;&#x611F;&#x89C9;&#x4E0D;&#x5230;Http&#x7684;&#x65E0;&#x72B6;&#x6001;&#x7279;&#x6027;&#xFF0C;&#x5B8C;&#x5168;&#x662F;&#x56E0;&#x4E3A;Microsoft&#x5E2E;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86; <strong>ViewState</strong> &#xFF0C;&#x5B83;&#x662F;ASP.NET WebForm&#x4E2D;&#x4FDD;&#x5B58;&#x9875;&#x9762;&#x4FE1;&#x606F;&#x7684;&#x57FA;&#x672C;&#x5355;&#x4F4D;&#xFF0C;&#x672C;&#x8D28;&#x662F;&#x4E00;&#x4E2A;HTML&#x4E2D;&#x7684;&#x9690;&#x85CF;&#x57DF;&#xFF0C;&#x56DE;&#x8C03;&#x65F6;&#x4F1A;&#x5C06;&#x8FD9;&#x4E2A;&#x9690;&#x85CF;&#x57DF;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x63D0;&#x4EA4;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x3002;&#xA0; </p>
<p>&#x5728;&#x5F88;&#x591A;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x7528;&#x6237;&#x90FD;&#x9700;&#x8981;&#x548C;&#x6211;&#x4EEC;&#x7684;&#x7F51;&#x7AD9;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x591A;&#x6B21;&#x7684;&#x4FE1;&#x606F;&#x4EA4;&#x4E92;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFFFD;&#xFFFD;&#xFFFD;&#x514B;&#x670D;&#x65E0;&#x72B6;&#x6001;&#x7279;&#x6027;&#x6240;&#x5E26;&#x6765;&#x7684;&#x56F0;&#x5883;&#x3002;&#x8FD8;&#x597D;&#xFF0C;&#x5728;&#x5DE8;&#x4EBA;&#x7684;&#x80A9;&#x8180;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x90A3;&#x5C31;&#x662F; <strong>&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x7684;Cookie</strong> &#x548C; <strong>&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;Session</strong> &#x3002;&#x5728;&#x4E00;&#x822C;&#x7684;&#x5355;&#x673A;&#x5F00;&#x53D1;&#x4E2D;&#xFF08;&#x8FD9;&#x91CC;&#x4E00;&#x822C;&#x662F;&#x6307;&#x53EA;&#x6709;&#x4E00;&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x60C5;&#x51B5;&#xFF09;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x4F7F;&#x7528;Session&#x6765;&#x5B58;&#x50A8;&#x7528;&#x6237;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF08;&#x4E00;&#x822C;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#xFF09;&#xFF0C;&#x5728;&#x591A;&#x6570;&#x7684;&#x7BA1;&#x7406;&#x4FE1;&#x606F;&#x7CFB;&#x7EDF;&#x5F00;&#x53D1;&#x4E2D;&#xFF08;&#x6BD5;&#x7ADF;&#x5185;&#x90E8;&#x7CFB;&#x7EDF;&#x7528;&#x6237;&#x91CF;&#x4E0D;&#x591A;&#xFF0C;&#x4E00;&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#x65E2;&#x63D0;&#x4F9B;Web&#x670D;&#x52A1;&#x53C8;&#x5B58;&#x50A8;Session&#x5BF9;&#x8C61;&#x5185;&#x5B58;&#x8FD8;&#x7B97;&#x662F;&#x591F;&#x7528;&#x7684;&#xFF09;&#x8FD9;&#x662F;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#x3002; </p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x5927;&#x7528;&#x6237;&#x91CF;&#x4E0B;&#xFF0C;&#x5355;&#x673A;&#x7248;&#x7684;Session&#x5C31;&#x4F1A;&#x663E;&#x5F97;&#x6548;&#x7387;&#x4F4E;&#x4E0B;&#xFF0C;&#x751A;&#x81F3;&#x4F1A;&#x62D6;&#x7D2F;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x6027;&#x80FD;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#xFF1A;&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x7684;Http&#x8BF7;&#x6C42;&#x53D1;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x540E;&#xFF0C;&#x6BCF;&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x670D;&#x52A1;&#x5668;&#x8F6F;&#x4EF6;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;IIS&#x3001;Tomcat&#x7B49;&#xFF09;&#x90FD;&#x4F1A;&#x4E3A;&#x8BE5;&#x8BF7;&#x6C42;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6765;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x548C;&#x54CD;&#x5E94;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x6BD5;&#x7ADF;&#x662F;&#x6709;&#x9650;&#x7684;&#xFF08;&#x8FD9;&#x4E2A;&#x6839;&#x636E;&#x670D;&#x52A1;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x800C;&#x5B9A;&#xFF0C;&#x4F8B;&#x5982;CPU&#x4E2D;i3&#x3001;i5&#x548C;i7&#x7C7B;&#x578B;&#x5206;&#x522B;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x90FD;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF09;&#xFF0C;&#x5F53;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x6BB5;&#x51FA;&#x73B0;&#x9AD8;&#x5E76;&#x53D1;&#x8BF7;&#x6C42;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF08;&#x6BD4;&#x5982;&#xFF1A;&#x7F51;&#x8D2D;&#x79D2;&#x6740;&#x7CFB;&#x7EDF;&#x4E2D;&#x7ECF;&#x5E38;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x4F1A;&#x51FA;&#x73B0;&#x6D77;&#x91CF;&#x7684;&#x5E76;&#x53D1;&#x6570;&#xFF09;&#xFF0C;&#x90A3;&#x8FD9;&#x53F0;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x4F1A;&#x63A5;&#x6536;&#x524D;&#x6240;&#x672A;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x8D1F;&#x8F7D;&#xFF0C;&#x6700;&#x7EC8;&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x4E3A;&#x627F;&#x53D7;&#x4E0D;&#x4E86;&#x9AD8;&#x8D1F;&#x8F7D;&#x800C;&#x5BFC;&#x81F4;&#x5B95;&#x673A;&#xFF0C;&#x7F51;&#x7AD9;&#x4E0D;&#x5F97;&#x4E0D;&#x505C;&#x6B62;&#x670D;&#x52A1;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/2781ee0.jpg" alt=""></p>
<p>&#x8FD9;&#x65F6;&#xFF0C;&#x53C8;&#x60F3;&#x8D77;&#x4E86;&#x90A3;&#x53E5;&#x8BDD;&#xFF1A; &#x5F53;&#x4E00;&#x5934;&#x725B;&#x62C9;&#x4E0D;&#x52A8;&#x8F66;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x8981;&#x53BB;&#x5BFB;&#x627E;&#x4E00;&#x5934;&#x66F4;&#x5F3A;&#x58EE;&#x7684;&#x725B;&#xFF0C;&#x800C;&#x662F;&#x7528;&#x4E24;&#x5934;&#x725B;&#x6765;&#x62C9;&#x8F66; &#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x7684;&#x6280;&#x672F;&#x6765;&#x5BF9;Web&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x6539;&#x8FDB;&#xFF0C;&#x589E;&#x52A0;N&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#x90E8;&#x7F72;&#x76F8;&#x540C;&#x7684;Web&#x5E94;&#x7528;&#x6784;&#x6210;Web&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x6765;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF0C;&#x901A;&#x8FC7;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x8BBE;&#x5907;&#x6216;&#x8F6F;&#x4EF6;&#x5C06;&#x6D77;&#x91CF;&#x7684;&#x5E76;&#x53D1;&#x8BF7;&#x6C42;&#x6570;&#x5E73;&#x5747;&#x5730;&#x5206;&#x644A;&#x5230;&#x6BCF;&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&#x5047;&#x8BBE;&#x67D0;&#x7CFB;&#x7EDF;&#x5728;&#x4FC3;&#x9500;&#x6D3B;&#x52A8;&#x671F;&#x95F4;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x6D8C;&#x5165;&#x4E86;10&#x4E07;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#x6709;5&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF0C;&#x8FD9;&#x65F6;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x8BBE;&#x5907;&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;10&#x4E07;&#x8BF7;&#x6C42;&#x901A;&#x8FC7;&#x67D0;&#x79CD;&#x7B97;&#x6CD5;&#x8F83;&#x4E3A;&#x5747;&#x8861;&#x5730;&#x5206;&#x914D;&#x7ED9;&#x5176;&#xFFFD;&#xFFFD;&#xFFFD;&#x7684;Web&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5E73;&#x5747;&#x4E0B;&#x6765;&#x6BCF;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x6700;&#x591A;&#x5C31;&#x53EA;&#x627F;&#x62C5;2&#x4E07;&#x4E2A;&#x8BF7;&#x6C42;&#x3002; </p>
<p>&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#xFF0C;&#x5DF2;&#x7ECF;&#x8F83;&#x597D;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x8BF7;&#x6C42;&#x8D1F;&#x8F7D;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x65F6;&#x65B0;&#x7684;&#x95EE;&#x9898;&#x53C8;&#x6765;&#x4E86;&#xFF1A;&#x7531;&#x4E8E;Session&#x9ED8;&#x8BA4;&#x662F;&#x5C5E;&#x4E8E;&#x8FDB;&#x7A0B;&#x5185;&#xFF08;InProc&#xFF09;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5B83;&#x662F;&#x5B58;&#x50A8;&#x5728;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x5185;&#x5B58;&#x91CC;&#x8FB9;&#x7684;&#x3002;&#x5F53;&#x6784;&#x5EFA;&#x597D;&#x96C6;&#x7FA4;&#x4E4B;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x7684;Session&#x4F1A;&#x5EFA;&#x7ACB;&#x5728;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x8BBE;&#x5907;&#x6240;&#x5206;&#x914D;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#x91CC;&#x8FB9;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x7528;&#x6237;&#x4E0B;&#x4E00;&#x6B21;&#x8BBF;&#x95EE;&#x6216;&#x8005;&#x8BBF;&#x95EE;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x5B50;&#x7CFB;&#x7EDF;&#xFF08;&#x6BD4;&#x5982;&#xFF1A;&#x6211;&#x9996;&#x5148;&#x5728;&#x767E;&#x5EA6;&#x767E;&#x79D1;&#x8FDB;&#x884C;&#x767B;&#x5F55;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x8BBF;&#x95EE;&#x767E;&#x5EA6;&#x8D34;&#x5427;&#xFF09;&#xFF0C;&#x7531;&#x4E8E;Session&#x4F1A;&#x8BDD;&#x8FD8;&#x5B58;&#x50A8;&#x5728;&#x4E0A;&#x4E00;&#x6B21;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;Web&#x670D;&#x52A1;&#x5668;&#x91CC;&#x8FB9;&#xFF0C;&#x7CFB;&#x7EDF;&#x6821;&#x9A8C;&#x89C4;&#x5219;&#xFF08;&#x73B0;&#x5728;&#x8FD9;&#x53F0;Web&#x670D;&#x52A1;&#x5668;&#x91CC;&#x8FB9;&#x68C0;&#x6D4B;&#x5230;&#x6CA1;&#x6709;&#x8BE5;&#x7528;&#x6237;&#x7684;Session&#xFF09;&#x4F1A;&#x9020;&#x6210;&#x7528;&#x6237;&#x7684;&#x91CD;&#x590D;&#x767B;&#x5F55;&#xFF08;&#x6BD4;&#x5982;&#xFF1A;&#x90FD;&#x662F;&#x5728;&#x767E;&#x5EA6;&#x7684;&#x7F51;&#x9875;&#xFF0C;&#x5B83;&#x5374;&#x8BA9;&#x4F60;&#x767B;&#x5F55;&#x597D;&#x51E0;&#x6B21;&#xFF0C;&#x4F60;&#x723D;&#x5417;&#xFF1F;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x4E0D;&#x723D;&#x5427;&#xFF09;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x89E3;&#x51B3;Web&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x7684;Session&#x7BA1;&#x7406;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x770B;&#x770B;&#x5982;&#x4F55;&#x8FDB;&#x884C;Web&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x7684;Session&#x7BA1;&#x7406;&#x3002;</p>
<h2 id="1-2_&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x7684;Session&#x7BA1;&#x7406;">1.2 &#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x7684;Session&#x7BA1;&#x7406;</h2><p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6765;&#x770B;&#x770B;&#x5728;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;Session&#x7BA1;&#x7406;&#x7684;&#x51E0;&#x79CD;&#x5E38;&#x89C1;&#x624B;&#x6BB5;&#xFF1A;</p>
<p>&#x2460;Session&#x590D;&#x5236;&#xFF1A;&#x8BE5;&#x65B9;&#x6848;&#x7B80;&#x5355;&#x6613;&#x884C;&#xFF0C;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x51E0;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x540C;&#x6B65;Session&#x5BF9;&#x8C61;&#xFF0C;&#x4EFB;&#x4F55;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5B95;&#x673A;&#x90FD;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;Session&#x5BF9;&#x8C61;&#x7684;&#x4E22;&#x5931;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E5F;&#x53EA;&#x9700;&#x8981;&#x4ECE;&#x672C;&#x673A;&#x83B7;&#x53D6;&#x5373;&#x53EF;&#x3002;&#x4F46;&#x662F;&#xFF0C; &#x8BE5;&#x65B9;&#x6848;&#x53EA;&#x9002;&#x5408;&#x96C6;&#x7FA4;&#x89C4;&#x6A21;&#x8F83;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x3002;&#x5F53;&#x89C4;&#x6A21;&#x8F83;&#x5927;&#x65F6;&#xFF0C;&#x5927;&#x91CF;&#x7684;Session&#x590D;&#x5236;&#x64CD;&#x4F5C;&#x4F1A;&#x5360;&#x7528;&#x670D;&#x52A1;&#x5668;&#x548C;&#x7F51;&#x7EDC;&#x7684;&#x5927;&#x91CF;&#x8D44;&#x6E90;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E0D;&#x582A;&#x91CD;&#x8D1F; &#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/2781ee0.jpg" alt=""></p>
<p>&#x2461;Session&#x7ED1;&#x5B9A;&#xFF1A;&#x5229;&#x7528;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684; <strong>&#x6E90;&#x5730;&#x5740;Hash</strong> &#x7B97;&#x6CD5;&#xFF0C;&#x603B;&#x662F;&#x5C06;&#x6E90;&#x4E8E;&#x540C;&#x4E00;IP&#x5730;&#x5740;&#x7684;&#x8BF7;&#x6C42;&#x5206;&#x53D1;&#x5230;&#x540C;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5728;&#x6574;&#x4E2A;&#x4F1A;&#x8BDD;&#x671F;&#x95F4;&#xFF0C;&#x7528;&#x6237;&#x6240;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x5728;&#x540C;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5373;Session&#x7ED1;&#x5B9A;&#x5728;&#x67D0;&#x53F0;&#x7279;&#x5B9A;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x4FDD;&#x8BC1;Session&#x603B;&#x80FD;&#x5728;&#x8FD9;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x83B7;&#x53D6;&#x3002;&#xFF08;&#x8FD9;&#x79CD;&#x65B9;&#x6848;&#x53C8;&#x53EB;&#x505A; <strong>&#x4F1A;&#x8BDD;&#x7C98;&#x6EDE;</strong> &#xFF09;&#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/2782151.jpg" alt=""></p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x6848; <strong><em>&#x4E0D;&#x7B26;&#x5408;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x9700;&#x6C42;</em></strong> &#x3002;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x67D0;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5B95;&#x673A;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x673A;&#x5668;&#x4E0A;&#x5F97;Session&#x4E5F;&#x5C31;&#x4E0D;&#x590D;&#x5B58;&#x5728;&#x4E86;&#xFF0C;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x5207;&#x6362;&#x5230;&#x5176;&#x4ED6;&#x673A;&#x5668;&#x540E;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;Session&#x800C;&#x65E0;&#x6CD5;&#x5B8C;&#x6210;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F88;&#x5C11;&#x6709;&#x7F51;&#x7AD9;&#x91C7;&#x7528;&#x6B64;&#x65B9;&#x6848;&#x8FDB;&#x884C;Session&#x7BA1;&#x7406;&#x3002; </p>
<p>&#x2462;Cookie&#x8BB0;&#x5F55;Session&#xFF1A;&#x5229;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x652F;&#x6301;&#x7684;Cookie&#x8BB0;&#x5F55;Session&#x7B80;&#x5355;&#x6613;&#x884C;&#xFF0C;&#x53EF;&#x7528;&#x6027;&#x9AD8;&#xFF0C;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7EBF;&#x6027;&#x4F38;&#x7F29;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8BB8;&#x591A;&#x7F51;&#x7AD9;&#x90FD;&#x6216;&#x591A;&#x6216;&#x5C11;&#x5730;&#x4F7F;&#x7528;&#x4E86;Cookie&#x6765;&#x8BB0;&#x5F55;Session&#x3002;&#x4F46;&#x662F;Cookie&#x8BB0;&#x5F55;Session&#x6709;&#x7F3A;&#x70B9;&#xFF1A;&#x6BD4;&#x5982;&#x53D7;Cookie&#x5927;&#x5C0F;&#x9650;&#x5236;&#x3001;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x54CD;&#x5E94;&#x90FD;&#x8981;&#x4F20;&#x8F93;Cookie&#x5F71;&#x54CD;&#x6027;&#x80FD;&#x3001;&#x7528;&#x6237;&#x5173;&#x95ED;&#x4E86;Cookie&#x4F1A;&#x9020;&#x6210;&#x8BBF;&#x95EE;&#x4E0D;&#x6B63;&#x5E38;&#x7B49;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/27823c2.jpg" alt=""></p>
<p>&#x2463; <strong>Session&#x670D;&#x52A1;&#x5668;</strong> &#xFF1A;&#x5229;&#x7528;&#x72EC;&#x7ACB;&#x90E8;&#x7F72;&#x7684;Session&#x670D;&#x52A1;&#x5668;&#xFF08;&#x96C6;&#x7FA4;&#xFF09;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;Session&#xFF0C;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6BCF;&#x6B21;&#x8BFB;&#x5199;Session&#x65F6;&#xFF0C;&#x90FD;&#x8BBF;&#x95EE;Session&#x670D;&#x52A1;&#x5668;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x6848; <strong>&#x5B9E;&#x9645;&#x4E0A;&#x662F; &#x5C06;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;&#x72B6;&#x6001;&#x5206;&#x79BB;</strong> &#xFF0C;&#x5206;&#x4E3A; <strong>&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;</strong> &#x548C; <strong>&#x6709;&#x72B6;&#x6001;&#x7684;Session&#x670D;&#x52A1;&#x5668;</strong> &#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/2782633.jpg" alt=""></p>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x770B;&#xFF0C;&#x5404;&#x6709;&#x5229;&#x5F0A;&#xFF0C;&#x4F46;Session&#x670D;&#x52A1;&#x5668;&#x662F;&#x6700;&#x7B26;&#x5408;&#x9AD8;&#x53EF;&#x7528;&#x9700;&#x6C42;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x4E5F;&#x662F;&#x4F01;&#x4E1A;&#x4E2D;&#x7ECF;&#x5E38;&#x7528;&#x5230;&#x7684;&#x65B9;&#x6848;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x5BF9;&#x4E8E;&#x6709;&#x72B6;&#x6001;&#x7684;Session&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E00;&#x79CD;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5229;&#x7528; <strong>&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;</strong> &#xFF08;&#x5982;Memcached&#x3001;Redis&#x7B49;&#xFF0C;&#x6709;&#x5173;Redis&#x7684;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;&#x6211;&#x7684;&#x535A;&#x6587;&#xFF1A; <a href="http://www.cnblogs.com/edisonchou/p/3821228.html" target="_blank" rel="external">NoSQL&#x521D;&#x63A2;&#x4E4B;&#x4EBA;&#x4EBA;&#x90FD;&#x7231;Redis</a> &#xFF09;&#x3001; <strong>&#x6570;&#x636E;&#x5E93;</strong> &#x7B49;&#xFF0C;&#x5728;&#x8FD9;&#x4E9B;&#x4EA7;&#x54C1;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x4F7F;&#x5176;&#x7B26;&#x5408;Session&#x7684;&#x5B58;&#x50A8;&#x548C;&#x8BBF;&#x95EE;&#x8981;&#x6C42;&#x3002;&#x7EFC;&#x5408;&#x4E0A;&#x8FF0;&#x4ECB;&#x7ECD;&#xFF0C;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x5C31;&#x91C7;&#x7528;Memcached&#x6765;&#x6784;&#x5EFA;&#x6211;&#x4EEC;&#x7684;Session&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x89E3;&#x51B3;Web&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x7684;Session&#x7684;&#x5171;&#x4EAB;&#x8BBF;&#x95EE;&#x3002; </p>
<p>PS&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x91C7;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x65B9;&#x6848;&#x800C;&#x4E0D;&#x91C7;&#x7528;&#x6570;&#x636E;&#x5E93;&#x6765;&#x5B58;&#x50A8;Session&#xFF1F;&#x8FD9;&#x4E2A;&#x5C31;&#x5F97;&#x8981;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x7684;&#x6027;&#x80FD;&#x74F6;&#x9888;&#x4E86;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x78C1;&#x76D8;IO&#x8BFB;&#x5199;&#x7684;&#x901F;&#x5EA6;&#x662F;&#x6700;&#x6162;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x6570;&#x636E;&#x5176;&#x5B9E;&#x662F;&#x5B58;&#x50A8;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#xFF0C;&#x867D;&#x7136;&#x76EE;&#x524D;&#x5927;&#x591A;&#x6570;&#x7684;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x91C7;&#x7528;&#x4E86;B+&#x6811;&#x7ED3;&#x6784;&#xFF0C;&#x8BFB;&#x53D6;&#x4E00;&#x6761;&#x6570;&#x636E;&#x6700;&#x591A;&#x90FD;&#x8FD8;&#x662F;&#x9700;&#x8981;4&#x6B21;&#x7684;&#x6570;&#x636E;&#x8BFB;&#x5199;&#xFF08;&#x4E09;&#x6B21;&#x78C1;&#x76D8;&#x8BBF;&#x95EE;&#x83B7;&#x5F97;&#x6570;&#x636E;&#x7D22;&#x5F15;&#x53CA;&#x884C;ID&#xFF0C;&#x4E00;&#x6B21;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;&#x7EC8;&#x4E8E;&#x77E5;&#x9053;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x591A;&#x9EBB;&#x70E6;&#x4E86;&#xFF09;&#x3002;&#x800C;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x4F8B;&#x5982;Memcached&#x662F;&#x4EE5;Key/Value&#x8FD9;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5185;&#x5B58;&#x91CC;&#x8FB9;&#x7684;&#xFF0C;&#x5185;&#x5B58;&#x7684;&#x968F;&#x673A;&#x8BFB;&#x5199;&#x901F;&#x5EA6;&#x662F;&#x5B8C;&#x7206;&#x78C1;&#x76D8;IO&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5185;&#x7F51;+&#x5185;&#x5B58;&#x7684;&#x53CC;&#x5185;&#x6A21;&#x5F0F;&#x662F;&#x6BD4;&#x8F83;&#x5B8C;&#x7F8E;&#x7684;&#x65B9;&#x6848;&#x3002; </p>
<p>&#x78C1;&#x76D8;&#x53C8;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF1A;</p>
<p>&#x2460;&#x673A;&#x68B0;&#x786C;&#x76D8;&#xFF1A; &#x901A;&#x8FC7;&#x9A6C;&#x8FBE;&#x9A71;&#x52A8;&#x78C1;&#x5934;&#x81C2;&#xFF0C;&#x5E26;&#x52A8;&#x78C1;&#x5934;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x78C1;&#x76D8;&#x4F4D;&#x7F6E;&#x8BBF;&#x95EE;&#x6570;&#x636E; &#x3002;&#x5B83;&#x80FD;&#x591F;&#x5B9E;&#x73B0; <strong>&#x5FEB;&#x901F;&#x987A;&#x5E8F;&#x8BFB;&#x5199;&#xFF0C;&#x6162;&#x901F;&#x968F;&#x673A;&#x8BFB;&#x5199;</strong> &#x3002; </p>
<p>&#x2461;&#x56FA;&#x6001;&#x786C;&#x76D8;&#xFF08;&#x53C8;&#x79F0;SSD&#xFF09;&#xFF1A; <strong>&#x65E0;&#x673A;&#x68B0;&#x88C5;&#x7F6E;&#xFF0C;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728;&#x53EF;&#x6301;&#x4E45;&#x8BB0;&#x5FC6;&#x7684;&#x7845;&#x6676;&#x4F53;&#x4E0A;</strong> &#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x50CF;&#x5185;&#x5B58;&#x4E00;&#x6837; <strong>&#x5FEB;&#x901F;&#x968F;&#x673A;&#x8BBF;&#x95EE;</strong> &#x3002; </p>
<p>&#x5728;&#x76EE;&#x524D;&#x7684;&#x7F51;&#x7AD9;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x5E94;&#x7528;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x90FD;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;SSD&#x5177;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x8868;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x6027;&#x4EF7;&#x6BD4;&#x6709;&#x5F85;&#x63D0;&#x5347;&#xFF08;&#x86EE;&#x8D35;&#x7684;&#xFF0C;&#x4E48;&#x4E48;&#x55D2;&#xFF09;&#x3002;</p>
<h2 id="&#x4E8C;&#x3001;Memcached&#x5B9E;&#x73B0;Session&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;">&#x4E8C;&#x3001;Memcached&#x5B9E;&#x73B0;Session&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;</h2><h2 id="2-0_&#x6848;&#x4F8B;&#x603B;&#x4F53;&#x9884;&#x89C8;">2.0 &#x6848;&#x4F8B;&#x603B;&#x4F53;&#x9884;&#x89C8;</h2><p>&#xFF08;1&#xFF09;&#x6A21;&#x62DF;&#x7684;&#x767B;&#x5F55;&#x6848;&#x4F8B;&#x573A;&#x666F;</p>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;ASP.NET&#x7684;&#x4FE1;&#x606F;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x7CFB;&#x7EDF;&#x767B;&#x5F55;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x7528;&#x6237;&#x767B;&#x5F55;&#xFF0C;&#x767B;&#x9646;&#x540E;&#x9ED8;&#x8BA4;&#x8DF3;&#x8F6C;&#x5230;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x4E3B;&#x9875;&#xFF0C;&#x5E76;&#x663E;&#x793A;&#xFF1A;&#x6B22;&#x8FCE;&#x60A8;&#xFF0C;{&#x7528;&#x6237;&#x8D26;&#x53F7;&#x540D;&#x79F0;}&#x3002;</p>
<p>&#x2460;&#x7CFB;&#x7EDF;&#x767B;&#x5F55;&#x9875;&#x9762;&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2782ff7.jpg" alt=""></p>
<p>&#x2461;&#x7528;&#x6237;&#x4E3B;&#x9875;&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2783268.jpg" alt=""></p>
<p>&#xFF08;2&#xFF09;&#x6A21;&#x62DF;&#x7684;&#x6280;&#x672F;&#x4F53;&#x7CFB;&#x9009;&#x62E9;</p>
<p>ASP.Net MVC+EF Code First+MySQL+Memcached</p>
<h2 id="2-1_&#x521D;&#x59CB;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;">2.1 &#x521D;&#x59CB;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</h2><p>&#xFF08;1&#xFF09;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;ASP.NET MVC4&#x7684;&#x7A7A;&#x9879;&#x76EE;&#xFF0C;&#x89C6;&#x56FE;&#x5F15;&#x64CE;&#x9009;&#x62E9;&#x4E3A;&#x201C;Razor&#x201D;&#x5373;&#x53EF;&#xFF1B;</p>
<p>&#xFF08;2&#xFF09;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#x201C;Lib&#x201D;&#xFF0C;&#x4E3B;&#x8981;&#x5B58;&#x653E;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;DLL&#x6587;&#x4EF6;&#xFF1B;</p>
<p><img src="http://taojinke.github.io/img/20150703/2783268.jpg" alt=""></p>
<p>&#xFF08;3&#xFF09;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x6DFB;&#x52A0;&#x5BF9;&#x8FD9;&#x51E0;&#x4E2A;DLL&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x5F15;&#x5165;EntityFramework.dll&#x662F;&#x4E3A;&#x4E86;&#x652F;&#x6301;&#x540E;&#x9762;&#x7684;CodeFirst&#x5F00;&#x53D1;&#x65B9;&#x5F0F;&#xFF0C;EF&#x7248;&#x672C;&#x5FC5;&#x987B;&#x5728;4.1&#x53CA;&#x4EE5;&#x4E0A;&#x3002;PS&#xFF1A;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Package Manager&#x6765;&#x5B89;&#x88C5;EntityFramework&#x3002;&#x5230;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x5C31;&#x505A;&#x597D;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x6B63;&#x5F0F;&#x7684;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;</p>
<h2 id="2-2_&#x501F;&#x52A9;EF_CodeFirst&#xFFFD;&#xFFFD;&#xFFFD;&#x6210;MySQL&#x6570;&#x636E;&#x5E93;">2.2 &#x501F;&#x52A9;EF CodeFirst&#xFFFD;&#xFFFD;&#xFFFD;&#x6210;MySQL&#x6570;&#x636E;&#x5E93;</h2><p>&#x9996;&#x5148;&#xFF0C;EF&#x662F;&#x4E00;&#x79CD; <strong>ORM</strong> &#xFF08;Object-relational mapping&#xFF09;&#x6846;&#x67B6;&#xFF0C;&#x5B83;&#x80FD;&#x628A;&#x6211;&#x4EEC;&#x5728;&#x7F16;&#x7A0B;&#x65F6;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x6620;&#x5C04;&#x5230;&#x5E95;&#x5C42;&#x7684;&#x6570;&#x636E;&#x5E93;&#x7ED3;&#x6784;&#x3002;ORM&#x6846;&#x67B6;&#x8D1F;&#x8D23;&#x628A;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4F20;&#x56DE;&#x7684;&#x8BB0;&#x5F55;&#x96C6;&#x8F6C;&#x6362;&#x4E3A;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F9D;&#x636E;&#x5BF9;&#x8C61;&#x5F53;&#x524D;&#x6240;&#x5904;&#x7684;&#x5177;&#x4F53;&#x72B6;&#x6001;&#x751F;&#x6210;&#x76F8;&#x5E94;&#x7684;SQL&#x547D;&#x4EE4;&#x53D1;&#x7ED9;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x7684;&#x5B58;&#x53D6;&#x5DE5;&#x4F5C;&#xFF08;&#x5E38;&#x89C1;&#x7684;&#x6570;&#x636E;&#x5B58;&#x53D6;&#x64CD;&#x4F5C;&#x53EF;&#x7B80;&#x79F0;&#x4E3A;CRUD&#xFF1A;Create&#x3001;Read&#x3001;Update&#x3001;Delete&#xFF09;&#x3002; </p>
<p>EF&#x7ED9;&#x6570;&#x636E;&#x5E93;&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x5F00;&#x53D1;&#x5E26;&#x6765;&#x4E86; <strong>&#x66F4;&#x9AD8;&#x7684;&#x6548;&#x7387;</strong> &#xFF0C;&#x4F7F;&#x7528;&#x5B83;&#x80FD;&#x66F4;&#x5BB9;&#x6613;&#x5730;&#x5199;&#x51FA;&#x6613;&#x7EF4;&#x62A4;&#x3001;&#x6613;&#x6269;&#x5C55;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x800C;&#x4E14; <strong>&#x6027;&#x80FD;&#x867D;&#x7136;&#x6BD4;&#x4E0D;&#x4E0A;ADO.NET</strong> &#xFF0C;&#x4F46;&#x4E5F;&#x8DB3;&#x591F;&#x597D;&#xFF0C;&#x80FD;&#x6EE1;&#x8DB3;&#x5927;&#x591A;&#x6570;&#x5F00;&#x53D1;&#x573A;&#x666F;&#x7684;&#x9700;&#x6C42;&#x3002;&#x4E0E;ADO.NET&#x4E0D;&#x4E00;&#x6837;&#xFF0C; <strong>EF&#x7684;&#x62BD;&#x8C61;&#x5C42;&#x6B21;&#x8F83;&#x9AD8;</strong> &#xFF1A;  &#x5B83;&#x628A;&#x6570;&#x636E;&#x5E93;&#x6620;&#x5C04;&#x4E3A;DbContext&#xFF0C;&#x628A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5B58;&#x53D6;&#x7684;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x6620;&#x5C04;&#x4E3A;&#x5B9E;&#x4F53;&#xFF08;Entity&#xFF09;&#x5BF9;&#x8C61;  &#xFF0C;&#x5C4F;&#x853D;&#x4E86;&#x5E95;&#x5C42;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5185;&#x90E8;&#x7ED3;&#x6784;&#xFF0C;&#x65E0;&#x9700;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x4E0B;&#x5C42;&#x6570;&#x636E;&#x5B58;&#x53D6;&#x5F15;&#x64CE;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#x5E95;&#x5C42;&#x5BF9;&#x8C61;&#xFF08;&#x6BD4;&#x5982;ADO.NET&#x6240;&#x63D0;&#x4F9B;&#x7684;DbConnection&#xFF0C;DbCommands&#x7B49;&#xFF09;&#x5B8C;&#x6210;CRUD&#x3002; </p>
<p>EF&#x652F;&#x6301;&#x4E09;&#x79CD;&#x5F00;&#x53D1;&#x6A21;&#x5F0F;&#xFF1A;Code First&#x3001;Database First&#x548C;Model First&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;Code First&#x6A21;&#x5F0F;&#xFF0C;&#x5B83;&#x80FD;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x5FEB;&#x901F;&#x5F00;&#x53D1;&#x8FED;&#x4EE3;&#x7684;&#x76EE;&#x6807;&#x3002;&#x6700;&#x540E;&#xFF0C;EF&#x4E0D;&#x662F;&#x672C;&#x6587;&#x7684;&#x91CD;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x4E0D;&#x4E86;&#x89E3;EF&#x6216;&#x8005;Code First&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x9605;&#x91D1;&#x65ED;&#x4EAE;&#x8001;&#x5E08;&#x7684;&#x300A; <a href="http://blog.csdn.net/bitfan/article/details/12887007" target="_blank" rel="external">EF&#x8D70;&#x9A6C;&#x89C2;&#x82B1;</a> &#x300B;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x4E86;&#x3002; </p>
<p>&#xFF08;1&#xFF09;&#x5728;Models&#x6587;&#x4EF6;&#x5939;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#x201C;UserInfo&#x201D;&#x3002;&#x5B83;&#x4F5C;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#xFF0C;&#x6620;&#x5C04;&#x5230;MySQL&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;UserInfo&#x8868;&#xFF08;&#x8FD9;&#x91CC;MySQL&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8FD8;&#x672A;&#x521B;&#x5EFA;&#x8FD9;&#x6837;&#x7684;&#x6570;&#x636E;&#x8868;&#xFF09;</p>
<p><img src="http://taojinke.github.io/img/20150703/27834d9.gif" alt=""></p>
<pre><code>    [Serializable]
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserInfo</span>
{
    [Key]
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    <span class="keyword">public</span> <span class="keyword">int</span> UserId { <span class="keyword">get</span>; <span class="keyword">set</span>; }
    [Required]
    [MaxLength(<span class="number">128</span>)]
    <span class="keyword">public</span> <span class="keyword">string</span> UserName { <span class="keyword">get</span>; <span class="keyword">set</span>; }
    [Required]
    [MaxLength(<span class="number">32</span>)]
    <span class="keyword">public</span> <span class="keyword">string</span> UserPwd { <span class="keyword">get</span>; <span class="keyword">set</span>; }
}
</code></pre><p> View Code</p>
<p>&#xFF08;2&#xFF09;&#x518D;&#x5728;Models&#x6587;&#x4EF6;&#x5939;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#x201C;MyDbContext&#x201D;&#xFF0C;&#x4F7F;&#x5176;&#x7EE7;&#x627F;&#x4E8E;DbContext&#xFF0C;&#x4F5C;&#x4E3A;EF&#x64CD;&#x4F5C;&#x7684;&#x6570;&#x636E;&#x5E93;&#x4E0A;&#x4E0B;&#x6587;&#x4F7F;&#x7528;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;&#x8FD9;&#x91CC;&#x7684;name=MySqlDemo&#xFF0C;MySqlDemo&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x7684;&#x540D;&#x5B57;&#x3002;&#x800C;&#x8FD9;&#x91CC;this.Database.CreateIfNotExists()&#x65B9;&#x6CD5;&#x5219;&#x7528;&#x4E8E;&#x5224;&#x65AD;MySqlDemo&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x662F;&#x5426;&#x5DF2;&#x5B58;&#x5728;&#xFF1F;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/27834d9.gif" alt=""></p>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyDbContext</span> : <span class="title">DbContext</span>
    {
        <span class="function"><span class="keyword">public</span> <span class="title">MyDbContext</span>(<span class="params"></span>)
            : <span class="title">base</span>(<span class="params">&amp;quot;name=MySqlDemo&amp;quot;</span>)
        </span>{
            <span class="keyword">this</span>.Database.CreateIfNotExists();
        }

        <span class="keyword">public</span> <span class="keyword">virtual</span> DbSet&amp;lt;UserInfo&amp;gt; UserInfo { <span class="keyword">get</span>; <span class="keyword">set</span>; }
    }
</code></pre><p> View Code</p>
<p>&#xFF08;3&#xFF09;&#x5728;Web.config&#x4E2D;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;database&#x8BBE;&#x7F6E;&#x4E3A;&#x201C;MySqlDemo&#x201D;&#xFF0C;&#x4E0E;&#x4E0A;&#x9762;&#x7684;MyDbContext&#x4E2D;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x7684;name&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/278374a.gif" alt=""></p>
<pre><code><span class="subst">&amp;</span><span class="literal">lt</span>;connectionStrings<span class="subst">&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;<span class="subst">!--&amp;</span><span class="variable">#x8BBE</span>;<span class="subst">&amp;</span><span class="variable">#x7F6E</span>;<span class="subst">&amp;</span><span class="variable">#x5BF9</span>;MySql<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x94FE</span>;<span class="subst">&amp;</span><span class="variable">#x63A5</span>;<span class="subst">&amp;</span><span class="variable">#x5B57</span>;<span class="subst">&amp;</span><span class="variable">#x7B26</span>;<span class="subst">&amp;</span><span class="variable">#x4E32</span>;<span class="subst">&amp;</span><span class="variable">#xFF08</span>;<span class="subst">&amp;</span><span class="variable">#x6CE8</span>;<span class="subst">&amp;</span><span class="variable">#x610F</span>;<span class="subst">&amp;</span><span class="variable">#xFF1A</span>;charset<span class="subst">=</span>utf8<span class="subst">&amp;</span><span class="variable">#x662F</span>;<span class="subst">&amp;</span><span class="variable">#x4E3A</span>;<span class="subst">&amp;</span><span class="variable">#x4E86</span>;<span class="subst">&amp;</span><span class="variable">#x89E3</span>;<span class="subst">&amp;</span><span class="variable">#x51B3</span>;MySql<span class="subst">&amp;</span><span class="variable">#x4E2D</span>;<span class="subst">&amp;</span><span class="variable">#x4FDD</span>;<span class="subst">&amp;</span><span class="variable">#x5B58</span>;<span class="subst">&amp;</span><span class="variable">#x4E2D</span>;<span class="subst">&amp;</span><span class="variable">#x6587</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x65F6</span>;<span class="subst">&amp;</span><span class="variable">#x5019</span>;<span class="subst">&amp;</span><span class="variable">#x51FA</span>;<span class="subst">&amp;</span><span class="variable">#x73B0</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x4E71</span>;<span class="subst">&amp;</span><span class="variable">#x7801</span>;<span class="subst">&amp;</span><span class="variable">#x7684</span>;<span class="subst">&amp;</span><span class="variable">#x95EE</span>;<span class="subst">&amp;</span><span class="variable">#x9898</span>;<span class="subst">&amp;</span><span class="variable">#xFF09</span>; <span class="subst">--&amp;</span><span class="literal">gt</span>;
    <span class="subst">&amp;</span><span class="literal">lt</span>;add name<span class="subst">=&amp;</span>quot;MySqlDemo<span class="subst">&amp;</span>quot; connectionString<span class="subst">=&amp;</span>quot;server<span class="subst">=</span><span class="number">127.0</span><span class="built_in">.0</span><span class="built_in">.1</span>;user id<span class="subst">=</span>root;password<span class="subst">=</span><span class="number">1234</span>;persist security info<span class="subst">=</span><span class="literal">True</span>;database<span class="subst">=</span>MySqlDemo;charset<span class="subst">=</span>utf8;<span class="subst">&amp;</span>quot; providerName<span class="subst">=&amp;</span>quot;MySql<span class="built_in">.</span><span class="built_in">Data</span><span class="built_in">.</span>MySqlClient<span class="subst">&amp;</span>quot; <span class="subst">/</span><span class="subst">&amp;</span><span class="literal">gt</span>;
  <span class="subst">&amp;</span><span class="literal">lt</span>;/connectionStrings<span class="subst">&amp;</span><span class="literal">gt</span>;
</code></pre><p> View Code</p>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EA;&#x7528;&#x5230;UserInfo&#x8FD9;&#x4E00;&#x4E2A;&#x8868;&#xFF0C;&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6709;&#x5173;&#x6570;&#x636E;&#x5E93;&#x4E0E;EF&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x5230;&#x6B64;&#x7ED3;&#x675F;&#x3002;</p>
<h2 id="2-3_&#x81EA;&#x5DF1;&#x5C01;&#x88C5;Memcached&#x5E2E;&#x52A9;&#x7C7B;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x63A5;&#x53E3;">2.3 &#x81EA;&#x5DF1;&#x5C01;&#x88C5;Memcached&#x5E2E;&#x52A9;&#x7C7B;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x63A5;&#x53E3;</h2><p>&#xFF08;1&#xFF09;&#x5728;Web.config&#x4E2D;&#x65B0;&#x589E;&#x4E00;&#x4E2A;AppSetting&#xFF0C;&#x4FDD;&#x5B58;Memcached&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&#x5217;&#x8868;&#xFF1A;</p>
<pre><code>&amp;<span class="keyword">lt</span>;!-- &amp;<span class="title">#x8</span>BBE;&amp;<span class="title">#x7</span>F<span class="number">6</span>E;Memcached&amp;<span class="title">#x670</span>D;&amp;<span class="title">#x52</span>A<span class="number">1</span>;&amp;<span class="title">#x5668</span>;&amp;<span class="title">#x96</span>C<span class="number">6</span>;&amp;<span class="title">#x7</span>FA<span class="number">4</span>;&amp;<span class="title">#x5217</span>;&amp;<span class="title">#x8868</span>; --&amp;<span class="keyword">gt</span>;
    &amp;<span class="keyword">lt</span>;add key=&amp;quot;MemcachedServers&amp;quot; value=&amp;quot;<span class="number">192.168.</span><span class="number">80.10</span>:<span class="number">11211</span>,<span class="number">192.168.</span><span class="number">80.11</span>:<span class="number">11211</span>&amp;quot;/&amp;<span class="keyword">gt</span>;
</code></pre><p>&#xFF08;2&#xFF09;&#x5728;Models&#x4E2D;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#x201C;MemcachedHelper&#x201D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;&#x9759;&#x6001;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x65B9;&#x6CD5;&#x5168;&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x9700;&#x5B9E;&#x4F8B;&#x5316;&#x4FBF;&#x53EF;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;&#x9759;&#x6001;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6765;&#x521D;&#x59CB;&#x5316;&#x5168;&#x5C40;&#x9759;&#x6001;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4E0D;&#x5C5E;&#x4E8E;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x53EA;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x5728;&#x521B;&#x5EFA;&#x6B64;&#x7C7B;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x6216;&#x5F15;&#x7528;&#x4EFB;&#x4F55;&#x9759;&#x6001;&#x6210;&#x5458;&#x4E4B;&#x524D;&#xFF0C;&#x7531;.NET&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/278374a.gif" alt=""></p>
<pre><code>/// &amp;lt;summary&amp;gt;
/// &amp;<span class="symbol">#x81EA</span>;&amp;<span class="symbol">#x5DF1</span>;&amp;<span class="symbol">#x5C01</span>;&amp;<span class="symbol">#x88C5</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5E2E</span>;&amp;<span class="symbol">#x52A9</span>;&amp;<span class="symbol">#x7C7B</span>;
/// &amp;lt;/summary&amp;gt;
public static class <span class="class">MemcacheHelper</span>
{
    <span class="symbol">#region</span> &amp;<span class="symbol">#x5168</span>;&amp;<span class="symbol">#x5C40</span>;&amp;<span class="symbol">#x9759</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#x5BF9</span>;&amp;<span class="symbol">#x8C61</span>;
    // &amp;<span class="symbol">#x5168</span>;&amp;<span class="symbol">#x5C40</span>;<span class="class">Socket</span>&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6C60</span>;&amp;<span class="symbol">#x5BF9</span>;&amp;<span class="symbol">#x8C61</span>;
    private readonly static <span class="class">SockIOPool</span> sockIOPool;
    public static <span class="class">SockIOPool</span> <span class="class">CurrentPool</span>
    {
        get
        {
            return sockIOPool;
        }
    }
    // &amp;<span class="symbol">#x5168</span>;&amp;<span class="symbol">#x5C40</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x5BF9</span>;&amp;<span class="symbol">#x8C61</span>;
    private static <span class="class">MemcachedClient</span> mc; 
    <span class="symbol">#endregion</span>
    <span class="symbol">#region</span> &amp;<span class="symbol">#x9759</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#x6784</span>;&amp;<span class="symbol">#x9020</span>;&amp;<span class="symbol">#x51FD</span>;&amp;<span class="symbol">#x6570</span>;
    /// &amp;lt;summary&amp;gt;
    /// &amp;<span class="symbol">#x9759</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#x6784</span>;&amp;<span class="symbol">#x9020</span>;&amp;<span class="symbol">#x51FD</span>;&amp;<span class="symbol">#x6570</span>;
    /// &amp;lt;/summary&amp;gt;
    static <span class="class">MemcacheHelper</span>()
    {
        // &amp;<span class="symbol">#x521D</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x5316</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x670D</span>;&amp;<span class="symbol">#x52A1</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#x5217</span>;&amp;<span class="symbol">#x8868</span>;
        string[] serverList = <span class="class">ConfigurationManager</span>.<span class="class">AppSettings</span>[&amp;quot;<span class="class">MemcachedServers</span>&amp;quot;].<span class="class">Split</span>(&amp;apos;,&amp;apos;);
        // &amp;<span class="symbol">#x521D</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x5316</span>;<span class="class">Socket</span>&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6C60</span>;
        sockIOPool = <span class="class">SockIOPool</span>.<span class="class">GetInstance</span>(&amp;quot;<span class="class">MemPool</span>&amp;quot;);
        sockIOPool.<span class="class">SetServers</span>(serverList);
        sockIOPool.<span class="class">Initialize</span>();
        // &amp;<span class="symbol">#x521D</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x5316</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;
        mc = new <span class="class">MemcachedClient</span>();
        mc.<span class="class">PoolName</span> = &amp;quot;<span class="class">MemPool</span>&amp;quot;;
        mc.<span class="class">EnableCompression</span> = <span class="keyword">false</span>;
    } 
    <span class="symbol">#endregion</span>
    <span class="symbol">#region</span> &amp;<span class="symbol">#x5C01</span>;&amp;<span class="symbol">#x88C5</span>;&amp;<span class="symbol">#x5BF9</span>;&amp;<span class="symbol">#x5916</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;
    /// &amp;lt;summary&amp;gt;
    /// <span class="class">Set</span>-&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x589E</span>;&amp;<span class="symbol">#x6216</span>;&amp;<span class="symbol">#x4FEE</span>;&amp;<span class="symbol">#x6539</span>;
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&amp;quot;key&amp;quot;&amp;gt;&amp;<span class="symbol">#x952E</span>;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&amp;quot;value&amp;quot;&amp;gt;&amp;<span class="symbol">#x503C</span>;&amp;lt;/param&amp;gt;
    /// &amp;lt;returns&amp;gt;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x529F</span>;&amp;lt;/returns&amp;gt;
    public static bool <span class="class">Set</span>(string key, object value)
    {
        if (!mc.<span class="class">KeyExists</span>(key))
        {
            return mc.<span class="class">Add</span>(key, value);
        }
        else
        {
            return mc.<span class="class">Set</span>(key, value);
        }
    }
    /// &amp;lt;summary&amp;gt;
    /// <span class="class">Set</span>-&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x589E</span>;&amp;<span class="symbol">#x6216</span>;&amp;<span class="symbol">#x4FEE</span>;&amp;<span class="symbol">#x6539</span>;
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&amp;quot;key&amp;quot;&amp;gt;&amp;<span class="symbol">#x952E</span>;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&amp;quot;value&amp;quot;&amp;gt;&amp;<span class="symbol">#x503C</span>;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&amp;quot;expiry&amp;quot;&amp;gt;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x671F</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x95F4</span>;&amp;lt;/param&amp;gt;
    /// &amp;lt;returns&amp;gt;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x529F</span>;&amp;lt;/returns&amp;gt;
    public static bool <span class="class">Set</span>(string key, object value, <span class="class">DateTime</span> expiry)
    {
        if (!mc.<span class="class">KeyExists</span>(key))
        {
            return mc.<span class="class">Add</span>(key, value, expiry);
        }
        else
        {
            return mc.<span class="class">Set</span>(key, value, expiry);
        }
    }
    /// &amp;lt;summary&amp;gt;
    /// <span class="class">Get</span>-&amp;<span class="symbol">#x83B7</span>;&amp;<span class="symbol">#x53D6</span>;
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&amp;quot;key&amp;quot;&amp;gt;&amp;<span class="symbol">#x952E</span>;&amp;lt;/param&amp;gt;
    /// &amp;lt;returns&amp;gt;&amp;<span class="symbol">#x5177</span>;&amp;<span class="symbol">#x4F53</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;lt;/returns&amp;gt;
    public static object <span class="class">Get</span>(string key)
    {
        if (!mc.<span class="class">KeyExists</span>(key))
        {
            return null;
        }
        else
        {
            return mc.<span class="class">Get</span>(key);
        }
    } 
    <span class="symbol">#endregion</span>
}
</code></pre><p> View Code</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5BF9;SockIOPool&#x8FDB;&#x884C;&#x4E00;&#x5217;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x91C7;&#x7528;&#x5176;&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x5373;&#x53EF;&#x3002;&#x4F46;&#x662F;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;SockIOPool&#x7684;PoolName&#x548C;MemcacheClient&#x7684;PoolName&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</p>
<h2 id="2-4_&#x7528;&#x6237;&#x767B;&#x5F55;&#x65F6;&#x8C03;&#x7528;Memcached&#x5E2E;&#x52A9;&#x7C7B;&#x63A5;&#x53E3;&#x5B58;&#x50A8;&#x7528;&#x6237;&#x767B;&#x5F55;&#x72B6;&#x6001;">2.4 &#x7528;&#x6237;&#x767B;&#x5F55;&#x65F6;&#x8C03;&#x7528;Memcached&#x5E2E;&#x52A9;&#x7C7B;&#x63A5;&#x53E3;&#x5B58;&#x50A8;&#x7528;&#x6237;&#x767B;&#x5F55;&#x72B6;&#x6001;</h2><p>&#xFF08;1&#xFF09;&#x5728;Controller&#x4E2D;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#x201C;LogonController&#x201D;&#x3002;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x663E;&#x793A;&#x7CFB;&#x7EDF;&#x767B;&#x9646;&#x9875;&#x548C;&#x8FDB;&#x884C;&#x7528;&#x6237;&#x9A8C;&#x8BC1;&#x7684;AJAX&#x64CD;&#x4F5C;&#xFF08;&#x5C06;&#x7528;&#x6237;Session&#x5B58;&#x5165;Memcached&#x4E5F;&#x5728;&#x6B64;&#x64CD;&#x4F5C;&#x4E2D;&#xFF09;&#x3002;&#x81F3;&#x4E8E;&#x767B;&#x5F55;&#x9875;&#x9762;&#x7684;HTML&#x548C;JS&#x811A;&#x672C;&#x5728;&#x6B64;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#xFF0C;&#x8BF7;&#x81EA;&#x884C;&#x4E0B;&#x8F7D;Demo&#x6587;&#x4EF6;&#x67E5;&#x770B;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/27839bb.gif" alt=""></p>
<pre><code>public class <span class="class">LogonController</span> : <span class="class">Controller</span>
{
    //
    // <span class="class">GET</span>: /<span class="class">Logon</span>/
    public <span class="class">ActionResult</span> <span class="class">Index</span>()
    {
        return <span class="class">View</span>();
    }
    [<span class="class">HttpPost</span>]
    public <span class="class">JsonResult</span> <span class="class">ValidateUserInfo</span>(string userName, string userPwd)
    {
        <span class="class">MyDbContext</span> dbContext = new <span class="class">MyDbContext</span>();
        var loginUser = dbContext.<span class="class">UserInfo</span>.<span class="class">Where</span>(u =&amp;gt; u.<span class="class">UserName</span>.<span class="class">Equals</span>(userName)).<span class="class">FirstOrDefault</span>();
        <span class="class">JsonObject</span> jsonReturn = new <span class="class">JsonObject</span>();
        if (loginUser == null)
        {
            jsonReturn.success = <span class="keyword">false</span>;
            jsonReturn.msg = &amp;quot;&amp;<span class="symbol">#x60A8</span>;&amp;<span class="symbol">#x8F93</span>;&amp;<span class="symbol">#x5165</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x540D</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5728</span>;&amp;<span class="symbol">#xFF01</span>;&amp;quot;;
        }
        else
        {
            if (!loginUser.<span class="class">UserPwd</span>.<span class="class">Equals</span>(userPwd))
            {
                jsonReturn.success = <span class="keyword">false</span>;
                jsonReturn.msg = &amp;quot;&amp;<span class="symbol">#x60A8</span>;&amp;<span class="symbol">#x8F93</span>;&amp;<span class="symbol">#x5165</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5BC6</span>;&amp;<span class="symbol">#x7801</span>;&amp;<span class="symbol">#x9519</span>;&amp;<span class="symbol">#x8BEF</span>;&amp;<span class="symbol">#xFF01</span>;&amp;quot;;
                return <span class="class">Json</span>(jsonReturn, <span class="class">JsonRequestBehavior</span>.<span class="class">DenyGet</span>);
            }
            // &amp;<span class="symbol">#x7533</span>;&amp;<span class="symbol">#x8BF7</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x6A21</span>;&amp;<span class="symbol">#x62DF</span>;&amp;<span class="symbol">#x7684</span>;<span class="class">Guid</span>&amp;<span class="symbol">#xFF1A</span>;<span class="class">SessionId</span>
            <span class="class">Guid</span> sessionId = <span class="class">Guid</span>.<span class="class">NewGuid</span>();
            // &amp;<span class="symbol">#x628A</span>;sessionid&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x6D4F</span>;&amp;<span class="symbol">#x89C8</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#x91CC</span>;&amp;<span class="symbol">#x9762</span>;&amp;<span class="symbol">#x53BB</span>;&amp;<span class="symbol">#x7D2F</span>;
            <span class="class">Response</span>.<span class="class">Cookies</span>[&amp;quot;sessionId&amp;quot;].<span class="class">Value</span> = sessionId.<span class="class">ToString</span>();
            // &amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x5B9E</span>;&amp;<span class="symbol">#x4F53</span>;&amp;<span class="symbol">#x5BF9</span>;&amp;<span class="symbol">#x8C61</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x5165</span>;&amp;<span class="symbol">#x5230</span>;<span class="class">Memcache</span>&amp;<span class="symbol">#x4E2D</span>;
            <span class="class">MemcacheHelper</span>.<span class="class">Set</span>(sessionId.<span class="class">ToString</span>(), loginUser, <span class="class">DateTime</span>.<span class="class">Now</span>.<span class="class">AddMinutes</span>(<span class="number">20</span>));
            // &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x529F</span>;&amp;<span class="symbol">#x54CD</span>;&amp;<span class="symbol">#x5E94</span>;&amp;<span class="symbol">#x6D88</span>;&amp;<span class="symbol">#x606F</span>;
            jsonReturn.success = <span class="keyword">true</span>;
            jsonReturn.msg = &amp;quot;&amp;<span class="symbol">#x606D</span>;&amp;<span class="symbol">#x559C</span>;&amp;<span class="symbol">#x60A8</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x767B</span>;&amp;<span class="symbol">#x5F55</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x529F</span>;&amp;<span class="symbol">#xFF01</span>;&amp;quot;;
        }
        return <span class="class">Json</span>(jsonReturn, <span class="class">JsonRequestBehavior</span>.<span class="class">DenyGet</span>);
    }
}
</code></pre><p> View Code</p>
<p>&#x73B0;&#x5728;&#x6765;&#x770B;&#x4E0B;&#x8FD9;&#x4E2A;&#x63A7;&#x5236;&#x5668;&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>&#x2460;Index&#x8FD9;&#x4E2A;Action&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x663E;&#x793A;&#x767B;&#x5F55;&#x89C6;&#x56FE;&#xFF0C;&#x9875;&#x9762;&#x4EE3;&#x7801;&#x4E0D;&#x518D;&#x8D34;&#x51FA;&#x6765;&#xFF0C;&#x53EA;&#x770B;&#x770B;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;AJAX&#x8BF7;&#x6C42;&#x4EE3;&#x7801;&#xFF1A;&#x501F;&#x52A9;JQuery AJAX&#x5411;ValidateUserInfo&#x8FD9;&#x4E2A;Action&#x63D0;&#x4EA4;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;&#xFF0C;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6821;&#x9A8C;&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;JSON&#x5BF9;&#x8C61;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x5224;&#x65AD;success&#x5C5E;&#x6027;&#x662F;&#x5426;&#x4E3A;true&#xFF0C;&#x5982;&#x679C;&#x4E3A;true&#x5219;&#x8DF3;&#x8F6C;&#x5230;&#x7CFB;&#x7EDF;&#x4E3B;&#x9875;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/27839bb.gif" alt=""></p>
<pre><code><span class="xml">    $.ajax(</span><span class="expression">{
    <span class="variable">type</span>: &amp;<span class="variable">quot</span>;<span class="variable">POST</span>&amp;<span class="variable">quot</span>;,
    <span class="variable">contentType</span>: &amp;<span class="variable">quot</span>;<span class="variable">application</span><span class="end-block">/json</span>;<span class="variable">charset</span>=<span class="variable">utf-</span>8&amp;<span class="variable">quot</span>;,
    <span class="variable">url</span>: &amp;<span class="variable">quot</span>;<span class="end-block">/Logon</span><span class="end-block">/ValidateUserInfo</span>&amp;<span class="variable">quot</span>;,
    <span class="variable">data</span>: &amp;<span class="variable">quot</span>;{ <span class="variable">userName</span>:&amp;<span class="variable">apos</span>;&amp;<span class="variable">quot</span>; + <span class="variable">txtUserName</span> + &amp;<span class="variable">quot</span>;&amp;<span class="variable">apos</span>;,<span class="variable">userPwd</span>:&amp;<span class="variable">apos</span>;&amp;<span class="variable">quot</span>; + <span class="variable">txtUserPwd</span> + &amp;<span class="variable">quot</span>;&amp;<span class="variable">apos</span>; }</span><span class="xml">&amp;quot;,
    dataType: &amp;quot;json&amp;quot;,
    beforeSend: function () </span><span class="expression">{
        <span class="variable">showMsg</span>(&amp;<span class="variable">quot</span>;&amp;<span class="begin-block">#x</span>64<span class="variable">CD</span>;&amp;<span class="begin-block">#x</span>4<span class="variable">F</span>5<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>63<span class="variable">D</span>0;&amp;<span class="begin-block">#x</span>793<span class="variable">A</span>;&amp;<span class="variable">quot</span>;, &amp;<span class="variable">quot</span>;&amp;<span class="begin-block">#x</span>6<span class="variable">B</span>63;&amp;<span class="begin-block">#x</span>5728;&amp;<span class="begin-block">#x</span>9<span class="variable">A</span>8<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>8<span class="variable">BC</span>1;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>2<span class="variable">D</span>;&amp;<span class="begin-block">#xFF</span>0<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>8<span class="variable">BF</span>7;&amp;<span class="begin-block">#x</span>7<span class="variable">A</span>0<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>5019;<span class="variable">...</span>&amp;<span class="variable">quot</span>;);
    }</span><span class="xml">,
    success: function (resultInfo) </span><span class="expression">{
        <span class="variable"><span class="keyword">if</span></span> (<span class="variable">resultInfo</span> != <span class="variable">null</span> &amp;<span class="variable">amp</span>;&amp;<span class="variable">amp</span>; <span class="variable">resultInfo.success</span>) {
            <span class="variable">window.location.href</span> = &amp;<span class="variable">quot</span>;<span class="end-block">/Home</span><span class="end-block">/Index</span>&amp;<span class="variable">quot</span>;;
        }</span><span class="xml">
        else </span><span class="expression">{
            <span class="variable">showMsg</span>(&amp;<span class="variable">quot</span>;&amp;<span class="begin-block">#x</span>767<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">F</span>55;&amp;<span class="begin-block">#x</span>5931;&amp;<span class="begin-block">#x</span>8<span class="variable">D</span>25;&amp;<span class="variable">quot</span>;, <span class="variable">resultInfo.msg</span>);
        }</span><span class="xml">
    },
    error: function () </span><span class="expression">{
        <span class="variable">showMsg</span>(&amp;<span class="variable">apos</span>;&amp;<span class="begin-block">#x</span>9519;&amp;<span class="begin-block">#x</span>8<span class="variable">BEF</span>;&amp;<span class="begin-block">#x</span>63<span class="variable">D</span>0;&amp;<span class="begin-block">#x</span>793<span class="variable">A</span>;&amp;<span class="variable">apos</span>;, &amp;<span class="variable">apos</span>;&amp;<span class="begin-block">#x</span>53<span class="variable">D</span>1;&amp;<span class="begin-block">#x</span>751<span class="variable">F</span>;&amp;<span class="begin-block">#x</span>672<span class="variable">A</span>;&amp;<span class="begin-block">#x</span>77<span class="variable">E</span>5;&amp;<span class="begin-block">#x</span>9519;&amp;<span class="begin-block">#x</span>8<span class="variable">BEF</span>;&amp;<span class="variable">apos</span>;);
    }</span><span class="xml">
});</span>
</code></pre><p> View Code</p>
<p>&#x2461;ValidateUserInfo&#x8FD9;&#x4E2A;Action&#x5219;&#x662F;&#x6839;&#x636E;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4EA4;&#x8FC7;&#x6765;&#x7684;AJAX&#x8BF7;&#x6C42;&#xFF0C;&#x5224;&#x65AD;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;&#x8FD9;&#x91CC;&#x7528;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x521A;&#x521A;&#x5199;&#x7684;MyDbContext&#xFF0C;&#x9996;&#x5148;&#x5BF9;&#x5B83;&#x8FDB;&#x884C;&#x5B9E;&#x4F8B;&#x5316;&#x3002;&#xFF08;&#x8FD9;&#x4E00;&#x6B65;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x7684;MySQL&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8FD8;&#x6728;&#x6709;MySqlDemo&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5F53;&#x7B2C;&#x4E00;&#x6B21;&#x5B9E;&#x4F8B;&#x5316;MyDbContext&#x65F6;&#xFF0C;EF&#x4F1A;&#x5E2E;&#x6211;&#x4EEC;&#x5728;MySQL&#x4E2D;&#x521B;&#x5EFA;MySqlDemo&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5176;&#x672C;&#x8D28;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5E2E;&#x6211;&#x4EEC;&#x751F;&#x6210;&#x4E00;&#x4E32;&#xFF1A;crate database mysqldemo;&#x4E4B;&#x7C7B;&#x7684;SQL&#x8BED;&#x53E5;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;Lambda&#x8868;&#x8FBE;&#x5F0F;&#x8FD9;&#x79CD;&#x4F18;&#x7F8E;&#x7684;&#x8BED;&#x6CD5;&#x53BB;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5BF9;Lambda&#x8868;&#x8FBE;&#x5F0F;&#x4E0D;&#x719F;&#x6089;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x9605;MSDN&#x7684;&#x300A; <a href="http://msdn.microsoft.com/zh-cn/library/bb397687.aspx" target="_blank" rel="external">Lambda&#x8868;&#x8FBE;&#x5F0F;&#xFF08;C#&#x7F16;&#x7A0B;&#x6307;&#x5357;&#xFF09;</a> &#x300B;&#x4E00;&#x6587;&#x6765;&#x5B66;&#x4E60;&#x4E0B;&#x3002; </p>
<p>&#x2462;&#x5C31;&#x662F;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x91C7;&#x7528;Guid&#xFF08;&#x4FDD;&#x8BC1;&#x4F5C;&#x4E3A;Key&#x7684;&#x552F;&#x4E00;&#x6027;&#xFF09;&#x4F5C;&#x4E3A; <strong>SessionId</strong> &#x5199;&#x5165;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x7684;Cookie&#x4E2D;&#xFF0C;&#x5E76;&#x4EE5;&#x6B64;&#x4F5C;&#x4E3A; <strong>Key</strong> &#x5B58;&#x5165;Memcached&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x8FD8;&#x7ED9;&#x5B83;&#x8BBE;&#x7F6E;&#x4E86;&#x9ED8;&#x8BA4;&#x5931;&#x6548;&#x65F6;&#x95F4;&#xFF08;&#x8FD9;&#x91CC;&#x4E3A;20&#x5206;&#x949F;&#xFF09;&#x3002;&#x4E4B;&#x540E;&#xFF0C;&#x6BCF;&#x6B21;&#x6D4F;&#x89C8;&#x5668;&#x5411;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x63D0;&#x4EA4;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5728;HTTP&#x62A5;&#x6587;&#x4E2D;&#x90FD;&#x4F1A;&#x9644;&#x5E26;&#x4E0A;&#x8FD9;&#x4E2A;Cookie&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;Cookie&#x4F5C;&#x4E3A;Key&#x53BB;Memcached&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x67E5;&#x627E;Session&#x5BF9;&#x8C61;&#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/2783c2c.jpg" alt=""></p>
<p>PS&#xFF1A;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;Memcached&#x7684;&#x6570;&#x636E;Key&#x7684;&#x547D;&#x540D;&#x662F;&#x6709;&#x8BB2;&#x7A76;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x4F20;&#x667A;&#x7684;&#x8001;&#x9A6C;&#x63A8;&#x8350;&#x4E86;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x89C4;&#x5219;&#xFF1A;{&#x547D;&#x540D;&#x7A7A;&#x95F4;}-{&#x90E8;&#x95E8;&#x540D;&#x79F0;}-{&#x9879;&#x76EE;&#x540D;&#x79F0;}&#x3002;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5C31;&#x7B80;&#x5355;&#x4E00;&#x70B9;&#xFF0C;&#x4F7F;&#x7528;Guid&#x6765;&#x4F5C;&#x4E3A;Key&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x751F;&#x6210;&#x7684;Guid&#x662F;&#x552F;&#x4E00;&#x7684;&#x3002; </p>
<h2 id="2-5_&#x5C01;&#x88C5;BaseController&#x89E3;&#x51B3;Action&#x89E6;&#x53D1;&#x524D;&#x7684;&#x6821;&#x9A8C;&#x89C4;&#x5219;">2.5 &#x5C01;&#x88C5;BaseController&#x89E3;&#x51B3;Action&#x89E6;&#x53D1;&#x524D;&#x7684;&#x6821;&#x9A8C;&#x89C4;&#x5219;</h2><p>&#xFF08;1&#xFF09;&#x5728;&#x4EE5;&#x5F80;&#x7684;&#x4FE1;&#x606F;&#x7CFB;&#x7EDF;&#x9879;&#x76EE;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x7CFB;&#x7EDF;&#x91CC;&#x8FB9;&#x4F1A;&#x505A;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x6821;&#x9A8C;&#x5668;&#xFF0C;&#x5224;&#x65AD;&#x7528;&#x6237;&#x7684;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x5177;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x662F;&#x6821;&#x9A8C;&#x7528;&#x6237;&#x662F;&#x5426;&#x767B;&#x5F55;&#xFF0C;&#x4EE5;&#x4FBF;&#x6211;&#x4EEC;&#x5728;&#x5177;&#x4F53;&#x7684;&#x6A21;&#x5757;&#x4E2D;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x7684;Session&#x5BF9;&#x8C61;&#x3002;&#x5355;&#x673A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x5C31;&#x5B58;&#x5165;&#x672C;&#x673A;&#x8FDB;&#x7A0B;&#x5185;&#x7684;Session&#xFF0C;&#x56E0;&#x6B64;&#x5C31;&#x4E3B;&#x8981;&#x5224;&#x65AD;Session&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;Memcached&#x6765;&#x5B58;&#x50A8;Session&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x5728;&#x6BCF;&#x4E2A;Action&#x6267;&#x884C;&#x524D;&#x52A0;&#x4E00;&#x6BB5;&#x89C4;&#x5219;&#xFF1A; &#x5224;&#x65AD;Memcached&#x4E2D;&#x662F;&#x5426;&#x6709;&#x5F53;&#x524D;&#x7528;&#x6237;&#x7684;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x6709;&#xFF0C;&#x5219;&#x7EE7;&#x7EED;&#x6267;&#x884C;Action&#x3002;&#x5982;&#x679C;&#x6728;&#x6709;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E0D;&#x8D77;&#xFF0C;&#x8BF7;&#x8FDB;&#x884C;&#x767B;&#x5F55; &#x3002; </p>
<p>&#xFF08;2&#xFF09;&#x5728;WebForm&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5199;&#x4E00;&#x4E2A;BasePage&#xFF0C;&#x4F7F;&#x5176;&#x7EE7;&#x627F;&#x4E8E;Page&#xFF0C;&#x91CD;&#x5199;OnLoad&#x4E8B;&#x4EF6;&#xFF0C;&#x518D;&#x8BA9;&#x5176;&#x4ED6;&#x9875;&#x9762;&#x7EE7;&#x627F;&#x4E8E;BasePage&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x7528;&#x6237;&#x662F;&#x5426;&#x767B;&#x5F55;&#x8FD9;&#x4E2A;&#x6821;&#x9A8C;&#x5E94;&#x7528;&#x5230;&#x6240;&#x6709;&#x7EE7;&#x627F;&#x4E86;BasePage&#x7684;Page&#x7C7B;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x5728;MVC&#x6A21;&#x5F0F;&#x4E2D;&#xFF0C;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x4E0D;&#x518D;&#x662F;xxx.aspx&#x9875;&#x9762;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x662F;/ControllerName/ActionName&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BFB;&#x627E;&#x4E00;&#x79CD;&#x9488;&#x5BF9;Action&#x7684;&#x5168;&#x5C40;&#x8FC7;&#x6EE4;&#x65B9;&#x6CD5;&#x3002;&#x989D;&#xFF0C;&#x5728;&#x6B64;&#x6211;&#x4EEC;&#x4E0D;&#x7981;&#x60F3;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x9AD8;&#x5927;&#x4E0A;&#x7684;&#x82F1;&#x6587;&#xFF1A; <strong>AoP&#xFF08;Aspect Oriented Programming&#xFF09;</strong> &#xFF0C;&#x5B83;&#x662F;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x4E2D;&#x4E00;&#x4E2A;&#x8F83;&#x4E3A;&#x70ED;&#x95E8;&#x7684;&#x8BDD;&#x9898;&#xFF0C;&#x5229;&#x7528;AOP&#x53EF;&#x4EE5; <strong>&#x5BF9;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x5404;&#x4E2A;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x9694;&#x79BB;</strong> &#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5F97;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5404;&#x90E8;&#x5206;&#x4E4B;&#x95F4;&#x7684;&#x8026;&#x5408;&#x5EA6;&#x964D;&#x4F4E;&#xFF0C;&#x63D0;&#x9AD8;&#x7A0B;&#x5E8F;&#x7684;&#x53EF;&#x91CD;&#x7528;&#x6027;&#xFF0C;&#x540C;&#x65F6;&#x63D0;&#x9AD8;&#x4E86;&#x5F00;&#x53D1;&#x7684;&#x6548;&#x7387;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;Action&#x589E;&#x52A0;&#x5168;&#x5C40;&#x6821;&#x9A8C;&#x89C4;&#x5219;&#x5C31;&#x662F;&#x5C06;Action&#x7684;&#x6821;&#x9A8C;&#x65B9;&#x6CD5;&#x4E0E;Action&#x7684;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x76F8;&#x5206;&#x79BB;&#xFF0C;&#x4F7F;&#x5176;&#x8026;&#x5408;&#x5EA6;&#x964D;&#x4F4E;&#xFF0C;&#x4E5F;&#x63D0;&#x9AD8;&#x4E86;Action&#x7684;&#x6821;&#x9A8C;&#x65B9;&#x6CD5;&#x7684;&#x91CD;&#x7528;&#x6027;&#xFF0C;&#x7B26;&#x5408;&#x4E86;AoP&#x7684;&#x601D;&#x60F3;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x626F;&#x4E86;&#x5927;&#x534A;&#x5929;&#xFF0C;&#x5728;ASP.NET MVC&#x4E2D;&#x5230;&#x5E95;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;&#x522B;&#x62C5;&#x5FC3;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x50CF;&#x5199;BasePage&#x4E00;&#x6837;&#xFF0C;&#x5199;&#x4E00;&#x4E2A;BaseController&#x6765;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4F7F;&#x5176;&#x7EE7;&#x627F;&#x4E8E;Controller&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5176;&#x4ED6;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x6821;&#x9A8C;&#x7684;Controller&#x90FD;&#x7EE7;&#x627F;&#x4E8E;BaseController&#x5373;&#x53EF;&#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/2783c2c.gif" alt=""></p>
<pre><code>public class <span class="class">BaseController</span> : <span class="class">Controller</span>
{
    // &amp;<span class="symbol">#x5168</span>;&amp;<span class="symbol">#x5C40</span>;&amp;<span class="symbol">#x5F53</span>;&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x5BF9</span>;&amp;<span class="symbol">#x8C61</span>;
    protected <span class="class">UserInfo</span> <span class="class">CurrentUser</span> { get; private set; }
    // &amp;<span class="symbol">#x5168</span>;&amp;<span class="symbol">#x5C40</span>;<span class="class">Action</span>&amp;<span class="symbol">#x6267</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x9A8C</span>;&amp;<span class="symbol">#x8BC1</span>;&amp;<span class="symbol">#x64CD</span>;&amp;<span class="symbol">#x4F5C</span>;&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x7C7B</span>;&amp;<span class="symbol">#x4F3C</span>;&amp;<span class="symbol">#x4E8E</span>;<span class="class">AoP</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x601D</span>;&amp;<span class="symbol">#x60F3</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x9762</span>;&amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5207</span>;&amp;<span class="symbol">#x9762</span>;&amp;<span class="symbol">#x7F16</span>;&amp;<span class="symbol">#x7A0B</span>;
    protected override void <span class="class">OnActionExecuting</span>(<span class="class">ActionExecutingContext</span> filterContext)
    {
        base.<span class="class">OnActionExecuting</span>(filterContext);
        // &amp;<span class="symbol">#x4ECE</span>;cookie&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x83B7</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x767B</span>;&amp;<span class="symbol">#x5F55</span>;&amp;<span class="symbol">#x7684</span>;sessionId
        string sessionId = <span class="class">Request</span>[&amp;quot;sessionId&amp;quot;];
        if (string.<span class="class">IsNullOrEmpty</span>(sessionId))
        {
            filterContext.<span class="class">Result</span> = new <span class="class">RedirectResult</span>(&amp;quot;/<span class="class">Logon</span>/<span class="class">Index</span>&amp;quot;);
        }
        else
        {
            object obj = <span class="class">MemcacheHelper</span>.<span class="class">Get</span>(sessionId);
            <span class="class">CurrentUser</span> = obj as <span class="class">UserInfo</span>;
            if (<span class="class">CurrentUser</span> == null)
            {
                filterContext.<span class="class">Result</span> = new <span class="class">RedirectResult</span>(&amp;quot;/<span class="class">Logon</span>/<span class="class">Index</span>&amp;quot;);
            }
            // &amp;<span class="symbol">#x518D</span>;&amp;<span class="symbol">#x6B21</span>;&amp;<span class="symbol">#x8BB0</span>;&amp;<span class="symbol">#x5F55</span>;&amp;<span class="symbol">#x5230</span>;<span class="class">Memcache</span>&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x5E03</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x7F13</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x5B9E</span>;&amp;<span class="symbol">#x73B0</span>;<span class="class">Session</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6ED1</span>;&amp;<span class="symbol">#x52A8</span>;&amp;<span class="symbol">#x7A97</span>;&amp;<span class="symbol">#x53E3</span>;&amp;<span class="symbol">#x673A</span>;&amp;<span class="symbol">#x5236</span>;
            <span class="class">MemcacheHelper</span>.<span class="class">Set</span>(sessionId, <span class="class">CurrentUser</span>, <span class="class">DateTime</span>.<span class="class">Now</span>.<span class="class">AddMinutes</span>(<span class="number">20</span>));
        }
    }
}
</code></pre><p> View Code</p>
<p>&#xFF08;3&#xFF09;&#x73B0;&#x5728;&#x6765;&#x770B;&#x770B;&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>&#x2460;&#x4ECE;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4EA4;&#x8FC7;&#x6765;&#x7684;HTTP&#x8BF7;&#x6C42;&#x62A5;&#x6587;&#x4E2D;&#x53D6;&#x5F97;Cookie&#xFF08;&#x4E5F;&#x5C31;&#x662F;SessionId&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;Cookie&#x90A3;&#x4E48;&#x80AF;&#x5B9A;&#x8FD8;&#x6CA1;&#x6709;&#x767B;&#x5F55;&#xFF0C;&#x5C06;&#x8FDB;&#x884C;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x9646;&#x9875;&#x9762;&#xFF1B;</p>
<p>&#x2461;&#x5982;&#x679C;&#x6709;Cookie&#x90A3;&#x4E48;&#x5C31;&#x53BB;Memcached&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x67E5;&#x8BE2;&#x662F;&#x5426;&#x6709;&#x8FD9;&#x4E2A;Key&#x7684;&#x6570;&#x636E;&#x5185;&#x5BB9;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6CA1;&#x6709;&#x5185;&#x5BB9;&#xFF0C;&#x90A3;&#x4E48;&#x8FD8;&#x662F;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x9646;&#x9875;&#x9762;&#xFF1B;&#x5982;&#x679C;&#x6709;&#x5185;&#x5BB9;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x7531;&#x4E8E;&#x8FD4;&#x56DE;&#x7684;&#x662F;Object&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x8F6C;&#x6362;&#x4E00;&#x4E0B;&#x8D4B;&#x7ED9;&#x5168;&#x5C40;&#x7684;&#x7528;&#x6237;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x3002;</p>
<p>&#x2462;&#x83B7;&#x53D6;&#x5230;UserInfo&#x5BF9;&#x8C61;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x6B21;&#x5C06;&#x5176;&#x91CD;&#x65B0;&#x5B58;&#x50A8;&#x5230;Memcached&#x4E2D;&#xFF0C;&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x662F;&#x5C06;Session&#x5EF6;&#x957F;&#x5931;&#x6548;&#x65F6;&#x95F4;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;Session&#x7684; <strong>&#x6ED1;&#x52A8;&#x65F6;&#x95F4;&#x673A;&#x5236;</strong> &#x7684;&#x6548;&#x679C;&#x3002; </p>
<p>PS&#xFF1A;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5728;&#x767B;&#x5F55;&#x9A8C;&#x8BC1;&#x7684;Action&#x91CC;&#x9762;&#x7ED9;&#x8FD9;&#x4E2A;&#x7F13;&#x5B58;&#x8BBE;&#x7F6E;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x662F;&#x4E00;&#x4E2A;&#x7EDD;&#x5BF9;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x975E;&#x6ED1;&#x52A8;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x3002;&#x6240;&#x8C13; <strong>&#x7EDD;&#x5BF9;&#x65F6;&#x95F4;&#x662F;&#x6307;&#x5230;&#x4E86;&#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x4EE5;&#x540E;&#x4FBF;&#x4F1A;&#x5931;&#x6548;</strong> &#xFF0C;&#x800C; <strong>&#x6ED1;&#x52A8;&#x65F6;&#x95F4;&#x662F;&#x6307;&#x5728;&#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x65E0;&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#x4FBF;&#x5931;&#x6548;</strong> &#x3002; </p>
<h2 id="2-6_&#x6D4B;&#x8BD5;&#x8FD0;&#x884C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x4E0E;Session&#x5B58;&#x50A8;">2.6 &#x6D4B;&#x8BD5;&#x8FD0;&#x884C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x4E0E;Session&#x5B58;&#x50A8;</h2><p>&#xFF08;1&#xFF09;&#x5230;&#x6B64;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x5DF2;&#x5B8C;&#x6BD5;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x5C0F;&#x6D4B;&#x8BD5;&#xFF0C;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;Controller&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#x201C;HomeController&#x201D;&#xFF0C;&#x5C06;Index&#x9875;&#x9762;&#x7528;&#x4F5C;&#x767B;&#x9646;&#x540E;&#x7684;&#x4E3B;&#x9875;&#xFF0C;&#x663E;&#x793A;Session&#x5BF9;&#x8C61;&#x4E2D;&#x7684;UserName&#x5C5E;&#x6027;&#x3002;&#x4EE3;&#x7801;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x6709;&#x4E24;&#x884C;&#xFF1A;</p>
<pre><code><span class="xml">public ActionResult Index()
        </span><span class="expression">{
            /<span class="end-block">/ </span>&amp;<span class="begin-block">#x</span>4<span class="variable">ECE</span>;<span class="variable">Memcached</span>&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>2<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>83<span class="variable">B</span>7;&amp;<span class="begin-block">#x</span>53<span class="variable">D</span>6;<span class="variable">Session</span>&amp;<span class="begin-block">#x</span>5<span class="variable">E</span>76;&amp;<span class="begin-block">#x</span>4<span class="variable">F</span>20;&amp;<span class="begin-block">#x</span>7<span class="variable">ED</span>9;<span class="variable">View</span>
            <span class="variable">ViewBag.UserName</span> = <span class="variable">CurrentUser.UserName</span>;
            <span class="variable">return</span> <span class="variable">View</span>();
        }</span><span class="xml">    </span>
</code></pre><p>&#x81F3;&#x4E8E;View&#xFF0C;&#x8BF7;&#x53C2;&#x8003;Demo&#x6587;&#x4EF6;&#xFF0C;&#x6B64;&#x5904;&#x5C31;&#x4E0D;&#x5728;&#x8D58;&#x8FF0;&#x4E86;&#xFF0C;&#x5C31;&#x4E00;&#x5806;HTML&#x800C;&#x5DF2;&#x3002;</p>
<p>&#xFF08;2&#xFF09;&#x2460;&#x5F00;&#x542F;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x7684;&#x4E24;&#x53F0;Windows Server&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x786E;&#x4FDD;Memcached&#x670D;&#x52A1;&#x90FD;&#x5DF2;&#x6210;&#x529F;&#x5F00;&#x542F;&#x3002;&#xFF08;&#x5982;&#x679C;&#x4F60;&#x662F;&#x88C5;&#x5728;&#x672C;&#x673A;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x5F00;&#x542F;&#x670D;&#x52A1;&#x5373;&#x53EF;&#xFF09;</p>
<p>&#x2461;&#x5F00;&#x542F;MySQL&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x7684;MySQL&#x662F;&#x88C5;&#x5728;&#x672C;&#x673A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x8981;&#x5F00;&#x542F;&#x670D;&#x52A1;&#x5373;&#x53EF;&#x3002;</p>
<p>&#xFF08;3&#xFF09;&#x70B9;&#x51FB;&#x8C03;&#x8BD5;&#xFF0C;&#x5F00;&#x59CB;&#x8FD0;&#x884C;IIS Express&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x5427;&#x9A9A;&#x5E74;&#xFF08;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x8BF4;&#x660E;&#x7684;&#xFFFD;&#xFFFD;&#xFFFD;&#xFF1A;&#x4F60;&#x9700;&#x8981;&#x9996;&#x5148;&#x968F;&#x4FBF;&#x8F93;&#x5165;&#x4E00;&#x4E2A;&#x8D26;&#x53F7;&#x548C;&#x5BC6;&#x7801;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x7684;&#x662F;Code First&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x5165;MySQL&#x6DFB;&#x52A0;&#x51E0;&#x884C;&#x6D4B;&#x8BD5;&#x7528;&#x6237;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x4E86;&#x51E0;&#x884C;&#xFF0C;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;&#xFF09;&#x6211;&#x5728;&#x6570;&#x636E;&#x5E93;&#x91CC;&#x8FB9;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x884C;{&#x8D26;&#x53F7;&#xFF1A;edisonchou&#xFF0C;&#x5BC6;&#x7801;&#xFF1A;123456}&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x8F93;&#x5165;&#x8D26;&#x53F7;&#x548C;&#x5BC6;&#x7801;&#xFF0C;&#x70B9;&#x51FB;&#x767B;&#x5F55;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x4E00;&#x4E2A;&#x53CB;&#x597D;&#x7684;&#x63D0;&#x793A;&#xFF1A;&#x201C;&#x6B63;&#x5728;&#x9A8C;&#x8BC1;&#x4E2D;&#xFF0C;&#x8BF7;&#x7A0D;&#x5019;…&#x201D;&#xFF08;&#x5982;&#x679C;&#x4F60;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x4F1A;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x4E0D;&#x8981;&#x62C5;&#x5FC3;&#xFF09;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/2783e9d.jpg" alt=""></p>
<p>&#xFF08;4&#xFF09;&#x7B49;&#x5F85;&#x7CFB;&#x7EDF;&#x9A8C;&#x8BC1;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4FBF;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;&#x7CFB;&#x7EDF;&#x4E3B;&#x9875;&#xFF0C;&#x663E;&#x793A;&#x6B22;&#x8FCE;&#x754C;&#x9762;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4E0B;&#x56FE;&#x4E2D;&#x7684;&#x4E24;&#x5904;&#x662F;&#x6839;&#x636E;Session&#x7684;UserName&#x6765;&#x663E;&#x793A;&#x7684;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/2783e9d.jpg" alt=""></p>
<p>&#xFF08;5&#xFF09;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x4FEE;&#x6539;URL&#xFF0C;&#x8F93;&#x5165;/Logon/Index&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;&#x767B;&#x9646;&#x9875;&#x9762;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x518D;&#x4FEE;&#x6539;URL&#x4E3A;/Home/Index&#xFF0C;&#x770B;&#x770B;&#x662F;&#x5426;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#xFF0C;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5C06;Session&#x5B58;&#x5165;&#x4E86;Memcached&#xFF0C;&#x6240;&#x4EE5;&#x518D;&#x6B21;&#x8FDB;&#x5165;/Home/Index&#x8FD9;&#x4E2A;Action&#x65F6;&#x4F1A;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#xFF0C;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x4F20;&#x8FC7;&#x53BB;&#x7684;Cookie&#x53BB;Memcached&#x4E2D;&#x53D6;Session&#xFF0C;&#x5982;&#x5B58;&#x5728;&#x5219;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x767B;&#x5F55;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x518D;&#x6B21;&#x8DF3;&#x8F6C;/Home/Index&#x7684;HTTP&#x62A5;&#x6587;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x767B;&#x5F55;&#x4E4B;&#x540E;&#x5DF2;&#x7ECF;&#x5199;&#x5165;&#x4E86;Cookie&#xFF0C;&#x4E4B;&#x540E;&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x5E26;&#x4E0A;Cookie&#x4F20;&#x9012;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x4E5F;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Cookie&#x4F5C;&#x4E3A;Key&#x83B7;&#x53D6;Session&#x5BF9;&#x8C61;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/2783e9d.jpg" alt=""></p>
<p>&#xFF08;6&#xFF09;&#x65B0;&#x5F00;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x518D;&#x4F7F;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x767B;&#x5F55;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2783e9d.jpg" alt=""></p>
<p>&#xFF08;7&#xFF09;&#x767B;&#x9646;&#x540E;&#xFF0C;&#x67E5;&#x770B;HTTP&#x62A5;&#x6587;&#xFF0C;&#x83B7;&#x53D6;Cookie&#x4E2D;&#x7684;sessionId&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/278410e.jpg" alt=""></p>
<p>&#xFF08;8&#xFF09;&#x6839;&#x636E;&#x4E24;&#x4E2A;&#x7528;&#x6237;&#x7684;sessionId&#x4F5C;&#x4E3A;Key&#xFF0C;&#x5728;Memcached&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x67E5;&#x770B;&#x5B58;&#x50A8;&#x60C5;&#x51B5;&#xFF1A;&#x7ECF;&#x67E5;&#x770B;&#xFF0C;&#x4E24;&#x4E2A;Session&#x90FD;&#x5B58;&#x50A8;&#x5230;&#x4E86;192.168.80.11&#x8FD9;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x91CC;&#x8FB9;&#x3002;&#x4E3A;&#x4F55;&#x6CA1;&#x6709;&#x5E73;&#x5747;&#x5206;&#x914D;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x7B97;&#x6CD5;&#x662F;&#x6839;&#x636E;&#x8BA1;&#x7B97;Hash&#x503C;&#x6765;&#x7684;&#xFF0C;&#x521A;&#x597D;&#x8FD9;&#x4E24;&#x4E2A;sessionId&#x8BA1;&#x7B97;&#x540E;&#x7684;Hash&#x503C;&#x90FD;&#x662F;&#x8981;&#x5206;&#x914D;&#x5230;192.168.80.11&#x8FD9;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x91CC;&#x8FB9;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x90FD;&#x5B58;&#x5230;&#x4E86;&#x8FD9;&#x91CC;&#x8FB9;&#x3002;&#xFF08;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;&#x8FD9;&#x91CC;&#x4EC5;&#x4EC5;&#x662F;&#x5728;&#x6211;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x8DD1;&#x7684;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#xFF0C;&#x7F51;&#x53CB;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x53EF;&#x80FD;&#x4F1A;&#x8DDF;&#x6211;&#x7684;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF09;</p>
<p><img src="http://taojinke.github.io/img/20150703/278410e.jpg" alt=""></p>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x5C0F;&#x6D4B;&#x8BD5;&#x5230;&#x6B64;&#x7ED3;&#x675F;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x6848;&#x4F8B;&#x4E5F;&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#x3002;</p>
<h2 id="&#x4E09;&#x3001;&#x5B66;&#x4E60;&#x5C0F;&#x7ED3;">&#x4E09;&#x3001;&#x5B66;&#x4E60;&#x5C0F;&#x7ED3;</h2><p>&#x672C;&#x7BC7;&#x6211;&#x9996;&#x5148;&#x901A;&#x8FC7;&#x82B1;&#x5927;&#x529B;&#x6C14;&#x5BF9;Session&#x670D;&#x52A1;&#x5668;&#x573A;&#x666F;&#x7684;&#x7B80;&#x4ECB;&#x5F15;&#x51FA;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x5BF9;&#x4E8E;&#x6784;&#x5EFA;Session&#x670D;&#x52A1;&#x5668;&#x7684;&#x53EF;&#x884C;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;ASP.NET MVC+EF Code First+MySQL+Memcached&#x6765;&#x6A21;&#x62DF;&#x4E86;&#x4E00;&#x4E2A;&#x4FE1;&#x606F;&#x7CFB;&#x7EDF;&#x767B;&#x5F55;&#x573A;&#x666F;&#xFF0C;&#x5176;&#x4E2D;&#x501F;&#x52A9;&#x4E86;Memcached&#x6765;&#x5B58;&#x50A8;Session&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;Action&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#x6765;&#x5B9E;&#x73B0;&#x5BF9;&#x7528;&#x6237;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x7684;&#x6821;&#x9A8C;&#x3002;&#x6700;&#x540E;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5C0F;&#x6D4B;&#x8BD5;&#xFF0C;&#x6765;&#x9A8C;&#x8BC1;Memcached&#x662F;&#x5426;&#x5B58;&#x50A8;&#x4E86;&#x6211;&#x4EEC;&#x7684;Session&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x6B64;&#x6848;&#x4F8B;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x73A9;&#x5177;&#x7EA7;&#x522B;&#x7684;Demo&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x7ECF;&#x8FC7;&#x5F88;&#x591A;&#x6B21;&#x6027;&#x80FD;&#x6D4B;&#x8BD5;&#x548C;&#x4F18;&#x5316;&#x624D;&#x80FD;&#x5E94;&#x7528;&#x5230;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x4E2D;&#x4E86;&#x89E3;&#x5230;&#x4E00;&#x4E9B;&#x6709;&#x76CA;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x7406;&#x89E3;&#x8FD9;&#x4E9B;&#x601D;&#x60F3;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x80FD;&#x529B;&#x6709;&#x6240;&#x88E8;&#x76CA;&#x7684;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x5E0C;&#x671B;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x80FD;&#x591F;&#x7ED9;&#x66F4;&#x591A;&#x7684;&#x50CF;&#x6211;&#x4E00;&#x6837;&#x7684;&#x83DC;&#x9E1F;&#x5F00;&#x53D1;&#x8005;&#x5E26;&#x6765;&#x4E00;&#x70B9;&#x5149;&#x660E;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x89C9;&#x5F97;&#x6709;&#x7528;&#xFF0C;&#x90A3;&#x5C31;&#x9EBB;&#x70E6;&#x70B9;&#x4E00;&#x4E0B;&#x201C;&#x63A8;&#x8350;&#x201D;&#x5427;&#xFF0C;&#x8C22;&#x8C22;&#xFF01;</p>
<h2 id="&#x53C2;&#x8003;&#x6587;&#x732E;">&#x53C2;&#x8003;&#x6587;&#x732E;</h2><p>&#xFF08;1&#xFF09;&#x674E;&#x667A;&#x6167;&#xFF0C;&#x300A;&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x6280;&#x672F;&#x67B6;&#x6784;-&#x6838;&#x5FC3;&#x539F;&#x7406;&#x4E0E;&#x6848;&#x4F8B;&#x5206;&#x6790;&#x300B;&#xFF0C;<a href="http://item.jd.com/11322972.html" target="_blank" rel="external">http://item.jd.com/11322972.html</a></p>
<p>&#xFF08;2&#xFF09;&#x9A6C;&#x4F26;&#xFF0C;&#x300A;Memcached&#x516C;&#x5F00;&#x8BFE;&#x300B;&#xFF0C;<a href="http://bbs.itcast.cn/thread-14836-1-1.html" target="_blank" rel="external">http://bbs.itcast.cn/thread-14836-1-1.html</a></p>
<p>&#xFF08;3&#xFF09;&#x65CB;&#x98CE;&#xFF0C;&#x300A;Memcached&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x66FF;&#x4EE3;Session&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x300B;&#xFF0C;<a href="http://www.cnblogs.com/xuanfeng/archive/2009/06/04/1494735.html" target="_blank" rel="external">http://www.cnblogs.com/xuanfeng/archive/2009/06/04/1494735.html</a></p>
<p>&#xFF08;4&#xFF09;&#x91D1;&#x65ED;&#x4EAE;&#xFF0C;&#x300A;Entity Framework&#x8D70;&#x9A6C;&#x89C2;&#x82B1;&#x300B;&#xFF0C;<a href="http://blog.csdn.net/bitfan/article/details/12779517" target="_blank" rel="external">http://blog.csdn.net/bitfan/article/details/12779517</a></p>
<p>&#xFF08;5&#xFF09;MSDN&#xFF0C;&#x300A;&#x9759;&#x6001;&#x7C7B;&#x548C;&#x9759;&#x6001;&#x6210;&#x5458;&#xFF08;C#&#x7F16;&#x7A0B;&#x6307;&#x5357;&#xFF09;&#x300B;&#xFF0C;<a href="http://msdn.microsoft.com/zh-cn/library/79b3xss3.aspx" target="_blank" rel="external">http://msdn.microsoft.com/zh-cn/library/79b3xss3.aspx</a></p>
<p>&#xFF08;6&#xFF09;&#x75DE;&#x5B50;&#x4E00;&#x6BDB;&#xFF0C;&#x300A;Memcached+Cookie&#x66FF;&#x4EE3;Session&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF08;MVC&#x7248;&#xFF09;&#x300B;&#xFF0C;<a href="http://www.cnblogs.com/piziyimao/archive/2013/01/29/2882236.html" target="_blank" rel="external">http://www.cnblogs.com/piziyimao/archive/2013/01/29/2882236.html</a></p>
<p>&#xFF08;7&#xFF09;&#x778C;&#x7761;&#x9F99;&#x98DE;&#xFF0C;&#x300A;.NET&#x4E2D;Cache&#x7684;&#x7528;&#x6CD5;&#x300B;&#xFF0C;<a href="http://blog.csdn.net/ttotcs/article/details/7476234" target="_blank" rel="external">http://blog.csdn.net/ttotcs/article/details/7476234</a></p>
<p>&#xFF08;8&#xFF09;lulu Studio&#xFF0C;&#x300A;ASP.NET MVC:Action&#x8FC7;&#x6EE4;&#x5668;&#xFF08;Filtering&#xFF09;&#x300B;&#xFF0C;<a href="http://www.cnblogs.com/QLeelulu/archive/2008/03/21/1117092.html" target="_blank" rel="external">http://www.cnblogs.com/QLeelulu/archive/2008/03/21/1117092.html</a></p>
<h2 id="&#x9644;&#x4EF6;&#x4E0B;&#x8F7D;">&#x9644;&#x4EF6;&#x4E0B;&#x8F7D;</h2><p>&#xFF08;1&#xFF09;MemcachedMvcDemo&#xFF1A; <a href="http://pan.baidu.com/s/1gd3RvKB" target="_blank" rel="external">http://pan.baidu.com/s/1gd3RvKB</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="&#x4E00;&#x3001;&#x9AD8;&#x53EF;&#x7528;&#x7684;Session&#x670D;&#x52A1;&#x5668;&#x573A;&#x666F;&#x7B80;&#x4ECB;">&#x4E00;&#x3001;&#x]]>
    </summary>
    
      <category term="Memcached" scheme="http://taojinke.github.io/tags/Memcached/"/>
    
      <category term="数据库" scheme="http://taojinke.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[【转】 Key/Value之王Memcached初探：二、Memcached在.Net中的基本操作 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/2776554/"/>
    <id>http://taojinke.github.io/2015/07/03/2776554/</id>
    <published>2015-07-03T02:09:44.000Z</published>
    <updated>2015-07-03T14:09:44.273Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x4E00;&#x3001;Memcached_ClientLib_For_-Net">&#x4E00;&#x3001;Memcached ClientLib For .Net</h2><p>&#x9996;&#x5148;&#xFF0C;&#x4E0D;&#x5F97;&#x4E0D;&#x8BF4;&#xFF0C;&#x8BB8;&#x591A;&#x8BED;&#x8A00;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&#x8FDE;&#x63A5;Memcached&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5176;&#x4E2D;&#x4EE5;Perl&#x3001;PHP&#x4E3A;&#x4E3B;&#x3002; &#x4EC5;&#x4EC5;memcached&#x7F51;&#x7AD9;&#x4E0A;&#x5217;&#x51FA;&#x7684;&#x8BED;&#x8A00;&#x5C31;&#x6709;&#xFF1A;Perl&#x3001;PHP&#x3001;Python&#x3001;Ruby&#x3001; <strong>C#&#x3001;</strong> C/C++&#x4EE5;&#x53CA;Lua&#x7B49;&#x3002; </p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x4F5C;&#x4E3A;.Net&#x7801;&#x519C;&#xFF0C;&#x81EA;&#x7136;&#x662F;&#x4F7F;&#x7528;C#&#x3002;&#x65E2;&#x7136;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x6709;.Net&#x7248;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x5C31;&#x53BB;&#x4E0B;&#x8F7D;&#x4E00;&#x4E2A;&#x6765;&#x8BD5;&#x8BD5;&#x3002;</p>
<p>&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;&#xFF1A; <a href="http://pan.baidu.com/s/1w9Q8I" target="_blank" rel="external">http://pan.baidu.com/s/1w9Q8I</a></p>
<p>memcached clientlib&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A; <a href="http://sourceforge.net/projects/memcacheddotnet/" target="_blank" rel="external">http://sourceforge.net/projects/memcacheddotnet/</a></p>
<p>&#x89E3;&#x538B;&#x8BE5;&#x5305;&#xFF0C;&#x91CC;&#x9762;&#x6709;1.1&#x548C;2.0&#x4E24;&#x4E2A;&#x7248;&#x672C;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;2.0&#x7248;&#x672C;&#x7684;&#x3002;&#xFF08;&#x5728;&#x538B;&#x7F29;&#x5305;&#x4E2D;&#x7684;&#x76EE;&#x5F55;&#x5730;&#x5740;&#x4E3A;&#xFF1A;\memcacheddotnet_clientlib-1.1.5\memcacheddotnet\trunk\clientlib\src\clientlib\bin\2.0\Release&#xFF09;</p>
<p><img src="http://taojinke.github.io/img/20150703/276d067.jpg" alt=""></p>
<p>&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x56DB;&#x4E2A;dll&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5F15;&#x5165;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x7A0B;&#x5E8F;&#x96C6;&#xFF0C;&#x6709;&#x4E86;&#x4ED6;&#x4EEC;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x548C;Memcached&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x4E86;&#xFF0C;&#x723D;&#x6B6A;&#x6B6A;&#x554A;&#x3002;</p>
<h2 id="&#x4E8C;&#x3001;&#x5728;-Net&#x4E2D;&#x8FDB;&#x884C;Memcached&#x57FA;&#x672C;&#x64CD;&#x4F5C;">&#x4E8C;&#x3001;&#x5728;.Net&#x4E2D;&#x8FDB;&#x884C;Memcached&#x57FA;&#x672C;&#x64CD;&#x4F5C;</h2><h2 id="2-1_&#x57FA;&#x672C;&#x7684;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x64CD;&#x4F5C;">2.1 &#x57FA;&#x672C;&#x7684;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x64CD;&#x4F5C;</h2><p>&#xFF08;1&#xFF09;&#x9996;&#x5148;&#xFF0C;&#x6253;&#x5F00;Windows Server 2003&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5F00;&#x542F;Memcached&#x670D;&#x52A1;&#xFF1B;&#xFF08;&#x975E;&#x5FC5;&#x8981;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x662F;&#x5728;&#x672C;&#x673A;&#xFF0C;&#x5219;&#x53EF;&#x8DF3;&#x8FC7;&#x8FD9;&#x4E00;&#x6B65;&#xFF0C;&#x53EA;&#x9700;&#x5F00;&#x542F;Memcached&#x670D;&#x52A1;&#x5373;&#x53EF;&#xFF09;</p>
<p><img src="http://taojinke.github.io/img/20150703/276d067.jpg" alt=""></p>
<p>&#xFF08;2&#xFF09;&#x2460;&#x6253;&#x5F00;VS&#xFF0C;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;C#&#x7684;&#x63A7;&#x5236;&#x53F0;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#xFF1A;MemcachedClientDemo&#x3002;</p>
<p>&#x2461;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;Lib&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x4E0A;&#x9762;&#x4E0B;&#x8F7D;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7A0B;&#x5E8F;&#x96C6;dll&#x62F7;&#x8D1D;&#x5230;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x5BF9;&#x8FD9;&#x51E0;&#x4E2A;dll&#x7684;&#x5F15;&#x7528;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/276d2d8.jpg" alt=""></p>
<p>&#xFF08;3&#xFF09;&#x5F00;&#x59CB;&#x5199;&#x4EE3;&#x7801;&#xFF0C;&#x901A;&#x8FC7;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<p> <img src="http://taojinke.github.io/img/20150703/276d2d8.gif" alt=""></p>
<pre><code>    [<span class="class">STAThread</span>]
    static void <span class="class">Main</span>(string[] args)
    {
// <span class="class">Memcached</span>&amp;<span class="symbol">#x670D</span>;&amp;<span class="symbol">#x52A1</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#x5217</span>;&amp;<span class="symbol">#x8868</span>;
// &amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x53F0</span>;&amp;<span class="symbol">#x670D</span>;&amp;<span class="symbol">#x52A1</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x9017</span>;&amp;<span class="symbol">#x53F7</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x9694</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x4F8B</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#xFF1A</span>;&amp;quot;<span class="number">192.168</span>.80.10:<span class="number">11211</span>&amp;quot;,&amp;quot;<span class="number">192.168</span>.80.11:<span class="number">11211</span>&amp;quot;
string[] serverList = { &amp;quot;<span class="number">192.168</span>.80.10:<span class="number">11211</span>&amp;quot; };
// &amp;<span class="symbol">#x521D</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x5316</span>;<span class="class">SocketIO</span>&amp;<span class="symbol">#x6C60</span>;
string poolName = &amp;quot;<span class="class">MyPool</span>&amp;quot;;
<span class="class">SockIOPool</span> sockIOPool = <span class="class">SockIOPool</span>.<span class="class">GetInstance</span>(poolName);
// &amp;<span class="symbol">#x6DFB</span>;&amp;<span class="symbol">#x52A0</span>;&amp;<span class="symbol">#x670D</span>;&amp;<span class="symbol">#x52A1</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#x5217</span>;&amp;<span class="symbol">#x8868</span>;
sockIOPool.<span class="class">SetServers</span>(serverList);
// &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6C60</span>;&amp;<span class="symbol">#x521D</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x76EE</span>;
sockIOPool.<span class="class">InitConnections</span> = <span class="number">3</span>;
// &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6C60</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x5C0F</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x76EE</span>;
sockIOPool.<span class="class">MinConnections</span> = <span class="number">3</span>;
// &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6C60</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x76EE</span>;
sockIOPool.<span class="class">MaxConnections</span> = <span class="number">5</span>;
// &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5957</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x8D85</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x95F4</span>;&amp;<span class="symbol">#xFF08</span>;&amp;<span class="symbol">#x5355</span>;&amp;<span class="symbol">#x4F4D</span>;&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x6BEB</span>;&amp;<span class="symbol">#x79D2</span>;&amp;<span class="symbol">#xFF09</span>;
sockIOPool.<span class="class">SocketConnectTimeout</span> = <span class="number">1000</span>;
// &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x5957</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x8D85</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x95F4</span>;&amp;<span class="symbol">#xFF08</span>;&amp;<span class="symbol">#x5355</span>;&amp;<span class="symbol">#x4F4D</span>;&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x6BEB</span>;&amp;<span class="symbol">#x79D2</span>;&amp;<span class="symbol">#xFF09</span>;
sockIOPool.<span class="class">SocketTimeout</span> = <span class="number">3000</span>;
// &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x7EF4</span>;&amp;<span class="symbol">#x62A4</span>;&amp;<span class="symbol">#x7EBF</span>;&amp;<span class="symbol">#x7A0B</span>;&amp;<span class="symbol">#x8FD0</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x7761</span>;&amp;<span class="symbol">#x7720</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x95F4</span>;&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x4E3A</span>;<span class="number">0</span>&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x90A3</span>;&amp;<span class="symbol">#x4E48</span>;&amp;<span class="symbol">#x7EF4</span>;&amp;<span class="symbol">#x62A4</span>;&amp;<span class="symbol">#x7EBF</span>;&amp;<span class="symbol">#x7A0B</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x542F</span>;&amp;<span class="symbol">#x52A8</span>;
sockIOPool.<span class="class">MaintenanceSleep</span> = <span class="number">30</span>;
// &amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;<span class="class">SockIO</span>&amp;<span class="symbol">#x6C60</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6545</span>;&amp;<span class="symbol">#x969C</span>;&amp;<span class="symbol">#x6807</span>;&amp;<span class="symbol">#x5FD7</span>;
sockIOPool.<span class="class">Failover</span> = <span class="keyword">true</span>;
// &amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x7528</span>;nagle&amp;<span class="symbol">#x7B97</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x542F</span>;&amp;<span class="symbol">#x52A8</span>;
sockIOPool.<span class="class">Nagle</span> = <span class="keyword">false</span>;
// &amp;<span class="symbol">#x6B63</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x521D</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x5316</span>;&amp;<span class="symbol">#x5BB9</span>;&amp;<span class="symbol">#x5668</span>;
sockIOPool.<span class="class">Initialize</span>();
// &amp;<span class="symbol">#x83B7</span>;&amp;<span class="symbol">#x53D6</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x5B9E</span>;&amp;<span class="symbol">#x4F8B</span>;
<span class="class">MemcachedClient</span> memClient = new <span class="class">MemcachedClient</span>();
// &amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x5B9A</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x8BBF</span>;&amp;<span class="symbol">#x95EE</span>;&amp;<span class="symbol">#x7684</span>;<span class="class">SockIO</span>&amp;<span class="symbol">#x6C60</span>;
memClient.<span class="class">PoolName</span> = poolName;
// &amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x542F</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x542F</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x4E8E</span>;&amp;<span class="symbol">#x95E8</span>;&amp;<span class="symbol">#x69DB</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x88AB</span>;&amp;<span class="symbol">#x50A8</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5728</span>;&amp;<span class="symbol">#x538B</span>;&amp;<span class="symbol">#x7F29</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5F62</span>;&amp;<span class="symbol">#x5F0F</span>;
memClient.<span class="class">EnableCompression</span> = <span class="keyword">false</span>;
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;----------------------------&amp;<span class="symbol">#x6D4B</span>;&amp;<span class="symbol">#x8BD5</span>;&amp;<span class="symbol">#x5F00</span>;&amp;<span class="symbol">#x59CB</span>;----------------------------&amp;quot;);
// <span class="number">01.</span>&amp;<span class="symbol">#x7B80</span>;&amp;<span class="symbol">#x5355</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6DFB</span>;&amp;<span class="symbol">#x52A0</span>;&amp;<span class="symbol">#x4E0E</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x64CD</span>;&amp;<span class="symbol">#x4F5C</span>;
memClient.<span class="class">Set</span>(&amp;quot;test1&amp;quot;, &amp;quot;edisonchou&amp;quot;);
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="method">test1:</span>{<span class="number">0</span>}&amp;quot;, memClient.<span class="class">Get</span>(&amp;quot;test1&amp;quot;));
// <span class="number">02.</span>&amp;<span class="symbol">#x5148</span>;&amp;<span class="symbol">#x6DFB</span>;&amp;<span class="symbol">#x52A0</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x4FEE</span>;&amp;<span class="symbol">#x6539</span>;&amp;<span class="symbol">#x518D</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x64CD</span>;&amp;<span class="symbol">#x4F5C</span>;
memClient.<span class="class">Set</span>(&amp;quot;test2&amp;quot;, &amp;quot;jacky&amp;quot;);
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="method">test2:</span>{<span class="number">0</span>}&amp;quot;, memClient.<span class="class">Get</span>(&amp;quot;test2&amp;quot;));
memClient.<span class="class">Set</span>(&amp;quot;test2&amp;quot;, &amp;quot;edwin&amp;quot;);
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="method">test2:</span>{<span class="number">0</span>}&amp;quot;, memClient.<span class="class">Get</span>(&amp;quot;test2&amp;quot;));
memClient.<span class="class">Replace</span>(&amp;quot;test2&amp;quot;, &amp;quot;lousie&amp;quot;);
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="method">test2:</span>{<span class="number">0</span>}&amp;quot;, memClient.<span class="class">Get</span>(&amp;quot;test2&amp;quot;));
// <span class="number">03.</span>&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;<span class="class">Key</span>&amp;<span class="symbol">#x503C</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5728</span>;
if (memClient.<span class="class">KeyExists</span>(&amp;quot;test2&amp;quot;))
{
    <span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="class">Key</span>:test2 is existed&amp;quot;);
}
// <span class="number">04.</span>&amp;<span class="symbol">#x5220</span>;&amp;<span class="symbol">#x9664</span>;&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x5B9A</span>;<span class="class">Key</span>&amp;<span class="symbol">#x503C</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;
memClient.<span class="class">Add</span>(&amp;quot;test3&amp;quot;, &amp;quot;memcached&amp;quot;);
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="method">test3:</span>{<span class="number">0</span>}&amp;quot;, memClient.<span class="class">Get</span>(&amp;quot;test3&amp;quot;));
memClient.<span class="class">Delete</span>(&amp;quot;test3&amp;quot;);
if (!memClient.<span class="class">KeyExists</span>(&amp;quot;test3&amp;quot;))
{
    <span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="class">Key</span>:test3 is not existed&amp;quot;);
}
// <span class="number">05.</span>&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x671F</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x95F4</span>;&amp;<span class="symbol">#xFF1A</span>;<span class="number">5</span>&amp;<span class="symbol">#x79D2</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x671F</span>;
memClient.<span class="class">Add</span>(&amp;quot;test4&amp;quot;, &amp;quot;expired&amp;quot;, <span class="class">DateTime</span>.<span class="class">Now</span>.<span class="class">AddSeconds</span>(<span class="number">5</span>));
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="method">test4:</span>{<span class="number">0</span>}&amp;quot;, memClient.<span class="class">Get</span>(&amp;quot;test4&amp;quot;));
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="class">Please</span> waiting the sleeping time&amp;quot;);
<span class="class">System</span>.<span class="class">Threading</span>.<span class="class">Thread</span>.<span class="class">Sleep</span>(<span class="number">6000</span>);
if(!memClient.<span class="class">KeyExists</span>(&amp;quot;test4&amp;quot;))
{
    <span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;test4 is expired&amp;quot;);
}
<span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;----------------------------&amp;<span class="symbol">#x6D4B</span>;&amp;<span class="symbol">#x8BD5</span>;&amp;<span class="symbol">#x5B8C</span>;&amp;<span class="symbol">#x6210</span>;----------------------------&amp;quot;);
// &amp;<span class="symbol">#x5173</span>;&amp;<span class="symbol">#x95ED</span>;<span class="class">SockIO</span>&amp;<span class="symbol">#x6C60</span>;
sockIOPool.<span class="class">Shutdown</span>();
<span class="class">Console</span>.<span class="class">ReadKey</span>();
    }
</code></pre><p> <img src="http://taojinke.github.io/img/20150703/276d549.gif" alt=""></p>
<p>&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x7EC6;&#x7EC6;&#x5206;&#x6790;&#x4E0B;&#x8FD9;&#x6BB5;&#x795E;&#x5947;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>&#x2460;&#x9996;&#x5148;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;string&#x7C7B;&#x578B;&#x7684;&#x6570;&#x7EC4;&#x6765;&#x8BB0;&#x5F55; <strong>Memcached&#x670D;&#x52A1;&#x5668;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;</strong> &#xFFFD;&#xFFFD;&#xFFFD;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5982;&#x679C;&#x6709;&#x591A;&#x53F0;Memcached&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694;&#x5F00;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&quot;192.168.80.10:11211&quot;,&quot;192.168.80.11:11211&quot;,&quot;192.168.80.12:11211&quot;&#xFF1B; </p>
<p>&#x2461;SockIOPool&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Socket&#xFF08;&#x5957;&#x63A5;&#x5B57;&#xFF09;&#x7684;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x6362;&#x4E2A;&#x65B9;&#x5F0F;&#x7406;&#x89E3;&#xFF1A;Memcached&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A; <strong>Socket&#x7684;&#x670D;&#x52A1;&#x5668;&#x7AEF;</strong> &#xFF0C;&#x5B83;&#x4E0D;&#x505C;&#x5730;&#x63A5;&#x6536;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x6765;&#x7684;&#x8BFB;&#x5199;&#x8BF7;&#x6C42;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;SockIOPool.GetInstance(&quot;MyPool&quot;)&#x6765;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;MyPool&#x7684;&#x8FDE;&#x63A5;&#x6C60;&#x5B9E;&#x4F8B;&#xFF0C;&#x770B;&#x5230;GetInstance()&#x8FD9;&#x4E2A;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x4FBF;&#x77E5;&#x9053;&#x8FD9;&#x662F;&#x91C7;&#x7528;&#x4E86;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x3002;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4E3A;&#x5176;&#x914D;&#x7F6E;&#x4E86;&#x53EF;&#x8BBF;&#x95EE;&#x7684;Memcached&#x670D;&#x52A1;&#x5668;&#x5217;&#x8868;&#x3001;&#x8FDE;&#x63A5;&#x6570;&#x3001;&#x5957;&#x63A5;&#x5B57;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7B49;&#x914D;&#x7F6E;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;Initialize()&#x65B9;&#x6CD5;&#x6B63;&#x5F0F;&#x5730;&#x521D;&#x59CB;&#x5316;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x7B49;&#x5F85;&#x540E;&#x9762;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#xFF1B; </p>
<p>PS&#xFF1A;&#x795E;&#x9A6C;&#x662F; <strong>Socket</strong> &#xFF1F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x751F;&#x6D3B;&#x4E2D;&#x7684;&#x573A;&#x666F;&#x6765;&#x7406;&#x89E3;&#xFF1A;&#x5047;&#x5982;&#x4F60;&#x8981;&#x6253;&#x7535;&#x8BDD;&#x7ED9;&#x4E00;&#x4E2A;&#x670B;&#x53CB;&#xFF0C;&#x62FF;&#x8D77;&#x7535;&#x8BDD;&#x5148;&#x62E8;&#x53F7;&#xFF0C;&#x670B;&#x53CB;&#x542C;&#x5230;&#x7535;&#x8BDD;&#x94C3;&#x58F0;&#x540E;&#x63D0;&#x8D77;&#x7535;&#x8BDD;&#xFF0C;&#x8FD9;&#x65F6;&#x4F60;&#x548C;&#x4F60;&#x7684;&#x670B;&#x53CB;&#x5C31;&#x5EFA;&#x7ACB;&#x8D77;&#x4E86;&#x8FDE;&#x63A5;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BB2;&#x8BDD;&#x4E86;&#x3002;&#x7B49;&#x5230;&#x4F60;&#x4EEC;&#x7684;&#x4EA4;&#x6D41;&#x7ED3;&#x675F;&#xFF0C;&#x6302;&#x65AD;&#x7535;&#x8BDD;&#x4EE5;&#x7ED3;&#x675F;&#x6B64;&#x6B21;&#x4EA4;&#x8C08;&#x3002;So&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x7535;&#x8BDD;&#x5C31;&#x662F;&#x4E00;&#x4E2A;Socket&#xFF0C;&#x4F60;&#x6253;&#x7535;&#x8BDD;&#x76F8;&#x5F53;&#x4E8E;&#x7533;&#x8BF7;&#x4E86;&#x4E00;&#x4E2A;Socket&#xFF0C;&#x544A;&#x8BC9;&#x4E86;Socket&#x4F60;&#x8981;&#x6253;&#x7ED9;&#x8C01;&#xFF08;&#x5BF9;&#x65B9;&#x7684;&#x7535;&#x8BDD;&#x53F7;&#x7801;&#x4F60;&#x4E8B;&#x5148;&#x77E5;&#x9053;&#xFF09;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x4F60;&#x548C;&#x5BF9;&#x65B9;&#x8FDB;&#x884C;&#x804A;&#x5929;&#x901A;&#x8BDD;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x5728;&#x5411;Socket&#x53D1;&#x9001;&#x6570;&#x636E;&#x548C;&#x4ECE;Socket&#x63A5;&#x6536;&#x6570;&#x636E;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x901A;&#x8BDD;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x4E00;&#x65B9;&#x6302;&#x6389;&#x7535;&#x8BDD;&#x5219;&#x76F8;&#x5F53;&#x4E8E;&#x5173;&#x95ED;Socket&#xFF0C;&#x64A4;&#x9500;&#x8FDE;&#x63A5;&#x3002; </p>
<p>&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x7F51;&#x7EDC;&#x7684;&#x8FDE;&#x63A5;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;Socket&#x4E00;&#x822C;&#x4F1A;&#x8BB0;&#x5F55;&#x670D;&#x52A1;&#x5668;&#x4E3B;&#x673A;&#x7684;IP&#x5730;&#x5740;&#x3001;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x7136;&#x540E;&#x5411;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#x5E76;&#x53D1;&#x9001;&#x548C;&#x63A5;&#x53D7;&#x6570;&#x636E;&#x3002;&#x800C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x662F;&#x76F8;&#x5F53;&#x4E8E;&#x4F7F;&#x7528;Socket&#x6307;&#x5B9A;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x7B49;&#x5F85;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x540E;&#x5219;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x3002;&#x4F1A;&#x8BDD;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5219;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x2462;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;MemcachedClient&#xFF08;Memcached&#x5BA2;&#x6237;&#x7AEF;&#xFF09;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x6307;&#x5B9A;&#x8981;&#x8FDE;&#x63A5;&#x7684;&#x5957;&#x63A5;&#x5B57;&#x8FDE;&#x63A5;&#x6C60;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x8BBE;&#x7F6E;&#x662F;&#x5426;&#x542F;&#x7528;&#x538B;&#x7F29;&#xFF08;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x4E3A;false&#xFF09;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8BBE;&#x7F6E;&#x662F;&#x5426;&#x8D77;&#x7528;&#x538B;&#x7F29;&#xFF1A; &#x5728;Memcached&#x4E2D;&#xFF0C;&#x6570;&#x636E;&#x662F;&#x4EE5;Key/Value&#x5BF9;&#x7684;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x5B58;&#x50A8;&#xFF0C;Key&#x7684;&#x957F;&#x5EA6;&#x662F;&#x6709;&#x9650;&#x5236;&#x7684;&#xFF0C;Memcached&#x670D;&#x52A1;&#x7AEF;&#x5185;&#x90E8;&#x9650;&#x5236;Key&#x4E3A;250&#x5B57;&#x7B26;&#xFF0C;&#x8FD9;&#x4E2A;&#x957F;&#x5EA6;&#x7EDD;&#x5BF9;&#x662F;&#x591F;&#x7528;&#x4E86;&#xFF0C;&#x5EFA;&#x8BAE;&#x4E0D;&#x8981;&#x8D85;&#x8FC7;&#x6700;&#x5927;&#x957F;&#x5EA6;&#xFF0C;&#x5C3D;&#x91CF;&#x63A7;&#x5236;&#x5728;200&#x4E2A;&#x5B57;&#x7B26;&#x4EE5;&#x4E0B;&#x3002;&#x5176;&#x5B9E;&#xFF0C;&#x6211;&#x4EEC;&#x6700;&#x5173;&#x5FC3;&#x7684;&#x8FD8;&#x662F;Value&#x7684;&#x9650;&#x5236;&#x957F;&#x5EA6;&#xFF0C;Value&#x7684;&#x9650;&#x5236;&#x5927;&#x5C0F;&#x4E3A;1MB&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x6709;&#x65F6;&#x5019;&#x8D85;&#x8FC7;&#x4E86;1MB&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;&#x8FD9;&#x65F6;&#x5019;&#x4E5F;&#x8BB8;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x538B;&#x7F29;&#x4E86;&#xFF0C;&#x4F7F;&#x7528;&#x538B;&#x7F29;&#x540E;&#x5982;&#x679C;&#x5C0F;&#x4E8E;1Mb&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x5230;&#x8BE5;Key&#x4E2D;&#x3002;&#x4F46;&#x5982;&#x679C;&#x5373;&#x4F7F;&#x538B;&#x7F29;&#x540E;&#x8FD8;&#x662F;&#x8D85;&#x8FC7;1Mb&#xFF0C;&#x90A3;&#x53EF;&#x80FD;&#x4F1A;&#x62C6;&#x5206;&#x5230;&#x591A;&#x4E2A;Key&#x4E2D;&#x53BB;&#x4E86;&#x3002;</p>
<p>PS&#xFF1A;Key&#x4E0D;&#x80FD;&#x6709;&#x7A7A;&#x683C;&#x548C;&#x63A7;&#x5236;&#x5B57;&#x7B26;&#x3002;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x8F83;&#x77ED;&#x7684;Key&#xFF0C;&#x53EF;&#x4EE5;&#x8282;&#x7701;&#x670D;&#x52A1;&#x5668;&#x5185;&#x5B58;&#x548C;&#x7F51;&#x7EDC;&#x5E26;&#x5BBD;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF1A;Key&#x4E0D;&#x80FD;&#x91CD;&#x590D;&#xFF01; </p>
<p>&#x2463;&#x4F7F;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x7684;&#x5404;&#x79CD;&#x8BFB;&#x5199;API&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x6D4B;&#x8BD5;&#xFF0C;&#x5982;Set&#x3001;Get&#x3001;Replace&#x3001;Add&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x6DFB;&#x52A0;&#x548C;&#x4FEE;&#x6539;&#xFF0C;&#x800C;KeyExists&#x5219;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x662F;&#x5426;&#x542B;&#x6709;&#x6307;&#x5B9A;Key&#x7684;&#x6570;&#x636E;&#xFF0C;Delete&#x5219;&#x63D0;&#x4F9B;&#x4E86;&#x5220;&#x9664;&#x6307;&#x5B9A;Key&#x7684;&#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x91CC;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x770B;&#x4EE3;&#x7801;&#x5C31;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#xFF0C;&#x6211;&#x5C31;&#x4E0D;&#x591A;&#x5E9F;&#x8BDD;&#x4E86;&#x3002;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#x6709;&#x4E2A;&#x6570;&#x636E;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x7684;&#x53EF;&#x9009;&#x53C2;&#x6570;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x5B58;&#x50A8;&#x4E86;&#x4E00;&#x5B9A;&#x65F6;&#x95F4;&#x540E;&#x5C31;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x76F8;&#x5F53;&#x6709;&#x7528;&#x3002;</p>
<p>&#xFF08;4&#xFF09;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8C03;&#x8BD5;&#xFF0C;&#xFFFD;&#xFFFD;&#xFFFD;&#x770B;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/276da2b.jpg" alt=""></p>
<h2 id="2-2_&#x8FDB;&#x9636;&#x7684;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x64CD;&#x4F5C;">2.2 &#x8FDB;&#x9636;&#x7684;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x64CD;&#x4F5C;</h2><p>&#xFF08;1&#xFF09;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x514B;&#x9686;&#x5DF2;&#x5B58;&#x5728;&#x7684;Windows Server&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E24;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x540D;&#x79F0;&#x4E3A;&#xFF1A;MemcacheServer1&#x548C;MemcachedServer2&#xFF0C;IP&#x5730;&#x5740;&#x8BBE;&#x7F6E;&#x4E3A;&#xFF1A;192.168.80.10&#x4E0E;192.168.80.11&#xFF0C;&#x6D4B;&#x8BD5;&#x4E24;&#x53F0;&#x865A;&#x62DF;&#x673A;&#x4E0E;&#x5BBF;&#x4E3B;&#x673A;&#x662F;&#x5426;&#x80FD;&#x591F;&#x4E92;&#x76F8;Ping&#x901A;&#xFF0C;&#x4E3A;&#x6784;&#x5EFA;Memcached&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x505A;&#x4E00;&#x4E2A;&#x6700;&#x5C0F;&#x5316;&#x7684;&#x51C6;&#x5907;&#xFF1B;</p>
<p><img src="http://taojinke.github.io/img/20150703/276dc9c.jpg" alt=""></p>
<p>&#xFF08;2&#xFF09;&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x6709;&#x4E86;&#x4E24;&#x53F0;Memcached&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x5F97;&#x8BD5;&#x8BD5;Memcached&#x96C6;&#x7FA4;&#x554A;&#xFF0C;&#x7531;&#x4E8E;Memcached&#x7684;&#x96C6;&#x7FA4;&#x662F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x670D;&#x52A1;&#x5668;&#x7684;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x53F7;&#x52A0;&#x5165;&#x670D;&#x52A1;&#x5668;&#x5217;&#x8868;&#x7684;string&#x6570;&#x7EC4;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>&#x2460;&#x9996;&#x5148;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;App.config&#x6587;&#x4EF6;&#xFF0C;&#x65B0;&#x589E;&#x4E00;&#x4E2A;AppSetting&#x9879;&#x5982;&#x4E0B;&#xFF1A;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&#x4FE1;&#x606F;&#x90FD;&#x662F;&#x5199;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#xFF0C;&#x4E3A;&#x4E86;&#x8FFD;&#x6C42;&#x6807;&#x51C6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x5199;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#x8FB9;</p>
<p><img src="http://taojinke.github.io/img/20150703/276dc9c.jpg" alt=""></p>
<p>&#x2461;&#x5C06;serverList&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#xFF1A;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#x8FB9;&#x7684;Value&#xFF1B;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;  &#x8981;&#x4F7F;&#x7528;ConfigurationManager&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x5F15;&#x7528;&#x4E2D;&#x6DFB;&#x52A0;&#x5BF9;System.Configuration&#x8FD9;&#x4E2A;dll&#x7684;&#x5F15;&#x7528;  &#xFF1B; </p>
<pre><code>string<span class="comment">[]</span> serverList = ConfigurationManager.AppSettings<span class="comment">[&amp;quot;MemcachedServers&amp;quot;]</span>.Split(&amp;apos;,&amp;apos;);
</code></pre><p>&#xFF08;3&#xFF09;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5148;&#x91CD;&#x542F;Memcached1&#xFF08;192.168.80.10&#xFF09;&#x7684;Memcached&#x670D;&#x52A1;&#xFF0C;&#x6E05;&#x7A7A;&#x5DF2;&#x7ECF;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;&#x5185;&#x5BB9;&#xFF0C;&#x786E;&#x4FDD;&#x4E24;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x73B0;&#x5728;&#x90FD;&#x6CA1;&#x6709;&#x6570;&#x636E;&#xFF1B;&#x7136;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x518D;&#x6B21;&#x5B8C;&#x6210;&#x4EE3;&#x7801;&#x6D4B;&#x8BD5;&#xFF0C;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#x8FD8;&#x662F;&#x5982;&#x4E0B;&#x56FE;&#xFF0C;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x7684;&#x4E24;&#x53F0;Memcached&#x96C6;&#x7FA4;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x6210;&#x529F;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/276df0d.jpg" alt=""></p>
<p>&#xFF08;4&#xFF09;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x4F7F;&#x7528;telnet&#x67E5;&#x770B;&#x6BCF;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5177;&#x4F53;&#x4FDD;&#x5B58;&#x4E86;&#x54EA;&#x4E2A;Key/Value&#x5BF9;&#xFF0C;&#x8FD9;&#x91CC;&#x7531;&#x4E8E;test3&#x548C;test4&#x5747;&#x88AB;&#x5220;&#x9664;&#x6216;&#x5DF2;&#x5931;&#x6548;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x67E5;&#x770B;&#x524D;&#x4E24;&#x4E2A;Key/Value&#x5BF9;&#xFF1A;</p>
<p>&#x2460;MemcacheServer1(192.168.80.10)&#xFF1A;&#x4FDD;&#x5B58;&#x4E86;&#x7B2C;&#x4E8C;&#x4E2A;Key/Value&#x5BF9;&#xFF0C;&lt;test2:lousie&gt;</p>
<p><img src="http://taojinke.github.io/img/20150703/276e17e.jpg" alt=""></p>
<p>&#x2461;MemcacheServer2(192.168.80.11)&#xFF1A;&#x4FDD;&#x5B58;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;Key/Value&#x5BF9;&#xFF0C;&lt;test1:edisonchou&gt;</p>
<p><img src="http://taojinke.github.io/img/20150703/276e17e.jpg" alt=""></p>
<p>&#xFF08;5&#xFF09;&#x5230;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x6700;&#x5C0F;&#x5316;&#x7684;memcached&#x96C6;&#x7FA4;&#x8BFB;&#x5199;&#x6D4B;&#x8BD5;Demo&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x7684;&#x5F00;&#x53D1;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x8FDC;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x5C31;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x65B0;&#x52A0;&#x4E00;&#x4E2A;&#x7C7B;MyObject&#xFF0C;&#x8BA9;&#x5176;&#x4F5C;&#x4E3A;&#x53EF;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x5BF9;&#x8C61;&#x6765;&#x5B58;&#x50A8;&#x8FDB;Memcached&#x4E2D;&#x3002;&#x6CE8;&#x610F;&#xFF1A;&#x9700;&#x8981;&#x4E3A;&#x8BE5;&#x7C7B;&#x52A0;&#x4E0A;[Serializable]&#x7684;&#x7279;&#x6027;&#xFF01;</p>
<p> <img src="http://taojinke.github.io/img/20150703/276e17e.gif" alt=""></p>
<pre><code>    [Serializable]
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyObject</span>
{
    <span class="keyword">public</span> <span class="keyword">int</span> ID
    {
        <span class="keyword">get</span>;
        <span class="keyword">set</span>;
    }
    <span class="keyword">public</span> <span class="keyword">string</span> Name
    {
        <span class="keyword">get</span>;
        <span class="keyword">set</span>;
    }
}
</code></pre><p> <img src="http://taojinke.github.io/img/20150703/276e3ef.gif" alt=""></p>
<p>&#x7136;&#x540E;&#xFF0C;&#x5728;&#x4E3B;&#x4EE3;&#x7801;&#x4E2D;&#x6DFB;&#x52A0;&#x4EE5;&#x4E0B;&#x51E0;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x589E;&#x52A0;&#x5BF9;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7684;&#x8BFB;&#x5199;&#x6D4B;&#x8BD5;&#xFF1A;</p>
<p> <img src="http://taojinke.github.io/img/20150703/276e3ef.gif" alt=""></p>
<pre><code>// <span class="number">06.</span>&amp;<span class="symbol">#x81EA</span>;&amp;<span class="symbol">#x5B9A</span>;&amp;<span class="symbol">#x4E49</span>;&amp;<span class="symbol">#x5BF9</span>;&amp;<span class="symbol">#x8C61</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x50A8</span>;
            <span class="class">MyObject</span> myObj = new <span class="class">MyObject</span>();
            myObj.<span class="class">ID</span> = <span class="number">12138</span>;
            myObj.<span class="class">Name</span> = &amp;quot;&amp;<span class="symbol">#x7231</span>;&amp;<span class="symbol">#x8FEA</span>;&amp;<span class="symbol">#x751F</span>;&amp;<span class="symbol">#x5468</span>;&amp;quot;;
            memClient.<span class="class">Set</span>(&amp;quot;test5&amp;quot;, myObj);
            <span class="class">MyObject</span> newMyObj = memClient.<span class="class">Get</span>(&amp;quot;test5&amp;quot;) as <span class="class">MyObject</span>;
            <span class="class">Console</span>.<span class="class">WriteLine</span>(&amp;quot;<span class="class">Hello</span>,<span class="class">My</span> <span class="class">ID</span> is {<span class="number">0</span>} and <span class="class">Name</span> is {<span class="number">1</span>}&amp;quot;, newMyObj.<span class="class">ID</span>, newMyObj.<span class="class">Name</span>);
</code></pre><p> <img src="http://taojinke.github.io/img/20150703/276e3ef.gif" alt=""></p>
<p>&#x6700;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x67E5;&#x770B;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/276e660.jpg" alt=""></p>
<p>&#xFF08;6&#xFF09;&#x600E;&#x4E48;&#x6837;&#xFF0C;&#x5706;&#x6EE1;&#x5B8C;&#x6210;&#x5BF9;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7684;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5427;&#xFF1F;&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x662F;&#x5B58;&#x5230;&#x4E86;&#x54EA;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF1A;&#x7ECF;&#x67E5;&#x8BE2;&#xFF0C;test5&#x662F;&#x5B58;&#x50A8;&#x5230;&#x4E86;MemcacheServer2&#xFF08;192.168.80.11&#xFF09;&#x4E0A;&#x3002;</p>
<h2 id="&#x4E09;&#x3001;&#x56DE;&#x5934;&#x518D;&#x770B;Memcached&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6A21;&#x578B;">&#x4E09;&#x3001;&#x56DE;&#x5934;&#x518D;&#x770B;Memcached&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6A21;&#x578B;</h2><p>&#x7ECF;&#x8FC7;&#x4E86;&#x521A;&#x521A;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5B9E;&#x8DF5;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4E00;&#x4E2A;&#x6700;&#x5C0F;&#x5316;&#x7684;&#x7531;&#x4E24;&#x53F0;Windows Server&#x642D;&#x5EFA;&#x7684;Memcached&#x96C6;&#x7FA4;&#x4E0A;&#x8FDB;&#x884C;&#x4E86;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x6D4B;&#x8BD5;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x7531;&#x5F97;&#x60F3;&#x8981;&#x53BB;&#x770B;&#x770B;&#x5230;&#x5E95;Memcached&#x662F;&#x600E;&#x6837;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x7684;&#x5462;&#xFF1F;&#x522B;&#x6025;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x770B;&#x770B;&#xFF0C;&#x7531;&#x5B9E;&#x8DF5;&#x5230;&#x7406;&#x8BBA;&#xFF0C;&#x6DF1;&#x5165;&#x7406;&#x89E3;&#x4E00;&#x4E0B;&#x3002;</p>
<p>&#xFF08;1&#xFF09;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x636E;</p>
<p><img src="http://taojinke.github.io/img/20150703/276e8d1.png" alt=""></p>
<p>&#x4ECE;&#x56FE;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;Memcached&#x867D;&#x7136;&#x79F0;&#x4E3A;&#x201C;&#x5206;&#x5E03;&#x5F0F;&#x201D;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F46;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5E76;&#x6CA1;&#x6709;&#x201C;&#x5206;&#x5E03;&#x5F0F;&#x201D;&#x529F;&#x80FD;&#xFF0C;&#x800C;&#x662F;&#x5B8C;&#x5168;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#x7A0B;&#x5E8F;&#x5E93;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x670D;&#x52A1;&#x7AEF;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x8054;&#x7CFB;&#xFF0C;&#x6570;&#x636E;&#x5B58;&#x53D6;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x5B58;&#x53D6;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x9996;&#x5148;&#x4F1A;&#x901A;&#x8FC7;&#x7B97;&#x6CD5;&#x67E5;&#x627E;&#x81EA;&#x5DF1;&#x7EF4;&#xFFFD;&#xFFFD;&#xFFFD;&#x7684;&#x670D;&#x52A1;&#x5668;&#x54C8;&#x5E0C;&#x5217;&#x8868;&#xFF0C;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x5668;&#x540E;&#xFF0C;&#x518D;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x5F80;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x5668;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x4E0A;&#x56FE;&#x4E2D;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8981;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&lt;&apos;tokyo&apos;,data&gt;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5B83;&#x540C;&#x8FC7;set&#x64CD;&#x4F5C;&#x63D0;&#x4EA4;&#x7ED9;Memcached&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;&#x4E00;&#x5B9A;&#x7684;&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#xFF08;&#x6BD4;&#x5982;&#xFF1A;&#x4E00;&#x822C;&#x7684;&#x6C42;&#x4F59;&#x51FD;&#x6570;&#x6216;&#x8005;&#x5F3A;&#x5927;&#x7684;&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#xFF09;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x5217;&#x8868;&#x4E2D;&#x8BA1;&#x7B97;&#x51FA;&#x4E00;&#x4E2A;&#x8981;&#x5B58;&#x50A8;&#x7684;&#x670D;&#x52A1;&#x5668;&#x5730;&#x5740;&#xFF0C;&#x6700;&#x540E;&#x5C06;&#x8BE5;&#x952E;&#x503C;&#x5BF9;&#x5B58;&#x50A8;&#x5230;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#x670D;&#x52A1;&#x5668;&#x91CC;&#x8FB9;&#x3002;</p>
<p>&#xFF08;2&#xFF09;&#x83B7;&#x53D6;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x636E;</p>
<p><img src="http://taojinke.github.io/img/20150703/276e8d1.png" alt=""></p>
<p>&#x4E0A;&#x56FE;&#x4E2D;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x60F3;&#x8981;&#x83B7;&#x53D6;Key&#x4E3A;&#x2018;tokyo&#x2019;&#xFF08;&#x4E1C;&#x4EAC;&#x8FD9;&#x4E48;&#x70ED;&#xFF0C;&#x8FD8;&#x8981;&#x53D6;&#x5B83;&#x7684;&#x503C;&#x662F;&#x5E72;&#x795E;&#x9A6C;&#x5462;&#xFF1F;&#xFF09;&#x7684;Value&#xFF0C;&#x4E8E;&#x662F;&#x5B83;&#x5411;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4EA4;&#x4E86;&#x4E00;&#x4E2A;Get&#x8BF7;&#x6C42;&#xFF0C;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x8FD8;&#x662F;&#x901A;&#x8FC7;&#x7B97;&#x6CD5;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x5217;&#x8868;&#x67E5;&#x8BE2;&#x54EA;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x5B58;&#x6709;Key&#x4E3A;&#x2018;tokyo&#x2019;&#x7684;Value&#xFF08;&#x5373;&#x9009;&#x62E9;&#x521A;&#x521A;Set&#x5230;&#x4E86;&#x54EA;&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x5230;&#xFF0C;&#x5219;&#x5411;&#x67E5;&#x5230;&#x7684;&#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x8FD4;&#x56DE;Key&#x4E3A;&#x2018;tokyo&#x2019;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<p>&#xFF08;3&#xFF09;Memcached&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x6838;&#x5FC3;&#x2014; <strong>&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;</strong></p>
<p>&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x7684;&#x6838;&#x5FC3;&#x7406;&#x8BBA;&#xFF0C;&#x6211;&#x4E5F;&#x5B66;&#x4E60;&#x5F97;&#x4E0D;&#x6DF1;&#x5165;&#xFF0C;&#x4E5F;&#x53EA;&#x662F;&#x521A;&#x521A;&#x4E86;&#x89E3;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x6709;&#x7A7A;&#x6DF1;&#x5165;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#xFF0C;&#x518D;&#x5355;&#x72EC;&#x5199;&#x4E00;&#x7BC7;&#x535A;&#x6587;&#x6765;&#x4ECB;&#x7ECD;&#x5B83;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;C#&#x6765;&#x7C97;&#x7565;&#x5730;&#x5B9E;&#x73B0;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x3002;&#x73B0;&#x5728;&#x6211;&#x5C31;&#x7B80;&#x5355;&#x5730;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x6211;&#x4E4B;&#x524D;&#x5199;&#x5165;&#x4E86;&#x6211;&#x7684;&#x53E6;&#x4E00;&#x7BC7;&#x535A;&#x6587;&#x300A; <a href="http://www.cnblogs.com/edisonchou/p/3851333.html" target="_blank" rel="external">&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x6280;&#x672F;&#x67B6;&#x6784;&#x8BFB;&#x4E66;&#x7B14;&#x8BB0;&#x4E4B;&#x7F51;&#x7AD9;&#x7684;&#x53EF;&#x4F38;&#xFFFD;&#xFFFD;&#xFFFD;&#x67B6;&#x6784;</a> &#x300B;&#x4E2D;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x670B;&#x53CB;&#x4E5F;&#x53EF;&#x4EE5;&#x53BB;&#x770B;&#x770B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x3002; </p>
<p>&#x9996;&#x5148;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x8DEF;&#x7531;&#x7B97;&#x6CD5;&#xFF08;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x4F59;&#x6570;Hash&#xFF09;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x4E1A;&#x52A1;&#x53D1;&#x5C55;&#x65F6;&#x670D;&#x52A1;&#x5668;&#x6269;&#x5BB9;&#x7684;&#x9700;&#x8981;&#xFF1A; <strong>&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x4E0B;&#x964D;</strong> &#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x5F53;3&#x53F0;&#x670D;&#x52A1;&#x5668;&#x6269;&#x5BB9;&#x81F3;4&#x53F0;&#x65F6;&#xFF0C;&#x91C7;&#x7528;&#x666E;&#x901A;&#x7684;&#x4F59;&#x6570;Hash&#x7B97;&#x6CD5;&#x4F1A;&#x5BFC;&#x81F4;&#x5927;&#x7EA6;75%&#xFF08;3/4&#xFF09;&#x88AB;&#x7F13;&#x5B58;&#x4E86;&#x7684;&#x6570;&#x636E;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x547D;&#x4E2D;&#xFF0C;&#x968F;&#x7740;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x89C4;&#x6A21;&#x7684;&#x589E;&#x5927;&#xFF0C;&#x8FD9;&#x4E2A;&#x6BD4;&#x4F8B;&#x4F1A;&#x7EBF;&#x6027;&#x5730;&#x4E0A;&#x5347;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#xFF0C;&#x5F53;100&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;&#x96C6;&#x7FA4;&#x4E2D;&#x52A0;&#x5165;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E0D;&#x80FD;&#x547D;&#x4E2D;&#x7684;&#x6982;&#x7387;&#x5927;&#x6982;&#x662F;99%&#xFF08;N/N+1&#xFF09;&#xFF0C;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x663E;&#x7136;&#x662F;&#x65E0;&#x6CD5;&#x63A5;&#x53D7;&#x7684;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x80FD;&#x5426;&#x901A;&#x8FC7;&#x6539;&#x8FDB;&#x8DEF;&#x7531;&#x7B97;&#x6CD5;&#xFF0C;&#x4F7F;&#x5F97;&#x65B0;&#x52A0;&#x5165;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x5F71;&#x54CD;&#x5927;&#x90E8;&#x5206;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684;&#x6B63;&#x786E;&#x6027;&#x5462;&#xFF1F;&#x8BF7;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#x3002; </p>
<p>&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x53EB;&#x505A;&#x4E00;&#x81F4;&#x6027;Hash&#x73AF;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5B9E;&#x73B0;KEY&#x5230;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x7684;Hash&#x6620;&#x5C04;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/276eb42.png" alt=""></p>
<p>&#x5177;&#x4F53;&#x7B97;&#x6CD5;&#x8FC7;&#x7A0B;&#x662F;&#xFF1A;</p>
<p>&#x2460;&#x5148;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E3A;0~2^32&#xFF08;2&#x7684;32&#x6B21;&#x5E42;&#xFF09;&#x4E2A;&#x7684;&#x6574;&#x6570;&#x73AF;&#xFF08;&#x53C8;&#x79F0;&#xFF1A;&#x4E00;&#x81F4;&#x6027;Hash&#x73AF;&#xFF09;&#xFF0C;&#x6839;&#x636E;&#x8282;&#x70B9;&#x540D;&#x79F0;&#x7684;Hash&#x503C;&#x5C06;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x8282;&#x70B9;&#x653E;&#x7F6E;&#x5728;&#x8FD9;&#x4E2A;Hash&#x73AF;&#x4E2D;&#xFF0C;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#x7684;node1&#xFF0C;node2&#x7B49;&#xFF1B;</p>
<p>&#x2461;&#x6839;&#x636E;&#x9700;&#x8981;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;&#x7684;KEY&#x503C;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x5176;Hash&#x503C;&#xFF0C;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#x53F3;&#x534A;&#x90E8;&#x5206;&#x7684;&#x201C;&#x952E;&#x201D;&#xFF0C;&#x8BA1;&#x7B97;&#x5176;Hash&#x503C;&#x540E;&#x79BB;node2&#x5F88;&#x8FD1;&#xFF1B;</p>
<p>&#x2462;&#x5728;Hash&#x73AF;&#x4E0A;&#x987A;&#x65F6;&#x9488;&#x67E5;&#x627E;&#x8DDD;&#x79BB;&#x8FD9;&#x4E2A;KEY&#x7684;Hash&#x503C;&#x6700;&#x8FD1;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x8282;&#x70B9;&#xFF0C;&#x5B8C;&#x6210;KEY&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;Hash&#x6620;&#x5C04;&#x67E5;&#x627E;&#xFF0C;&#x5982;&#x4E0A;&#x56FE;&#x4E2D;&#x79BB;&#x53F3;&#x8FB9;&#x8FD9;&#x4E2A;&#x952E;&#x7684;Hash&#x503C;&#x6700;&#x8FD1;&#x7684;&#x987A;&#x65F6;&#x9488;&#x65B9;&#x5411;&#x7684;&#x670D;&#x52A1;&#x5668;&#x8282;&#x70B9;&#x662F;node2&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;KEY&#x4F1A;&#x5230;node2&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF1B;</p>
<p>&#x5F53;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x9700;&#x8981;&#x6269;&#x5BB9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x65B0;&#x52A0;&#x5165;&#x7684;&#x8282;&#x70B9;&#x540D;&#x79F0;&#xFF08;&#x5982;node5&#xFF09;&#x7684;Hash&#x503C;&#x653E;&#x5165;&#x4E00;&#x81F4;&#x6027;Hash&#x73AF;&#x4E2D;&#xFF0C; &#x7531;&#x4E8E;KEY&#x603B;&#x662F;&#x987A;&#x65F6;&#x9488;&#x67E5;&#x627E;&#x8DDD;&#x79BB;&#x5176;&#x6700;&#x8FD1;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x56E0;&#x6B64;&#x65B0;&#x52A0;&#x5165;&#x7684;&#x8282;&#x70B9;&#x53EA;&#x5F71;&#x54CD;&#x6574;&#x4E2A;&#x73AF;&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206; &#x3002;&#x5982;&#x4E0B;&#x56FE;&#x4E2D;&#x6240;&#x793A;&#xFF0C;&#x6DFB;&#x52A0;node5&#x540E;&#xFF0C;&#x53EA;&#x5F71;&#x54CD;&#x53F3;&#x8FB9;&#x9006;&#x65F6;&#x9488;&#x65B9;&#x5411;&#x7684;&#x4E09;&#x4E2A;Key/Value&#x5BF9;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x5360;&#x6574;&#x4E2A;Hash&#x73AF;&#x4E2D;&#x7684;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/276eb42.png" alt=""></p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E0E;&#x4E4B;&#x524D;&#x7684;&#x666E;&#x901A;&#x4F59;&#x6570;Hash&#x4F5C;&#x5BF9;&#x6BD4;&#xFF1A;&#x91C7;&#x7528;&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#x65F6;&#xFF0C;&#x5F53;3&#x53F0;&#x670D;&#x52A1;&#x5668;&#x6269;&#x5BB9;&#x5230;4&#x53F0;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x547D;&#x4E2D;&#x539F;&#x6709;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684;&#x6982;&#x7387;&#x4E3A;75%&#xFF0C;&#x8FDC;&#x9AD8;&#x4E8E;&#x666E;&#x901A;&#x4F59;&#x6570;Hash&#x7684;25%&#xFF0C;&#x800C;&#x4E14;&#x968F;&#x7740;&#x96C6;&#x7FA4;&#x89C4;&#x6A21;&#x8D8A;&#x5927;&#xFF0C;&#x7EE7;&#x7EED;&#x547D;&#x4E2D;&#x539F;&#x6709;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684;&#x6982;&#x7387;&#x4E5F;&#x4F1A;&#x968F;&#x4E4B;&#x589E;&#x5927;&#x3002;&#x5F53;100&#x53F0;&#x670D;&#x52A1;&#x5668;&#x589E;&#x52A0;1&#x53F0;&#x65F6;&#xFF0C;&#x7EE7;&#x7EED;&#x547D;&#x4E2D;&#x7684;&#x6982;&#x7387;&#x662F;99%&#x3002; &#x867D;&#x7136;&#xFF0C;&#x4ECD;&#x6709;&#x5C0F;&#x90E8;&#x5206;&#x6570;&#x636E;&#x7F13;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x65E0;&#x6CD5;&#x88AB;&#x8BFB;&#x53D6;&#x5230;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x6BD4;&#x4F8B;&#x8DB3;&#x591F;&#x5C0F;&#xFF0C;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x4E5F;&#x4E0D;&#x4F1A;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x9020;&#x6210;&#x81F4;&#x547D;&#x7684;&#x8D1F;&#x8F7D;&#x538B;&#x529B; &#x3002; </p>
<h2 id="&#x56DB;&#x3001;&#x5B66;&#x4E60;&#x5C0F;&#x7ED3;">&#x56DB;&#x3001;&#x5B66;&#x4E60;&#x5C0F;&#x7ED3;</h2><p>&#x5728;&#x672C;&#x7BC7;&#x6211;&#x9996;&#x5148;&#x82B1;&#x4E86;&#x5927;&#x529B;&#x6C14;&#x6765;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x4F7F;&#x7528;Memcached&#x5BA2;&#x6237;&#x7AEF;&#x5728;.Net&#x4E2D;&#x8FDB;&#x884C;&#x5E38;&#x7528;&#x7684;&#x57FA;&#x7840;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;VMWare Workstation&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x7531;&#x4E24;&#x53F0;Windows Server&#x7EC4;&#x6210;&#x7684;&#x6700;&#x5C0F;&#x5316;&#x7684;Memcached&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x6211;&#x901A;&#x8FC7;&#x4F7F;&#x7528;C#&#x8C03;&#x7528;Memcached&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5230;Memcached&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x4E86;&#x662F;&#x5426;&#x4FDD;&#x5B58;&#x4E8E;&#x96C6;&#x7FA4;&#x4E2D;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x8FD4;&#x56DE;&#x5230;Memcached&#x7684;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x6A21;&#x578B;&#x4E0A;&#xFF0C;&#x4ECE;&#x7406;&#x8BBA;&#x5230;&#x5B9E;&#x8DF5;&#xFF0C;&#x518D;&#x4ECE;&#x5B9E;&#x8DF5;&#x8FD4;&#x56DE;&#x5230;&#x7406;&#x8BBA;&#xFF0C;&#x7406;&#x89E3;Memcached&#x7684;&#x4E92;&#x4E0D;&#x901A;&#x4FE1;&#x7684;&#x96C6;&#x7FA4;&#x6A21;&#x5F0F;&#x4E0E;&#x6570;&#x636E;&#x8BFB;&#x5199;&#x6D41;&#x7A0B;&#xFF0C;&#x5E76;&#x7B80;&#x5355;&#x4E86;&#x89E3;&#x4E86;&#x4E00;&#x4E0B;&#x5206;&#x5E03;&#x5F0F;&#x6280;&#x672F;&#x4E2D;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x7B97;&#x6CD5;&#xFF1A;&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#x3002;</p>
<p>&#x4E0D;&#x77E5;&#x4E0D;&#x89C9;&#x90FD;&#x5FEB;1:20&#x4E86;&#xFF0C;&#x4ECA;&#x5929;&#x5C31;&#x5230;&#x6B64;&#x505C;&#x7B14;&#x5173;&#x673A;&#xFF0C;&#x6D17;&#x6D17;&#x7761;&#x4E86;&#x3002;&#x540E;&#x9762;&#xFF0C;&#x6211;&#x4F1A;&#x4ECB;&#x7ECD;&#x5728;ASP.NET MVC&#x4E2D;&#x5E94;&#x7528;Memcached&#x6765;&#x89E3;&#x51B3;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x7684;&#x6848;&#x4F8B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;Session&#x4F1A;&#x8BDD;&#x5BF9;&#x8C61;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x3002;&#x5982;&#x679C;&#x5927;&#x5BB6;&#x89C9;&#x5F97;&#x6709;&#x7528;&#x6216;&#x8005;&#x6709;&#x5174;&#x8DA3;&#xFF0C;&#x90A3;&#x5C31;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x4E86;&#xFF0C;&#x4E5F;&#x8BF7;&#x9EBB;&#x70E6;&#x70B9;&#x4E2A;&#x201C;&#x63A8;&#x8350;&#x201D;&#xFF0C;&#x8BA9;&#x6211;&#x66F4;&#x6709;&#x52A8;&#x529B;&#x5199;&#x4E0B;&#x53BB;&#xFF0C;&#x8C22;&#x8C22;&#xFF01;</p>
<h2 id="&#x53C2;&#x8003;&#x6587;&#x732E;">&#x53C2;&#x8003;&#x6587;&#x732E;</h2><p>&#xFF08;1&#xFF09;&#x4F20;&#x667A;&#x64AD;&#x5BA2;&#x9A6C;&#x4F26;&#xFF0C;&#x300A;Memcached&#x516C;&#x5F00;&#x8BFE;&#x300B;&#xFF0C;<a href="http://bbs.itcast.cn/thread-14836-1-1.html" target="_blank" rel="external">http://bbs.itcast.cn/thread-14836-1-1.html</a></p>
<p>&#xFF08;2&#xFF09;charlee&#xFF0C;&#x300A;Memcached&#x5B8C;&#x5168;&#x5256;&#x6790;&#x300B;&#xFF0C;<a href="http://kb.cnblogs.com/page/42731/" target="_blank" rel="external">http://kb.cnblogs.com/page/42731/</a></p>
<p>&#xFF08;3&#xFF09;&#x5C0F;&#x57CE;&#x5C81;&#x6708;&#xFF0C;&#x300A;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;Memcached&#x5165;&#x95E8;&#x300B;&#xFF0C;<a href="http://www.cnblogs.com/mecity/archive/2011/06/13/Memcached.html" target="_blank" rel="external">http://www.cnblogs.com/mecity/archive/2011/06/13/Memcached.html</a></p>
<p>&#xFF08;4&#xFF09;&#x5438;&#x6C34;&#x7684;&#x6280;&#x672F;&#x70B9;&#x70B9;&#xFF0C;&#x300A;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;Memcached&#x7B80;&#x4ECB;&#x4E0E;&#x5B9E;&#x8DF5;&#x300B;&#xFF0C;<a href="http://www.cnblogs.com/zjneter/archive/2007/07/19/822780.html" target="_blank" rel="external">http://www.cnblogs.com/zjneter/archive/2007/07/19/822780.html</a></p>
<p>&#xFF08;5&#xFF09;&#x6E90;&#x7801;&#x5DE5;&#x4F5C;&#x5BA4;&#xFF0C;&#x300A;&#x63ED;&#x5F00;Socket&#x7F16;&#x7A0B;&#x7684;&#x9762;&#x7EB1;&#x300B;&#xFF0C;<a href="http://goodcandle.cnblogs.com/archive/2005/12/10/294652.aspx" target="_blank" rel="external">http://goodcandle.cnblogs.com/archive/2005/12/10/294652.aspx</a></p>
<h2 id="&#x9644;&#x4EF6;&#x4E0B;&#x8F7D;">&#x9644;&#x4EF6;&#x4E0B;&#x8F7D;</h2><p>&#xFF08;1&#xFF09;Memcached ClientLib&#xFF1A; <a href="http://pan.baidu.com/s/1w9Q8I" target="_blank" rel="external">http://pan.baidu.com/s/1w9Q8I</a></p>
<p>&#xFF08;2&#xFF09;MemcachedClientDemo&#xFF1A; <a href="http://pan.baidu.com/s/1hqrDUss" target="_blank" rel="external">http://pan.baidu.com/s/1hqrDUss</a></p>
<p>&#x8F6C;&#x81EA;&#xFF1A;<a href="http://www.cnblogs.com/edisonchou/p/3855969.html" target="_blank" rel="external">http://www.cnblogs.com/edisonchou/p/3855969.html</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="&#x4E00;&#x3001;Memcached_ClientLib_For_-Net">&#x4E00;&#x3001;Memcached ClientLib For .Net</h2><p>&#x9996;&#x5148;&#xFF0C;&#x4E0D;&#]]>
    </summary>
    
      <category term=".Net" scheme="http://taojinke.github.io/tags/Net/"/>
    
      <category term="Memcached" scheme="http://taojinke.github.io/tags/Memcached/"/>
    
      <category term="Nosql" scheme="http://taojinke.github.io/tags/Nosql/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[【转】Key/Value之王Memcached初探：一、掀起Memcached的盖头来 -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/276b7fd/"/>
    <id>http://taojinke.github.io/2015/07/03/276b7fd/</id>
    <published>2015-07-03T02:09:44.000Z</published>
    <updated>2015-07-03T14:09:44.269Z</updated>
    <content type="html"><![CDATA[<h2 id="&#x4E00;&#x3001;Memcached&#x662F;&#x4F55;&#x65B9;&#x795E;&#x5723;&#xFF1F;">&#x4E00;&#x3001;Memcached&#x662F;&#x4F55;&#x65B9;&#x795E;&#x5723;&#xFF1F;</h2><p><img src="http://taojinke.github.io/img/20150703/2768e7c.jpg" alt=""></p>
<p>&#x5728;&#x6570;&#x636E;&#x9A71;&#x52A8;&#x7684;Web&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x7ECF;&#x5E38;&#x8981;&#x91CD;&#x590D;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x53D6;&#x51FA;&#x76F8;&#x540C;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x79CD;&#x91CD;&#x590D;&#x6781;&#x5927;&#x7684;&#x589E;&#x52A0;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x8D1F;&#x8F7D;&#x3002;&#x7F13;&#x5B58;&#x662F;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x597D;&#x529E;&#x6CD5;&#x3002;&#x4F46;&#x662F;ASP.NET&#x4E2D;&#x7684;HttpRuntime.Cache&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;&#x9875;&#x9762;&#x5C40;&#x90E8;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x4E0D;&#x591F;&#x7075;&#x6D3B;&#xFF0C;&#x6B64;&#x65F6;Memcached&#x6216;&#x8BB8;&#x662F;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x3002;</p>
<p>Memcached &#x662F;&#x4E00;&#x4E2A; <strong>&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5185;&#x5B58;&#x5BF9;&#x8C61;&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;</strong> &#xFF0C;&#x7528;&#x4E8E;&#x52A8;&#x6001;Web&#x5E94;&#x7528;&#x4EE5;&#x51CF;&#x8F7B;&#x6570;&#x636E;&#x5E93;&#x8D1F;&#x8F7D;&#x3002;&#x5B83;&#x901A;&#x8FC7;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x548C;&#x5BF9;&#x8C61;&#x6765;&#x51CF;&#x5C11;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x52A8;&#x6001;&#x3001;&#x6570;&#x636E;&#x5E93;&#x9A71;&#x52A8;&#x7F51;&#x7AD9;&#x7684;&#x901F;&#x5EA6;&#x3002;&#x7ECF;&#x8FC7;&#x591A;&#x5E74;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x76EE;&#x524D;&#x5DF2;&#x7ECF;&#x6709;&#x5F88;&#x591A;&#x77E5;&#x540D;&#x7684;&#x4E92;&#x8054;&#x7F51;&#x5E94;&#x7528;&#x4F7F;&#x7528;&#x5230;&#x4E86;Memcached&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;Wikipedia&#x3001;Flickr&#x3001;Youtube&#x3001;Wordpress&#x7B49;&#x7B49;&#x3002; </p>
<h2 id="&#x4E8C;&#x3001;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;Memcached&#xFF1F;">&#x4E8C;&#x3001;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;Memcached&#xFF1F;</h2><p><img src="http://taojinke.github.io/img/20150703/27690ed.png" alt=""></p>
<p>&#x4E0A;&#x56FE;&#x5C55;&#x793A;&#x4E86;Memcached&#x7684;&#x4E00;&#x822C;&#x6027;&#x7528;&#x9014;&#xFF1A; <strong>&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;</strong> &#x3002;&#x5F53;&#x6D4F;&#x89C8;&#x5668;&#x9996;&#x6B21;&#x8BF7;&#x6C42;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x5148;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x53D6;&#x5F97;&#x8FD4;&#x56DE;&#x7ED9;&#x7528;&#x6237;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x4EE5;Key/Value&#x952E;&#x503C;&#x5BF9;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x5165;Memcached&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x3002;&#x5F53;&#x7528;&#x6237;&#x7B2C;&#x4E8C;&#x6B21;&#x8BBF;&#x95EE;&#x4E0A;&#x6B21;&#x8BF7;&#x6C42;&#xFFFD;&#xFFFD;&#xFFFD;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x901A;&#x8FC7;&#x5728;Memcached&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x67E5;&#x627E;&#x662F;&#x5426;&#x6709;&#x7F13;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5219;&#x76F4;&#x63A5;&#x4ECE;Memcached&#x4E2D;&#x8BFB;&#x53D6;&#x3002;&#x7531;&#x4E8E;Memcached&#x670D;&#x52A1;&#x5668;&#x662F;&#x90E8;&#x7F72;&#x5728;&#x7F51;&#x7AD9;&#x673A;&#x623F;&#x5185;&#x7F51;&#x4E2D;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x6570;&#x636E;&#x65F6;&#x5B58;&#x50A8;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x6BD4;&#x6570;&#x636E;&#x5E93;&#x7684;&#x78C1;&#x76D8;IO&#x8981;&#x5FEB;&#x4E00;&#x4E9B;&#xFF0C;&#x4E5F;&#x5C31;&#x63D0;&#x9AD8;&#x4E86;&#x670D;&#x52A1;&#x54CD;&#x5E94;&#x901F;&#x5EA6;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x9AD8;&#x5CF0;&#x65F6;&#x95F4;&#x51CF;&#x8F7B;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8D1F;&#x8F7D;&#x538B;&#x529B;&#x3002; </p>
<p>&#xFF08;1&#xFF09;Memcached&#x4F5C;&#x4E3A;&#x9AD8;&#x901F;&#x8FD0;&#x884C;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x7684;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li><strong>&#x534F;&#x8BAE;&#x7B80;&#x5355;</strong> &#xFF1A;&#x4F7F;&#x7528; <strong>&#x7B80;&#x5355;&#x7684;&#x57FA;&#x4E8E;&#x6587;&#x672C;&#x884C;</strong> &#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x590D;&#x6742;&#x7684;XML&#x534F;&#x8BAE;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x901A;&#x8FC7;telnet&#x4E5F;&#x80FD;&#x5728;memcached&#x4E0A;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x3001;&#x53D6;&#x5F97;&#x6570;&#x636E;&#xFF1B;</li>
<li><strong>&#x57FA;&#x4E8E;libevent&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;</strong> &#xFF1A;memcached&#x4F7F;&#x7528;&#x8FD9;&#x4E2A; <strong>libevent</strong> &#x5E93;&#xFF0C;&#x56E0;&#x6B64;&#x80FD;&#x5728;Linux&#x3001;BSD&#x3001;Solaris&#x7B49;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#x53D1;&#x6325;&#x5176;&#x9AD8;&#x6027;&#x80FD;&#xFF1B;</li>
</ul>
<p><strong>libevent</strong> &#x662F;&#x4E2A;&#x7A0B;&#x5E8F;&#x5E93;&#xFF0C;&#x5B83;&#x5C06;Linux&#x7684;epoll&#x3001;BSD&#x7C7B;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;kqueue&#x7B49;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x529F;&#x80FD; &#x5C01;&#x88C5;&#x6210;&#x7EDF;&#x4E00;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x5373;&#x4F7F;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x589E;&#x52A0;&#xFF0C;&#x4E5F;&#x80FD;&#x53D1;&#x6325;O(1)&#x7684;&#x6027;&#x80FD;&#x3002; </p>
<p>libevent: <a href="http://www.monkey.org/~provos/libevent/" target="_blank" rel="external">http://www.monkey.org/~provos/libevent/</a></p>
<ul>
<li><strong>&#x5185;&#x7F6E;&#x5185;&#x5B58;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;</strong> &#xFF1A;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;memcached&#x4E2D;&#x4FDD;&#x5B58;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5B58;&#x50A8;&#x5728;memcached <strong>&#x5185;&#x7F6E;&#x7684;&#x5185;&#x5B58;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;</strong> &#x4E2D;&#xFF1B;</li>
</ul>
<p>&#x7531;&#x4E8E;&#x6570;&#x636E;&#x4EC5;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64; <strong>&#x91CD;&#x542F;memcached&#x3001;&#x91CD;&#x542F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4F1A;&#x5BFC;&#x81F4;&#x5168;&#x90E8;&#x6570;&#x636E;&#x6D88;&#x5931;</strong> &#x3002; &#x53E6;&#x5916;&#xFF0C;&#x5185;&#x5BB9;&#x5BB9;&#x91CF;&#x8FBE;&#x5230;&#x6307;&#x5B9A;&#x503C;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x57FA;&#x4E8E;LRU(Least Recently Used)&#x7B97;&#x6CD5;&#x81EA;&#x52A8;&#x5220;&#x9664;&#x4E0D;&#x4F7F;&#x7528;&#x7684;&#x7F13;&#x5B58;&#x3002;memcached&#x672C;&#x8EAB;&#x662F;&#x4E3A;&#x7F13;&#x5B58;&#x800C;&#x8BBE;&#x8BA1;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x56E0;&#x6B64; <strong>&#x5E76;&#x6CA1;&#x6709;&#x8FC7;&#x591A;&#x8003;&#x8651;&#x6570;&#x636E;&#x7684;&#x6C38;&#x4E45;&#x6027;&#x95EE;&#x9898;</strong> &#x3002; </p>
<p>NoSQL&#x4E2D;&#x6BD4;&#x8F83;&#x4F18;&#x79C0;&#x7684;&#x4E00;&#x6B3E;&#x4EA7;&#x54C1;&#xFF1A; <strong>Redis</strong> &#xFF0C;&#x6BD4;&#x8F83;&#x597D;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x7684;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x91CD;&#x542F;Redis&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x4E22;&#x5931;&#x3002; </p>
<ul>
<li><strong>&#x4E0D;&#x4E92;&#x76F8;&#x901A;&#x4FE1;&#x7684;&#x5206;&#x5E03;&#x5F0F;</strong> &#xFF1A;&#x5C3D;&#x7BA1;&#x662F;&#x201C;&#x5206;&#x5E03;&#x5F0F;&#x201D;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F46;&#x670D;&#x52A1;&#x5668;&#xFFFD;&#xFFFD;&#xFFFD;&#x5E76;&#x6CA1;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x529F;&#x80FD;&#xFF0C;&#x8FD9; <strong>&#x5B8C;&#x5168;&#x53D6;&#x51B3;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;</strong> &#x7684;&#x5B9E;&#x73B0;&#x3002;&#x6211;&#x4EEC;&#x4F1A;&#x5F88;&#x60CA;&#x5947;&#x7684;&#x53D1;&#x73B0;memcached&#x7684;&#x96C6;&#x7FA4;&#x975E;&#x5E38;easy&#xFF0C;&#x7B80;&#x5355;&#x5F97;&#x751A;&#x81F3;&#x53EA;&#x9700;&#x8981;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x670D;&#x52A1;&#x5668;IP&#x4E0E;&#x7AEF;&#x53E3;&#x53F7;&#xFF1B;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x7ED9;memcached&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5728;memcached&#x5BA2;&#x6237;&#x7AEF;&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#xFF08;&#x4E00;&#x81F4;&#x6027;Hash&#x7B97;&#x6CD5;&#xFF09;&#x4ECE;memcached&#x670D;&#x52A1;&#x5668;&#x5217;&#x8868;&#x4E2D;&#x8BA1;&#x7B97;&#x4E00;&#x4E2A;memcached&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&#xFF08;&#x5982;&#x679C;&#x662F;&#x8BFB;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x6839;&#x636E;Key&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x4E2D;&#x5F97;&#x5230;&#x7F13;&#x5B58;&#x6709;&#x8BE5;Key&#x7684;memcached&#x670D;&#x52A1;&#x5668;&#x4FE1;&#x606F;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x5C06;&#x6570;&#x636E;&#xFF08;Key/Value&#x5BF9;&#xFF09;&#x4F20;&#x9012;&#x7ED9;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;memcached&#x670D;&#x52A1;&#x5668;&#xFF08;&#x5982;&#x679C;&#x662F;&#x8BFB;&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x4ECE;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;memcached&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x8BFB;&#x53D6;&#x542B;&#x6709;&#x6307;&#x5B9A;Key&#x7684;&#x6570;&#x636E;&#xFF09;&#xFF1B;</li>
</ul>
<p><img src="http://taojinke.github.io/img/20150703/276935e.png" alt=""></p>
<p>PS&#xFF1A;&#x6B63;&#x56E0;&#x4E3A;memcached&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x4E92;&#x4E0D;&#x901A;&#x4FE1;&#xFF0C;&#x56E0;&#x800C;&#x96C6;&#x7FA4;&#x89C4;&#x6A21;&#x53EF;&#x4EE5;&#x8F7B;&#x6613;&#x5730;&#x6269;&#x5BB9;&#xFF0C;&#x5177;&#x6709;&#x826F;&#x597D;&#x7684; <strong>&#x4F38;&#x7F29;&#x6027;</strong> &#x3002; </p>
<p>&#xFF08;2&#xFF09;Memcached&#x4E0E;Redis&#x7684;&#x5BF9;&#x6BD4;</p>
<p>&#x2460;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x8FC7;&#x591A;&#x7684;&#x5173;&#x5FC3;&#x6027;&#x80FD;&#xFF0C;&#x56E0;&#x4E3A; <strong>&#x4E8C;&#x8005;&#x7684;&#x6027;&#x80FD;&#x90FD;&#x5DF2;&#x7ECF;&#x8DB3;&#x591F;&#x9AD8;</strong> &#x4E86;&#x3002;&#x7531;&#x4E8E; <strong>Redis&#x53EA;&#x4F7F;&#x7528;&#x5355;&#x6838;</strong> &#xFF0C;&#x800C; <strong>Memcached&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x6838;</strong> &#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6BD4;&#x8F83;&#x4E0A;&#xFF0C;&#x5E73;&#x5747;&#x6BCF;&#x4E00;&#x4E2A;&#x6838;&#x4E0A;Redis&#x5728;&#x5B58;&#x50A8;&#x5C0F;&#x6570;&#x636E;&#x65F6;&#x6BD4;Memcached&#x6027;&#x80FD;&#x66F4;&#x9AD8;&#x3002;&#x800C;&#x5728;100k&#x4EE5;&#x4E0A;&#x7684;&#x6570;&#x636E;&#x4E2D;&#xFF0C;Memcached&#x6027;&#x80FD;&#x8981;&#x9AD8;&#x4E8E;Redis&#xFF0C;&#x867D;&#x7136;Redis&#x6700;&#x8FD1;&#x4E5F;&#x5728;&#x5B58;&#x50A8;&#x5927;&#x6570;&#x636E;&#x7684;&#x6027;&#x80FD;&#x4E0A;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#xFF0C;&#x4F46;&#x662F;&#x6BD4;&#x8D77;Memcached&#xFF0C;&#x8FD8;&#x662F;&#x7A0D;&#x6709;&#x900A;&#x8272;&#x3002;&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x7ED3;&#x8BBA;&#x662F;&#xFF0C;&#x65E0;&#x8BBA;&#x4F60;&#x4F7F;&#x7528;&#x54EA;&#x4E00;&#x4E2A;&#xFF0C;&#x6BCF;&#x79D2;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x6B21;&#x6570;&#x90FD;&#x4E0D;&#x4F1A;&#x6210;&#x4E3A;&#x74F6;&#x9888;&#x3002;&#xFF08;&#x6BD4;&#x5982;&#x74F6;&#x9888;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x7F51;&#x5361;&#xFF09; </p>
<p>&#x2461;&#x5982;&#x679C;&#x8981;&#x8BF4;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x6548;&#x7387;&#xFF0C; &#x4F7F;&#x7528;&#x7B80;&#x5355;&#x7684;key-value&#x5B58;&#x50A8;&#x7684;&#x8BDD;&#xFF0C;Memcached&#x7684;&#x5185;&#x5B58;&#x5229;&#x7528;&#x7387;&#x66F4;&#x9AD8; &#xFF0C;&#x800C;&#x5982;&#x679C;Redis&#x91C7;&#x7528;hash&#x7ED3;&#x6784;&#x6765;&#x505A;key-value&#x5B58;&#x50A8;&#xFF0C;&#x7531;&#x4E8E;&#x5176;&#x7EC4;&#x5408;&#x5F0F;&#x7684;&#x538B;&#x7F29;&#xFF0C;&#x5176;&#x5185;&#x5B58;&#x5229;&#x7528;&#x7387;&#x4F1A;&#x9AD8;&#x4E8E;Memcached&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x548C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;&#x548C;&#x6570;&#x636E;&#x7279;&#x6027;&#x6709;&#x5173;&#x3002; </p>
<p>&#x2462;&#x5982;&#x679C;&#x4F60; &#x5BF9;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x548C;&#x6570;&#x636E;&#x540C;&#x6B65;&#x6709;&#x6240;&#x8981;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x63A8;&#x8350;&#x4F60;&#x9009;&#x62E9;Redis &#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E24;&#x4E2A;&#x7279;&#x6027;Memcached&#x90FD;&#x4E0D;&#x5177;&#x5907;&#x3002;&#x5373;&#x4F7F;&#x4F60;&#x53EA;&#x662F;&#x5E0C;&#x671B;&#x5728;&#x5347;&#x7EA7;&#x6216;&#x8005;&#x91CD;&#x542F;&#x7CFB;&#x7EDF;&#x540E;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x4E0D;&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x9009;&#x62E9;Redis&#x4E5F;&#x662F;&#x660E;&#x667A;&#x7684;&#x3002; </p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x4E00;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF1A;&#x5728;&#x7B80;&#x5355;&#x7684;Key/Value&#x5E94;&#x7528;&#x573A;&#x666F;&#xFF08;&#x4F8B;&#x5982;&#x7F13;&#x5B58;&#xFF09;&#xFF0C;Memcached&#x62E5;&#x6709;&#x66F4;&#x9AD8;&#x7684;&#x8BFB;&#x5199;&#x6027;&#x80FD;&#xFF1B;&#x800C;&#x5728;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x548C;&#x6570;&#x636E;&#x540C;&#x6B65;&#x573A;&#x666F;&#xFF0C;Redis&#x62E5;&#x6709;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x548C;&#x66F4;&#x4E3A;&#x4E30;&#x5BCC;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF1B;</p>
<h2 id="&#x4E09;&#x3001;Memcached&#x7684;&#x5B89;&#x88C5;&#x4E0E;&#x7B80;&#x5355;&#x64CD;&#x4F5C;">&#x4E09;&#x3001;Memcached&#x7684;&#x5B89;&#x88C5;&#x4E0E;&#x7B80;&#x5355;&#x64CD;&#x4F5C;</h2><p>Memcached&#x7684;&#x5B89;&#x88C5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x800C;&#x4E14;&#x652F;&#x6301;&#x591A;&#x5E73;&#x53F0;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;&#x6700;&#x7ECF;&#x5178;&#x7684;Linux&#x3001;FreeBSD&#x3001;Solaris (memcached 1.2.5&#x4EE5;&#x4E0A;&#x7248;&#x672C;)&#x3001;Mac OS X&#x4EE5;&#x53CA;&#x6211;&#x4EEC;&#x6700;&#x719F;&#x6089;&#x7684;Windows&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x6700;&#x719F;&#x6089;&#x7684;Windows&#x5E73;&#x53F0;&#x6765;&#x5B89;&#x88C5;Memcached&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#x548C;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#xFF08;1&#xFF09;&#x4E0B;&#x8F7D;Memcached For Windows</p>
<p>URL&#xFF1A; <a href="http://code.jellycan.com/files/memcached-1.2.6-win32-bin.zip" target="_blank" rel="external">http://code.jellycan.com/files/memcached-1.2.6-win32-bin.zip</a></p>
<p>&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x6E90;&#x7801;&#x5730;&#x5740;&#xFF1A; <a href="http://code.jellycan.com/files/memcached-1.2.6-win32-src.zip" target="_blank" rel="external">http://code.jellycan.com/files/memcached-1.2.6-win32-src.zip</a></p>
<p>&#xFF08;2&#xFF09;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x5B89;&#x88C5;Windows Server 2003 Enterprise Edition&#xFF08; <strong>&#x975E;&#x5FC5;&#x8981;&#x6B65;&#x51D1;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x673A;&#x8FDB;&#x884C;</strong> &#xFF09;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;&#xFF1A;MemcachedServer&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x8FD8;&#x8981;&#x7ED9;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x7684;Windows Server&#x8BBE;&#x7F6E;&#x597D;IP&#x5730;&#x5740;&#xFF0C;&#x786E;&#x4FDD;&#x5BBF;&#x4E3B;&#x673A;&#x548C;&#x865A;&#x62DF;&#x673A;&#x80FD;&#x591F;&#x4E92;&#x76F8;ping&#x901A;&#x3002; </p>
<p><img src="http://taojinke.github.io/img/20150703/276935e.jpg" alt=""></p>
<p>&#xFF08;3&#xFF09;&#x5C06;&#x4E0B;&#x8F7D;&#x7684;Memcached&#x5305;&#x62F7;&#x8D1D;&#x5230;Windows&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x7684;Windows Server&#x4E2D;&#x7684;C:/MemcachedServer/</p>
<p><img src="http://taojinke.github.io/img/20150703/27695cf.jpg" alt=""></p>
<p>&#xFF08;4&#xFF09;&#x2460;&#x5728;Windows&#x4E2D;&#x5B89;&#x88C5;Memcached&#x670D;&#x52A1;&#xFF1A; <strong>memcached.exe -d install</strong> &#xFF08;&#x90A3;&#x4E48;&#xFF0C;&#x5BF9;&#x5E94;&#x5378;&#x8F7D;&#x547D;&#x4EE4;&#x4E3A;&#xFF1A; <strong>memcached.exe -d uninstall</strong> &#xFF09; </p>
<p><img src="http://taojinke.github.io/img/20150703/2769840.jpg" alt=""></p>
<p>&#x2461;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#x5373;&#x53EF;&#x5728;Windows&#x670D;&#x52A1;&#x5217;&#x8868;&#x4E2D;&#x67E5;&#x770B;&#x5230;Memcached Server&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x6211;&#x4EEC;&#x8981;&#x5C06;&#x5176;&#x8BBE;&#x4E3A;&#x5F00;&#x673A;&#x542F;&#x52A8;&#x9879;&#xFF1A;&#x5728;&#x5C5E;&#x6027;&#x4E2D;&#x8BBE;&#x7F6E;&#x542F;&#x52A8;&#x7C7B;&#x578B;&#x4E3A;&#x81EA;&#x52A8;&#x5373;&#x53EF;</p>
<p><img src="http://taojinke.github.io/img/20150703/2769840.jpg" alt=""></p>
<p>&#x2462;&#x5B89;&#x88C5;&#x597D;&#x670D;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x542F;&#x52A8;Memcached&#x670D;&#x52A1;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x542F;&#x52A8;&#xFF1A;&#x4E00;&#x662F;&#x76F4;&#x63A5;&#x5728;Windows&#x670D;&#x52A1;&#x5217;&#x8868;&#x91CC;&#x9009;&#x4E2D;Memcached&#x670D;&#x52A1;&#x70B9;&#x51FB;&#x542F;&#x52A8;&#xFF1B;&#x4E8C;&#x662F;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x8F93;&#x5165;&#xFF1A; <strong>memcached -d start</strong> &#xFF08;&#x5BF9;&#x5E94;&#x7684;&#x505C;&#x6B62;&#x670D;&#x52A1;&#x547D;&#x4EE4;&#x4E3A;&#xFF1A; <strong>memcached -d stop</strong> &#xFF09; </p>
<p>&#xFF08;5&#xFF09;&#x68C0;&#x6D4B;Memcached&#x670D;&#x52A1;&#x662F;&#x5426;&#x6210;&#x529F;&#x542F;&#x52A8;&#xFF1A;</p>
<p>&#x2460;&#x4F7F;&#x7528;telnet&#x547D;&#x4EE4;&#x8FDE;&#x63A5;&#x5230;&#x767B;&#x5F55;&#x53F0;&#xFF1A;telnet &#x670D;&#x52A1;&#x5668;IP&#x5730;&#x5740; 11211&#xFF08;11211&#x662F;&#x9ED8;&#x8BA4;&#x7684;Memcached&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x53F7;&#xFF09;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x8F93;&#x5165;&#xFF1A; <strong>telnet 192.168.80.10 11211</strong> &#xFF08;192.168.80.10&#x662F;&#x6211;&#x7684;Windows Server&#x865A;&#x62DF;&#x673A;&#x7684;IP&#x5730;&#x5740;&#xFF09; </p>
<p><img src="http://taojinke.github.io/img/20150703/2769ab1.jpg" alt=""></p>
<p>&#x2461;&#x6253;&#x5370;&#x5F53;&#x524D;Memcache&#x670D;&#x52A1;&#x5668;&#x72B6;&#x6001;&#xFF1A; <strong>stats</strong></p>
<p><img src="http://taojinke.github.io/img/20150703/2769ab1.jpg" alt=""></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x901A;&#x8FC7;stats&#x547D;&#x4EE4;&#x5217;&#x51FA;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x7684;Memcached&#x670D;&#x52A1;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x53C8;&#x4EE3;&#x8868;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x56FE;&#x6765;&#x77E5;&#x9053;&#xFF1A;</p>
<p><img src="http://taojinke.github.io/img/20150703/2769ab1.png" alt=""></p>
<p>&#xFF08;6&#xFF09;&#x521D;&#x6B65;&#x5B66;&#x4E60;Memcached&#x7684;&#x6570;&#x636E;&#x8BFB;&#x5199;&#x547D;&#x4EE4;&#x64CD;&#x4F5C;&#xFF1A;</p>
<p>&#x2460;&#x6DFB;&#x52A0;&#x6216;&#x66F4;&#x6539;&#x547D;&#x4EE4;&#xFF1A; <strong>set</strong> KeyName &#x989D;&#x5916;&#x4FE1;&#x606F; &#x5B58;&#x6D3B;&#x65F6;&#x95F4; &#x5B58;&#x50A8;&#x5B57;&#x8282;&#x6570; [&#x56DE;&#x8F66;] &#x5177;&#x4F53;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x5757; </p>
<p><img src="http://taojinke.github.io/img/20150703/2769d22.jpg" alt=""></p>
<p>&#x8FD9;&#x91CC;&#x989D;&#x5916;&#x4FE1;&#x606F;&#x4E3A;0&#xFF0C;&#x4EE3;&#x8868;&#x65E0;&#xFF1B;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;&#x4E3A;0&#xFF0C;&#x4EE3;&#x8868;&#x6C38;&#x4E45;&#xFF1B;&#x800C;&#x5177;&#x4F53;&#x7684;&#x6570;&#x636E;&#x5757;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684;Key/Value&#x4E2D;&#x7684;Value&#xFF1B;</p>
<p>PS&#xFF1A;&#x8FD9;&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <strong>add</strong> KeyName &#x989D;&#x5916;&#x4FE1;&#x606F; &#x5B58;&#x6D3B;&#x65F6;&#x95F4; &#x5B58;&#x50A8;&#x5B57;&#x8282;&#x6570; [&#x56DE;&#x8F66;] &#x5177;&#x4F53;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x5757;&#x3002;&#x4E0D;&#x8FC7;set&#x663E;&#x7136;&#x66F4;&#x4E3A;&#x5F3A;&#x5927;&#xFF0C;&#x5B83;&#x4F1A;&#x5224;&#x65AD;keyname&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x65B0;&#x589E;&#xFF0C;&#x5B58;&#x5728;&#x5219;&#x4FEE;&#x6539;&#xFF1B; </p>
<p>&#x2461;&#x8BFB;&#x53D6;&#x547D;&#x4EE4;&#xFF1A; <strong>get</strong> KeyName&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x521A;&#x521A;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;key1&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#xFF1A;get key1&#x4FBF;&#x83B7;&#x53D6;&#x4E86;key1&#x8FD9;&#x4E2A;key&#x7684;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x4FE1;&#x606F;&#xFF1B; </p>
<p>&#x2462;&#x66F4;&#x65B0;&#x547D;&#x4EE4;&#xFF1A; <strong>replace</strong> KeyName &#x989D;&#x5916;&#x4FE1;&#x606F; &#x5B58;&#x6D3B;&#x65F6;&#x95F4; &#x5B58;&#x50A8;&#x5B57;&#x8282;&#x6570; [&#x56DE;&#x8F66;] &#x5177;&#x4F53;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x5757; </p>
<p><img src="http://taojinke.github.io/img/20150703/2769d22.jpg" alt=""></p>
<p>&#x2463;&#x5220;&#x9664;&#x547D;&#x4EE4;&#xFF1A; <strong>delete</strong> KeyName </p>
<p><img src="http://taojinke.github.io/img/20150703/2769f93.jpg" alt=""></p>
<h2 id="&#x56DB;&#x3001;&#x5B66;&#x4E60;&#x5C0F;&#x7ED3;">&#x56DB;&#x3001;&#x5B66;&#x4E60;&#x5C0F;&#x7ED3;</h2><p>&#x672C;&#x7BC7;&#x6211;&#x4EEC;&#x521D;&#x6B65;&#x4E86;&#x89E3;&#x4E86;&#x4EC0;&#x4E48;&#x662F;Memcached&#xFF0C;&#x4E0B;&#x8F7D;&#x5E76;&#x5B89;&#x88C5;&#x4E86;Memcached&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x5176;&#x8BBE;&#x4E3A;Windows&#x81EA;&#x542F;&#x52A8;&#x670D;&#x52A1;&#xFF0C;&#x901A;&#x8FC7;telnet&#x8FDE;&#x63A5;&#x5230;Memcached&#x767B;&#x5F55;&#x53F0;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;&#x603B;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;Memcached&#x662F;&#x4E00;&#x4E2A;&#x9AD8;&#x6027;&#x80FD;&#x7684;Key/Value&#x7F13;&#x5B58;&#x7CFB;&#x7EDF;&#xFF0C;&#x901A;&#x8FC7;&#x6784;&#x5EFA;Memcached&#x96C6;&#x7FA4;&#xFF0C;&#x80FD;&#x591F;&#x9002;&#x5E94;&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x9700;&#x8981;&#x3002;&#x4E0B;&#x4E00;&#x7BC7;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5728;.Net&#x4E2D;&#x8FDE;&#x63A5;&#x5E76;&#x64CD;&#x4F5C;Memcached&#xFF0C;&#x6700;&#x540E;&#x4EE5;&#x4E00;&#x4E2A;&#x7EFC;&#x5408;&#x6848;&#x4F8B;&#x6765;&#x4F53;&#x73B0;Memcached&#x4F5C;&#x4E3A;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x7684;&#x91CD;&#x8981;&#x4F5C;&#x7528;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x4EB2;&#x89C9;&#x5F97;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x4E0D;&#x9519;&#x6216;&#x8005;&#x5BF9;&#x4F60;&#x6709;&#x7528;&#xFF0C;&#x9EBB;&#x70E6;&#x5E2E;&#x6211;&#x70B9;&#x4E2A;&#x201C;&#x63A8;&#x8350;&#x201D;&#xFF0C;&#x8BA9;&#x6211;&#x66F4;&#x6709;&#x52A8;&#x529B;&#x7EE7;&#x7EED;&#x5199;&#x4E0B;&#x53BB;&#xFF0C;&#x8C22;&#x8C22;&#xFF01;</p>
<h2 id="&#x53C2;&#x8003;&#x6587;&#x732E;">&#x53C2;&#x8003;&#x6587;&#x732E;</h2><p>&#xFF08;1&#xFF09;&#x4F20;&#x667A;&#x64AD;&#x5BA2;&#x9A6C;&#x4F26;&#xFF0C;&#x300A;Memcached&#x516C;&#x5F00;&#x8BFE;&#x300B;&#xFF0C;<a href="http://bbs.itcast.cn/thread-14836-1-1.html" target="_blank" rel="external">http://bbs.itcast.cn/thread-14836-1-1.html</a></p>
<p>&#xFF08;2&#xFF09;charlee&#xFF0C;&#x300A;Memcached&#x5B8C;&#x5168;&#x5256;&#x6790;&#x300B;&#xFF0C;<a href="http://kb.cnblogs.com/page/42731/" target="_blank" rel="external">http://kb.cnblogs.com/page/42731/</a></p>
<p>&#xFF08;3&#xFF09;&#x5F20;&#x948A;&#xFF0C;&#x300A;Memcached&#x4ECB;&#x7ECD;&#x300B;&#xFF0C;<a href="http://blog.csdn.net/zz198808/article/details/8032571" target="_blank" rel="external">http://blog.csdn.net/zz198808/article/details/8032571</a></p>
<p>&#xFF08;4&#xFF09;toxic&#xFF0C;&#x300A;memcached&#x300B;&#xFF0C;<a href="http://www.cnblogs.com/lost-1987/articles/3069460.html" target="_blank" rel="external">http://www.cnblogs.com/lost-1987/articles/3069460.html</a></p>
<p>&#x8F6C;&#x81EA;&#xFF1A;<a href="http://www.cnblogs.com/edisonchou/p/3855517.html" target="_blank" rel="external">http://www.cnblogs.com/edisonchou/p/3855517.html</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="&#x4E00;&#x3001;Memcached&#x662F;&#x4F55;&#x65B9;&#x795E;&#x5723;&#xFF1F;">&#x4E00;&#x3001;Memcached&#x662F;&#x4F55;&#x65B9;&#x795E;]]>
    </summary>
    
      <category term="Memcached" scheme="http://taojinke.github.io/tags/Memcached/"/>
    
      <category term="Nosql" scheme="http://taojinke.github.io/tags/Nosql/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Linux c 开发 - Memcached源码分析之命令解析（2） -]]></title>
    <link href="http://taojinke.github.io/2015/07/03/27631b6/"/>
    <id>http://taojinke.github.io/2015/07/03/27631b6/</id>
    <published>2015-07-03T02:09:43.000Z</published>
    <updated>2015-07-03T14:09:44.085Z</updated>
    <content type="html"><![CDATA[<p> &#x524D;&#x8A00; </p>
<p>&#x4ECE;&#x6211;&#x4EEC;&#x4E0A;&#x4E00;&#x7AE0;&#x300A;Linux c &#x5F00;&#x53D1; - Memcached&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E4B;&#x57FA;&#x4E8E;Libevent&#x7684;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#xFF08;1&#xFF09;&#x300B;&#x6211;&#x4EEC;&#x57FA;&#x672C;&#x4E86;&#x89E3;&#x4E86;Memcached&#x7684;&#x7F51;&#x7EDC;&#x6A21;&#x578B;&#x3002;&#x8FD9;&#x4E00;&#x7AE0;&#x8282;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BE6;&#x7EC6;&#x89E3;&#x8BFB;Memcached&#x7684;&#x547D;&#x4EE4;&#x89E3;&#x6790;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x56DE;&#x987E;&#x4E0A;&#x4E00;&#x7AE0;&#x53D1;&#x73B0;Memcached&#x4F1A;&#x5206;&#x6210;&#x4E3B;&#x7EBF;&#x7A0B;&#x548C;N&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x3002;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x76D1;&#x542C;accpet&#x5BA2;&#x6237;&#x7AEF;&#x7684;Socket&#x8FDE;&#x63A5;&#xFF0C;&#x800C;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x63A5;&#x7BA1;&#x5177;&#x4F53;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x4E3B;&#x7EBF;&#x7A0B;&#x548C;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x4E3B;&#x8981;&#x901A;&#x8FC7;&#x57FA;&#x4E8E;Libevent&#x7684;pipe&#x7684;&#x8BFB;&#x5199;&#x4E8B;&#x4EF6;&#x6765;&#x76D1;&#x542C;&#xFF0C;&#x5F53;&#x6709;&#x8FDE;&#x63A5;&#x7EC3;&#x4E0A;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;&#x4F1A;&#x5C06;&#x8FDE;&#x63A5;&#x4EA4;&#x4E2A;&#x67D0;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x53BB;&#x63A5;&#x7BA1;&#xFF0C;&#x540E;&#x671F;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x8BFB;&#x5199;&#x5DE5;&#x4F5C;&#x90FD;&#x4F1A;&#x5728;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x3002;</p>
<p>&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x4E5F;&#x662F;&#x57FA;&#x4E8E;Libevent&#x7684;&#x4E8B;&#x4EF6;&#x7684;&#xFF0C;&#x5F53;&#x6709;&#x8BFB;&#x6216;&#x8005;&#x5199;&#x7684;&#x4E8B;&#x4EF6;&#x8FDB;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x90A3;&#x4E48;Memcached&#x662F;&#x5982;&#x4F55;&#x6765;&#x89E3;&#x6790;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x4F20;&#x7684;&#x547D;&#x4EE4;&#x6570;&#x636E;&#x62A5;&#x6587;&#x7684;&#x5462;&#xFF1F;&#x8FD9;&#x4E00;&#x7AE0;&#x6211;&#x4EEC;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;&#x547D;&#x4EE4;&#x7684;&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E0B;&#x4E00;&#x7AE0;&#x4F1A;&#x8BB2;&#x89E3;Memcached&#x5BF9;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x56DE;&#x5E94;&#x3002;</p>
<p>Memcached&#x7684;&#x547D;&#x4EE4;&#x89E3;&#x6790;&#x6E90;&#x7801;&#x5206;&#x6790;</p>
<p>conn&#x6570;&#x636E;&#x7ED3;&#x6784;</p>
<p>&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x90FD;&#x4F1A;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x4E2A;conn&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x4E3B;&#x8981;&#x5B58;&#x50A8;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x8FD9;&#x4E00;&#x7AE0;&#x4E2D;&#x7528;&#x5230;&#x7684;&#x51E0;&#x4E2A;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x53C2;&#x6570;&#xFF1A;</p>
<p>char * rbuf&#xFF1A;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x636E;&#x62A5;&#x6587;&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x3002;</p>
<p>int rsize&#xFF1A;rbuf&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>char * rcurr&#xFF1A;&#x672A;&#x89E3;&#x6790;&#x7684;&#x547D;&#x4EE4;&#x7684;&#x5B57;&#x7B26;&#x6307;&#x9488;&#x3002;</p>
<p>int rbytes&#xFF1A;&#x4E3A;&#x89E3;&#x6790;&#x7684;&#x547D;&#x4EE4;&#x7684;&#x957F;&#x5EA6;&#x3002;</p>
<p><img src="http://taojinke.github.io/img/20150703/275f4ad.jpg" alt=""></p>
<pre><code><span class="keyword">typedef</span> <span class="keyword">struct</span> conn conn;  
<span class="keyword">struct</span> conn {  
    <span class="keyword">int</span>    sfd;  
    <span class="keyword">sasl_conn_t</span> *sasl_conn;  
    <span class="keyword">bool</span> authenticated;  
    <span class="keyword">enum</span> conn_states  state;  
    <span class="keyword">enum</span> bin_substates substate;  
    <span class="keyword">rel_time_t</span> <span class="keyword">last_cmd_t</span>ime;  
    <span class="keyword">struct</span> event event;  
    <span class="keyword">short</span>  ev_flags;  
    <span class="keyword">short</span>  which;   <span class="comment">/** which events were just triggered */</span>  

    <span class="keyword">char</span>   *rbuf;   <span class="comment">/** buffer to read commands into */</span>  
    <span class="keyword">char</span>   *rcurr;  <span class="comment">/** but if we parsed some already, this is where we stopped */</span>  
    <span class="keyword">int</span>    rsize;   <span class="comment">/** total allocated size of rbuf */</span>  
    <span class="keyword">int</span>    rbytes;  <span class="comment">/** how much data, starting from rcur, do we have unparsed */</span>  

    <span class="keyword">char</span>   *wbuf;  
    <span class="keyword">char</span>   *wcurr;  
    <span class="keyword">int</span>    wsize;  
    <span class="keyword">int</span>    wbytes;  
    <span class="comment">/** which state to go into after finishing current write */</span>  
    <span class="keyword">enum</span> conn_states  write_and_go;  
    <span class="keyword">void</span>   *write_and_free; <span class="comment">/** free this memory after finishing writing */</span>  

    <span class="keyword">char</span>   *ritem;  <span class="comment">/** when we read in an item&amp;apos;s value, it goes here */</span>  
    <span class="keyword">int</span>    rlbytes;  

    <span class="comment">/* data for the nread state */</span>  

    <span class="comment">/** 
     * item is used to hold an item structure created after reading the command 
     * line of set/add/replace commands, but before we finished reading the actual 
     * data. The data is read into ITEM_data(item) to avoid extra copying. 
     */</span>  

    <span class="keyword">void</span>   *item;     <span class="comment">/* for commands set/add/replace  */</span>  

    <span class="comment">/* data for the swallow state */</span>  
    <span class="keyword">int</span>    sbytes;    <span class="comment">/* how many bytes to swallow */</span>  

    <span class="comment">/* data for the mwrite state */</span>  
    <span class="keyword">struct</span> iovec *iov;  
    <span class="keyword">int</span>    iovsize;   <span class="comment">/* number of elements allocated in iov[] */</span>  
    <span class="keyword">int</span>    iovused;   <span class="comment">/* number of elements used in iov[] */</span>  

    <span class="keyword">struct</span> msghdr *msglist;  
    <span class="keyword">int</span>    msgsize;   <span class="comment">/* number of elements allocated in msglist[] */</span>  
    <span class="keyword">int</span>    msgused;   <span class="comment">/* number of elements used in msglist[] */</span>  
    <span class="keyword">int</span>    msgcurr;   <span class="comment">/* element in msglist[] being transmitted now */</span>  
    <span class="keyword">int</span>    msgbytes;  <span class="comment">/* number of bytes in current msg */</span>  

    item   **ilist;   <span class="comment">/* list of items to write out */</span>  
    <span class="keyword">int</span>    isize;  
    item   **icurr;  
    <span class="keyword">int</span>    ileft;  

    <span class="keyword">char</span>   **suffixlist;  
    <span class="keyword">int</span>    suffixsize;  
    <span class="keyword">char</span>   **suffixcurr;  
    <span class="keyword">int</span>    suffixleft;  

    <span class="keyword">enum</span> protocol protocol;   <span class="comment">/* which protocol this connection speaks */</span>  
    <span class="keyword">enum</span> <span class="keyword">network_t</span>ransport transport; <span class="comment">/* what transport is used by this connection */</span>  

    <span class="comment">/* data for UDP clients */</span>  
    <span class="keyword">int</span>    request_id; <span class="comment">/* Incoming UDP request ID, if this is a UDP &amp;quot;connection&amp;quot; */</span>  
    <span class="keyword">struct</span> sockaddr_in6 request_addr; <span class="comment">/* udp: Who sent the most recent request */</span>  
    <span class="keyword">socklen_t</span> request_addr_size;  
    <span class="keyword">unsigned</span> <span class="keyword">char</span> *hdrbuf; <span class="comment">/* udp packet headers */</span>  
    <span class="keyword">int</span>    hdrsize;   <span class="comment">/* number of headers&amp;apos; worth of space is allocated */</span>  

    <span class="keyword">bool</span>   noreply;   <span class="comment">/* True if the reply should not be sent. */</span>  
    <span class="comment">/* current stats command */</span>  
    <span class="keyword">struct</span> {  
        <span class="keyword">char</span> *buffer;  
        <span class="keyword">size_t</span> size;  
        <span class="keyword">size_t</span> offset;  
    } stats;  

    <span class="comment">/* Binary protocol stuff */</span>  
    <span class="comment">/* This is where the binary header goes */</span>  
    protocol_binary_request_header binary_header;  
    <span class="keyword">uint64_t</span> cas; <span class="comment">/* the cas to return */</span>  
    <span class="keyword">short</span> cmd; <span class="comment">/* current command being processed */</span>  
    <span class="keyword">int</span> opaque;  
    <span class="keyword">int</span> keylen;  
    conn   *next;     <span class="comment">/* Used for generating a list of conn structures */</span>  
    LIBEVENT_THREAD *thread; <span class="comment">/* Pointer to the thread object serving this connection */</span>  
};
</code></pre><p>&#x6574;&#x4F53;&#x6D41;&#x7A0B;</p>
<ol>
<li><p>&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x548C;Memcached&#x5EFA;&#x7ACB;TCP&#x8FDE;&#x63A5;&#x540E;&#xFF0C;Memcached&#x4F1A;&#x57FA;&#x4E8E;Libevent&#x7684;event&#x4E8B;&#x4EF6;&#x6765;&#x76D1;&#x542C;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x5426;&#x6709;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x3002;</p>
</li>
<li><p>&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x547D;&#x4EE4;&#x6570;&#x636E;&#x62A5;&#x6587;&#x4E0A;&#x62A5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;drive_machine&#x65B9;&#x6CD5;&#x4E2D;&#x7684;conn_read&#x8FD9;&#x4E2A;Case&#x3002;</p>
</li>
<li><p>memcached&#x901A;&#x8FC7;try_read_network&#x65B9;&#x6CD5;&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x62A5;&#x6587;&#x3002;&#x5982;&#x679C;&#x8BFB;&#x53D6;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;conn_closing&#xFF0C;&#x53BB;&#x5173;&#x95ED;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#xFF1B;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BFB;&#x53D6;&#x5230;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x4F1A;&#x8FD4;&#x56DE;conn_waiting&#xFF0C;&#x7EE7;&#x7EED;&#x7B49;&#x5F85;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4E8B;&#x4EF6;&#x5230;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x9000;&#x51FA;drive_machine&#x7684;&#x5FAA;&#x73AF;&#xFF1B;&#x5982;&#x679C;&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x4F1A;&#x5C06;&#x72B6;&#x6001;&#x8F6C;&#x4EA4;&#x7ED9;conn_parse_cmd&#x5904;&#x7406;&#xFF0C;&#x8BFB;&#x53D6;&#x5230;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x5B58;&#x50A8;&#x5728;c-&gt;rbuf&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>
</li>
<li><p>conn_parse_cmd&#x4E3B;&#x8981;&#x7684;&#x5DE5;&#x4F5C;&#x5C31;&#x662F;&#x7528;&#x6765;&#x89E3;&#x6790;&#x547D;&#x4EE4;&#x3002;&#x4E3B;&#x8981;&#x901A;&#x8FC7;try_read_command&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x8BFB;&#x53D6;c-&gt;rbuf&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x6570;&#x636E;&#xFF0C;&#x901A;&#x8FC7;\n&#x6765;&#x5206;&#x9694;&#x6570;&#x636E;&#x62A5;&#x6587;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x5982;&#x679C;c-&gt;buf&#x5185;&#x5B58;&#x5757;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5339;&#x914D;&#x4E0D;&#x5230;\n&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x7EE7;&#x7EED;&#x7B49;&#x5F85;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x547D;&#x4EE4;&#x6570;&#x636E;&#x62A5;&#x6587;&#x5230;&#x6765;conn_waiting&#xFF1B;&#x5426;&#x5219;&#x5C31;&#x4F1A;&#x8F6C;&#x4EA4;&#x7ED9;process_command&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x5904;&#x7406;&#x5177;&#x4F53;&#x7684;&#x547D;&#x4EE4;&#xFF08;&#x547D;&#x4EE4;&#x89E3;&#x6790;&#x4F1A;&#x901A;&#x8FC7;\0&#x7B26;&#x53F7;&#x6765;&#x5206;&#x9694;&#xFF09;&#x3002;</p>
</li>
<li><p>process<em>command&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5904;&#x7406;&#x5177;&#x4F53;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x5176;&#x4E2D;tokenize_command&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x5C06;&#x547D;&#x4EE4;&#x62C6;&#x89E3;&#x6210;&#x591A;&#x4E2A;&#x5143;&#x7D20;&#xFF08;KEY&#x7684;&#x6700;&#x5927;&#x957F;&#x5EA6;250&#xFF09;&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x4EE5;get&#x547D;&#x4EE4;&#x4E3A;&#x4F8B;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;process_get_command&#x8FD9;&#x4E2A;&#x547D;&#x4EE4; process</em>*_command&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x5C31;&#x662F;&#x5904;&#x7406;&#x5177;&#x4F53;&#x7684;&#x547D;&#x4EE4;&#x903B;&#x8F91;&#x7684;&#x3002;</p>
</li>
<li><p>&#x6211;&#x4EEC;&#x8FDB;&#x5165;process_get_command&#xFF0C;&#x5F53;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x8F6C;&#x4EA4;&#x5230;conn_mwrite&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002;</p>
</li>
<li><p>&#x8FDB;&#x5165;conn_mwrite&#x540E;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;transmit&#x65B9;&#x6CD5;&#x6765;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4EA4;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x5199;&#x6570;&#x636E;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x6216;&#x9000;&#x51FA;drive_machine&#x5FAA;&#x73AF;&#xFF1B;&#x5982;&#x679C;&#x5199;&#x5165;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x53C8;&#x8F6C;&#x4EA4;&#x5230;conn_new_cmd&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;</p>
</li>
<li><p>conn_new_cmd&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x4E3B;&#x8981;&#x662F;&#x5904;&#x7406;c-&gt;rbuf&#x4E2D;&#x5269;&#x4F59;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x4E3B;&#x8981;&#x770B;&#x4E00;&#x4E0B;reset_cmd_handler&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x56DE;&#x53BB;&#x5224;&#x65AD;c-&gt;rbytes&#x4E2D;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x5269;&#x4F59;&#x7684;&#x62A5;&#x6587;&#x6CA1;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x672A;&#x5904;&#x7406;&#xFF0C;&#x5219;&#x8F6C;&#x4EA4;&#x5230;conn_parse_cmd&#xFF08;&#x7B2C;&#x56DB;&#x90E8;&#xFF09;&#x7EE7;&#x7EED;&#x89E3;&#x6790;&#x5269;&#x4F59;&#x547D;&#x4EE4;&#xFF1B;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x4E86;&#xFF0C;&#x5219;&#x8F6C;&#x4EA4;&#x5230;conn_waiting&#xFF0C;&#x7B49;&#x5F85;&#x65B0;&#x7684;&#x4E8B;&#x4EF6;&#x5230;&#x6765;&#x3002;&#x5728;&#x8F6C;&#x4EA4;&#x4E4B;&#x524D;&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x4F1A;&#x6267;&#x884C;&#x4E00;&#x6B21;conn_shrink&#x65B9;&#x6CD5;&#x3002;</p>
</li>
<li><p>conn_shrink&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5904;&#x7406;&#x547D;&#x4EE4;&#x62A5;&#x6587;&#x5BB9;&#x5668;c-&gt;rbuf&#x548C;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x7684;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6570;&#x636E;&#x6EE1;&#x4E86;&#xFF1F;&#x662F;&#x5426;&#x9700;&#x8981;&#x6269;&#x5927;buffer&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x662F;&#x5426;&#x9700;&#x8981;&#x79FB;&#x52A8;&#x5185;&#x5B58;&#x5757;&#x3002;&#x63A5;&#x53D7;&#x547D;&#x4EE4;&#x62A5;&#x6587;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5185;&#x5B58;&#x5757;&#x5927;&#x5C0F;2048&#xFF0C;&#x6700;&#x5927;8192&#x3002;</p>
</li>
</ol>
<p><img src="http://taojinke.github.io/img/20150703/275f4ad.jpg" alt=""></p>
<p><img src="http://taojinke.github.io/img/20150703/275f71e.jpg" alt=""></p>
<p>&#x547D;&#x4EE4;rbuf&#x6570;&#x636E;&#x7ED3;&#x6784;&#x53D8;&#x5316;&#x56FE;&#xFF1A;</p>
<ol>
<li>&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6570;&#x636E;</li>
</ol>
<p><img src="http://taojinke.github.io/img/20150703/275f98f.jpg" alt=""></p>
<ol>
<li>&#x89E3;&#x6790;buf&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x5982;&#x679C;&#x9047;&#x5230;\n&#xFF0C;&#x5219;&#x8868;&#x660E;&#x662F;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x5C3E;&#x6807;&#x8BC6;&#x7B26;&#x3002;</li>
</ol>
<p><img src="http://taojinke.github.io/img/20150703/275f98f.jpg" alt=""></p>
<ol>
<li>&#x547D;&#x4EE4;&#x62C6;&#x5206;&#x3002;&#x547D;&#x4EE4;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x4E4B;&#x540E;&#xFF0C;&#x5BF9;&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x5206;&#x89E3;&#xFF0C;&#x5206;&#x89E3;&#x662F;&#x901A;&#x8FC7;&#x7A7A;&#x683C;&#x6765;&#x5206;&#x79BB;&#x7684;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E00;&#x822C;&#x4E3A;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x4E00;&#x822C;&#x4E3A;KEY&#x3002;</li>
</ol>
<p><img src="http://taojinke.github.io/img/20150703/275f98f.jpg" alt=""></p>
<ol>
<li>&#x5185;&#x5B58;&#x5757;&#x91CD;&#x8BBE;&#x7F6E;&#x3002;&#x5982;&#x679C;rbuf&#x5185;&#x5B58;&#x5757;&#x4F7F;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#xFF0C;&#x6216;&#x8005;&#x5927;&#x4E8E;8k&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x5185;&#x5B58;&#x5757;</li>
</ol>
<p><img src="http://taojinke.github.io/img/20150703/275fc00.jpg" alt=""></p>
<p>&#x4ECE;drive_machine&#x5F00;&#x59CB;</p>
<p>&#x6211;&#x4EEC;&#x4E0A;&#x4E00;&#x8282;&#x770B;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x7684;&#x8BFB;&#x5199;&#x4E8B;&#x4EF6;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1A;event_handler&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x662F;drive_machine&#x3002;</p>
<pre><code><span class="function"><span class="keyword">void</span> <span class="title">event_handler</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">short</span> which, <span class="keyword">void</span> *arg)</span> </span>{  
    conn *c;  
    <span class="comment">//&amp;#x7EC4;&amp;#x88C5;conn&amp;#x7ED3;&amp;#x6784;  </span>
    c = (conn *) arg;  
    <span class="keyword">assert</span>(c != NULL);  
    c-&amp;gt;which = which;  
    <span class="comment">/* sanity */</span>  
    <span class="keyword">if</span> (fd != c-&amp;gt;sfd) {  
        <span class="keyword">if</span> (settings.verbose &amp;gt; <span class="number">0</span>)  
            fprintf(stderr, &amp;quot;Catastrophic: event fd doesn&amp;apos;t match conn fd!\n&amp;quot;);  
        conn_close(c);  
        <span class="keyword">return</span>;  
    }  
    <span class="comment">//&amp;#x6700;&amp;#x7EC8;&amp;#x8F6C;&amp;#x4EA4;&amp;#x7ED9;&amp;#x4E86;drive_machine&amp;#x8FD9;&amp;#x4E2A;&amp;#x65B9;&amp;#x6CD5;  </span>
    drive_machine(c);  
    <span class="comment">/* wait for next event */</span>  
    <span class="keyword">return</span>;  
}
</code></pre><p>drive_machine&#xFF1A;</p>
<p>drive_machine&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;c-&gt;state&#x6765;&#x5224;&#x65AD;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;&#x903B;&#x8F91;&#x3002;</p>
<p>conn_listening&#xFF1A;&#xFFFD;&#xFFFD;&#xFFFD;&#x542C;&#x72B6;&#x6001;</p>
<p>conn_waiting&#xFF1A;&#x7B49;&#x5F85;&#x72B6;&#x6001;</p>
<p>conn_read&#xFF1A;&#x8BFB;&#x53D6;&#x72B6;&#x6001;</p>
<p>conn_parse_cmd&#xFF1A;&#x547D;&#x4EE4;&#x884C;&#x89E3;&#x6790;</p>
<p>conn_mwrite&#xFF1A;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x5199;&#x6570;&#x636E;</p>
<p>conn_new_cmd&#xFF1A;&#x89E3;&#x6790;&#x65B0;&#x7684;&#x547D;&#x4EE4;</p>
<pre><code><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">drive_machine</span><span class="params">(conn *c)</span> </span>{  
    <span class="keyword">bool</span> stop = <span class="keyword">false</span>;  
    <span class="keyword">int</span> sfd;  
    <span class="keyword">socklen_t</span> addrlen;  
    <span class="keyword">struct</span> sockaddr_storage addr;  
    <span class="keyword">int</span> nreqs = settings.reqs_per_event;  
    <span class="keyword">int</span> res;  
    <span class="keyword">const</span> <span class="keyword">char</span> *str;  
    <span class="preprocessor">#ifdef HAVE_ACCEPT4  </span>
    <span class="keyword">static</span> <span class="keyword">int</span> use_accept4 = <span class="number">1</span>;  
    <span class="preprocessor">#<span class="keyword">else</span>  </span>
    <span class="keyword">static</span> <span class="keyword">int</span> use_accept4 = <span class="number">0</span>;  
    <span class="preprocessor">#<span class="keyword">endif</span>  </span>
    assert(c != NULL);  
    <span class="keyword">while</span> (!stop) {  
        <span class="keyword">switch</span> (c-&amp;gt;state) {  
        <span class="keyword">case</span> conn_listening:  
<span class="comment">//.......&amp;#x66F4;&amp;#x591A;&amp;#x4EE3;&amp;#x7801;  </span>
}
</code></pre><p>&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x770B;&#x4E00;&#x4E0B;conn_read&#x3001;conn_wait&#x548C;conn_parse_cmd&#x72B6;&#x6001;&#x7684;&#x4EE3;&#x7801;</p>
<pre><code>//&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x5F85</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x6765</span>;  
case <span class="method">conn_waiting:</span>  
    if (!update_event(c, <span class="class">EV_READ</span> | <span class="class">EV_PERSIST</span>)) {  
        if (settings.verbose &amp;gt; <span class="number">0</span>)  
            fprintf(stderr, &amp;quot;<span class="class">Couldn</span>&amp;apos;t update event\n&amp;quot;);  
        conn_set_state(c, conn_closing);  
        break;  
    }  
    //&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x5F85</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x7A0B</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5E76</span>;&amp;<span class="symbol">#x4E14</span>;stop&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x4E3A</span>;<span class="keyword">true</span>&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x9000</span>;&amp;<span class="symbol">#x51FA</span>;while(stop)&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5FAA</span>;&amp;<span class="symbol">#x73AF</span>;  
    conn_set_state(c, conn_read);  
    stop = <span class="keyword">true</span>;  
    break;  
    //&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x4E8B</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5F53</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x4E0A</span>;&amp;<span class="symbol">#x4F20</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x5019</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5C31</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x89E6</span>;&amp;<span class="symbol">#x53D1</span>;libevent&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x4E8B</span>;&amp;<span class="symbol">#x4EF6</span>;  
case <span class="method">conn_read:</span>  
    //try_read_network &amp;<span class="symbol">#x4E3B</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;<span class="class">TCP</span>&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
    //&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;try_read_result&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x679A</span>;&amp;<span class="symbol">#x4E3E</span>;&amp;<span class="symbol">#x7C7B</span>;&amp;<span class="symbol">#x578B</span>;&amp;<span class="symbol">#x7ED3</span>;&amp;<span class="symbol">#x6784</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x679A</span>;&amp;<span class="symbol">#x4E3E</span>;&amp;<span class="symbol">#x7C7B</span>;&amp;<span class="symbol">#x578B</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x5DF2</span>;&amp;<span class="symbol">#x7ECF</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5931</span>;&amp;<span class="symbol">#x8D25</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x60C5</span>;&amp;<span class="symbol">#x51B5</span>;  
    res = <span class="class">IS_UDP</span>(c-&amp;gt;transport) ? try_read_udp(c) : try_read_network(c);  
    switch (res) {  
    //&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x90A3</span>;&amp;<span class="symbol">#x4E48</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x4E8B</span>;&amp;<span class="symbol">#x4EF6</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x5F85</span>;&amp;<span class="symbol">#x3002</span>;  
    //while(stop)&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x5FAA</span>;&amp;<span class="symbol">#x73AF</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x53BB</span>;&amp;<span class="symbol">#x8C03</span>;&amp;<span class="symbol">#x7528</span>;conn_waiting&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;case  
    case <span class="class">READ_NO_DATA_RECEIVED</span>:  
        conn_set_state(c, conn_waiting);  
        break;  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x5019</span>;&amp;<span class="symbol">#x5C31</span>;&amp;<span class="symbol">#x9700</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x8C03</span>;&amp;<span class="symbol">#x7528</span>;conn_parse_cmd&amp;<span class="symbol">#x903B</span>;&amp;<span class="symbol">#x8F91</span>;  
        //conn_parse_cmd&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x4E3B</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
    case <span class="class">READ_DATA_RECEIVED</span>:  
        conn_set_state(c, conn_parse_cmd);  
        break;  
        //&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5931</span>;&amp;<span class="symbol">#x8D25</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x76F4</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x8C03</span>;&amp;<span class="symbol">#x7528</span>;conn_closing &amp;<span class="symbol">#x5173</span>;&amp;<span class="symbol">#x95ED</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;  
    case <span class="class">READ_ERROR</span>:  
        conn_set_state(c, conn_closing);  
        break;  
    case <span class="class">READ_MEMORY_ERROR</span>: /* <span class="class">Failed</span> to allocate more memory */  
        /* <span class="class">State</span> already set by try_read_network */  
        break;  
    }  
    break;  
    //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x4F8B</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#xFF1A</span>;set username zhuli  
case <span class="method">conn_parse_cmd:</span>  
    //try_read_command&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x5F88</span>;&amp;<span class="symbol">#x5173</span>;&amp;<span class="symbol">#x952E</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
    //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;&amp;<span class="symbol">#x4E3A</span>;<span class="number">0</span>&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x8868</span>;&amp;<span class="symbol">#x793A</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5931</span>;&amp;<span class="symbol">#x8D25</span>;&amp;<span class="symbol">#xFF08</span>;&amp;<span class="symbol">#x56E0</span>;&amp;<span class="symbol">#x4E3A</span>;<span class="class">TCP</span>&amp;<span class="symbol">#x7C98</span>;&amp;<span class="symbol">#x5305</span>;&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5305</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x539F</span>;&amp;<span class="symbol">#x56E0</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x80FD</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x5B8C</span>;&amp;<span class="symbol">#x6574</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x9700</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x5F85</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#xFF09</span>;  
    if (try_read_command(c) == <span class="number">0</span>) {  
        /* wee need more data! */  
        //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6CE8</span>;&amp;<span class="symbol">#x91CA</span>;&amp;<span class="symbol">#x8C8C</span>;&amp;<span class="symbol">#x4F3C</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x9519</span>;&amp;<span class="symbol">#x8BEF</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x5427</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5E94</span>;&amp;<span class="symbol">#x8BE5</span>;&amp;<span class="symbol">#x662F</span>;we need more data!  
        conn_set_state(c, conn_waiting);  
    }  
    break;
</code></pre><p>try_read_network</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x8BFB;&#x53D6;TCP&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x3002;&#x8BFB;&#x53D6;&#x5230;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x653E;&#x8FDB;c-&gt;rbuf&#x7684;buf&#x4E2D;&#x3002;</p>
<p>&#x5982;&#x679C;buf&#x6CA1;&#x6709;&#x7A7A;&#x95F4;&#x5B58;&#x50A8;&#x66F4;&#x591A;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x5185;&#x5B58;&#x5757;&#x7684;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x3002;&#x91CD;&#x65B0;&#x5206;&#x914D;&#xFF0C;memcached&#x9650;&#x5236;&#x4E86;4&#x6B21;&#xFF0C;&#x4F30;&#x8BA1;&#x662F;&#x62C5;&#x5FE7;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x800C;&#x5DF2;&#x653B;&#x51FB;&#x5BFC;&#x81F4;&#x5B58;&#x50A8;&#x547D;&#x4EE4;&#x884C;&#x6570;&#x636E;&#x62A5;&#x6587;&#x7684;buf&#x4E0D;&#x65AD;&#x7684;ralloc&#x3002;</p>
<pre><code>//&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x8FC7</span>;<span class="class">TCP</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x4F20</span>;&amp;<span class="symbol">#x9012</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
static enum try_read_result try_read_network(conn *c) {  
    //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x7EC8</span>;&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;try_read_result&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x679A</span>;&amp;<span class="symbol">#x4E3E</span>;&amp;<span class="symbol">#x7C7B</span>;&amp;<span class="symbol">#x578B</span>;  
    //&amp;<span class="symbol">#x9ED8</span>;&amp;<span class="symbol">#x8BA4</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;<span class="class">READ_NO_DATA_RECEIVED</span>&amp;<span class="symbol">#xFF1A</span>;&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x53D7</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
    enum try_read_result gotdata = <span class="class">READ_NO_DATA_RECEIVED</span>;  
    int res;  
    int num_allocs = <span class="number">0</span>;  
    assert(c != <span class="class">NULL</span>);  
    //c-&amp;gt;rcurr &amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x653E</span>;&amp;<span class="symbol">#x672A</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5BB9</span>;&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x9488</span>;   c-&amp;gt;rbytes &amp;<span class="symbol">#x8FD8</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x5C11</span>;&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
    //c-&amp;gt;rbuf &amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x4E8E</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x7684</span>;buf&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x50A8</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x4E32</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x9488</span>;  c-&amp;gt;rsize rbuf&amp;<span class="symbol">#x7684</span>;size  
        //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x6BCF</span>;&amp;<span class="symbol">#x6B21</span>;&amp;<span class="symbol">#x90FD</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x6B21</span>;&amp;<span class="symbol">#x5269</span>;&amp;<span class="symbol">#x4F59</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x79FB</span>;&amp;<span class="symbol">#x52A8</span>;&amp;<span class="symbol">#x5230</span>;c-&amp;gt;rbuf&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5934</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x3002</span>;  
        if (c-&amp;gt;rcurr != c-&amp;gt;rbuf) {  
        if (c-&amp;gt;rbytes != <span class="number">0</span>) /* otherwise there&amp;apos;s nothing to copy */  
            memmove(c-&amp;gt;rbuf, c-&amp;gt;rcurr, c-&amp;gt;rbytes);  
        c-&amp;gt;rcurr = c-&amp;gt;rbuf;  
    }  
    //&amp;<span class="symbol">#x5FAA</span>;&amp;<span class="symbol">#x73AF</span>;&amp;<span class="symbol">#x4ECE</span>;fd&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
    while (<span class="number">1</span>) {  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;buf&amp;<span class="symbol">#x6EE1</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x9700</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x66F4</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;  
        //&amp;<span class="symbol">#x5F53</span>;&amp;<span class="symbol">#x672A</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;size &amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x4E8E</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x4E8E</span>; buf&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x7684</span>;size&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x9700</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x914D</span>;  
        if (c-&amp;gt;rbytes &amp;gt;= c-&amp;gt;rsize) {  
            //&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x914D</span>;<span class="number">4</span>&amp;<span class="symbol">#x6B21</span>;  
            if (num_allocs == <span class="number">4</span>) {  
                return gotdata;  
            }  
            ++num_allocs;  
            //&amp;<span class="symbol">#x4ECE</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x5C0F</span>;&amp;<span class="symbol">#x4E3A</span>;rsize&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x4E24</span>;&amp;<span class="symbol">#x500D</span>;  
            char *new_rbuf = realloc(c-&amp;gt;rbuf, c-&amp;gt;rsize * <span class="number">2</span>);  
            if (!new_rbuf) {  
                <span class="class">STATS_LOCK</span>();  
                stats.malloc_fails++;  
                <span class="class">STATS_UNLOCK</span>();  
                if (settings.verbose &amp;gt; <span class="number">0</span>) {  
                    fprintf(stderr, &amp;quot;<span class="class">Couldn</span>&amp;apos;t realloc input buffer\n&amp;quot;);  
                }  
                c-&amp;gt;rbytes = <span class="number">0</span>; /* ignore what we read */  
                out_of_memory(c, &amp;quot;<span class="class">SERVER_ERROR</span> out of memory reading request&amp;quot;);  
                c-&amp;gt;write_and_go = conn_closing;  
                return <span class="class">READ_MEMORY_ERROR</span>;  
            }  
            //c-&amp;gt;rcurr&amp;<span class="symbol">#x548C</span>;c-&amp;gt;rbuf&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x7684</span>;buf&amp;<span class="symbol">#x5757</span>;  
            c-&amp;gt;rcurr = c-&amp;gt;rbuf = new_rbuf;  
            c-&amp;gt;rsize *= <span class="number">2</span>; //rsize&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x4E58</span>;&amp;<span class="symbol">#x4EE5</span>;<span class="number">2</span>  
        }  
        //avail&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x8BA1</span>;&amp;<span class="symbol">#x7B97</span>;&amp;<span class="symbol">#x51FA</span>;buf&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x5269</span>;&amp;<span class="symbol">#x4F59</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x7A7A</span>;&amp;<span class="symbol">#x95F4</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x5927</span>;  
        int avail = c-&amp;gt;rsize - c-&amp;gt;rbytes;  
        //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x770B</span>;&amp;<span class="symbol">#x5230</span>;<span class="class">Socket</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;  
        //c-&amp;gt;sfd&amp;<span class="symbol">#x4E3A</span>;<span class="class">Socket</span>&amp;<span class="symbol">#x7684</span>;<span class="class">ID</span>  
        //c-&amp;gt;rbuf + c-&amp;gt;rbytes &amp;<span class="symbol">#x610F</span>;&amp;<span class="symbol">#x601D</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x4ECE</span>;buf&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x7A7A</span>;&amp;<span class="symbol">#x4F59</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5730</span>;&amp;<span class="symbol">#x5740</span>;&amp;<span class="symbol">#x5F00</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x653E</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
        //avail &amp;<span class="symbol">#x6BCF</span>;&amp;<span class="symbol">#x6B21</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6536</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x80FD</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
        res = read(c-&amp;gt;sfd, c-&amp;gt;rbuf + c-&amp;gt;rbytes, avail);  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x53D7</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x7ED3</span>;&amp;<span class="symbol">#x679C</span>;res&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x4E8E</span>;<span class="number">0</span>&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x8BF4</span>;&amp;<span class="symbol">#x660E</span>;<span class="class">Socket</span>&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
        //&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x6210</span>;<span class="class">READ_DATA_RECEIVED</span>&amp;<span class="symbol">#x679A</span>;&amp;<span class="symbol">#x4E3E</span>;&amp;<span class="symbol">#x7C7B</span>;&amp;<span class="symbol">#x578B</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8868</span>;&amp;<span class="symbol">#x660E</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
        if (res &amp;gt; <span class="number">0</span>) {  
            pthread_mutex_lock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex); //&amp;<span class="symbol">#x7EBF</span>;&amp;<span class="symbol">#x7A0B</span>;&amp;<span class="symbol">#x9501</span>;  
            c-&amp;gt;thread-&amp;gt;stats.bytes_read += res;  
            pthread_mutex_unlock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex);  
            gotdata = <span class="class">READ_DATA_RECEIVED</span>;  
            c-&amp;gt;rbytes += res; //&amp;<span class="symbol">#x672A</span>;&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x91CF</span>; + &amp;<span class="symbol">#x5F53</span>;&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;size  
            if (res == avail) {  
                continue;  
            } else {  
                break;  
            }  
        }  
        //&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5931</span>;&amp;<span class="symbol">#x8D25</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x4E24</span>;&amp;<span class="symbol">#x79CD</span>;&amp;<span class="symbol">#x60C5</span>;&amp;<span class="symbol">#x51B5</span>;  
        if (res == <span class="number">0</span>) {  
            return <span class="class">READ_ERROR</span>;  
        }  
        if (res == -<span class="number">1</span>) {  
            if (errno == <span class="class">EAGAIN</span> || errno == <span class="class">EWOULDBLOCK</span>) {  
                break;  
            }  
            return <span class="class">READ_ERROR</span>;  
        }  
    }  
    return gotdata;  
}
</code></pre><p>try_read_command</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x8BFB;&#x53D6;rbuf&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x7684;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#x547D;&#x4EE4;&#xFF1A;set username zhuli\r\n get username \n</p>
<p>&#x5219;&#x4F1A;&#x901A;&#x8FC7;\n&#x8FD9;&#x4E2A;&#x6362;&#x884C;&#x7B26;&#x6765;&#x5206;&#x9694;&#x6570;&#x636E;&#x62A5;&#x6587;&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x62A5;&#x6587;&#x4F1A;&#x6709;&#x7C98;&#x5305;&#x548C;&#x62C6;&#x5305;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x6709;&#x7B49;&#x5230;&#x547D;&#x4EE4;&#x884C;&#x5B8C;&#x6574;&#x4E86;&#x624D;&#x80FD;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#x3002;&#x6240;&#x6709;&#x53EA;&#x6709;&#x5339;&#x914D;&#x5230;&#x4E86;\n&#x7B26;&#x53F7;&#xFF0C;&#x624D;&#x80FD;&#x5339;&#x914D;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x547D;&#x4EE4;&#x3002;</p>
<pre><code>//&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x5DF2</span>;&amp;<span class="symbol">#x7ECF</span>;&amp;<span class="symbol">#x5728</span>;c-&amp;gt;rbuf&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x5C31</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x8C03</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x6B64</span>;&amp;<span class="symbol">#x51FD</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;  
static int try_read_command(conn *c) {  
    assert(c != <span class="class">NULL</span>);  
    assert(c-&amp;gt;rcurr &amp;lt;= (c-&amp;gt;rbuf + c-&amp;gt;rsize)); //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x8A00</span>;  
    assert(c-&amp;gt;rbytes &amp;gt; <span class="number">0</span>);  
    if (c-&amp;gt;protocol == negotiating_prot || c-&amp;gt;transport == udp_transport) {  
        if ((unsigned char) c-&amp;gt;rbuf[<span class="number">0</span>] == (unsigned char) <span class="class">PROTOCOL_BINARY_REQ</span>) {  
            c-&amp;gt;protocol = binary_prot;  
        } else {  
            c-&amp;gt;protocol = ascii_prot;  
        }  
        if (settings.verbose &amp;gt; <span class="number">1</span>) {  
            fprintf(stderr, &amp;quot;%<span class="method">d:</span> <span class="class">Client</span> using the %s protocol\n&amp;quot;, c-&amp;gt;sfd,  
                    prot_text(c-&amp;gt;protocol));  
        }  
    }  
    //&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x4E24</span>;&amp;<span class="symbol">#x79CD</span>;&amp;<span class="symbol">#x6A21</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x4E8C</span>;&amp;<span class="symbol">#x8FDB</span>;&amp;<span class="symbol">#x5236</span>;&amp;<span class="symbol">#x6A21</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x8FD8</span>;&amp;<span class="symbol">#x662F</span>;ascii&amp;<span class="symbol">#x6A21</span>;&amp;<span class="symbol">#x5F0F</span>;  
    if (c-&amp;gt;protocol == binary_prot) {  
        //&amp;<span class="symbol">#x66F4</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x4EE3</span>;&amp;<span class="symbol">#x7801</span>;  
    } else {  
        //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x4E3B</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x975E</span>;&amp;<span class="symbol">#x4E8C</span>;&amp;<span class="symbol">#x8FDB</span>;&amp;<span class="symbol">#x5236</span>;&amp;<span class="symbol">#x6A21</span>;&amp;<span class="symbol">#x5F0F</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;  
        char *el, *cont;  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;c-&amp;gt;rbytes==<span class="number">0</span> &amp;<span class="symbol">#x8868</span>;&amp;<span class="symbol">#x793A</span>;buf&amp;<span class="symbol">#x5BB9</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;<span class="number">0</span>  
        //<span class="number">0</span> &amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x8BA9</span>;&amp;<span class="symbol">#x7A0B</span>;&amp;<span class="symbol">#x5E8F</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x5F85</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6536</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;  
        if (c-&amp;gt;rbytes == <span class="number">0</span>)  
            return <span class="number">0</span>;  
        //&amp;<span class="symbol">#x67E5</span>;&amp;<span class="symbol">#x627E</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x6709</span>;\n&amp;<span class="symbol">#xFF0C</span>;memcache&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x8FC7</span>;\n&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x5272</span>;  
        //&amp;<span class="symbol">#x5F53</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x5019</span>;&amp;<span class="symbol">#xFF0C</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x67E5</span>;&amp;<span class="symbol">#x627E</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6536</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x6709</span>;\n&amp;<span class="symbol">#x6362</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x6536</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x5305</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x5B8C</span>;&amp;<span class="symbol">#x6574</span>;  
        //&amp;<span class="symbol">#x4F8B</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#xFF1A</span>;set username <span class="number">10234344</span> \n get username \n  
        //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5C31</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x5272</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x4E24</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x522B</span>;&amp;<span class="symbol">#x662F</span>;set&amp;<span class="symbol">#x548C</span>;get&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
        //el&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;\n&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x9488</span>;&amp;<span class="symbol">#x5730</span>;&amp;<span class="symbol">#x5740</span>;  
        el = memchr(c-&amp;gt;rcurr, &amp;apos;\n&amp;apos;, c-&amp;gt;rbytes);  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x627E</span>;&amp;<span class="symbol">#x5230</span>;\n&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8BF4</span>;&amp;<span class="symbol">#x660E</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x5B8C</span>;&amp;<span class="symbol">#x6574</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;<span class="number">0</span>&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x5F85</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6536</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;  
        if (!el) {  
            //c-&amp;gt;rbytes&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6536</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x5305</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x5EA6</span>;  
            //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x975E</span>;&amp;<span class="symbol">#x5E38</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x8DA3</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x6B21</span>;&amp;<span class="symbol">#x63A5</span>;&amp;<span class="symbol">#x6536</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x62A5</span>;&amp;<span class="symbol">#x6587</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x4E8E</span>;&amp;<span class="symbol">#x4E86</span>;<span class="number">1</span>K&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x56DE</span>;&amp;<span class="symbol">#x53BB</span>;&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x8BF7</span>;&amp;<span class="symbol">#x6C42</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x592A</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x95EE</span>;&amp;<span class="symbol">#x9898</span>;&amp;<span class="symbol">#xFF1F</span>;  
            //&amp;<span class="symbol">#x7136</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x5173</span>;&amp;<span class="symbol">#x95ED</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x94FE</span>;&amp;<span class="symbol">#x63A5</span>;  
            if (c-&amp;gt;rbytes &amp;gt; <span class="number">1024</span>) {  
                /* 
                 * <span class="class">We</span> didn&amp;apos;t have a &amp;apos;\n&amp;apos; in the first k. <span class="class">This</span> _has_ to be a 
                 * large multiget, if not we should just nuke the connection. 
                 */  
                char *ptr = c-&amp;gt;rcurr;  
                while (*ptr == &amp;apos; &amp;apos;) { /* ignore leading whitespaces */  
                    ++ptr;  
                }  
                if (ptr - c-&amp;gt;rcurr &amp;gt; <span class="number">100</span>  
                        || (strncmp(ptr, &amp;quot;get &amp;quot;, <span class="number">4</span>) &amp;amp;&amp;amp; strncmp(ptr, &amp;quot;gets &amp;quot;, <span class="number">5</span>))) {  
                    conn_set_state(c, conn_closing);  
                    return <span class="number">1</span>;  
                }  
            }  
            return <span class="number">0</span>;  
        }  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x627E</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E86</span>;\n&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8BF4</span>;&amp;<span class="symbol">#x660E</span>;c-&amp;gt;rcurr&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x5B8C</span>;&amp;<span class="symbol">#x6574</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x4E86</span>;  
        cont = el + <span class="number">1</span>; //&amp;<span class="symbol">#x4E0B</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5F00</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x9488</span>;&amp;<span class="symbol">#x8282</span>;&amp;<span class="symbol">#x70B9</span>;  
        //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x662F</span>;\r\n,&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x662F</span>;\r\n&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;el&amp;<span class="symbol">#x5F80</span>;&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x79FB</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4F4D</span>;  
        if ((el - c-&amp;gt;rcurr) &amp;gt; <span class="number">1</span> &amp;amp;&amp;amp; *(el - <span class="number">1</span>) == &amp;apos;\r&amp;apos;) {  
            el--;  
        }  
        //&amp;<span class="symbol">#x7136</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x7528</span>; \<span class="number">0</span>&amp;<span class="symbol">#xFF08</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x4E32</span>;&amp;<span class="symbol">#x7ED3</span>;&amp;<span class="symbol">#x675F</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x53F7</span>;&amp;<span class="symbol">#xFF09</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x9694</span>;  
        *el = &amp;apos;\<span class="number">0</span>&amp;apos;;  
        assert(cont &amp;lt;= (c-&amp;gt;rcurr + c-&amp;gt;rbytes));  
        c-&amp;gt;last_cmd_time = current_time; //&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x95F4</span>;  
        //&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#xFF0C</span>;c-&amp;gt;rcurr&amp;<span class="symbol">#x5C31</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
        process_command(c, c-&amp;gt;rcurr);  
        c-&amp;gt;rbytes -= (cont - c-&amp;gt;rcurr); //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5730</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x4F55</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x6837</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#xFF1F</span>;c-&amp;gt;rbytes = c-&amp;gt;rcurr - cont  
        c-&amp;gt;rcurr = cont; //&amp;<span class="symbol">#x5C06</span>;c-&amp;gt;rcurr&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E0B</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x9488</span>;&amp;<span class="symbol">#x8282</span>;&amp;<span class="symbol">#x70B9</span>;  
        assert(c-&amp;gt;rcurr &amp;lt;= (c-&amp;gt;rbuf + c-&amp;gt;rsize));  
    }  
    return <span class="number">1</span>;  
}
</code></pre><p>process_command</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5904;&#x7406;&#x5177;&#x4F53;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x5C06;&#x547D;&#x4EE4;&#x5206;&#x89E3;&#x540E;&#xFF0C;&#x5206;&#x53D1;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x5177;&#x4F53;&#x64CD;&#x4F5C;&#x4E2D;&#x53BB;&#x3002;</p>
<pre><code>//&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x51FD</span>;&amp;<span class="symbol">#x6570</span>;  
//&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x627E</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E86</span>;rbuf&amp;<span class="symbol">#x4E2D</span>;\n&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x7136</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x5176</span>;&amp;<span class="symbol">#x66FF</span>;&amp;<span class="symbol">#x6362</span>;&amp;<span class="symbol">#x6210</span>;\<span class="number">0</span>  
static void process_command(conn *c, char *command) {  

    //tokens&amp;<span class="symbol">#x7ED3</span>;&amp;<span class="symbol">#x6784</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x5C06</span>;c-&amp;gt;rcurr&amp;<span class="symbol">#xFF08</span>;command&amp;<span class="symbol">#xFF09</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x6765</span>;  
    //&amp;<span class="symbol">#x5E76</span>;&amp;<span class="symbol">#x4E14</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x901A</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x7A7A</span>;&amp;<span class="symbol">#x683C</span>;&amp;<span class="symbol">#x7B26</span>;&amp;<span class="symbol">#x53F7</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x9694</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;  
    //&amp;<span class="symbol">#x4F8B</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#xFF1A</span>;set username zhuli,&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x6210</span>;<span class="number">3</span>&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x522B</span>;&amp;<span class="symbol">#x662F</span>;set&amp;<span class="symbol">#x548C</span>;username&amp;<span class="symbol">#x548C</span>;zhuli  
    //<span class="class">MAX_TOKENS</span>&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x503C</span>;&amp;<span class="symbol">#x4E3A</span>;<span class="number">8</span>&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8BF4</span>;&amp;<span class="symbol">#x660E</span>;memcached&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x6210</span>;<span class="number">8</span>&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;  
    token_t tokens[<span class="class">MAX_TOKENS</span>];  
    size_t ntokens;  
    int comm;  

    assert(c != <span class="class">NULL</span>);  

    <span class="class">MEMCACHED_PROCESS_COMMAND_START</span>(c-&amp;gt;sfd, c-&amp;gt;rcurr, c-&amp;gt;rbytes);  

    if (settings.verbose &amp;gt; <span class="number">1</span>)  
        fprintf(stderr, &amp;quot;&amp;lt;%d %s\n&amp;quot;, c-&amp;gt;sfd, command);  

    /* 
     * for commands set/add/replace, we build an item and read the data 
     * directly into it, then continue in nread_complete(). 
     */  

    c-&amp;gt;msgcurr = <span class="number">0</span>;  
    c-&amp;gt;msgused = <span class="number">0</span>;  
    c-&amp;gt;iovused = <span class="number">0</span>;  
    if (add_msghdr(c) != <span class="number">0</span>) {  
        out_of_memory(c, &amp;quot;<span class="class">SERVER_ERROR</span> out of memory preparing response&amp;quot;);  
        return;  
    }  

    //tokenize_command&amp;<span class="symbol">#x975E</span>;&amp;<span class="symbol">#x5E38</span>;&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x4E3B</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x5C31</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x7684</span>;  
    //&amp;<span class="symbol">#x5E76</span>;&amp;<span class="symbol">#x4E14</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;&amp;<span class="symbol">#x653E</span>;&amp;<span class="symbol">#x8FDB</span>;tokens&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x7EC4</span>;&amp;<span class="symbol">#x4E2D</span>;  
    //&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;:command&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
    ntokens = tokenize_command(command, tokens, <span class="class">MAX_TOKENS</span>);  

    //tokens[<span class="class">COMMAND_TOKEN</span>] <span class="class">COMMAND_TOKEN</span>=<span class="number">0</span>  
    //&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x7B2C</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x64CD</span>;&amp;<span class="symbol">#x4F5C</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;  
    if (ntokens &amp;gt;= <span class="number">3</span>  
            &amp;amp;&amp;amp; ((strcmp(tokens[<span class="class">COMMAND_TOKEN</span>].value, &amp;quot;get&amp;quot;) == <span class="number">0</span>)  
                    || (strcmp(tokens[<span class="class">COMMAND_TOKEN</span>].value, &amp;quot;bget&amp;quot;) == <span class="number">0</span>))) {  

        //&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;get&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
        process_get_command(c, tokens, ntokens, <span class="keyword">false</span>);  

    } else if ((ntokens == <span class="number">6</span> || ntokens == <span class="number">7</span>)  
            &amp;amp;&amp;amp; ((strcmp(tokens[<span class="class">COMMAND_TOKEN</span>].value, &amp;quot;add&amp;quot;) == <span class="number">0</span> &amp;amp;&amp;amp; (comm =  
                    <span class="class">NREAD_ADD</span>))  
                    || (strcmp(tokens[<span class="class">COMMAND_TOKEN</span>].value, &amp;quot;set&amp;quot;) == <span class="number">0</span>  
                            &amp;amp;&amp;amp; (comm = <span class="class">NREAD_SET</span>))  
                    || (strcmp(tokens[<span class="class">COMMAND_TOKEN</span>].value, &amp;quot;replace&amp;quot;) == <span class="number">0</span>  
                            &amp;amp;&amp;amp; (comm = <span class="class">NREAD_REPLACE</span>))  
                    || (strcmp(tokens[<span class="class">COMMAND_TOKEN</span>].value, &amp;quot;prepend&amp;quot;) == <span class="number">0</span>  
                            &amp;amp;&amp;amp; (comm = <span class="class">NREAD_PREPEND</span>))  
                    || (strcmp(tokens[<span class="class">COMMAND_TOKEN</span>].value, &amp;quot;append&amp;quot;) == <span class="number">0</span>  
                            &amp;amp;&amp;amp; (comm = <span class="class">NREAD_APPEND</span>)))) {  

        //&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#x66F4</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
        process_update_command(c, tokens, ntokens, comm, <span class="keyword">false</span>);  
//&amp;<span class="symbol">#x66F4</span>;&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x4EE3</span>;&amp;<span class="symbol">#x7801</span>;....  
}
</code></pre><p>tokenize_command&#xFF1A;</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5206;&#x89E3;&#x547D;&#x4EE4;&#x3002;&#x5177;&#x4F53;&#x662F;&#x5C06;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x8BED;&#x53E5;&#x5206;&#x89E3;&#x6210;&#x591A;&#x4E2A;&#x5143;&#x7D20;&#x3002;</p>
<p>&#x4F8B;&#x5982;:set username zhuli\n</p>
<p>&#x5219;&#x4F1A;&#x5206;&#x89E3;&#x6210;&#x4E09;&#x4E2A;&#x5143;&#x7D20;&#xFF1A;set&#x548C;username&#x548C;zhuli&#x8FD9;&#x4E09;&#x4E2A;&#x5143;&#x7D20;&#x3002;</p>
<pre><code>//&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;  
static size_t tokenize_command(char *command, token_t *tokens,  
        const size_t max_tokens) {  
    char *s, *e;  
    size_t ntokens = <span class="number">0</span>; //&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x6E38</span>;&amp;<span class="symbol">#x6807</span>;  
    size_t len = strlen(command); //&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x5EA6</span>;  
    unsigned int i = <span class="number">0</span>;  
    assert(command != <span class="class">NULL</span> &amp;amp;&amp;amp; tokens != <span class="class">NULL</span> &amp;amp;&amp;amp; max_tokens &amp;gt; <span class="number">1</span>);  
    s = e = command;  
    for (i = <span class="number">0</span>; i &amp;lt; len; i++) {  
        //&amp;<span class="symbol">#x6307</span>;&amp;<span class="symbol">#x9488</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x505C</span>;&amp;<span class="symbol">#x5F80</span>;&amp;<span class="symbol">#x524D</span>;&amp;<span class="symbol">#x8D70</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x9047</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x7A7A</span>;&amp;<span class="symbol">#x683C</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x505C</span>;&amp;<span class="symbol">#x4E0B</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;&amp;<span class="symbol">#x62C6</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x653E</span>;&amp;<span class="symbol">#x8FDB</span>;tokens&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x7EC4</span>;&amp;<span class="symbol">#x4E2D</span>;  
        if (*e == &amp;apos; &amp;apos;) {  
            if (s != e) {  
                tokens[ntokens].value = s;  
                tokens[ntokens].length = e - s;  
                ntokens++;  
                //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x7A7A</span>;&amp;<span class="symbol">#x683C</span>;&amp;<span class="symbol">#x66FF</span>;&amp;<span class="symbol">#x6362</span>;&amp;<span class="symbol">#x6210</span>;\<span class="number">0</span>  
                //<span class="class">Memcached</span>&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x4EE3</span>;&amp;<span class="symbol">#x7801</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x975E</span>;&amp;<span class="symbol">#x5E38</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x597D</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x8FDB</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x5207</span>;&amp;<span class="symbol">#x5272</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x65F6</span>;&amp;<span class="symbol">#x5019</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5E76</span>;&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x8FDB</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x62F7</span>;&amp;<span class="symbol">#x8D1D</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x800C</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5728</span>;&amp;<span class="symbol">#x539F</span>;&amp;<span class="symbol">#x6765</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x4E0A</span>;&amp;<span class="symbol">#x8FDB</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x5207</span>;&amp;<span class="symbol">#x5272</span>;  
                *e = &amp;apos;\<span class="number">0</span>&amp;apos;;  
                //&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x591A</span>;<span class="number">8</span>&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;  
                if (ntokens == max_tokens - <span class="number">1</span>) {  
                    e++;  
                    s = e; /* so we don&amp;apos;t add an extra token */  
                    break;  
                }  
            }  
            s = e + <span class="number">1</span>;  
        }  
        e++;  
    }  
    if (s != e) {  
        tokens[ntokens].value = s;  
        tokens[ntokens].length = e - s;  
        ntokens++;  
    }  
    /* 
     * <span class="class">If</span> we scanned the whole string, the terminal value pointer is null, 
     * otherwise it is the first unprocessed character. 
     */  
    tokens[ntokens].value = *e == &amp;apos;\<span class="number">0</span>&amp;apos; ? <span class="class">NULL</span> : e;  
    tokens[ntokens].length = <span class="number">0</span>;  
    ntokens++;  
    //&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;&amp;<span class="symbol">#x503C</span>;&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x4F8B</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x51FA</span>;<span class="number">3</span>&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;<span class="number">3</span>  
    return ntokens;  
}
</code></pre><p>process_get_command</p>
<p>get&#x7684;&#x547D;&#x4EE4;&#x4F8B;&#x5B50;&#x3002;get&#x8BF7;&#x6C42;&#x62FF;&#x5230;Memcached Item&#x4E2D;&#x7684;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x53C8;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;conn_mwrite&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x5C06;&#x8FDB;&#x5165;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x5199;&#x6570;&#x636E;&#x7684;&#x72B6;&#x6001;&#x3002;</p>
<pre><code>//&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;<span class="class">GET</span>&amp;<span class="symbol">#x8BF7</span>;&amp;<span class="symbol">#x6C42</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
static inline void process_get_command(conn *c, token_t *tokens, size_t ntokens,  
        bool return_cas) {  
    //&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;<span class="class">GET</span>&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
    char *key;  
    size_t nkey;  
    int i = <span class="number">0</span>;  
    item *it;  
    //&amp;amp;tokens[<span class="number">0</span>] &amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x64CD</span>;&amp;<span class="symbol">#x4F5C</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;  
    //&amp;amp;tokens[<span class="number">1</span>] &amp;<span class="symbol">#x4E3A</span>;key  
    //token_t &amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x50A8</span>;&amp;<span class="symbol">#x4E86</span>;value&amp;<span class="symbol">#x548C</span>;length  
    token_t *key_token = &amp;amp;tokens[<span class="class">KEY_TOKEN</span>];  
    char *suffix;  
    assert(c != <span class="class">NULL</span>);  
    do {  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;key&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x5EA6</span>;&amp;<span class="symbol">#x4E0D</span>;&amp;<span class="symbol">#x4E3A</span>;<span class="number">0</span>  
        while (key_token-&amp;gt;length != <span class="number">0</span>) {  
            key = key_token-&amp;gt;value;  
            nkey = key_token-&amp;gt;length;  
            //&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;key&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x5EA6</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x8D85</span>;&amp;<span class="symbol">#x8FC7</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x5EA6</span>;&amp;<span class="symbol">#xFF0C</span>;memcache key&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6700</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x5EA6</span>;&amp;<span class="symbol">#x4E3A</span>;<span class="number">250</span>  
            //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5730</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x9700</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x975E</span>;&amp;<span class="symbol">#x5E38</span>;&amp;<span class="symbol">#x6CE8</span>;&amp;<span class="symbol">#x610F</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x6211</span>;&amp;<span class="symbol">#x4EEC</span>;&amp;<span class="symbol">#x5728</span>;&amp;<span class="symbol">#x5E73</span>;&amp;<span class="symbol">#x5E38</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x4F7F</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8FD8</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x6CE8</span>;&amp;<span class="symbol">#x610F</span>;key&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5B57</span>;&amp;<span class="symbol">#x8282</span>;&amp;<span class="symbol">#x957F</span>;&amp;<span class="symbol">#x5EA6</span>;&amp;<span class="symbol">#x7684</span>;  
            if (nkey &amp;gt; <span class="class">KEY_MAX_LENGTH</span>) {  
                //out_string &amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5916</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x8F93</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
                out_string(c, &amp;quot;<span class="class">CLIENT_ERROR</span> bad command line format&amp;quot;);  
                while (i-- &amp;gt; <span class="number">0</span>) {  
                    item_remove(*(c-&amp;gt;ilist + i));  
                }  
                return;  
            }  
            //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x4ECE</span>;<span class="class">Memcached</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x50A8</span>;&amp;<span class="symbol">#x5FEB</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x53BB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
            it = item_get(key, nkey);  
            if (settings.detail_enabled) {  
                //&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#x8BB0</span>;&amp;<span class="symbol">#x5F55</span>;&amp;<span class="symbol">#xFF0C</span>;key&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8BB0</span>;&amp;<span class="symbol">#x5F55</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;  
                stats_prefix_record_get(key, nkey, <span class="class">NULL</span> != it);  
            }  
            //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x83B7</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
            if (it) {  
                //c-&amp;gt;ilist &amp;<span class="symbol">#x5B58</span>;&amp;<span class="symbol">#x653E</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x4E8E</span>;&amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5916</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x7684</span>;buf  
                //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;ilist&amp;<span class="symbol">#x592A</span>;&amp;<span class="symbol">#x5C0F</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x5206</span>;&amp;<span class="symbol">#x914D</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x5757</span>;&amp;<span class="symbol">#x5185</span>;&amp;<span class="symbol">#x5B58</span>;  
                if (i &amp;gt;= c-&amp;gt;isize) {  
                    item **new_list = realloc(c-&amp;gt;ilist,  
                            sizeof(item *) * c-&amp;gt;isize * <span class="number">2</span>);  
                    if (new_list) {  
                        c-&amp;gt;isize *= <span class="number">2</span>;  
                        c-&amp;gt;ilist = new_list;  
                    } else {  
                        <span class="class">STATS_LOCK</span>();  
                        stats.malloc_fails++;  
                        <span class="class">STATS_UNLOCK</span>();  
                        item_remove(it);  
                        break;  
                    }  
                }  
                /* 
                 * <span class="class">Construct</span> the response. <span class="class">Each</span> hit adds three elements to the 
                 * outgoing data <span class="method">list:</span> 
                 *   &amp;quot;<span class="class">VALUE</span> &amp;quot; 
                 *   key 
                 *   &amp;quot; &amp;quot; + flags + &amp;quot; &amp;quot; + data length + &amp;quot;\r\n&amp;quot; + data (with \r\n) 
                 */  
                //&amp;<span class="symbol">#x521D</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x5316</span>;&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;&amp;<span class="symbol">#x51FA</span>;&amp;<span class="symbol">#x53BB</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x7ED3</span>;&amp;<span class="symbol">#x6784</span>;  
                if (return_cas) {  
                    <span class="class">MEMCACHED_COMMAND_GET</span>(c-&amp;gt;sfd, <span class="class">ITEM_key</span>(it), it-&amp;gt;nkey,  
                            it-&amp;gt;nbytes, <span class="class">ITEM_get_cas</span>(it));  
                    /* <span class="class">Goofy</span> mid-flight realloc. */  
                    if (i &amp;gt;= c-&amp;gt;suffixsize) {  
                        char **new_suffix_list = realloc(c-&amp;gt;suffixlist,  
                                sizeof(char *) * c-&amp;gt;suffixsize * <span class="number">2</span>);  
                        if (new_suffix_list) {  
                            c-&amp;gt;suffixsize *= <span class="number">2</span>;  
                            c-&amp;gt;suffixlist = new_suffix_list;  
                        } else {  
                            <span class="class">STATS_LOCK</span>();  
                            stats.malloc_fails++;  
                            <span class="class">STATS_UNLOCK</span>();  
                            item_remove(it);  
                            break;  
                        }  
                    }  
                    suffix = cache_alloc(c-&amp;gt;thread-&amp;gt;suffix_cache);  
                    if (suffix == <span class="class">NULL</span>) {  
                        <span class="class">STATS_LOCK</span>();  
                        stats.malloc_fails++;  
                        <span class="class">STATS_UNLOCK</span>();  
                        out_of_memory(c,  
                                &amp;quot;<span class="class">SERVER_ERROR</span> out of memory making <span class="class">CAS</span> suffix&amp;quot;);  
                        item_remove(it);  
                        while (i-- &amp;gt; <span class="number">0</span>) {  
                            item_remove(*(c-&amp;gt;ilist + i));  
                        }  
                        return;  
                    }  
                    *(c-&amp;gt;suffixlist + i) = suffix;  
                    int suffix_len = snprintf(suffix, <span class="class">SUFFIX_SIZE</span>, &amp;quot; %llu\r\n&amp;quot;,  
                            (unsigned long long) <span class="class">ITEM_get_cas</span>(it));  
                    if (add_iov(c, &amp;quot;<span class="class">VALUE</span> &amp;quot;, <span class="number">6</span>) != <span class="number">0</span>  
                            || add_iov(c, <span class="class">ITEM_key</span>(it), it-&amp;gt;nkey) != <span class="number">0</span>  
                            || add_iov(c, <span class="class">ITEM_suffix</span>(it), it-&amp;gt;nsuffix - <span class="number">2</span>) != <span class="number">0</span>  
                            || add_iov(c, suffix, suffix_len) != <span class="number">0</span>  
                            || add_iov(c, <span class="class">ITEM_data</span>(it), it-&amp;gt;nbytes) != <span class="number">0</span>) {  
                        item_remove(it);  
                        break;  
                    }  
                } else {  
                    <span class="class">MEMCACHED_COMMAND_GET</span>(c-&amp;gt;sfd, <span class="class">ITEM_key</span>(it), it-&amp;gt;nkey,  
                            it-&amp;gt;nbytes, <span class="class">ITEM_get_cas</span>(it));  
                    if (add_iov(c, &amp;quot;<span class="class">VALUE</span> &amp;quot;, <span class="number">6</span>) != <span class="number">0</span>  
                            || add_iov(c, <span class="class">ITEM_key</span>(it), it-&amp;gt;nkey) != <span class="number">0</span>  
                            || add_iov(c, <span class="class">ITEM_suffix</span>(it),  
                                    it-&amp;gt;nsuffix + it-&amp;gt;nbytes) != <span class="number">0</span>) {  
                        item_remove(it);  
                        break;  
                    }  
                }  
                if (settings.verbose &amp;gt; <span class="number">1</span>) {  
                    int ii;  
                    fprintf(stderr, &amp;quot;&amp;gt;%d sending key &amp;quot;, c-&amp;gt;sfd);  
                    for (ii = <span class="number">0</span>; ii &amp;lt; it-&amp;gt;nkey; ++ii) {  
                        fprintf(stderr, &amp;quot;%c&amp;quot;, key[ii]);  
                    }  
                    fprintf(stderr, &amp;quot;\n&amp;quot;);  
                }  
                /* item_get() has incremented it-&amp;gt;refcount for us */  
                pthread_mutex_lock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex);  
                c-&amp;gt;thread-&amp;gt;stats.slab_stats[it-&amp;gt;slabs_clsid].get_hits++;  
                c-&amp;gt;thread-&amp;gt;stats.get_cmds++;  
                pthread_mutex_unlock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex);  
                item_update(it);  
                *(c-&amp;gt;ilist + i) = it;  
                i++;  
            } else {  
                pthread_mutex_lock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex);  
                c-&amp;gt;thread-&amp;gt;stats.get_misses++;  
                c-&amp;gt;thread-&amp;gt;stats.get_cmds++;  
                pthread_mutex_unlock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex);  
                <span class="class">MEMCACHED_COMMAND_GET</span>(c-&amp;gt;sfd, key, nkey, -<span class="number">1</span>, <span class="number">0</span>);  
            }  
            key_token++;  
        }  
        /* 
         * <span class="class">If</span> the command string hasn&amp;apos;t been fully processed, get the next set 
         * of tokens. 
         */  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x6CA1</span>;&amp;<span class="symbol">#x6709</span>;&amp;<span class="symbol">#x5168</span>;&amp;<span class="symbol">#x90E8</span>;&amp;<span class="symbol">#x88AB</span>;&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x4E0B</span>;&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
        //&amp;<span class="symbol">#x4E00</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x884C</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x53EF</span>;&amp;<span class="symbol">#x4EE5</span>;get&amp;<span class="symbol">#x591A</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x5143</span>;&amp;<span class="symbol">#x7D20</span>;  
        if (key_token-&amp;gt;value != <span class="class">NULL</span>) {  
            ntokens = tokenize_command(key_token-&amp;gt;value, tokens, <span class="class">MAX_TOKENS</span>);  
            key_token = tokens;  
        }  
    } while (key_token-&amp;gt;value != <span class="class">NULL</span>);  
    c-&amp;gt;icurr = c-&amp;gt;ilist;  
    c-&amp;gt;ileft = i;  
    if (return_cas) {  
        c-&amp;gt;suffixcurr = c-&amp;gt;suffixlist;  
        c-&amp;gt;suffixleft = i;  
    }  
    if (settings.verbose &amp;gt; <span class="number">1</span>)  
        fprintf(stderr, &amp;quot;&amp;gt;%d <span class="class">END</span>\n&amp;quot;, c-&amp;gt;sfd);  
    /* 
     <span class="class">If</span> the loop was terminated because of out-of-memory, it is not 
     reliable to add <span class="class">END</span>\r\n to the buffer, because it might not end 
     in \r\n. <span class="class">So</span> we send <span class="class">SERVER_ERROR</span> instead. 
     */  
    if (key_token-&amp;gt;value != <span class="class">NULL</span> || add_iov(c, &amp;quot;<span class="class">END</span>\r\n&amp;quot;, <span class="number">5</span>) != <span class="number">0</span>  
            || (<span class="class">IS_UDP</span>(c-&amp;gt;transport) &amp;amp;&amp;amp; build_udp_headers(c) != <span class="number">0</span>)) {  
        out_of_memory(c, &amp;quot;<span class="class">SERVER_ERROR</span> out of memory writing get response&amp;quot;);  
    } else {  
        //&amp;<span class="symbol">#x5C06</span>;&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#x4FEE</span>;&amp;<span class="symbol">#x6539</span>;&amp;<span class="symbol">#x4E3A</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x8BFB</span>;&amp;<span class="symbol">#x53D6</span>;&amp;<span class="symbol">#x5230</span>;item&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x540E</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x53C8</span>;&amp;<span class="symbol">#x5F00</span>;&amp;<span class="symbol">#x59CB</span>;&amp;<span class="symbol">#x9700</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x5F80</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#x3002</span>;  
        conn_set_state(c, conn_mwrite);  
        c-&amp;gt;msgcurr = <span class="number">0</span>;  
    }  
}
</code></pre><p>conn_mwrite&#x548C;transmit</p>
<p>&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x5199;&#x6570;&#x636E;&#x3002;&#x5199;&#x5B8C;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x5199;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF1B;&#x5982;&#x679C;&#x5199;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x4F1A;&#x5C06;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x6210;conn_new_cmd&#xFF0C;&#x7EE7;&#x7EED;&#x89E3;&#x6790;c-&gt;rbuf&#x4E2D;&#x5269;&#x4F59;&#x7684;&#x547D;&#x4EE4;</p>
<pre><code>//drive_machine&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;  
//&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;conn_mwrite&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;  
case <span class="method">conn_mwrite:</span>  
    if (<span class="class">IS_UDP</span>(c-&amp;gt;transport) &amp;amp;&amp;amp; c-&amp;gt;msgcurr == <span class="number">0</span>  
            &amp;amp;&amp;amp; build_udp_headers(c) != <span class="number">0</span>) {  
        if (settings.verbose &amp;gt; <span class="number">0</span>)  
            fprintf(stderr, &amp;quot;<span class="class">Failed</span> to build <span class="class">UDP</span> headers\n&amp;quot;);  
        conn_set_state(c, conn_closing);  
        break;  
    }  
    //transmit&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x975E</span>;&amp;<span class="symbol">#x5E38</span>;&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x4E3B</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x64CD</span>;&amp;<span class="symbol">#x4F5C</span>;&amp;<span class="symbol">#x90FD</span>;&amp;<span class="symbol">#x5728</span>;&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x8FDB</span>;&amp;<span class="symbol">#x884C</span>;  
    //&amp;<span class="symbol">#x8FD4</span>;&amp;<span class="symbol">#x56DE</span>;transmit_result&amp;<span class="symbol">#x679A</span>;&amp;<span class="symbol">#x4E3E</span>;&amp;<span class="symbol">#x7C7B</span>;&amp;<span class="symbol">#x578B</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x7528</span>;&amp;<span class="symbol">#x4E8E</span>;&amp;<span class="symbol">#x5224</span>;&amp;<span class="symbol">#x65AD</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x5426</span>;&amp;<span class="symbol">#x5199</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x529F</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x5931</span>;&amp;<span class="symbol">#x8D25</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x5173</span>;&amp;<span class="symbol">#x95ED</span>;&amp;<span class="symbol">#x8FDE</span>;&amp;<span class="symbol">#x63A5</span>;  
    switch (transmit(c)) {  
    //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x5411</span>;&amp;<span class="symbol">#x5BA2</span>;&amp;<span class="symbol">#x6237</span>;&amp;<span class="symbol">#x7AEF</span>;&amp;<span class="symbol">#x53D1</span>;&amp;<span class="symbol">#x9001</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x529F</span>;  
    case <span class="class">TRANSMIT_COMPLETE</span>:  
        if (c-&amp;gt;state == conn_mwrite) {  
            conn_release_items(c);  
            /* <span class="class">XXX</span>:  <span class="class">I</span> don&amp;apos;t know why this wasn&amp;apos;t the general case */  
            if (c-&amp;gt;protocol == binary_prot) {  
                conn_set_state(c, c-&amp;gt;write_and_go);  
            } else {  
                //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x8FB9</span>;&amp;<span class="symbol">#x662F</span>;<span class="class">TCP</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;  
                //&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;&amp;<span class="symbol">#x53C8</span>;&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x5207</span>;&amp;<span class="symbol">#x56DE</span>;&amp;<span class="symbol">#x5230</span>;conn_new_cmd&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x72B6</span>;&amp;<span class="symbol">#x6001</span>;  
                //conn_new_cmd&amp;<span class="symbol">#x4E3B</span>;&amp;<span class="symbol">#x8981</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;c-&amp;gt;rbuf&amp;<span class="symbol">#x5BB9</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x5269</span>;&amp;<span class="symbol">#x4F59</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x53C2</span>;&amp;<span class="symbol">#x6570</span>;  
                conn_set_state(c, conn_new_cmd);  
            }  
        } else if (c-&amp;gt;state == conn_write) {  
            if (c-&amp;gt;write_and_free) {  
                free(c-&amp;gt;write_and_free);  
                c-&amp;gt;write_and_free = <span class="number">0</span>;  
            }  
            conn_set_state(c, c-&amp;gt;write_and_go);  
        } else {  
            if (settings.verbose &amp;gt; <span class="number">0</span>)  
                fprintf(stderr, &amp;quot;<span class="class">Unexpected</span> state %d\n&amp;quot;, c-&amp;gt;state);  
            conn_set_state(c, conn_closing);  
        }  
        break;  
    case <span class="class">TRANSMIT_INCOMPLETE</span>:  
    case <span class="class">TRANSMIT_HARD_ERROR</span>:  
        break; /* <span class="class">Continue</span> in state machine. */  
    //&amp;<span class="symbol">#x5931</span>;&amp;<span class="symbol">#x8D25</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x60C5</span>;&amp;<span class="symbol">#x51B5</span>;  
    case <span class="class">TRANSMIT_SOFT_ERROR</span>:  
        stop = <span class="keyword">true</span>;  
        break;  
    }  
    break;
</code></pre><p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6570;&#x636E;&#x3002;</p>
<pre><code><span class="xml">//&amp;#x8FD9;&amp;#x4E2A;&amp;#x65B9;&amp;#x6CD5;&amp;#x4E3B;&amp;#x8981;&amp;#x5411;&amp;#x5BA2;&amp;#x6237;&amp;#x7AEF;&amp;#x5199;&amp;#x6570;&amp;#x636E;  
static enum transmit_result transmit(conn *c) </span><span class="expression">{  
    <span class="variable">assert</span>(<span class="variable">c</span> != <span class="variable">NULL</span>);  
    <span class="variable"><span class="keyword">if</span></span> (<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msgcurr</span> &amp;<span class="variable"><span class="keyword">lt</span></span>; <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msgused</span> &amp;<span class="variable">amp</span>;&amp;<span class="variable">amp</span>; <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msglist</span>[<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msgcurr</span>]<span class="variable">.msg</span>_<span class="variable">iovlen</span> == 0) {  
        /* <span class="variable">Finished</span> <span class="variable">writing</span> <span class="variable">the</span> <span class="variable">current</span> <span class="variable">msg</span>; <span class="variable">advance</span> <span class="variable">to</span> <span class="variable">the</span> <span class="variable">next.</span> *<span class="end-block">/  </span>
        <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msgcurr</span>++;  
    }</span><span class="xml">  
    if (c-&amp;gt;msgcurr &amp;lt; c-&amp;gt;msgused) </span><span class="expression">{  
        <span class="variable">ssize</span>_<span class="variable">t</span> <span class="variable">res</span>;  
        /<span class="end-block">/msghdr </span>&amp;<span class="begin-block">#x</span>53<span class="variable">D</span>1;&amp;<span class="begin-block">#x</span>9001;&amp;<span class="begin-block">#x</span>6570;&amp;<span class="begin-block">#x</span>636<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>7<span class="variable">ED</span>3;&amp;<span class="begin-block">#x</span>6784;  
        <span class="variable">struct</span> <span class="variable">msghdr</span> *<span class="variable">m</span> = &amp;<span class="variable">amp</span>;<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msglist</span>[<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msgcurr</span>];  
        /<span class="end-block">/sendmsg </span>&amp;<span class="begin-block">#x</span>53<span class="variable">D</span>1;&amp;<span class="begin-block">#x</span>9001;&amp;<span class="begin-block">#x</span>6570;&amp;<span class="begin-block">#x</span>636<span class="variable">E</span>;&amp;<span class="begin-block">#x</span>65<span class="variable">B</span>9;&amp;<span class="begin-block">#x</span>6<span class="variable">CD</span>5;  
        <span class="variable">res</span> = <span class="variable">sendmsg</span>(<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">sfd</span>, <span class="variable">m</span>, 0);  
        //&amp;<span class="begin-block">#x</span>53<span class="variable">D</span>1;&amp;<span class="begin-block">#x</span>9001;&amp;<span class="begin-block">#x</span>6210;&amp;<span class="begin-block">#x</span>529<span class="variable">F</span>;  
        <span class="variable"><span class="keyword">if</span></span> (<span class="variable">res</span> &amp;<span class="variable"><span class="keyword">gt</span></span>; 0) {  
            <span class="variable">pthread</span>_<span class="variable">mutex</span>_<span class="variable">lock</span>(&amp;<span class="variable">amp</span>;<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">thread-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">stats.mutex</span>);  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">thread-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">stats.bytes</span>_<span class="variable">written</span> += <span class="variable">res</span>;  
            <span class="variable">pthread</span>_<span class="variable">mutex</span>_<span class="variable">unlock</span>(&amp;<span class="variable">amp</span>;<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">thread-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">stats.mutex</span>);  
            /* <span class="variable">We</span>&amp;<span class="variable">apos</span>;<span class="variable">ve</span> <span class="variable">written</span> <span class="variable">some</span> <span class="variable">of</span> <span class="variable">the</span> <span class="variable">data.</span> <span class="variable">Remove</span> <span class="variable">the</span> <span class="variable">completed</span> 
             <span class="variable">iovec</span> <span class="variable">entries</span> <span class="variable">from</span> <span class="variable">the</span> <span class="variable">list</span> <span class="variable">of</span> <span class="variable">pending</span> <span class="variable">writes.</span> *<span class="end-block">/  </span>
            <span class="variable">while</span> (<span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iovlen</span> &amp;<span class="variable"><span class="keyword">gt</span></span>; 0 &amp;<span class="variable">amp</span>;&amp;<span class="variable">amp</span>; <span class="variable">res</span> &amp;<span class="variable"><span class="keyword">gt</span></span>;= <span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iov-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span>_<span class="variable">len</span>) {  
                <span class="variable">res</span> <span class="variable">-</span>= <span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iov-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span>_<span class="variable">len</span>;  
                <span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iovlen--</span>;  
                <span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iov</span>++;  
            }</span><span class="xml">  
            /* Might have written just part of the last iovec entry; 
             adjust it so the next write will do the rest. */  
            if (res &amp;gt; 0) </span><span class="expression">{  
                <span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iov-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span>_<span class="variable">base</span> = (<span class="variable">caddr</span>_<span class="variable">t</span>) <span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iov-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span>_<span class="variable">base</span> + <span class="variable">res</span>;  
                <span class="variable">m-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msg</span>_<span class="variable">iov-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span>_<span class="variable">len</span> <span class="variable">-</span>= <span class="variable">res</span>;  
            }</span><span class="xml">  
            return TRANSMIT_INCOMPLETE;  
        }  
        if (res == -1 &amp;amp;&amp;amp; (errno == EAGAIN || errno == EWOULDBLOCK)) </span><span class="expression">{  
            <span class="variable"><span class="keyword">if</span></span> (!<span class="variable">update</span>_<span class="variable">event</span>(<span class="variable">c</span>, <span class="variable">EV</span>_<span class="variable">WRITE</span> | <span class="variable">EV</span>_<span class="variable">PERSIST</span>)) {  
                <span class="variable"><span class="keyword">if</span></span> (<span class="variable">settings.verbose</span> &amp;<span class="variable"><span class="keyword">gt</span></span>; 0)  
                    <span class="variable">fprintf</span>(<span class="variable">stderr</span>, &amp;<span class="variable">quot</span>;<span class="variable">Couldn</span>&amp;<span class="variable">apos</span>;<span class="variable">t</span> <span class="variable">update</span> <span class="variable">event</span>\<span class="variable">n</span>&amp;<span class="variable">quot</span>;);  
                <span class="variable">conn</span>_<span class="variable">set</span>_<span class="variable">state</span>(<span class="variable">c</span>, <span class="variable">conn</span>_<span class="variable">closing</span>);  
                <span class="variable">return</span> <span class="variable">TRANSMIT</span>_<span class="variable">HARD</span>_<span class="variable">ERROR</span>;  
            }</span><span class="xml">  
            return TRANSMIT_SOFT_ERROR;  
        }  
        /* if res == 0 or res == -1 and error is not EAGAIN or EWOULDBLOCK, 
         we have a real error, on which we close the connection */  
        if (settings.verbose &amp;gt; 0)  
            perror(&amp;quot;Failed to write, and not due to blocking&amp;quot;);  
        if (IS_UDP(c-&amp;gt;transport))  
            conn_set_state(c, conn_read);  
        else  
            conn_set_state(c, conn_closing);  
        return TRANSMIT_HARD_ERROR;  
    } else </span><span class="expression">{  
        <span class="variable">return</span> <span class="variable">TRANSMIT</span>_<span class="variable">COMPLETE</span>;  
    }</span><span class="xml">  
}</span>
</code></pre><p>conn_new_cmd&#x548C;reset_cmd_handler</p>
<p>&#x7EE7;&#x7EED;&#x89E3;&#x6790;c-&gt;rbuf&#x4E2D;&#x5269;&#x4F59;&#x7684;&#x547D;&#x4EE4;&#x3002;</p>
<pre><code>//&amp;<span class="symbol">#x5904</span>;&amp;<span class="symbol">#x7406</span>;c-&amp;gt;rbuf&amp;<span class="symbol">#x4E2D</span>;&amp;<span class="symbol">#x5269</span>;&amp;<span class="symbol">#x4F59</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
case <span class="method">conn_new_cmd:</span>  
    /* <span class="class">Only</span> process nreqs at a time to avoid starving other 
     connections */  
    --nreqs;  
    if (nreqs &amp;gt;= <span class="number">0</span>) {  
        reset_cmd_handler(c); //&amp;<span class="symbol">#x4F1A</span>;&amp;<span class="symbol">#x8DF3</span>;&amp;<span class="symbol">#x8F6C</span>;&amp;<span class="symbol">#x5230</span>;reset_cmd_handler&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;  
    } else {  
        pthread_mutex_lock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex);  
        c-&amp;gt;thread-&amp;gt;stats.conn_yields++;  
        pthread_mutex_unlock(&amp;amp;c-&amp;gt;thread-&amp;gt;stats.mutex);  
        if (c-&amp;gt;rbytes &amp;gt; <span class="number">0</span>) {  
            /* <span class="class">We</span> have already read in data into the input buffer, 
             so libevent will most likely not signal read events 
             on the socket (unless more data is available. <span class="class">As</span> a 
             hack we should just put in a request to write data, 
             because that should be possible ;-) 
             */  
            if (!update_event(c, <span class="class">EV_WRITE</span> | <span class="class">EV_PERSIST</span>)) {  
                if (settings.verbose &amp;gt; <span class="number">0</span>)  
                    fprintf(stderr, &amp;quot;<span class="class">Couldn</span>&amp;apos;t update event\n&amp;quot;);  
                conn_set_state(c, conn_closing);  
                break;  
            }  
        }  
        stop = <span class="keyword">true</span>;  
    }  
    break;


//&amp;<span class="symbol">#x91CD</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x8BBE</span>;&amp;<span class="symbol">#x7F6E</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;handler  
static void reset_cmd_handler(conn *c) {  
    c-&amp;gt;cmd = -<span class="number">1</span>;  
    c-&amp;gt;substate = bin_no_state;  
    if (c-&amp;gt;item != <span class="class">NULL</span>) {  
        item_remove(c-&amp;gt;item);  
        c-&amp;gt;item = <span class="class">NULL</span>;  
    }  
    conn_shrink(c); //&amp;<span class="symbol">#x8FD9</span>;&amp;<span class="symbol">#x4E2A</span>;&amp;<span class="symbol">#x65B9</span>;&amp;<span class="symbol">#x6CD5</span>;&amp;<span class="symbol">#x662F</span>;&amp;<span class="symbol">#x68C0</span>;&amp;<span class="symbol">#x67E5</span>;c-&amp;gt;rbuf&amp;<span class="symbol">#x5BB9</span>;&amp;<span class="symbol">#x5668</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x5927</span>;&amp;<span class="symbol">#x5C0F</span>;  
    //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x5269</span>;&amp;<span class="symbol">#x4F59</span>;&amp;<span class="symbol">#x672A</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>; &amp;gt; <span class="number">0</span>&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x8BDD</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x8DF3</span>;&amp;<span class="symbol">#x8F6C</span>;&amp;<span class="symbol">#x5230</span>;conn_parse_cmd&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;  
    if (c-&amp;gt;rbytes &amp;gt; <span class="number">0</span>) {  
        conn_set_state(c, conn_parse_cmd);  
    } else {  
        //&amp;<span class="symbol">#x5982</span>;&amp;<span class="symbol">#x679C</span>;&amp;<span class="symbol">#x547D</span>;&amp;<span class="symbol">#x4EE4</span>;&amp;<span class="symbol">#x90FD</span>;&amp;<span class="symbol">#x89E3</span>;&amp;<span class="symbol">#x6790</span>;&amp;<span class="symbol">#x5B8C</span>;&amp;<span class="symbol">#x6210</span>;&amp;<span class="symbol">#x4E86</span>;&amp;<span class="symbol">#xFF0C</span>;&amp;<span class="symbol">#x5219</span>;&amp;<span class="symbol">#x7EE7</span>;&amp;<span class="symbol">#x7EED</span>;&amp;<span class="symbol">#x7B49</span>;&amp;<span class="symbol">#x5F85</span>;&amp;<span class="symbol">#x65B0</span>;&amp;<span class="symbol">#x7684</span>;&amp;<span class="symbol">#x6570</span>;&amp;<span class="symbol">#x636E</span>;&amp;<span class="symbol">#x5230</span>;&amp;<span class="symbol">#x6765</span>;  
        conn_set_state(c, conn_waiting);  
    }  
}
</code></pre><p>conn_shrink</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x68C0;&#x67E5;&#x547D;&#x4EE4;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<pre><code><span class="xml">//&amp;#x68C0;&amp;#x67E5;rbuf&amp;#x7684;&amp;#x5927;&amp;#x5C0F;  
static void conn_shrink(conn *c) </span><span class="expression">{  
    <span class="variable">assert</span>(<span class="variable">c</span> != <span class="variable">NULL</span>);  
    <span class="variable"><span class="keyword">if</span></span> (<span class="variable">IS</span>_<span class="variable">UDP</span>(<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">transport</span>))  
        <span class="variable">return</span>;  
    //&amp;<span class="begin-block">#x</span>5982;&amp;<span class="begin-block">#x</span>679<span class="variable">C</span>;<span class="variable">bufsize</span>&amp;<span class="begin-block">#x</span>5927;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>8<span class="variable">E</span>;<span class="variable">READ</span>_<span class="variable">BUFFER</span>_<span class="variable">HIGHWAT</span>&amp;<span class="begin-block">#xFF</span>08;8192&amp;<span class="begin-block">#xFF</span>09;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>65<span class="variable">F</span>6;&amp;<span class="begin-block">#x</span>5019;&amp;<span class="begin-block">#x</span>9700;&amp;<span class="begin-block">#x</span>8981;&amp;<span class="begin-block">#x</span>91<span class="variable">CD</span>;&amp;<span class="begin-block">#x</span>65<span class="variable">B</span>0;&amp;<span class="begin-block">#x</span>5904;&amp;<span class="begin-block">#x</span>7406;  
    /<span class="end-block">/DATA</span>_<span class="variable">BUFFER</span>_<span class="variable">SIZE</span>&amp;<span class="begin-block">#x</span>7<span class="variable">B</span>49;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>8<span class="variable">E</span>;2048&amp;<span class="begin-block">#xFF</span>0<span class="variable">C</span>;&amp;<span class="begin-block">#x</span>6240;&amp;<span class="begin-block">#x</span>4<span class="variable">EE</span>5;&amp;<span class="begin-block">#x</span>6211;&amp;<span class="begin-block">#x</span>4<span class="variable">EEC</span>;&amp;<span class="begin-block">#x</span>53<span class="variable">EF</span>;&amp;<span class="begin-block">#x</span>4<span class="variable">EE</span>5;&amp;<span class="begin-block">#x</span>770<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>5230;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>4<span class="variable">B</span>;&amp;<span class="begin-block">#x</span>524<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>7684;&amp;<span class="begin-block">#x</span>4<span class="variable">EE</span>3;&amp;<span class="begin-block">#x</span>7801;&amp;<span class="begin-block">#x</span>4<span class="variable">E</span>2<span class="variable">D</span>;&amp;<span class="begin-block">#x</span>5<span class="variable">BF</span>9;<span class="variable">rbuf</span>&amp;<span class="begin-block">#x</span>6700;&amp;<span class="begin-block">#x</span>591<span class="variable">A</span>;&amp;<span class="begin-block">#x</span>53<span class="variable">EA</span>;&amp;<span class="begin-block">#x</span>80<span class="variable">FD</span>;&amp;<span class="begin-block">#x</span>8<span class="variable">FDB</span>;&amp;<span class="begin-block">#x</span>884<span class="variable">C</span>;4&amp;<span class="begin-block">#x</span>6<span class="variable">B</span>21;<span class="variable">recalloc</span>  
    <span class="variable"><span class="keyword">if</span></span> (<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rsize</span> &amp;<span class="variable"><span class="keyword">gt</span></span>; <span class="variable">READ</span>_<span class="variable">BUFFER</span>_<span class="variable">HIGHWAT</span> &amp;<span class="variable">amp</span>;&amp;<span class="variable">amp</span>; <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rbytes</span> &amp;<span class="variable"><span class="keyword">lt</span></span>; <span class="variable">DATA</span>_<span class="variable">BUFFER</span>_<span class="variable">SIZE</span>) {  
        <span class="variable">char</span> *<span class="variable">newbuf</span>;  
        <span class="variable"><span class="keyword">if</span></span> (<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rcurr</span> != <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rbuf</span>)  
            <span class="variable">memmove</span>(<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rbuf</span>, <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rcurr</span>, (<span class="variable">size</span>_<span class="variable">t</span>) <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rbytes</span>); //&amp;<span class="begin-block">#x</span>5185;&amp;<span class="begin-block">#x</span>5<span class="variable">B</span>58;&amp;<span class="begin-block">#x</span>79<span class="variable">FB</span>;&amp;<span class="begin-block">#x</span>52<span class="variable">A</span>8;  
        <span class="variable">newbuf</span> = (<span class="variable">char</span> *) <span class="variable">realloc</span>((<span class="variable">void</span> *) <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rbuf</span>, <span class="variable">DATA</span>_<span class="variable">BUFFER</span>_<span class="variable">SIZE</span>);  
        <span class="variable"><span class="keyword">if</span></span> (<span class="variable">newbuf</span>) {  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rbuf</span> = <span class="variable">newbuf</span>;  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">rsize</span> = <span class="variable">DATA</span>_<span class="variable">BUFFER</span>_<span class="variable">SIZE</span>;  
        }</span><span class="xml">  
        /* TODO check other branch... */  
        c-&amp;gt;rcurr = c-&amp;gt;rbuf;  
    }  
    if (c-&amp;gt;isize &amp;gt; ITEM_LIST_HIGHWAT) </span><span class="expression">{  
        <span class="variable">item</span> **<span class="variable">newbuf</span> = (<span class="variable">item</span>**) <span class="variable">realloc</span>((<span class="variable">void</span> *) <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">ilist</span>,  
                <span class="variable">ITEM</span>_<span class="variable">LIST</span>_<span class="variable">INITIAL</span> * <span class="variable">sizeof</span>(<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">ilist</span>[0]));  
        <span class="variable"><span class="keyword">if</span></span> (<span class="variable">newbuf</span>) {  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">ilist</span> = <span class="variable">newbuf</span>;  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">isize</span> = <span class="variable">ITEM</span>_<span class="variable">LIST</span>_<span class="variable">INITIAL</span>;  
        }</span><span class="xml">  
        /* TODO check error condition? */  
    }  
    if (c-&amp;gt;msgsize &amp;gt; MSG_LIST_HIGHWAT) </span><span class="expression">{  
        <span class="variable">struct</span> <span class="variable">msghdr</span> *<span class="variable">newbuf</span> = (<span class="variable">struct</span> <span class="variable">msghdr</span> *) <span class="variable">realloc</span>((<span class="variable">void</span> *) <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msglist</span>,  
                <span class="variable">MSG</span>_<span class="variable">LIST</span>_<span class="variable">INITIAL</span> * <span class="variable">sizeof</span>(<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msglist</span>[0]));  
        <span class="variable"><span class="keyword">if</span></span> (<span class="variable">newbuf</span>) {  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msglist</span> = <span class="variable">newbuf</span>;  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">msgsize</span> = <span class="variable">MSG</span>_<span class="variable">LIST</span>_<span class="variable">INITIAL</span>;  
        }</span><span class="xml">  
        /* TODO check error condition? */  
    }  
    if (c-&amp;gt;iovsize &amp;gt; IOV_LIST_HIGHWAT) </span><span class="expression">{  
        <span class="variable">struct</span> <span class="variable">iovec</span> *<span class="variable">newbuf</span> = (<span class="variable">struct</span> <span class="variable">iovec</span> *) <span class="variable">realloc</span>((<span class="variable">void</span> *) <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span>,  
                <span class="variable">IOV</span>_<span class="variable">LIST</span>_<span class="variable">INITIAL</span> * <span class="variable">sizeof</span>(<span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span>[0]));  
        <span class="variable"><span class="keyword">if</span></span> (<span class="variable">newbuf</span>) {  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iov</span> = <span class="variable">newbuf</span>;  
            <span class="variable">c-</span>&amp;<span class="variable"><span class="keyword">gt</span></span>;<span class="variable">iovsize</span> = <span class="variable">IOV</span>_<span class="variable">LIST</span>_<span class="variable">INITIAL</span>;  
        }</span><span class="xml">  
        /* TODO check return value */  
    }  
}</span>
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<p> &#x524D;&#x8A00; </p>
<p>&#x4ECE;&#x6211;&#x4EEC;&#x4E0A;&#x4E00;&#x7AE0;&#x300A;Linux c &#x5F00;&#x53D1; - Memcached&#x6E90;&#x7801;&#x]]>
    </summary>
    
      <category term="Linux" scheme="http://taojinke.github.io/tags/Linux/"/>
    
      <category term="Memcached" scheme="http://taojinke.github.io/tags/Memcached/"/>
    
      <category term="源码分析" scheme="http://taojinke.github.io/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
      <category term="transcribe" scheme="http://taojinke.github.io/categories/transcribe/"/>
    
  </entry>
  
</feed>